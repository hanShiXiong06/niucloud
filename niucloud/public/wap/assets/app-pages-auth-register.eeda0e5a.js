import{d as e,a as l,s as r,x as a,r as o,y as t,q as s,t as i,L as n,N as u,E as p,b as d,o as m,c,w as x,j as f,e as b,B as g,C as _,f as h,Y as v,i as y,Z as k,A as w,D as C,a1 as j,a2 as V,H as F,$ as P,a0 as S,m as T,J as z,k as A,l as U,R as q,K as R,p as B,z as I,T as L}from"./index-5dd3a833.js";import{_ as E}from"./u-input.c864510e.js";import{_ as O,a as $}from"./u-form.8a5e7be8.js";import{_ as H}from"./u-icon.2d8c39b5.js";import{u as J,_ as K}from"./sms-code.vue_vue_type_script_setup_true_lang.7b18027f.js";import{_ as N}from"./u-checkbox.8fdcff45.js";import{_ as D}from"./u-checkbox-group.f4041679.js";import{_ as G}from"./uni-popup.15132c6d.js";import{t as Y}from"./topTabbar.bf25bba3.js";import{_ as Z}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-line.5e2da613.js";import"./u-modal.58ad5f0d.js";import"./u-loading-icon.63963092.js";import"./u-popup.b109731e.js";import"./u-transition.22a584d7.js";import"./u-safe-bottom.94dec507.js";const M=Z(e({__name:"register",setup(e){const Z=l();Y().setTopTabbarParam({title:"",topStatusBar:{bgColor:"#fff",textColor:"#333"}}),r(()=>Object.keys(Z.menuButtonInfo).length?L(Number(Z.menuButtonInfo.height))+L(Z.menuButtonInfo.top)+L(8)+"rpx":"auto");const M=a({username:"",password:"",confirm_password:"",mobile:"",mobile_code:"",mobile_key:"",captcha_key:"",captcha_code:""}),Q=o(),W=()=>{Q.value.close()},X=()=>{xe.value=!0,Q.value.close(),be()},ee=o(!0);t(()=>{setTimeout(()=>{ee.value=!1},800)});const le=o(!0),re=o(!0),ae=()=>{le.value=!le.value},oe=()=>{re.value=!re.value},te=s(),se=i(),ie=o("");n(async e=>{await se.getLoginConfig(),u()||se.login.is_username||se.login.is_mobile||se.login.is_bind_mobile||(p({title:"商家未开启普通账号注册",icon:"none"}),setTimeout(()=>{d({url:"/app/pages/index/index",mode:"reLaunch"})},100)),uni.getStorageSync("openid")&&Object.assign(M,{wx_openid:uni.getStorageSync("openid")}),uni.getStorageSync("pid")&&Object.assign(M,{pid:uni.getStorageSync("pid")}),se.login.is_username?pe.value="username":(se.login.is_mobile||se.login.is_bind_mobile)&&(pe.value="mobile"),ie.value=e.type});const ne=J(M);ne.refresh();const ue=o(!1),pe=o(""),de=()=>{xe.value=!xe.value},me=r(()=>{const e=[];return se.login.is_username&&e.push({type:"username",title:I("usernameRegister")}),se.login.is_mobile&&!se.login.is_bind_mobile&&e.push({type:"mobile",title:I("mobileRegister")}),e}),ce=r(()=>({username:[{type:"string",required:"username"==pe.value,message:I("usernamePlaceholder"),trigger:["blur","change"]},{validator:(e,l)=>!uni.$u.test.number(l),message:I("usernameTips"),trigger:["change","blur"]}],password:{type:"string",required:"username"==pe.value,message:I("passwordPlaceholder"),trigger:["blur","change"]},confirm_password:[{type:"string",required:"username"==pe.value,message:I("confirmPasswordPlaceholder"),trigger:["blur","change"]},{validator:(e,l)=>l==M.password,message:I("confirmPasswordError"),trigger:["change","blur"]}],mobile:[{type:"string",required:"mobile"==pe.value||se.login.is_bind_mobile,message:I("mobilePlaceholder"),trigger:["blur","change"]},{validator:(e,l)=>"mobile"!=pe.value&&!se.login.is_bind_mobile||uni.$u.test.mobile(l),message:I("mobileError"),trigger:["change","blur"]}],mobile_code:{type:"string",required:"mobile"==pe.value||se.login.is_bind_mobile,message:I("codePlaceholder"),trigger:["blur","change"]},captcha_code:{type:"string",required:"username"==pe.value,message:I("captchaPlaceholder"),trigger:["blur","change"]}})),xe=o(!1),fe=o(null),be=()=>{fe.value.validate().then(()=>{if(se.login.agreement_show&&!xe.value)return Q.value.open(),!1;if(ue.value)return;ue.value=!0;("username"==pe.value?j:V)(M).then(e=>{te.setToken(e.data.token),F().handleLoginBack()}).catch(()=>{ue.value=!1,ne.refresh()})})},ge=()=>{const e=P();if(e.length>1){"app/pages/auth/login"==e[e.length-2].route?S({delta:1}):d({url:"/app/pages/auth/login",mode:"redirectTo"})}else d({url:"/app/pages/auth/login",mode:"redirectTo"})};return(e,l)=>{const r=T,a=z,o=A(U("u-input"),E),t=A(U("u-form-item"),O),s=A(U("u-icon"),H),i=A(U("sms-code"),K),n=q,u=A(U("u-form"),$),p=R,j=A(U("u-checkbox"),N),V=A(U("u-checkbox-group"),D),F=A(U("uni-popup"),G),P=B("layout-default-uni");return m(),c(P,null,{default:x(()=>[pe.value?(m(),c(r,{key:0,class:"w-screen h-screen flex flex-col",style:f(e.themeColor())},{default:x(()=>[b(r,{class:"mx-[60rpx]"},{default:x(()=>[b(r,{class:"pt-[140rpx] text-[44rpx] font-500 text-[#333]"},{default:x(()=>[g(_("username"==pe.value?h(I)("usernameRegister"):h(I)("mobileRegister")),1)]),_:1}),b(r,{class:"flex items-center justify-between mt-[24rpx] mb-[90rpx]"},{default:x(()=>[b(r,{class:"text-[26rpx] text-[#333] leading-[34rpx]",onClick:ge},{default:x(()=>[b(a,null,{default:x(()=>[g(_(h(I)("haveAccount"))+",",1)]),_:1}),b(a,{class:"text-primary"},{default:x(()=>[g(_(h(I)("toLogin")),1)]),_:1})]),_:1})]),_:1}),b(u,{labelPosition:"left",model:M,errorType:"toast",rules:h(ce),ref_key:"formRef",ref:fe},{default:x(()=>["username"==pe.value?(m(),v(k,{key:0},[b(r,{class:"h-[88rpx] flex w-full items-center px-[30rpx] rounded-[40rpx] box-border bg-[#F6F6F6]"},{default:x(()=>[b(t,{label:"",prop:"username","border-bottom":!1},{default:x(()=>[b(o,{modelValue:M.username,"onUpdate:modelValue":l[0]||(l[0]=e=>M.username=e),border:"none",maxlength:"40",placeholder:h(I)("usernamePlaceholder"),class:"!bg-transparent",disabled:ee.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]"},null,8,["modelValue","placeholder","disabled"])]),_:1})]),_:1}),b(r,{class:"h-[88rpx] flex w-full items-center px-[30rpx] rounded-[40rpx] box-border bg-[#F6F6F6] mt-[40rpx]"},{default:x(()=>[b(t,{label:"",prop:"password","border-bottom":!1},{default:x(()=>[b(o,{modelValue:M.password,"onUpdate:modelValue":l[1]||(l[1]=e=>M.password=e),border:"none",password:le.value,maxlength:"40",placeholder:h(I)("passwordPlaceholder"),class:"!bg-transparent",disabled:ee.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]"},{suffix:x(()=>[M.password?(m(),c(r,{key:0,onClick:ae},{default:x(()=>[b(s,{name:le.value?"eye-off":"eye-fill",color:"#b9b9b9",size:"20"},null,8,["name"])]),_:1})):y("v-if",!0)]),_:1},8,["modelValue","password","placeholder","disabled"])]),_:1})]),_:1}),b(r,{class:"h-[88rpx] flex w-full items-center px-[30rpx] rounded-[40rpx] box-border bg-[#F6F6F6] mt-[40rpx]"},{default:x(()=>[b(t,{label:"",prop:"confirm_password","border-bottom":!1},{default:x(()=>[b(o,{modelValue:M.confirm_password,"onUpdate:modelValue":l[2]||(l[2]=e=>M.confirm_password=e),border:"none",password:re.value,maxlength:"40",placeholder:h(I)("confirmPasswordPlaceholder"),class:"!bg-transparent",disabled:ee.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]"},{suffix:x(()=>[M.confirm_password?(m(),c(r,{key:0,onClick:oe},{default:x(()=>[b(s,{name:re.value?"eye-off":"eye-fill",color:"#b9b9b9",size:"20"},null,8,["name"])]),_:1})):y("v-if",!0)]),_:1},8,["modelValue","password","placeholder","disabled"])]),_:1})]),_:1})],64)):y("v-if",!0),"mobile"==pe.value||h(se).login.is_bind_mobile?(m(),v(k,{key:1},[b(r,{class:"h-[88rpx] flex w-full items-center px-[30rpx] rounded-[40rpx] box-border bg-[#F6F6F6] mt-[40rpx]"},{default:x(()=>[b(t,{label:"",prop:"mobile","border-bottom":!1},{default:x(()=>[b(o,{modelValue:M.mobile,"onUpdate:modelValue":l[3]||(l[3]=e=>M.mobile=e),border:"none",maxlength:"11",placeholder:h(I)("mobilePlaceholder"),class:"!bg-transparent",disabled:ee.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]"},null,8,["modelValue","placeholder","disabled"])]),_:1})]),_:1}),b(r,{class:"h-[88rpx] flex w-full items-center px-[30rpx] rounded-[40rpx] box-border bg-[#F6F6F6] mt-[40rpx]"},{default:x(()=>[b(t,{label:"",prop:"mobile_code","border-bottom":!1},{default:x(()=>[b(o,{modelValue:M.mobile_code,"onUpdate:modelValue":l[6]||(l[6]=e=>M.mobile_code=e),border:"none",maxlength:"4",placeholder:h(I)("codePlaceholder"),class:"!bg-transparent",disabled:ee.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]"},{suffix:x(()=>[h(se).login.agreement_show?(m(),c(i,{key:0,mobile:M.mobile,type:"login",modelValue:M.mobile_key,"onUpdate:modelValue":l[4]||(l[4]=e=>M.mobile_key=e),isAgree:xe.value},null,8,["mobile","modelValue","isAgree"])):(m(),c(i,{key:1,mobile:M.mobile,type:"login",modelValue:M.mobile_key,"onUpdate:modelValue":l[5]||(l[5]=e=>M.mobile_key=e)},null,8,["mobile","modelValue"]))]),_:1},8,["modelValue","placeholder","disabled"])]),_:1})]),_:1})],64)):y("v-if",!0),"username"==pe.value?(m(),c(r,{key:2,class:"h-[88rpx] flex w-full items-center px-[30rpx] rounded-[40rpx] box-border bg-[#F6F6F6] mt-[40rpx]"},{default:x(()=>[b(t,{label:"",prop:"captcha_code","border-bottom":!1},{default:x(()=>[b(o,{modelValue:M.captcha_code,"onUpdate:modelValue":l[8]||(l[8]=e=>M.captcha_code=e),border:"none",placeholder:h(I)("captchaPlaceholder"),class:"!bg-transparent",disabled:ee.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]"},{suffix:x(()=>[b(n,{src:h(ne).image.value,class:"h-[48rpx] w-[60rpx] ml-[20rpx]",mode:"heightFix",onClick:l[7]||(l[7]=e=>h(ne).refresh())},null,8,["src"])]),_:1},8,["modelValue","placeholder","disabled"])]),_:1})]),_:1})):y("v-if",!0)]),_:1},8,["model","rules"]),b(r,{class:"mt-[140rpx]"},{default:x(()=>[b(p,{class:"w-full h-[80rpx] !bg-[var(--primary-color)] text-[26rpx] rounded-[40rpx] leading-[80rpx] font-500 !text-[#fff]",onClick:be},{default:x(()=>[g(_(h(I)("register")),1)]),_:1}),h(se).login.agreement_show?(m(),c(r,{key:0,class:"flex items-center mt-[10rpx] mb-[40rpx] py-[14rpx]",onClick:w(de,["stop"])},{default:x(()=>[b(V,{onChange:de},{default:x(()=>[b(j,{activeColor:"var(--primary-color)",checked:xe.value,shape:"circle",size:"24rpx"},null,8,["checked"])]),_:1}),b(r,{class:"text-[24rpx] -ml-[4rpx] text-[var(--text-color-light6)] flex items-center flex-wrap leading-[30rpx]"},{default:x(()=>[b(a,null,{default:x(()=>[g(_(h(I)("agreeTips")),1)]),_:1}),b(a,{onClick:l[9]||(l[9]=w(e=>h(d)({url:"/app/pages/auth/agreement?key=privacy"}),["stop"])),class:"text-primary"},{default:x(()=>[g("《"+_(h(I)("privacyAgreement"))+"》",1)]),_:1}),b(a,null,{default:x(()=>[g(_(h(I)("and")),1)]),_:1}),b(a,{onClick:l[10]||(l[10]=w(e=>h(d)({url:"/app/pages/auth/agreement?key=service"}),["stop"])),class:"text-primary"},{default:x(()=>[g("《"+_(h(I)("userAgreement"))+"》",1)]),_:1})]),_:1})]),_:1},8,["onClick"])):y("v-if",!0)]),_:1}),h(me).length>1?(m(),c(r,{key:0,class:C(["footer w-full",{"fixed bottom-0 left-0 right-0":"mobile"==pe.value,"pt-[60rpx]":"username"==pe.value}])},{default:x(()=>[b(r,{class:"text-[26rpx] leading-[36rpx] text-[#666] text-center mb-[30rpx] font-400"},{default:x(()=>[g("其他注册方式")]),_:1}),b(r,{class:"flex justify-center gap-[40rpx]"},{default:x(()=>["mobile"==pe.value&&h(se).login.is_mobile?(m(),c(a,{key:0,onClick:l[11]||(l[11]=e=>pe.value="username"),class:"w-[66rpx] h-[66rpx] flex items-center justify-center iconfont iconmima6Vmm border-[2rpx] rounded-[50%] border-solid border-[#ddd] !text-[26rpx]"})):y("v-if",!0),"username"==pe.value&&h(se).login.is_username?(m(),c(a,{key:1,onClick:l[12]||(l[12]=e=>pe.value="mobile"),class:"w-[66rpx] h-[66rpx] flex items-center justify-center iconfont iconshouji6Vmm border-[2rpx] rounded-[50%] border-solid border-[#ddd] !text-[26rpx]"})):y("v-if",!0)]),_:1})]),_:1},8,["class"])):y("v-if",!0)]),_:1}),b(F,{ref_key:"popupRef",ref:Q,type:"dialog"},{default:x(()=>[b(r,{class:"bg-[#fff] flex flex-col justify-between w-[600rpx] min-h-[280rpx] rounded-[var(--rounded-big)] box-border px-[35rpx] pt-[35rpx] pb-[8rpx] relative"},{default:x(()=>[b(r,{class:"flex justify-center"},{default:x(()=>[b(a,{class:"text-[33rpx] font-700"},{default:x(()=>[g(" 用户协议及隐私保护")]),_:1})]),_:1}),b(r,{class:"flex items-center mb-[20rpx] mt-[20rpx] py-[20rpx]",onClick:w(de,["stop"])},{default:x(()=>[b(r,{class:"text-[26rpx] text-[var(--text-color-light6)] flex items-center flex-wrap"},{default:x(()=>[b(a,null,{default:x(()=>[g(_(h(I)("agreeTips")),1)]),_:1}),b(a,{onClick:l[13]||(l[13]=w(e=>h(d)({url:"/app/pages/auth/agreement?key=privacy"}),["stop"])),class:"text-primary"},{default:x(()=>[g("《"+_(h(I)("privacyAgreement"))+"》",1)]),_:1}),b(a,null,{default:x(()=>[g(_(h(I)("and")),1)]),_:1}),b(a,{onClick:l[14]||(l[14]=w(e=>h(d)({url:"/app/pages/auth/agreement?key=service"}),["stop"])),class:"text-primary"},{default:x(()=>[g("《"+_(h(I)("userAgreement"))+"》",1)]),_:1})]),_:1})]),_:1},8,["onClick"]),b(r,null,{default:x(()=>[b(r,{class:"w-[100%] flex justify-center bg-[var(--primary-color)] h-[70rpx] leading-[70rpx] text-[#fff] text-[26rpx] border-[0] font-500 rounded-[50rpx]",onClick:X},{default:x(()=>[g("同意并注册")]),_:1}),b(r,{class:"w-[100%] flex justify-center h-[70rpx] leading-[70rpx] text-[#999] text-[24rpx] border-[0] font-500 rounded-[50rpx]",onClick:W},{default:x(()=>[g("不同意")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1},8,["style"])):y("v-if",!0)]),_:1})}}}),[["__scopeId","data-v-589e1c1a"]]);export{M as default};
