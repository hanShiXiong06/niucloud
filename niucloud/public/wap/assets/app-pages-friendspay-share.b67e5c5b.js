import{d as e,r as a,a as t,o as l,Y as s,i as r,e as o,w as u,A as i,j as n,c as p,f as d,B as f,Z as c,ap as m,as as _,S as v,R as x,m as g,J as y,K as h,k as b,l as w,u as k,q as F,s as j,L as P,O as T,at as O,au as S,V as C,n as U,W as I,C as B,ac as $,p as z,z as D,b as J}from"./index-0259f5df.js";import{_ as N}from"./u-avatar.bc708e92.js";import{_ as R}from"./u-image.b850c93a.js";import{_ as V}from"./loading-page.vue_vue_type_script_setup_true_lang.5a0da197.js";import{g as A,_ as L}from"./message.vue_vue_type_script_setup_true_lang.5143cd04.js";import{t as q}from"./topTabbar.6a4f0c22.js";import{_ as K}from"./u-popup.6f1fa414.js";import{_ as M}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.e993510c.js";import"./u-transition.9813ca7a.js";import"./u-loading-icon.d4562dd7.js";const W=M(e({__name:"share-poster",props:{posterId:{type:[String,Number],default:0},posterType:{type:String,default:""},posterParam:{type:Object,default:{}},copyUrl:{type:String,default:""},copyUrlParam:{type:String,default:""},isPreload:{type:Boolean,default:!0}},emits:["close"],setup(e,{expose:k,emit:F}){const j=e,P=a(!1),T=()=>{let e="";if(j.copyUrl){let a=location.pathname,t=["/app/","/addon/"];for(let e=0;e<t.length;e++)-1!=a.indexOf(t[e])&&(a=a.substr(0,a.indexOf(t[e])));e=location.origin+a+j.copyUrl+j.copyUrlParam}else e=location.origin+location.pathname+j.copyUrlParam;m(e,()=>{P.value=!1})},O=a(!1),S=a(!1),C=a(""),U=()=>{if(C.value&&j.isPreload)O.value=!1,S.value=!0;else{O.value=!0,S.value=!1;let e={id:j.posterId,type:j.posterType,param:j.posterParam},a=Date.parse(new Date);_(e).then(e=>{C.value=e.data&&v(e.data)||"";let t=Date.parse(new Date)-a;t<2200?setTimeout(()=>{O.value=!1,S.value=!0},2200-t):(O.value=!1,S.value=!0)}).catch(()=>{z()})}},I=a(!1),B=()=>{I.value=!1},$=a(0);t();const z=()=>{P.value=!1,O.value=!1,S.value=!1,F("close")};return k({openShare:()=>{P.value=!0,U()},loadPoster:U}),(e,a)=>{const t=x,m=g,_=y,k=h,F=b(w("u-popup"),K);return l(),s(c,null,[r(" 分享弹窗 "),o(m,{onTouchmove:a[2]||(a[2]=i(()=>{},["prevent","stop"])),class:"share-popup"},{default:u(()=>[o(F,{show:P.value,onClose:z,overlayOpacity:"0.8"},{default:u(()=>[o(m,{onTouchmove:a[0]||(a[0]=i(()=>{},["prevent","stop"]))},{default:u(()=>[o(m,{class:"poster-img-wrap",style:n({top:$.value})},{default:u(()=>[O.value?(l(),p(t,{key:0,class:"poster-animation",src:d(v)("addon/shop/poster_animation.gif"),mode:"aspectFit"},null,8,["src"])):r("v-if",!0),S.value?(l(),p(t,{key:1,class:"poster-img",src:d(v)(C.value),mode:"aspectFit","show-menu-by-longpress":!0},null,8,["src"])):r("v-if",!0)]),_:1},8,["style"]),o(m,{class:"share-content"},{default:u(()=>[o(m,{class:"share-box",onClick:T},{default:u(()=>[o(k,{class:"share-btn",plain:!0},{default:u(()=>[o(m,{class:"text-[#07c160] iconfont iconfuzhilianjie"}),o(_,null,{default:u(()=>[f("复制链接")]),_:1})]),_:1})]),_:1})]),_:1}),o(m,{class:"share-footer",onClick:z},{default:u(()=>[o(_,null,{default:u(()=>[f("取消分享")]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),o(F,{show:I.value,mode:"center",round:10,closeable:!0,onClose:a[1]||(a[1]=e=>I.value=!1),"safe-area-inset-bottom":!1},{default:u(()=>[o(m,{class:"dialog-popup"},{default:u(()=>[o(m,{class:"title"},{default:u(()=>[f("提示")]),_:1}),o(m,{class:"message"},{default:u(()=>[f("您拒绝了保存图片到相册的授权请求，无法保存图片到相册，如需正常使用，请授权之后再进行操作。")]),_:1}),o(m,{class:"action-wrap"},{default:u(()=>[o(m,{onClick:B},{default:u(()=>[f("取消")]),_:1}),o(m,null,{default:u(()=>[o(k,{type:"default",class:"authorization-btn","open-type":"openSetting",onOpensetting:B,"hover-class":"none"},{default:u(()=>[f("立即授权")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})],2112)}}}),[["__scopeId","data-v-cbccbfe1"]]),Y=M(e({__name:"share",setup(e){const t=q();t.setTopTabbarParam({title:""});const i=a(!0),m=a(!1),_=a(0),K=a(""),M=a({}),Y=a(!0),Z=a(null),{setShare:E}=k(),G=F(),H=j(()=>G.info);P(e=>{_.value=e.id||0,K.value=e.type||""}),T(()=>{_.value&&K.value&&Q(K.value,_.value)}),O(()=>{Z.value&&(clearTimeout(Z.value),Z.value=null)}),S(()=>{Z.value&&(clearTimeout(Z.value),Z.value=null)});const Q=(e,a)=>{Y.value&&(i.value=!0,Y.value=!1),A(e,a).then(l=>{M.value=l.data,i.value=!1,C({title:M.value.config.pay_page_name}),t.setTopTabbarParam({title:M.value.config.pay_page_name});let s="",r=location.pathname,o=["/app/","/addon/"];for(let e=0;e<o.length;e++)-1!=r.indexOf(o[e])&&(r=r.substr(0,r.indexOf(o[e])));s=location.origin+r+`/app/pages/friendspay/money?id=${M.value.trade_id}&type=${M.value.trade_type}`;let u={desc:M.value.config.pay_leave_message,path:`/app/pages/friendspay/money?id=${M.value.trade_id}&type=${M.value.trade_type}`,link:s};if(M.value.member){let e=M.value.member.nickname;e=e.length>15?e=e.substring(0,15)+"...":e,u.title=`${e}希望你帮他付${M.value.money}元`}"[]"!==JSON.stringify(M.value.trade_info)&&M.value.trade_info.item_list.length?u.url=M.value.trade_info.item_list[0].item_image?M.value.trade_info.item_list[0].item_image:M.value.config.pay_wechat_share_image:u.url=M.value.config.pay_wechat_share_image,E({wechat:{...u},weapp:{...u},isStop:!0}),re(),U(()=>{setTimeout(()=>{ae.value&&(se.id=M.value.trade_id,se.type=M.value.trade_type,H.value&&H.value.member_id&&(se.member_id=H.value.member_id),ae.value.loadPoster())},400)}),2!=M.value.status&&1!=M.value.status&&-1!=M.value.status?Z.value=setTimeout(()=>{Q(e,a)},3e3):(clearTimeout(Z.value),Z.value=null)}).catch(e=>{Z.value&&(clearTimeout(Z.value),Z.value=null),i.value=!1;I({title:"未找到帮付订单信息",url:"/app/pages/index/index",mode:"reLaunch"})})},X=a(null),ee=()=>{X.value.open(M.value.config)},ae=a(null),te=a("/app/pages/friendspay/money"),le=a("");let se={};const re=()=>{le.value="?id="+M.value.trade_id,le.value+="&type="+M.value.trade_type},oe=()=>{se.id=M.value.trade_id,se.type=M.value.trade_type,H.value&&H.value.member_id&&(se.member_id=H.value.member_id),ae.value.openShare()};return(e,a)=>{const t=b(w("u-avatar"),N),_=y,k=g,F=h,j=x,P=b(w("up-image"),R),T=b(w("loading-page"),V),O=z("layout-default-uni");return l(),p(O,null,{default:u(()=>[o(k,{style:n(e.themeColor())},{default:u(()=>[Object.keys(M.value).length&&!i.value?(l(),p(k,{key:0,class:"bg-[var(--page-bg-color)] min-h-screen overflow-hidden"},{default:u(()=>[o(k,{style:n({background:"url("+d(v)("static/resource/images/app/friendpay_bg.png")+") left bottom /100% no-repeat"}),class:"pb-[168rpx] overflow-hidden"},{default:u(()=>[o(k,{class:"mt-[20rpx] flex flex-col items-center"},{default:u(()=>[o(t,{src:d(v)(M.value.member.headimg),size:"50",leftIcon:"none","default-url":d(v)("static/resource/images/default_headimg.png")},null,8,["src","default-url"]),o(k,{class:"flex items-center mt-[20rpx] text-[#fff] text-[26rpx] leading-[36rpx]"},{default:u(()=>[o(_,{class:"font-bold mr-[10rpx] max-w-[250rpx] truncate"},{default:u(()=>[f(B(M.value.member.nickname),1)]),_:1}),o(_,null,{default:u(()=>[f("发起了订单帮付请求~")]),_:1})]),_:1})]),_:1})]),_:1},8,["style"]),o(k,{class:"mt-[-128rpx] card-template sidebar-margin mb-[var(--top-m)]"},{default:u(()=>[o(k,{class:"text-[24rpx] text-center text-[#333] mb-[10rpx]"},{default:u(()=>[f(B(d(D)("payMoney")),1)]),_:1}),o(k,{class:"text-center mb-[50rpx]"},{default:u(()=>[o(_,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:u(()=>[f("￥")]),_:1}),o(_,{class:"text-[56rpx] font-bold price-font text-[#FF4142]"},{default:u(()=>[f(B(parseFloat(M.value.money).toFixed(2).split(".")[0]),1)]),_:1}),o(_,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:u(()=>[f("."+B(parseFloat(M.value.money).toFixed(2).split(".")[1]),1)]),_:1})]),_:1}),o(k,{class:"px-[20rpx] box-border"},{default:u(()=>[2==M.value.status?(l(),p(F,{key:0,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:u(()=>[f(B(d(D)("finish")),1)]),_:1})):-1==M.value.status?(l(),p(F,{key:1,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:u(()=>[f(B(d(D)("close")),1)]),_:1})):(l(),p(F,{key:2,class:"button-color !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none",loading:m.value,onClick:oe},{default:u(()=>[f(B(M.value.config.pay_type_name?M.value.config.pay_type_name:d(D)("friendPay")),1)]),_:1},8,["loading"]))]),_:1}),2==M.value.status&&"[]"!==JSON.stringify(M.value.trade_info)&&M.value.trade_info.detail_url?(l(),p(k,{key:0,class:"mt-[20rpx] flex items-baseline justify-center text-[var(--text-color-light9)]",onClick:a[0]||(a[0]=e=>d(J)({url:M.value.trade_info.detail_url}))},{default:u(()=>[o(_,{class:"text-[24rpx] mr-[6rpx]"},{default:u(()=>[f("查看订单")]),_:1}),o(_,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx]"})]),_:1})):r("v-if",!0)]),_:1}),o(k,{class:"card-template sidebar-margin mb-[var(--top-m)]"},{default:u(()=>[o(k,{class:"flex justify-between items-center mb-[30rpx]"},{default:u(()=>[o(k,{class:"text-[30rpx] text-[#333] font-500"},{default:u(()=>[f(B(d(D)("friendPayOrderInfo")),1)]),_:1}),M.value.config.pay_explain_switch?(l(),p(k,{key:0,class:"text-[#666] leading-[1]",onClick:ee},{default:u(()=>[o(_,{class:"mr-[8rpx] text-[24rpx]"},{default:u(()=>[f(B(M.value.config.pay_explain_title),1)]),_:1}),o(_,{class:"nc-iconfont nc-icon-jichuxinxiV6xx text-[26rpx]"})]),_:1})):r("v-if",!0)]),_:1}),"[]"!==JSON.stringify(M.value.trade_info)?(l(),s(c,{key:0},[M.value.trade_info.item_list.length?(l(),s(c,{key:0},[o(k,{class:"border-0 border-solid border-b-[1rpx] border-[#f6f6f6] mb-[20rpx]"},{default:u(()=>[(l(!0),s(c,null,$(M.value.trade_info.item_list,(e,a)=>(l(),p(k,{class:"flex justify-between mb-[30rpx]"},{default:u(()=>[o(k,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden flex-shrink-0"},{default:u(()=>[o(P,{class:"overflow-hidden",radius:"var(--goods-rounded-big)",width:"170rpx",height:"170rpx",src:d(v)(e.item_image?e.item_image:""),model:"aspectFill"},{error:u(()=>[o(j,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden",src:d(v)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])]),_:2},1032,["src"])]),_:2},1024),o(k,{class:"ml-[20rpx] flex flex-1 flex-col justify-between"},{default:u(()=>[o(k,null,{default:u(()=>[o(k,{class:"text-[28rpx] using-hidden leading-[40rpx] text-[#333]"},{default:u(()=>[f(B(e.item_name),1)]),_:2},1024),e.item_sub_name?(l(),p(k,{key:0,class:"text-[24rpx] mt-[14rpx] text-[var(--text-color-light9)] using-hidden leading-[28rpx]"},{default:u(()=>[f(B(e.item_sub_name),1)]),_:2},1024)):r("v-if",!0)]),_:2},1024),o(k,{class:"flex justify-between items-baseline"},{default:u(()=>[o(k,{class:"price-font text-[#FF4142]"},{default:u(()=>[o(_,{class:"text-[24rpx]"},{default:u(()=>[f("￥")]),_:1}),o(_,{class:"text-[40rpx] font-500"},{default:u(()=>[f(B(parseFloat(e.item_price).toFixed(2).split(".")[0]),1)]),_:2},1024),o(_,{class:"text-[24rpx] font-500"},{default:u(()=>[f("."+B(parseFloat(e.item_price).toFixed(2).split(".")[1]),1)]),_:2},1024)]),_:2},1024),o(_,{class:"text-right text-[26rpx]"},{default:u(()=>[f("x"+B(e.item_num),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1}),o(k,{class:"text-[26rpx] text-right"},{default:u(()=>[f(B(M.value.trade_info.item_total),1)]),_:1})],64)):r("v-if",!0)],64)):(l(),p(k,{key:1,class:"text-[28rpx] leading-[40rpx] text-[#333]"},{default:u(()=>[f(B(M.value.body),1)]),_:1}))]),_:1}),o(W,{ref_key:"sharePosterRef",ref:ae,posterType:"friendspay",posterId:M.value.poster_id,posterParam:d(se),copyUrl:te.value,copyUrlParam:le.value},null,8,["posterId","posterParam","copyUrl","copyUrlParam"]),r(" 帮付说明 "),o(L,{ref_key:"messageRef",ref:X},null,512)]),_:1})):r("v-if",!0),o(T,{loading:i.value},null,8,["loading"])]),_:1},8,["style"])]),_:1})}}}),[["__scopeId","data-v-e237eb50"]]);export{Y as default};
