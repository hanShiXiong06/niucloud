import{bO as t,E as s,a0 as e,aA as a,o,c as r,w as n,p as l,e as i,i as c,B as u,Y as d,a9 as f,Z as h,J as m,m as p,au as g,R as _,k as C,l as y,D as S,C as v,A as k,K as L}from"./index-5dd3a833.js";import{_ as M}from"./u-modal.58ad5f0d.js";import{b as x,c as w,d as b,f as j}from"./return_order.52a39582.js";import{_ as O}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-line.5e2da613.js";import"./u-loading-icon.63963092.js";import"./u-popup.b109731e.js";import"./u-transition.22a584d7.js";import"./u-icon.2d8c39b5.js";import"./u-safe-bottom.94dec507.js";const R=O({components:{},data:()=>({statusList:[],currentStatus:-1,scrollLeft:0,orderList:[],page:1,limit:10,hasMore:!0,loadMoreStatus:"more",contentText:{contentdown:"上拉加载更多",contentrefresh:"加载中...",contentnomore:"没有更多数据了"},statusCount:{all:0,pending:0,returning:0,completed:0,cancelled:0},confirmOrderId:0,showConfirmModal:!1}),onLoad(){this.statusList=x(),this.getStatusCount(),this.getOrderList(!0)},onPullDownRefresh(){this.page=1,this.hasMore=!0,this.loadMoreStatus="more",this.getStatusCount(),this.getOrderList(!0,()=>{t()})},onReachBottom(){this.hasMore&&(this.loadMoreStatus="loading",this.page++,this.getOrderList())},methods:{async getOrderList(t=!1,e){t&&(this.page=1,this.orderList=[]);try{const e={page:this.page,limit:this.limit};-1!==this.currentStatus&&(e.status=this.currentStatus);const a=await w(e);if(200===a.data.code){const{list:s,count:e}=a.data.data;this.orderList=t?s:[...this.orderList,...s],this.hasMore=this.orderList.length<e,this.loadMoreStatus=this.hasMore?"more":"noMore"}else s({title:a.data.message||"获取订单列表失败",icon:"none"})}catch(a){console.error(a),s({title:"获取订单列表失败",icon:"none"})}finally{"function"==typeof e&&e()}},async getStatusCount(){try{const t=await b();200===t.data.code&&(this.statusCount=t.data.data)}catch(t){console.error(t)}},goBack(){e()},goToDetail(t){a({url:`/addon/recycle/pages/return-order/detail?id=${t}`})},handleStatusChange(t){this.currentStatus!==t&&(this.currentStatus=t,this.page=1,this.hasMore=!0,this.loadMoreStatus="more",this.getOrderList(!0))},getStatusText:t=>({0:"待处理",1:"退货中",2:"已完成",3:"已取消"}[t]||"未知状态"),getStatusCountKey:t=>({"-1":"all",0:"pending",1:"returning",2:"completed",3:"cancelled"}[t]||"all"),handleConfirmReceive(t){this.confirmOrderId=t,this.showConfirmModal=!0},closeConfirmPopup(){this.showConfirmModal=!1},async confirmReceive(){this.showConfirmModal=!1;try{const t=await j(this.confirmOrderId,{});200===t.data.code?(s({title:"确认收货成功",icon:"success"}),this.getStatusCount(),this.getOrderList(!0)):s({title:t.data.message||"确认收货失败",icon:"none"})}catch(t){console.error(t),s({title:"确认收货失败",icon:"none"})}}}},[["render",function(t,s,e,a,x,w){const b=m,j=p,O=g,R=L,D=_,T=l("uni-load-more"),K=C(y("up-modal"),M),B=l("layout-default-uni");return o(),r(B,null,{default:n(()=>[i(j,{class:"return-order-list"},{default:n(()=>[c(" 顶部导航栏 "),i(j,{class:"nav-bar"},{default:n(()=>[i(j,{class:"nav-back",onClick:w.goBack},{default:n(()=>[i(b,{class:"iconfont iconarrow-left"})]),_:1},8,["onClick"]),i(j,{class:"nav-title"},{default:n(()=>[u("退回订单")]),_:1})]),_:1}),c(" 状态筛选 "),i(O,{"scroll-x":"",class:"status-scroll","scroll-left":x.scrollLeft},{default:n(()=>[i(j,{class:"status-tabs"},{default:n(()=>[(o(!0),d(h,null,f(x.statusList,(t,s)=>(o(),r(j,{key:s,class:S(["status-tab",{active:x.currentStatus===t.value}]),onClick:s=>w.handleStatusChange(t.value)},{default:n(()=>[i(b,null,{default:n(()=>[u(v(t.text),1)]),_:2},1024),x.statusCount[w.getStatusCountKey(t.value)]?(o(),r(b,{key:0,class:"status-count"},{default:n(()=>[u(v(x.statusCount[w.getStatusCountKey(t.value)]),1)]),_:2},1024)):c("v-if",!0)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1},8,["scroll-left"]),c(" 订单列表 "),x.orderList.length>0?(o(),r(j,{key:0,class:"order-list"},{default:n(()=>[(o(!0),d(h,null,f(x.orderList,(t,s)=>(o(),r(j,{class:"order-item",key:s,onClick:s=>w.goToDetail(t.id)},{default:n(()=>[i(j,{class:"order-header"},{default:n(()=>[i(j,{class:"order-no"},{default:n(()=>[u("订单编号："+v(t.order_no),1)]),_:2},1024),i(j,{class:S(["order-status","status-"+t.status])},{default:n(()=>[u(v(w.getStatusText(t.status)),1)]),_:2},1032,["class"])]),_:2},1024),i(j,{class:"order-content"},{default:n(()=>[i(j,{class:"device-info"},{default:n(()=>[i(j,{class:"device-count"},{default:n(()=>[u(" 退回设备："+v(t.returnDevices?t.returnDevices.length:0)+"台 ",1)]),_:2},1024),t.express_company?(o(),r(j,{key:0,class:"express-info"},{default:n(()=>[i(b,null,{default:n(()=>[u(v(t.express_company),1)]),_:2},1024),t.express_no?(o(),r(b,{key:0},{default:n(()=>[u("："+v(t.express_no),1)]),_:2},1024)):c("v-if",!0)]),_:2},1024)):c("v-if",!0)]),_:2},1024),i(j,{class:"order-time"},{default:n(()=>[u(v(t.create_at),1)]),_:2},1024)]),_:2},1024),1===t.status?(o(),r(j,{key:0,class:"order-footer"},{default:n(()=>[i(R,{class:"btn-confirm",onClick:k(s=>w.handleConfirmReceive(t.id),["stop"])},{default:n(()=>[u("确认收货")]),_:2},1032,["onClick"])]),_:2},1024)):c("v-if",!0)]),_:2},1032,["onClick"]))),128))]),_:1})):(o(),d(h,{key:1},[c(" 空状态 "),i(j,{class:"empty-state"},{default:n(()=>[i(D,{class:"empty-image",src:"/wap/static/images/empty-order.png",mode:"aspectFit"}),i(b,{class:"empty-text"},{default:n(()=>[u("暂无退回订单")]),_:1})]),_:1})],2112)),c(" 加载更多 "),i(T,{status:x.loadMoreStatus,"content-text":x.contentText},null,8,["status","content-text"]),c(" 确认收货弹窗 "),i(K,{show:x.showConfirmModal,title:"确认收货",content:"确认已收到退回的设备吗？","show-cancel-button":!0,onConfirm:w.confirmReceive,onCancel:w.closeConfirmPopup},null,8,["show","onConfirm","onCancel"])]),_:1})]),_:1})}],["__scopeId","data-v-0be3b0c1"]]);export{R as default};
