import{a7 as e,a8 as a,a9 as l,ad as t,ae as s,k as i,l as r,o as d,c as o,w as u,e as n,j as c,D as p,m,d as v,a as f,r as h,L as _,c8 as g,s as y,bt as b,E as x,c9 as w,f as C,B as S,C as V,A as k,c7 as A,ca as z,b as j,J as I,K as $,p as P,z as B}from"./index-0259f5df.js";import{_ as q}from"./u-input.8fd8730e.js";import{_ as N,a as E}from"./u-form.acd3204a.js";import{_ as T}from"./u-loading-icon.d4562dd7.js";import{_ as U}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as W}from"./area-select.vue_vue_type_script_setup_true_lang.57e94a11.js";import{m as M}from"./manifest.452e73d8.js";import"./u-icon.e993510c.js";import"./u-line.2127c15d.js";import"./u-popup.6f1fa414.js";import"./u-transition.9813ca7a.js";const R=U({name:"u-switch",mixins:[a,l,{props:{loading:{type:Boolean,default:()=>e.switch.loading},disabled:{type:Boolean,default:()=>e.switch.disabled},size:{type:[String,Number],default:()=>e.switch.size},activeColor:{type:String,default:()=>e.switch.activeColor},inactiveColor:{type:String,default:()=>e.switch.inactiveColor},modelValue:{type:[Boolean,String,Number],default:()=>e.switch.value},activeValue:{type:[String,Number,Boolean],default:()=>e.switch.activeValue},inactiveValue:{type:[String,Number,Boolean],default:()=>e.switch.inactiveValue},asyncChange:{type:Boolean,default:()=>e.switch.asyncChange},space:{type:[String,Number],default:()=>e.switch.space}}}],watch:{modelValue:{immediate:!0,handler(e){e!==this.inactiveValue&&this.activeValue}}},data:()=>({bgColor:"#ffffff"}),computed:{isActive(){return this.modelValue===this.activeValue},switchStyle(){let e={};return e.width=t(2*this.size+2),e.height=t(Number(this.size)+2),this.customInactiveColor&&(e.borderColor="rgba(0, 0, 0, 0)"),e.backgroundColor=this.isActive?this.activeColor:this.inactiveColor,e},nodeStyle(){let e={};e.width=t(this.size-this.space),e.height=t(this.size-this.space);const a=this.isActive?t(this.space):t(this.size);return e.transform=`translateX(-${a})`,e},bgStyle(){let e={};return e.width=t(2*Number(this.size)-this.size/2),e.height=t(this.size),e.backgroundColor=this.inactiveColor,e.transform=`scale(${this.isActive?0:1})`,e},customInactiveColor(){return"#fff"!==this.inactiveColor&&"#ffffff"!==this.inactiveColor}},emits:["update:modelValue","change"],methods:{addStyle:s,clickHandler(){if(!this.disabled&&!this.loading){const e=this.isActive?this.inactiveValue:this.activeValue;this.asyncChange||this.$emit("update:modelValue",e),this.$nextTick(()=>{this.$emit("change",e)})}}}},[["render",function(e,a,l,t,s,v){const f=m,h=i(r("u-loading-icon"),T);return d(),o(f,{class:p(["u-switch cursor-pointer",[e.disabled&&"u-switch--disabled"]]),style:c([v.switchStyle,v.addStyle(e.customStyle)]),onClick:v.clickHandler},{default:u(()=>[n(f,{class:"u-switch__bg",style:c([v.bgStyle])},null,8,["style"]),n(f,{class:p(["u-switch__node",[e.modelValue&&"u-switch__node--on"]]),style:c([v.nodeStyle]),ref:"u-switch__node"},{default:u(()=>[n(h,{show:e.loading,mode:"circle",timingFunction:"linear",color:e.modelValue?e.activeColor:"#AAABAD",size:.6*e.size},null,8,["show","color","size"])]),_:1},8,["class","style"])]),_:1},8,["class","style","onClick"])}],["__scopeId","data-v-09bf48b9"]]),D=U(v({__name:"address_edit",setup(e){const a=f(),l=h({id:0,name:"",mobile:"",province_id:0,city_id:0,district_id:0,lat:"",lng:"",address:"",address_name:"",full_address:"",is_default:0,area:""}),t=h(),s=h(null),v=h(""),T=h(!1),U=h(!1),D=h("address"),H=h(2);h(null),_(e=>{H.value=e.isSelectMap||"";const a=uni.getStorageSync("selectAddressCallback");if(e.id)g(e.id).then(e=>{e.data&&Object.assign(l.value,e.data),a&&(D.value="express"==a.delivery?"address":"locationAddress")});else if(e.name){uni.getStorageSync("addressInfo")&&Object.assign(l.value,uni.getStorageSync("addressInfo")),G(e.latng);const a=Q("latng").split(",");l.value.lat=a[0],l.value.lng=a[1]}v.value=e.source||"",a&&(D.value="express"==a.delivery?"address":"locationAddress"),Z()});const O=y(()=>({name:{type:"string",required:!0,message:B("namePlaceholder"),trigger:["blur","change"]},mobile:[{type:"string",required:!0,message:B("mobilePlaceholder"),trigger:["blur","change"]},{validator(e,a,l){/^1[3-9]\d{9}$/.test(a)?l():l(new Error(B("mobileError")))}}],area:{validator(){let e=!0;return uni.$u.test.isEmpty(l.value.area)&&uni.$u.test.isEmpty(l.value.address_name)&&(e=!1),e},message:B("selectAreaPlaceholder")},address:{type:"string",required:!0,message:B("addressPlaceholder"),trigger:["blur","change"]}})),F=()=>{U.value=!0,t.value.open()},J=e=>{var a,t,s,i,r,d,o,u,n;!U.value||l.value.province_id!=(null==(a=e.province)?void 0:a.id)&&l.value.city_id==(null==(t=e.city)?void 0:t.id)&&l.value.district_id==(null==(s=e.district)?void 0:s.id)||(l.value.lat="",l.value.lng=""),l.value.province_id=(null==(i=e.province)?void 0:i.id)||0,l.value.city_id=(null==(r=e.city)?void 0:r.id)||0,l.value.district_id=(null==(d=e.district)?void 0:d.id)||0,l.value.area=`${(null==(o=e.province)?void 0:o.name)||""}${(null==(u=e.city)?void 0:u.name)||""}${(null==(n=e.district)?void 0:n.name)||""}`,U.value=!1},K=h(!1),L=()=>{const e=l.value.id?A:z;s.value.validate().then(()=>{if(!K.value){if(K.value=!0,T.value=!0,l.value.full_address=l.value.area+l.value.address,1==H.value&&!l.value.lat&&!l.value.lng)return x({title:"缺少经纬度，请在地图上重新选点",icon:"none"}),K.value=!1,T.value=!1,!1;e(l.value).then(e=>{K.value=!1,setTimeout(()=>{if(T.value=!1,"shop_order_payment"==v.value){const a=uni.getStorageSync("selectAddressCallback");a&&(a.address_id=e.data.id||l.value.id,uni.setStorage({key:"selectAddressCallback",data:a,success(){j({url:a.back,mode:"redirectTo"})}}))}else j({url:"/app/pages/member/address",mode:"redirectTo",param:{source:v.value}})},1e3)}).catch(()=>{K.value=!1,T.value=!1})}})},X=()=>{a.diyAddressInfo&&a.diyAddressInfo.latitude,a.diyAddressInfo&&a.diyAddressInfo.longitude;const e=l.value;uni.setStorageSync("addressInfo",e);let t=location.origin+location.pathname+"?source="+v.value;H.value&&(t=t+"&isSelectMap="+H.value),window.location.href="https://apis.map.qq.com/tools/locpicker?search=1&type=0&backurl="+encodeURIComponent(t)+"&key="+M.h5.sdkConfigs.maps.qqmap.key+"&referer=myapp"},G=e=>{b({latlng:e}).then(e=>{e.data?(l.value.address=e.data.formatted_addresses.recommend,l.value.full_address="",l.value.full_address+=null!=e.data.province?e.data.province:"",l.value.full_address+=null!=e.data.city?""+e.data.city:"",l.value.full_address+=null!=e.data.district?""+e.data.district:"",l.value.address_name=l.value.full_address.replace(/-/g,""),l.value.area=e.data.province+e.data.city+e.data.district||e.data.full_address,l.value.province_id=null!=e.data.province_id?e.data.province_id:0,l.value.city_id=null!=e.data.city_id?e.data.city_id:0,l.value.district_id=null!=e.data.district_id?e.data.district_id:0):x({title:e.msg,icon:"none"})})},Q=e=>{const a=window.location.search.substring(1).split("&");for(let l=0;l<a.length;l++){const t=a[l].split("=");if(t[0]==e)return t[1]}return!1},Y=h([]),Z=()=>{w(3).then(e=>{Y.value=e.data}).catch()};return h(!1),(e,a)=>{const v=i(r("u-input"),q),f=i(r("u-form-item"),N),h=m,_=I,g=i(r("u-switch"),R),y=i(r("u-form"),E),b=$,x=i(r("area-select"),W),w=P("layout-default-uni");return d(),o(w,null,{default:u(()=>[n(h,{class:"bg-[var(--page-bg-color)] min-h-[100vh] overflow-hidden address-edit",style:c(e.themeColor())},{default:u(()=>[n(y,{labelPosition:"left",model:l.value,errorType:"toast",rules:C(O),ref_key:"formRef",ref:s},{default:u(()=>[n(h,{class:"sidebar-margin card-template mt-[var(--top-m)] py-[20rpx]"},{default:u(()=>[n(h,null,{default:u(()=>[n(f,{label:C(B)("name"),prop:"name",labelWidth:"200rpx"},{default:u(()=>[n(v,{fontSize:"28rpx",modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value.name=e),modelModifiers:{trim:!0},border:"none",clearable:"",maxlength:"25",placeholderStyle:"color: #888",placeholder:C(B)("namePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),n(h,{class:"mt-[16rpx]"},{default:u(()=>[n(f,{label:C(B)("mobile"),prop:"mobile",labelWidth:"200rpx"},{default:u(()=>[n(v,{fontSize:"28rpx",modelValue:l.value.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>l.value.mobile=e),modelModifiers:{trim:!0},maxlength:"11",border:"none",clearable:"",placeholder:C(B)("mobilePlaceholder"),placeholderStyle:"color: #888"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),n(h,{class:"mt-[16rpx]"},{default:u(()=>[n(f,{label:C(B)("selectArea"),prop:"area",labelWidth:"200rpx"},{default:u(()=>["address"==D.value&&1!=H.value?(d(),o(h,{key:0,class:"flex w-full items-center h-[52rpx]",onClick:F},{default:u(()=>[l.value.area?(d(),o(h,{key:1,class:"text-[28rpx] flex-1 leading-[1.4]"},{default:u(()=>[S(V(l.value.area),1)]),_:1})):(d(),o(h,{key:0,class:"text-[#888] text-[28rpx] flex-1"},{default:u(()=>[S(V(C(B)("selectAreaPlaceholder")),1)]),_:1})),n(h,{onClick:k(X,["stop"]),class:"flex items-center"},{default:u(()=>[n(_,{class:"nc-iconfont nc-icon-dizhiguanliV6xx mr-[4rpx] text-[32rpx] text-[var(--primary-color)]"}),n(_,{class:"text-[24rpx] whitespace-nowrap text-[var(--primary-color)]"},{default:u(()=>[S("定位")]),_:1})]),_:1},8,["onClick"])]),_:1})):(d(),o(h,{key:1,class:"flex justify-between items-center flex-1 h-[52rpx]",onClick:X},{default:u(()=>[l.value.area||l.value.address_name?(d(),o(h,{key:0,class:"text-[28rpx] text-[#303133] leading-[1.4]"},{default:u(()=>[S(V(l.value.area||l.value.address_name),1)]),_:1})):(d(),o(h,{key:1,class:"text-[#888] text-[28rpx]"},{default:u(()=>[S(V(C(B)("selectAddressPlaceholder")),1)]),_:1})),n(h,{class:"flex items-center"},{default:u(()=>[n(_,{class:"nc-iconfont nc-icon-dizhiguanliV6xx text-[32rpx] mr-[4rpx] text-[var(--primary-color)]"}),n(_,{class:"text-[24rpx] whitespace-nowrap text-[var(--primary-color)]"},{default:u(()=>[S("定位")]),_:1})]),_:1})]),_:1}))]),_:1},8,["label"])]),_:1}),n(h,{class:"mt-[16rpx]"},{default:u(()=>[n(f,{label:C(B)("address"),prop:"address",labelWidth:"200rpx"},{default:u(()=>[n(v,{fontSize:"28rpx",modelValue:l.value.address,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.address=e),border:"none",clearable:"",maxlength:"120",placeholder:C(B)("addressPlaceholder"),placeholderStyle:"color: #888"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),n(h,{class:"sidebar-margin card-template mt-[var(--top-m)] py-[10rpx]"},{default:u(()=>[n(f,{label:C(B)("defaultAddress"),prop:"name","border-bottom":!1,labelWidth:"200rpx"},{default:u(()=>[n(g,{modelValue:l.value.is_default,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.is_default=e),size:"20",activeValue:1,inactiveValue:0,activeColor:"var(--primary-color)",inactiveColor:"var(--temp-bg)"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["model","rules"]),n(h,{class:"w-full footer"},{default:u(()=>[n(h,{class:"py-[var(--top-m)] px-[var(--sidebar-m)] footer w-full fixed bottom-30 left-0 right-0 box-border"},{default:u(()=>[n(b,{"hover-class":"none",class:p(["primary-btn-bg !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500",{"opacity-50":T.value}]),onClick:L,disabled:T.value,loading:K.value},{default:u(()=>[S(V(C(B)("save")),1)]),_:1},8,["disabled","loading","class"])]),_:1})]),_:1}),n(x,{ref_key:"areaRef",ref:t,onComplete:J,"area-id":l.value.district_id||l.value.city_id},null,8,["area-id"])]),_:1},8,["style"])]),_:1})}}}),[["__scopeId","data-v-49842fff"]]);export{D as default};
