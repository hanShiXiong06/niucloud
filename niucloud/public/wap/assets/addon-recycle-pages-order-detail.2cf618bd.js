import{d as e,r as t,s as a,L as s,O as l,y as c,o as r,c as u,w as i,e as n,i as d,f as o,Y as f,a9 as m,Z as x,B as _,C as v,D as p,A as y,E as g,k as h,l as b,J as k,m as w,K as j,p as C,g as I,S as E,v as z,aL as N,aJ as q,aA as L,b as M,aM as A,aC as F,aN as O,R as S,au as T}from"./index-c3bd19d7.js";import{_ as J,a as P}from"./u-steps.a363574b.js";import{_ as Y}from"./u-icon.fed07783.js";import{_ as Z}from"./u-checkbox.629328c6.js";import{u as $,b as B,d as D,e as K,f as R}from"./order.991f8481.js";import{g as V}from"./return_order.95e00675.js";import{g as X}from"./payment.05bc5a1e.js";import{_ as G}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-text.cec1c8ef.js";const H=G(e({__name:"detail",setup(e){const G=t({id:0,order_no:"",status:"1",create_at:0,devices:[],delivery_type:"self",send_username:"",telphone:""}),H=t(!1),Q=t([]),U=t([]),W=t({}),ee=t({device_status:{},order_status:{}}),te=a({get:()=>G.value.devices.length>0&&U.value.length===G.value.devices.length,set:e=>{e?(U.value=G.value.devices.map(e=>e.id),G.value.devices.forEach(e=>{W.value[e.id]=!0})):(U.value=[],G.value.devices.forEach(e=>{W.value[e.id]=!1}))}}),ae=(e,t)=>{if(W.value[e]=!W.value[e],W.value[e])U.value.includes(e)||U.value.push(e);else{const t=U.value.indexOf(e);-1!==t&&U.value.splice(t,1)}},se=()=>{te.value=!te.value},le=()=>{if(0===U.value.length)return void g({title:"请先选择设备",icon:"none"});const e=G.value.devices.filter(e=>U.value.includes(e.id)).map(e=>e.imei).join("\n");N({data:e,success:()=>{g({title:"已复制选中IMEI",icon:"success"})}})},ce=e=>{N({data:e,success:()=>{g({title:"已复制IMEI",icon:"success"})}})},re=async()=>{try{const e=await B();console.log("设备状态数据:",e),1===e.code&&e.data?ee.value={device_status:e.data.device_status||{},order_status:e.data.order_status||{}}:console.error("获取状态列表失败, 接口返回:",e)}catch(e){console.error("获取状态列表失败:",e)}},ue=e=>Q.value.includes(e),ie=e=>{const t=String(e);return console.log(ee.value.device_status[t]),ee.value.device_status[t]||"未知状态"},ne=e=>{switch(Number(e)){case 1:return"您的订单已提交，等待商家确认";case 2:return"您的订单已签收，等待商家质检";case 3:return"商家正在质检您的设备，请耐心等待";case 4:return"设备已完成质检，等待您确认价格";case 5:return"您已确认部分设备价格，等待确认剩余设备";case 6:return"价格已确认，等待商家打款";case 7:return"交易已完成，感谢您的使用";case 8:return"订单已取消";case 9:return"订单已删除";default:return"订单状态未知"}};a(()=>{var e,t;return(null==(t=null==(e=G.value)?void 0:e.devices)?void 0:t.some(e=>4===Number(e.status)))||!1});const de=async()=>{if(0!==U.value.length)try{H.value=!0,await $().request("recycle_order_pay");const e=G.value.devices.filter(e=>U.value.includes(e.id)&&4===Number(e.status));if(0===e.length)return void g({title:"所选设备中没有需要确认的设备",icon:"none"});const t=e.map(e=>e.id),a=await D(t);1===a.code?(g({title:"批量确认成功",icon:"success"}),await fe(G.value.id),U.value=[],W.value={}):g({title:a.msg||"操作失败",icon:"none"})}catch(e){console.error("批量确认失败:",e),g({title:"操作失败",icon:"none"})}finally{H.value=!1}else g({title:"请先选择设备",icon:"none"})},oe=()=>{M({url:"/app/pages/member/contact",mode:"navigateTo"})},fe=async e=>{try{H.value=!0;const t="string"==typeof e?parseInt(e):e,a=await K(t);1===a.code&&(G.value=a.data,U.value=[],W.value={},G.value.devices.forEach(e=>{W.value[e.id]=!1}),G.value.devices&&G.value.devices.length>0&&(Q.value=[G.value.devices[0].id]))}catch(t){console.error("获取订单详情失败:",t)}finally{H.value=!1}},me=a(()=>{var e;switch(Number(null==(e=G.value)?void 0:e.status)){case 1:default:return 0;case 2:case 3:return 1;case 4:case 5:return 2;case 6:return 3;case 7:return 4;case 8:case 9:return 9}}),xe=a(()=>{var e,t;return null==(t=null==(e=G.value)?void 0:e.devices)?void 0:t.reduce((e,t)=>e+parseFloat(String(t.final_price||0)),0).toFixed(2)});return s(e=>{(null==e?void 0:e.id)&&fe(e.id),re()}),l(async()=>{await $().request("recycle_order_sign,recycle_order_agree,recycle_order_pay")}),c(()=>{re()}),(e,t)=>{const a=h(b("up-steps-item"),J),s=k,l=h(b("up-steps"),P),c=w,N=h(b("up-icon"),Y),M=h(b("up-checkbox"),Z),B=S,D=T,K=j,ee=C("layout-default-uni");return r(),u(ee,null,{default:i(()=>[n(c,{class:"order-detail bg-gray-100 min-h-screen pb-20"},{default:i(()=>[d(" 订单状态卡片 "),n(c,{class:"status-card bg-white rounded-lg shadow-sm mx-2 mt-2 mb-3 overflow-hidden"},{default:i(()=>[n(c,{class:"p-3"},{default:i(()=>[d(" 顶部进度条 "),n(c,{class:"rounded px-2 py-3 mb-3"},{default:i(()=>[n(l,{current:o(me)},{default:i(()=>[9==o(me)?(r(),u(a,{key:0,error:"",title:"已取消",desc:"订单取消"})):(r(),f(x,{key:1},m([{name:"已下单",desc:"订单已提交"},{name:"待质检",desc:"待设备检测"},{name:"待确认",desc:"待确认价格"},{name:"待打款",desc:"等待转账"},{name:"已完成",desc:"交易完成"}],e=>n(a,{title:e.name},{desc:i(()=>[n(s,{class:"text-[12px] text-gray-500"},{default:i(()=>[_(v(e.desc),1)]),_:2},1024)]),_:2},1032,["title"])),64))]),_:1},8,["current"])]),_:1}),d(" 状态标题 "),n(c,{class:"flex items-center justify-between mb-3"},{default:i(()=>[n(s,{class:"text-xs text-gray-500"},{default:i(()=>[_(v(G.value.create_at),1)]),_:1}),n(c,{class:p(["status-badge rounded-full py-1 px-2 inline-flex items-center",`status-bg-${G.value.status}`])},{default:i(()=>[n(N,{name:"4"==G.value.status?"rmb-circle":"checkbox-mark",size:"12",color:"#fff",class:"mr-1"},null,8,["name"]),n(s,{class:"text-xs font-medium text-white"},{default:i(()=>[_(v(G.value.status_name),1)]),_:1})]),_:1},8,["class"])]),_:1}),d(" 订单说明 "),n(c,{class:"bg-gray-50 rounded px-3 py-2 text-xs text-gray-700 leading-relaxed"},{default:i(()=>[_(v(ne(G.value.status)),1)]),_:1})]),_:1})]),_:1}),d(" 设备列表 "),n(c,{class:"mx-2"},{default:i(()=>[n(c,{class:"flex justify-between items-center mb-2"},{default:i(()=>[n(s,{class:"text-base font-bold text-gray-800"},{default:i(()=>[_("设备列表")]),_:1}),n(s,{class:"text-xs font-medium text-red-500 bg-white py-1 px-2 rounded-full shadow-sm"},{default:i(()=>[_(" 总价值: ¥"+v(o(xe)),1)]),_:1})]),_:1}),d(" 设备批量操作工具栏 "),G.value.devices&&G.value.devices.length>0?(r(),u(c,{key:0,class:"bg-white rounded px-3 py-2 mb-2 shadow-sm flex justify-between items-center"},{default:i(()=>[n(c,{class:"flex items-center space-x-3"},{default:i(()=>[n(c,{class:"flex items-center",onClick:y(se,["stop"])},{default:i(()=>[n(M,{checked:o(te),shape:"square",onChange:se},null,8,["checked"]),n(s,{class:"ml-1 text-xs"},{default:i(()=>[_(v(o(te)?"取消全选":"全选"),1)]),_:1})]),_:1},8,["onClick"]),n(c,{class:"flex items-center",onClick:y(le,["stop"])},{default:i(()=>[n(N,{name:"cut",size:"14",color:"#2979ff"}),n(s,{class:"ml-1 text-xs text-blue-500"},{default:i(()=>[_("复制IMEI")]),_:1})]),_:1},8,["onClick"])]),_:1}),U.value.length>0?(r(),u(c,{key:0,class:"text-xs text-blue-500 font-medium"},{default:i(()=>[_(" 已选择 "+v(U.value.length)+" 台 ",1)]),_:1})):d("v-if",!0)]),_:1})):d("v-if",!0),(r(!0),f(x,null,m(G.value.devices,(e,t)=>(r(),u(c,{class:"mb-2",key:e.id},{default:i(()=>[n(c,{class:"bg-white rounded-lg shadow-sm overflow-hidden"},{default:i(()=>{return[d(" 设备基本信息 "),n(c,{class:"p-2 flex items-center border-b border-gray-100 relative"},{default:i(()=>[d(" 选择框 "),n(c,{class:"mr-2",onClick:y(t=>ae(e.id),["stop"])},{default:i(()=>{return[n(M,{checked:(t=e.id,!!W.value[t]),shape:"square",onChange:t=>ae(e.id)},null,8,["checked","onChange"])];var t}),_:2},1032,["onClick"]),d(" 设备信息 "),n(c,{class:"flex-1"},{default:i(()=>[n(s,{class:p(["absolute top-0 right-0 text-xs py-0.5 px-1.5 rounded-bl-lg rounded-tr-lg",`status-text-${e.status}`])},{default:i(()=>[_(v(e.status_name||ie(e.status)),1)]),_:2},1032,["class"]),n(c,{class:"mt-2"},{default:i(()=>[n(s,{class:"text-sm font-medium text-gray-700 flex items-center"},{default:i(()=>[n(s,{class:"text-sm text-[#579af8]"},{default:i(()=>[_(v(t+1)+". ",1)]),_:2},1024),_(" "+v(e.model||"待识别"),1)]),_:2},1024)]),_:2},1024),n(c,{class:"mt-0.5 flex items-center",onLongpress:t=>ce(e.imei)},{default:i(()=>[n(s,{class:"text-xs text-gray-600"},{default:i(()=>[_("IMEI: "+v(e.imei),1)]),_:2},1024),n(N,{name:"cut",size:"12",color:"#000",onClick:t=>ce(e.imei),class:"ml-1 opacity-50"},null,8,["onClick"])]),_:2},1032,["onLongpress"])]),_:2},1024),d(" 价格和展开区域 "),n(c,{class:"flex mt-2 flex-row items-center justify-center min-w-[60px]",onClick:y(t=>(e=>{const t=Q.value.indexOf(e);-1===t?Q.value.push(e):Q.value.splice(t,1)})(e.id),["stop"])},{default:i(()=>[d(" 价格 "),n(c,{class:"text-center mb-1 mr-1"},{default:i(()=>[e.final_price&&"0.00"!==e.final_price?(r(),u(s,{key:0,class:"text-sm font-bold text-red-500 block"},{default:i(()=>[_("¥"+v(e.final_price),1)]),_:2},1024)):(r(),u(s,{key:1,class:"text-xs text-gray-400 block"},{default:i(()=>[_("待定价")]),_:1}))]),_:2},1024),d(" 展开/收起图标 "),n(c,{class:p(["transition-transform duration-300",{"transform rotate-180":ue(e.id)}])},{default:i(()=>[n(N,{name:"arrow-down",size:"16",color:"#999"})]),_:2},1032,["class"])]),_:2},1032,["onClick"])]),_:2},1024),d(" 设备详细信息（展开时显示） "),I(n(c,null,{default:i(()=>[d(" 设备图片展示 "),n(c,{class:"ml-2 mr-2 p-2 bg-gray-50"},{default:i(()=>[e.check_images?(r(),u(c,{key:0,class:"text-xs font-medium text-gray-700 mb-1"},{default:i(()=>[_("设备检测图片")]),_:1})):(r(),u(c,{key:1,class:"text-xs text-gray-500 mb-1"},{default:i(()=>[_("暂无设备图片")]),_:1})),e.check_images?(r(),u(D,{key:2,"scroll-x":"",class:"whitespace-nowrap"},{default:i(()=>[n(c,{class:"inline-flex space-x-1.5 py-1"},{default:i(()=>[(r(!0),f(x,null,m(e.check_images.split(","),(t,a)=>(r(),u(c,{class:"w-15 h-15 rounded overflow-hidden shadow-sm",key:a},{default:i(()=>[n(B,{src:o(E)(t),mode:"aspectFill",class:"w-full h-full object-cover",onClick:y(t=>((e,t)=>{const a=e.map(e=>E(e));F({urls:a,current:a[t],longPressActions:{itemList:["保存图片"],success:e=>{0===e.tapIndex&&O({filePath:a[t],success:()=>{g({title:"保存成功",icon:"success"})},fail:e=>{console.error("保存图片失败:",e),g({title:"保存失败",icon:"none"})}})}}})})(e.check_images.split(","),a),["stop"])},null,8,["src","onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):d("v-if",!0)]),_:2},1024),d(" 价格详情 "),n(c,{class:"p-2"},{default:i(()=>["0.00"!==e.initial_price||"0.00"!==e.final_price?(r(),u(c,{key:0,class:"bg-gray-50 rounded p-2 mb-1"},{default:i(()=>["0.00"!==e.initial_price?(r(),u(c,{key:0,class:"flex justify-between mb-1 text-xs"},{default:i(()=>[n(s,{class:"text-gray-500"},{default:i(()=>[_("预估价格")]),_:1}),n(s,{class:"text-red-500 font-medium"},{default:i(()=>[_("¥"+v(e.initial_price||"0.00"),1)]),_:2},1024)]),_:2},1024)):d("v-if",!0),"0.00"!==e.final_price?(r(),u(c,{key:1,class:"flex justify-between mb-1 text-xs"},{default:i(()=>[n(s,{class:"text-gray-500"},{default:i(()=>[_("最终价格")]),_:1}),n(s,{class:"text-red-500 font-medium"},{default:i(()=>[_("¥"+v(e.final_price),1)]),_:2},1024)]),_:2},1024)):d("v-if",!0),e.remark?(r(),u(c,{key:2,class:"flex justify-between text-xs"},{default:i(()=>[n(s,{class:"text-gray-500 w-[125rpx]"},{default:i(()=>[_("价格说明")]),_:1}),n(s,{class:"text-gray-700"},{default:i(()=>[_(v(e.remark),1)]),_:2},1024)]),_:2},1024)):d("v-if",!0)]),_:2},1024)):d("v-if",!0),d(" 检测详情 "),e.check_result||e.check_at?(r(),u(c,{key:1,class:"bg-gray-50 rounded p-2"},{default:i(()=>[void 0!==e.check_status?(r(),u(c,{key:0,class:"flex justify-between mb-1 text-xs"},{default:i(()=>[n(s,{class:"text-gray-500"},{default:i(()=>[_("检测状态")]),_:1}),n(s,{class:"text-gray-700"},{default:i(()=>[_(v(1===e.check_status?"已检测":"未检测"),1)]),_:2},1024)]),_:2},1024)):d("v-if",!0),e.check_result?(r(),u(c,{key:1,class:"flex justify-between mb-1 text-xs"},{default:i(()=>[n(s,{class:"text-gray-500 w-[125rpx]"},{default:i(()=>[_("检测结果")]),_:1}),n(s,{class:"text-gray-700"},{default:i(()=>[_(v(e.check_result),1)]),_:2},1024)]),_:2},1024)):d("v-if",!0),e.check_at?(r(),u(c,{key:2,class:"flex justify-between text-xs"},{default:i(()=>[n(s,{class:"text-gray-500"},{default:i(()=>[_("检测时间")]),_:1}),n(s,{class:"text-gray-700"},{default:i(()=>{return[_(v((t=e.check_at,A(t))),1)];var t}),_:2},1024)]),_:2},1024)):d("v-if",!0)]),_:2},1024)):d("v-if",!0)]),_:2},1024),d(" 设备操作按钮 ")]),_:2},1536),[[z,ue(e.id)]]),(a=e.status,4===Number(a)?(r(),u(c,{key:0,class:"p-2 flex space-x-2 border-t border-gray-100"},{default:i(()=>[n(K,{class:"flex-1 h-8 rounded bg-gradient-to-r flex from-teal-500 to-green-600 items-center justify-center text-white text-xs",onClick:y(oe,["stop"])},{default:i(()=>[n(N,{name:"chat-fill",size:"14",color:"#fff",class:"mr-1"}),_(" 议价 ")]),_:1},8,["onClick"]),n(K,{class:"flex-1 h-8 rounded bg-gradient-to-r from-pink-500 to-pink-600 flex items-center justify-center text-white text-xs",onClick:y(t=>(async e=>{if(Number(G.value.status)<4)g({title:"请等待全部设备质检完成后在确认",icon:"none"});else try{H.value=!0,await $().request("recycle_order_pay");const t=await X(),a=await V();if(!(t&&1===t.code&&t.data&&0!==t.data.length&&a&&1===a.code&&a.data&&a.data.id_card))return H.value=!1,void q({title:"提示",content:"请先完善信息",confirmText:"去添加",success:e=>{e.confirm&&setTimeout(()=>{L({url:"/addon/recycle/pages/payment/index"})},100)}});const s=await R(e.id);1===s.code?(g({title:"确认成功",icon:"success"}),fe(G.value.id)):g({title:s.msg||"操作失败",icon:"none"})}catch(t){console.error("确认设备失败:",t),g({title:"操作失败",icon:"none"})}finally{H.value=!1}})(e),["stop"])},{default:i(()=>[n(N,{name:"checkmark",size:"14",color:"#fff",class:"mr-1"}),_(" 确认价格 ")]),_:2},1032,["onClick"])]),_:2},1024)):d("v-if",!0))];var a}),_:2},1024)]),_:2},1024))),128))]),_:1}),d(" 底部操作栏 "),U.value.length>0&&5==G.value.status?(r(),u(c,{key:0,class:"fixed left-0 right-0 bottom-0 bg-white bg-opacity-95 p-2 shadow-up backdrop-blur-sm"},{default:i(()=>[n(K,{class:"w-full h-10 rounded-full bg-gradient-to-r from-green-500 to-green-600 flex items-center justify-center text-white text-sm font-medium",onClick:de},{default:i(()=>[n(N,{name:"checkmark-circle",size:"16",color:"#fff",class:"mr-1"}),_(" 确认选中设备 ("+v(U.value.length)+") ",1)]),_:1})]),_:1})):d("v-if",!0)]),_:1})]),_:1})}}}),[["__scopeId","data-v-4f52ebbd"]]);export{H as default};
