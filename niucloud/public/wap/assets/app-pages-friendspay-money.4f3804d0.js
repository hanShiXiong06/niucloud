import{d as e,M as a,am as t,r as l,av as r,b as s,k as n,l as o,o as i,c as u,w as p,A as d,e as c,B as f,C as x,f as _,z as m,ai as v,Y as y,Z as g,ac as b,S as h,i as k,E as w,m as j,aw as F,K as S,L as T,O as C,at as I,au as P,V as R,W as B,j as O,N as A,H as z,J as E,p as H,D as L,R as M}from"./index-0259f5df.js";import{_ as V}from"./u-avatar.bc708e92.js";import{_ as J}from"./u-image.b850c93a.js";import{_ as N}from"./u-icon.e993510c.js";import{_ as U}from"./u-popup.6f1fa414.js";import{p as $,g as D}from"./pay.bf41184e.js";import{_ as G}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as K}from"./loading-page.vue_vue_type_script_setup_true_lang.5a0da197.js";import{t as W}from"./topTabbar.6a4f0c22.js";import{g as Y,_ as Z}from"./message.vue_vue_type_script_setup_true_lang.5143cd04.js";import"./u-transition.9813ca7a.js";import"./u-loading-icon.d4562dd7.js";const q=G(e({__name:"pay",props:{ignorePay:{type:Array,default:()=>[]},reformat:{type:String,default:""}},emits:["close","confirm"],setup(e,{expose:T,emit:C}){const I=e;a()&&t.init();const P=l(!1),R=l(!1),B=l(null),O=l(""),A=()=>{var e,l,r,n;if(!uni.$u.test.isEmpty(O.value))return"friendspay"==O.value?(s({url:"/app/pages/friendspay/share",param:{id:null==(e=B.value)?void 0:e.trade_id,type:null==(l=B.value)?void 0:l.trade_type},mode:"redirectTo"}),!1):void(R.value||(R.value=!0,$({trade_type:null==(r=B.value)?void 0:r.trade_type,trade_id:null==(n=B.value)?void 0:n.trade_id,type:O.value,openid:uni.getStorageSync("openid")||""}).then(e=>{var l,r,n,o,i,u;switch(O.value){case"wechatpay":a()?(e.data.timestamp=e.data.timeStamp,delete e.data.timeStamp,t.pay({...e.data,success:()=>{E()},cancel:()=>{R.value=!1}})):(uni.setStorageSync("paymenting",{trade_type:null==(l=B.value)?void 0:l.trade_type,trade_id:null==(r=B.value)?void 0:r.trade_id}),location.href=e.data.h5_url);break;case"alipay":a()?s({url:"/app/pages/pay/browser",param:{trade_type:null==(n=B.value)?void 0:n.trade_type,trade_id:null==(o=B.value)?void 0:o.trade_id,alipay:encodeURIComponent(e.data.url)},mode:"redirectTo"}):(uni.setStorageSync("paymenting",{trade_type:null==(i=B.value)?void 0:i.trade_type,trade_id:null==(u=B.value)?void 0:u.trade_id}),location.href=e.data.url);break;default:if(e.data.url)return void s({url:e.data.url,param:e.data.param||{},mode:"redirectTo"});E()}}).catch(()=>{R.value=!1})));w({title:m("pay.notHavePayType"),icon:"none"})};r("checkIsReturnAfterPayment",()=>{const e=uni.getStorageSync("paymenting");uni.getStorageSync("paymenting")&&s({url:"/app/pages/pay/result",param:{trade_type:e.trade_type,trade_id:e.trade_id},mode:"redirectTo",success(){uni.removeStorageSync("paymenting")}})});const z=l(!1),E=()=>{var e,a;C("confirm"),I.reformat?s({url:I.reformat,mode:"redirectTo"}):s({url:"/app/pages/pay/result",param:{trade_type:null==(e=B.value)?void 0:e.trade_type,trade_id:null==(a=B.value)?void 0:a.trade_id},mode:"redirectTo"})},H=()=>{uni.removeStorageSync("paymenting"),P.value=!1,C("close")};return T({open:(e,a,t="",l="")=>{if(z.value)return;z.value=!0,uni.setStorageSync("payReturn",encodeURIComponent(t));const r={};l&&(r.scene=l),D(e,a,r).then(e=>{let{data:a}=e;uni.$u.test.isEmpty(a)?w({title:m("pay.notObtainedInfo"),icon:"none"}):0!=a.money?(B.value=a,I.ignorePay&&(a.pay_type_list=a.pay_type_list.filter(e=>!I.ignorePay.includes(e.key))),O.value=a.pay_type_list[0]?a.pay_type_list[0].key:"",P.value=!0,z.value=!1):E()}).catch(()=>{z.value=!1})},payInfo:B}),(e,a)=>{const t=j,l=n(o("u-image"),J),r=n(o("u-icon"),N),s=F,w=S,T=n(o("u-popup"),U);return i(),u(T,{show:P.value,round:10,onClose:H,closeable:!0,bgColor:"#fff",zIndex:"10081",closeOnClickOverlay:!1},{default:p(()=>[B.value?(i(),u(t,{key:0,class:"flex flex-col h-[65vh] popup-common",onTouchmove:a[0]||(a[0]=d(()=>{},["prevent","stop"]))},{default:p(()=>[c(t,{class:"head"},{default:p(()=>[c(t,{class:"title"},{default:p(()=>[f(x(_(m)("pay.payTitle")),1)]),_:1}),c(t,{class:"flex items-end justify-center w-full text-xl font-bold py-[20rpx] price-font"},{default:p(()=>[c(t,{class:"text-base mr-[4rpx]"},{default:p(()=>[f(x(_(m)("currency")),1)]),_:1}),f(" "+x(_(v)(B.value.money)),1)]),_:1})]),_:1}),c(s,{"scroll-y":"true",class:"flex-1 pt-[20rpx]"},{default:p(()=>[c(t,{class:"flex text-[28rpx] px-[36rpx] py-[20rpx] mb-[10rpx]"},{default:p(()=>[c(t,{class:"text-[var(--text-color-light6)]"},{default:p(()=>[f(x(_(m)("pay.orderInfo")),1)]),_:1}),c(t,{class:"text-right flex-1 pl-[30rpx] truncate"},{default:p(()=>[f(x(B.value.body),1)]),_:1})]),_:1}),c(t,{class:"mx-[var(--popup-sidebar-m)] px-[30rpx] bg-white rounded-[20rpx] bg-[var(--temp-bg)]"},{default:p(()=>[B.value.pay_type_list.length?(i(!0),y(g,{key:0},b(B.value.pay_type_list,(e,a)=>(i(),u(t,{class:"pay-item py-[30rpx] flex items-center border-0 border-b border-solid border-[#eee]",key:a,onClick:a=>O.value=e.key},{default:p(()=>[c(l,{src:_(h)(e.icon),width:"50rpx",height:"50rpx"},null,8,["src"]),c(t,{class:"flex-1 px-[20rpx] text-[28rpx] font-500"},{default:p(()=>[f(x(e.name),1)]),_:2},1024),e.key==O.value?(i(),u(r,{key:0,name:"checkbox-mark",color:"var(--primary-color)"})):k("v-if",!0)]),_:2},1032,["onClick"]))),128)):(i(),u(t,{key:1,class:"py-[30rpx] text-center text-[24rpx] text-gray-subtitle"},{default:p(()=>[f(x(_(m)("pay.notHavePayType")),1)]),_:1}))]),_:1})]),_:1}),c(t,{class:"btn-wrap"},{default:p(()=>[c(w,{class:"primary-btn-bg btn","hover-class":"none",loading:R.value,onClick:A},{default:p(()=>[f(x(_(m)("pay.confirmPay")),1)]),_:1},8,["loading"])]),_:1})]),_:1})):k("v-if",!0)]),_:1},8,["show"])}}}),[["__scopeId","data-v-572f8d79"]]),Q=G(e({__name:"money",setup(e){const a=W();a.setTopTabbarParam({title:""});const t=l(!0),r=l(0),d=l(""),v=l({}),w=l(!1),F=l(!0),N=l(null);T(e=>{r.value=e.id||0,d.value=e.type||""}),C(()=>{r.value&&d.value&&U(d.value,r.value)}),I(()=>{N.value&&(clearTimeout(N.value),N.value=null)}),P(()=>{N.value&&(clearTimeout(N.value),N.value=null)});const U=(e,l)=>{F.value&&(t.value=!0,F.value=!1),Y(e,l).then(r=>{v.value=r.data,R({title:v.value.config.pay_page_name}),a.setTopTabbarParam({title:v.value.config.pay_page_name}),t.value=!1,2!=v.value.status&&1!=v.value.status&&-1!=v.value.status?N.value=setTimeout(()=>{U(e,l)},3e3):(clearTimeout(N.value),N.value=null)}).catch(()=>{N.value&&(clearTimeout(N.value),N.value=null),t.value=!1;B({title:"未找到帮付订单信息",url:"/app/pages/index/index",mode:"reLaunch"})})},$=l(null),D=()=>{$.value.open(v.value.config)},G=l(),Q=()=>{var e;A()?null==(e=G.value)||e.open(v.value.trade_type,v.value.trade_id,"/app/pages/index/index","friendspay"):z().setLoginBack({url:"/app/pages/friendspay/money",param:{id:v.value.trade_id,type:v.value.trade_type}})};return(e,a)=>{const l=n(o("u-avatar"),V),r=E,d=j,F=S,T=M,C=n(o("up-image"),J),I=n(o("pay"),q),P=n(o("loading-page"),K),R=H("layout-default-uni");return i(),u(R,null,{default:p(()=>[c(d,{style:O(e.themeColor())},{default:p(()=>[Object.keys(v.value).length&&!t.value?(i(),u(d,{key:0,class:"bg-[var(--page-bg-color)] min-h-screen overflow-hidden"},{default:p(()=>[c(d,{style:O({background:"url("+_(h)("static/resource/images/app/friendpay_money.png")+") left bottom / cover no-repeat"}),class:"pb-[194rpx] overflow-hidden"},{default:p(()=>[c(d,{class:"mt-[20rpx] flex flex-col items-center"},{default:p(()=>[c(l,{src:_(h)(v.value.member.headimg),size:"50",leftIcon:"none","default-url":_(h)("static/resource/images/default_headimg.png")},null,8,["src","default-url"]),c(d,{class:"flex items-center mt-[20rpx] text-[#fff] text-[26rpx] leading-[36rpx]"},{default:p(()=>[c(r,{class:"font-bold mr-[10rpx] max-w-[250rpx] truncate"},{default:p(()=>[f(x(v.value.member.nickname),1)]),_:1}),c(r,null,{default:p(()=>[f("请您帮忙付款~")]),_:1})]),_:1}),v.value.config.pay_leave_message?(i(),u(d,{key:0,class:"message bg-[#fe0708] relative max-w-[520rpx] px-[20rpx] py-[12rpx] rounded-[12rpx] border-solid border-[1rpx] border-color text-[24rpx] text-[#fff] leading-[30rpx] box-border text-center mt-[20rpx] mx-[114rpx]"},{default:p(()=>[f(x(v.value.config.pay_leave_message),1)]),_:1})):k("v-if",!0)]),_:1})]),_:1},8,["style"]),c(d,{class:"-mt-[154rpx] card-template sidebar-margin mb-[var(--top-m)]"},{default:p(()=>[c(d,{class:"text-[24rpx] text-center mb-[10rpx]"},{default:p(()=>[f(x(_(m)("payMoney")),1)]),_:1}),c(d,{class:"text-center mb-[50rpx]"},{default:p(()=>[c(r,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:p(()=>[f("￥")]),_:1}),c(r,{class:"text-[56rpx] font-bold price-font text-[#FF4142]"},{default:p(()=>[f(x(parseFloat(v.value.money).toFixed(2).split(".")[0]),1)]),_:1}),c(r,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:p(()=>[f("."+x(parseFloat(v.value.money).toFixed(2).split(".")[1]),1)]),_:1})]),_:1}),c(d,{class:"px-[20rpx] box-border"},{default:p(()=>[2==v.value.status?(i(),u(F,{key:0,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:p(()=>[f(x(_(m)("finish")),1)]),_:1})):-1==v.value.status?(i(),u(F,{key:1,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:p(()=>[f(x(_(m)("close")),1)]),_:1})):(i(),u(F,{key:2,class:"botton-color !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none",loading:w.value,onClick:Q},{default:p(()=>[f(x(v.value.config.pay_button_name?v.value.config.pay_button_name:_(m)("payGenerously")),1)]),_:1},8,["loading"]))]),_:1}),c(d,{class:"px-[10px] flex justify-between items-center text-[var(--text-color-light9)] mt-[20rpx]"},{default:p(()=>[c(d,{class:"flex items-baseline justify-between text-[var(--text-color-light9)]",onClick:a[0]||(a[0]=e=>_(s)({url:"/app/pages/index/index"}))},{default:p(()=>[c(r,{class:"text-[24rpx] mr-[6rpx]"},{default:p(()=>[f("返回首页")]),_:1})]),_:1}),v.value.config.pay_explain_switch?(i(),u(d,{key:0,class:"flex-shrink-0",onClick:D},{default:p(()=>[c(r,{class:"mr-[8rpx] text-[24rpx]"},{default:p(()=>[f(x(v.value.config.pay_explain_title),1)]),_:1}),c(r,{class:"nc-iconfont nc-icon-jichuxinxiV6xx text-[26rpx]"})]),_:1})):k("v-if",!0)]),_:1})]),_:1}),v.value.config.pay_info_switch?(i(),u(d,{key:0,class:"card-template sidebar-margin mb-[var(--top-m)]"},{default:p(()=>["[]"!==JSON.stringify(v.value.trade_info)&&v.value.trade_info.item_list.length?(i(),y(g,{key:0},[c(d,{class:"flex justify-between items-center mb-[30rpx]"},{default:p(()=>[c(d,{class:"text-[30rpx] text-[#333] font-500"},{default:p(()=>[f(x(_(m)("helpPayInfo")),1)]),_:1}),k(' <view class="flex-shrink-0" @click="handleMessage" v-if="friendsInfo.config.pay_explain_switch">\r\n                            <text class="mr-[8rpx] text-[24rpx]">{{ friendsInfo.config.pay_explain_title }}</text>\r\n                            <text class="nc-iconfont nc-icon-jichuxinxiV6xx text-[26rpx]"></text>\r\n                        </view> ')]),_:1}),c(d,{class:"border-0 border-solid border-b-[1rpx] border-[#f6f6f6] mb-[20rpx]"},{default:p(()=>[(i(!0),y(g,null,b(v.value.trade_info.item_list,(e,a)=>(i(),u(d,{class:L(["flex justify-between",{" mb-[34rpx]":a+1!=v.value.trade_info.length}])},{default:p(()=>[c(d,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden flex-shrink-0"},{default:p(()=>[c(C,{class:"overflow-hidden",radius:"var(--goods-rounded-big)",width:"170rpx",height:"170rpx",src:_(h)(e.item_image?e.item_image:""),model:"aspectFill"},{error:p(()=>[c(T,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden",src:_(h)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])]),_:2},1032,["src"])]),_:2},1024),c(d,{class:"ml-[20rpx] flex flex-1 flex-col justify-between"},{default:p(()=>[c(d,null,{default:p(()=>[c(d,{class:"text-[28rpx] using-hidden leading-[40rpx] text-[#333]"},{default:p(()=>[f(x(e.item_name),1)]),_:2},1024),e.item_sub_name?(i(),u(d,{key:0,class:"text-[24rpx] mt-[14rpx] text-[var(--text-color-light9)] using-hidden leading-[28rpx]"},{default:p(()=>[f(x(e.item_sub_name),1)]),_:2},1024)):k("v-if",!0)]),_:2},1024),c(d,{class:"flex justify-between items-baseline"},{default:p(()=>[c(d,{class:"price-font text-[#FF4142]"},{default:p(()=>[c(r,{class:"text-[24rpx]"},{default:p(()=>[f("￥")]),_:1}),c(r,{class:"text-[40rpx] font-500"},{default:p(()=>[f(x(parseFloat(e.item_price).toFixed(2).split(".")[0]),1)]),_:2},1024),c(r,{class:"text-[24rpx] font-500"},{default:p(()=>[f("."+x(parseFloat(e.item_price).toFixed(2).split(".")[1]),1)]),_:2},1024)]),_:2},1024),c(r,{class:"text-right text-[26rpx]"},{default:p(()=>[f("x"+x(e.item_num),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]))),256))]),_:1}),c(d,{class:"text-[26rpx] text-right"},{default:p(()=>[f(x(v.value.trade_info.item_total),1)]),_:1})],64)):(i(),u(d,{key:1,class:"text-[28rpx] leading-[40rpx] text-[#333]"},{default:p(()=>[f(x(v.value.body),1)]),_:1}))]),_:1})):k("v-if",!0)]),_:1})):k("v-if",!0),k(" 帮付说明 "),c(Z,{ref_key:"messageRef",ref:$},null,512),k(" 支付 "),c(I,{ref_key:"payRef",ref:G},null,512),c(P,{loading:t.value},null,8,["loading"])]),_:1},8,["style"])]),_:1})}}}),[["__scopeId","data-v-15419211"]]);export{Q as default};
