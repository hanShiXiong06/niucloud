import{d as e,r as a,s as l,x as s,L as t,y as c,O as u,o as r,c as d,w as i,e as n,i as o,Y as f,a9 as v,Z as _,B as p,D as y,f as m,J as k,m as g,au as h,k as x,l as b,p as C,C as w,A as j,b as z}from"./index-5dd3a833.js";import{_ as I}from"./u-icon.2d8c39b5.js";import{_ as F}from"./u-input.c864510e.js";import{_ as E}from"./tabbar.1857a260.js";import{u as V,g as A,a as B}from"./order.2cdbbcae.js";import{_ as D}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-safe-bottom.94dec507.js";const M=D(e({__name:"list",setup(e){const D=a([]),M=a([]),S=a(""),$=a(1),q=a(10),J=a(!0),L=a(!1),O=a({}),P=a("all"),R=l(()=>"all"===P.value?D.value:D.value.filter(e=>e.delivery_type===P.value)),T=async e=>{P.value=e,await U()},U=async()=>{try{const e={page:$.value,page_size:q.value,status:S.value||void 0,delivery_type:"all"===P.value?void 0:P.value,search:N.value.trim()||void 0},a=await A(e);1===a.code&&(1===$.value?D.value=a.data.data:D.value=[...D.value,...a.data.data],J.value=a.data.current_page<a.data.last_page,a.data.status_count&&(O.value=a.data.status_count))}catch(e){console.error("获取订单列表失败:",e)}},X=async()=>{J.value&&(console.log(22),$.value++,await U())},Y=async()=>{L.value=!0,$.value=1,await U(),L.value=!1},Z=async()=>{try{const e=await B();1===e.code&&(M.value=e.data.list,O.value=e.data.status_count)}catch(e){console.error("获取状态列表失败:",e)}},G=e=>{z({url:`/addon/recycle/pages/order/detail?id=${e.id}`,mode:"navigateTo"})},H={1:"pending",2:"checking",3:"checked",4:"paying",5:"payed",6:"completed",7:"cancelled",8:"returning",9:"returned"},K=a(!1),N=a(""),Q=()=>{N.value="",U()},W=()=>{N.value.trim()&&($.value=1,U())},ee=s({});return t(e=>{console.log("Page loaded with options:",e,"pending_inspection"===e.status),"pending_inspection"===e.status?S.value="1":"processing"===e.status?S.value="2":"inspected"===e.status?S.value="3":"pending_confirm"===e.status?S.value="5":S.value=e.status}),c(()=>{Z().then(()=>{U()})}),u(async()=>{await V().request("recycle_order_sign,recycle_order_agree,recycle_order_pay"),Z(),U()}),(e,a)=>{const l=k,s=g,t=h,c=x(b("up-icon"),I),u=x(b("up-input"),F),z=x(b("tabbar"),E),V=C("layout-default-uni");return r(),d(V,null,{default:i(()=>[n(s,{class:"page"},{default:i(()=>[o(" 顶部状态切换 "),n(s,{class:"header-section"},{default:i(()=>[n(s,{class:"nav-header"},{default:i(()=>[n(t,{class:"status-nav","scroll-x":""},{default:i(()=>[n(s,{class:"nav-items"},{default:i(()=>[(r(!0),f(_,null,v(M.value,(e,a)=>(r(),d(s,{key:a,class:y(["nav-item",{active:S.value===e.key}]),onClick:a=>(async e=>{S.value=e,$.value=1,D.value=[],J.value=!0,await U()})(e.key)},{default:i(()=>[p(w(e.text)+" ",1),e.count&&"all"!=e.key?(r(),d(l,{key:0,class:"count"},{default:i(()=>[p(w(e.count),1)]),_:2},1024)):o("v-if",!0)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})]),_:1}),o(" 搜索 "),n(s,{class:"search-section"},{default:i(()=>[n(s,{class:"search-bar"},{default:i(()=>[n(s,{class:"search-input"},{default:i(()=>[n(c,{size:"22",name:"search"}),n(u,{type:"text",border:"none",modelValue:N.value,"onUpdate:modelValue":a[0]||(a[0]=e=>N.value=e),clearable:"",placeholder:"搜索订单号/IMEI","confirm-type":"search",onCancel:Q,onConfirm:W},null,8,["modelValue"]),N.value?(r(),d(l,{key:0,class:"iconfont icon-close",onClick:Q})):o("v-if",!0)]),_:1}),n(l,{class:"cancel-search",onClick:W},{default:i(()=>[p("搜索")]),_:1})]),_:1})]),_:1}),o(" 配送方式筛选 "),n(s,{class:"delivery-filter"},{default:i(()=>[n(s,{class:"filter-options"},{default:i(()=>[n(s,{class:y(["filter-item",{active:"all"===P.value}]),onClick:a[1]||(a[1]=e=>T("all"))},{default:i(()=>[p(" 全部配送 ")]),_:1},8,["class"]),n(s,{class:y(["filter-item",{active:"1"===P.value}]),onClick:a[2]||(a[2]=e=>T("1"))},{default:i(()=>[p(" 邮寄配送 ")]),_:1},8,["class"]),n(s,{class:y(["filter-item",{active:"2"===P.value}]),onClick:a[3]||(a[3]=e=>T("2"))},{default:i(()=>[p(" 自行配送 ")]),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),o(" 订单列表 "),n(t,{"scroll-y":"",class:y(["order-list",{"has-search":K.value}]),onScrolltolower:X,"refresher-enabled":!0,"refresher-triggered":L.value,onRefresherrefresh:Y},{default:i(()=>[(r(!0),f(_,null,v(m(R),(e,a)=>(r(),d(s,{class:"order-item",key:a},{default:i(()=>[o(" 订单头部 "),n(s,{class:"item-index"},{default:i(()=>[p(w(e.order_no),1)]),_:2},1024),n(s,{class:"order-header",onClick:a=>G(e)},{default:i(()=>[n(s,{class:"header-left mt-3"},{default:i(()=>[n(l,{class:"time"},{default:i(()=>[p("创建时间: "+w(e.create_at),1)]),_:2},1024)]),_:2},1024),n(s,{class:"header-right"},{default:i(()=>[n(s,null,{default:i(()=>{return[n(l,{class:y(["order-status",(a=e.status,H[a]||"pending")])},{default:i(()=>[p(w(e.status_name||"已删除"),1)]),_:2},1032,["class"])];var a}),_:2},1024),n(s,{class:"delivery-type-tag"},{default:i(()=>[n(l,null,{default:i(()=>[p(w("1"==e.delivery_type?"邮寄":"自送"),1)]),_:2},1024),"1"==e.delivery_type?(r(),d(l,{key:0,class:"express-id"},{default:i(()=>[p(" | "+w(e.express_no||"暂无单号"),1)]),_:2},1024)):o("v-if",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]),o(" 订单内容 "),n(s,{class:"order-content",onClick:a=>G(e)},{default:i(()=>[o(" 设备信息 "),n(s,{class:"device-info"},{default:i(()=>[e.devices.length>0?(r(),d(s,{key:0,class:"device-list"},{default:i(()=>[(r(!0),f(_,null,v(ee[e.id]?e.devices:e.devices.slice(0,3),(e,a)=>(r(),d(s,{class:"device-item",key:a},{default:i(()=>[n(s,null,{default:i(()=>[n(s,{class:"model"},{default:i(()=>[p(w(e.model||"待识别"),1)]),_:2},1024),n(s,{class:"imei text-sm"},{default:i(()=>[p("IMEI: "+w(e.imei),1)]),_:2},1024)]),_:2},1024),n(s,{class:""},{default:i(()=>["0.00"!==e.final_price?(r(),d(l,{key:0,class:"price"},{default:i(()=>[p(" ¥"+w(e.final_price),1)]),_:2},1024)):o("v-if",!0),1==e.status?(r(),d(l,{key:1,class:"price pending"},{default:i(()=>[p(" 待质检 ")]),_:1})):2==e.status?(r(),d(l,{key:2,class:"price checking"},{default:i(()=>[p(" 质检中 ")]),_:1})):3==e.status?(r(),d(l,{key:3,class:"price checked"},{default:i(()=>[p(" 已质检 ")]),_:1})):4==e.status?(r(),d(l,{key:4,class:"price text-[#d3483e] bg-[#f3dddb]"},{default:i(()=>[p(" 待确认 ")]),_:1})):5==e.status?(r(),d(l,{key:5,class:"price completed"},{default:i(()=>[p(" 已确认 ")]),_:1})):6==e.status?(r(),d(l,{key:6,class:"price completed"},{default:i(()=>[p(" 已完成 ")]),_:1})):(r(),d(l,{key:7,class:"price returned"},{default:i(()=>[p(" 已退回 ")]),_:1}))]),_:2},1024)]),_:2},1024))),128)),o(" 展开/折叠按钮 "),e.devices.length>3?(r(),d(s,{key:0,class:"expand-toggle",onClick:j(a=>{return l=e.id,void(ee[l]=!ee[l]);var l},["stop"])},{default:i(()=>[n(l,null,{default:i(()=>[p(w(ee[e.id]?"收起":`展开更多(${e.devices.length-3})`),1)]),_:2},1024),n(c,{name:ee[e.id]?"arrow-up":"arrow-down",size:"14",color:"#666"},null,8,["name"])]),_:2},1032,["onClick"])):o("v-if",!0)]),_:2},1024)):o("v-if",!0)]),_:2},1024)]),_:2},1032,["onClick"]),o(" 个人信息 "),o(" 订单底部 "),0!==e.devices.length&&"1"!=e.status?(r(),d(s,{key:0,class:"order-footer"},{default:i(()=>[o(' <view class="total-info order-footer flex "> '),n(l,null,{default:i(()=>[p("共"),n(l,{class:"device-count"},{default:i(()=>[p(w(e.devices.length),1)]),_:2},1024),p("台设备")]),_:2},1024),n(l,{class:"total-label flex ml-2"},{default:i(()=>[n(l,{class:"text-xs mr-1"},{default:i(()=>[p("总价")]),_:1}),n(l,{class:"total-price"},{default:i(()=>{return[p("¥"+w((a=e,a.devices.reduce((e,a)=>e+(parseFloat(a.final_price)||0),0).toFixed(2))),1)];var a}),_:2},1024)]),_:2},1024),o(" </view> "),o(' <view class="action-buttons">\n\n                        <button v-for="(btn, index) in renderActionButtons(item)" :key="index"\n                            :class="[\'btn\', btn.class]" @click.stop="updateStatus(item, btn.type)">\n                            {{ btn.text }}\n                        </button>\n                    </view> ')]),_:2},1024)):(r(),d(s,{key:1,class:"order-footer"},{default:i(()=>[n(l,{class:"mr-1 text-xs"},{default:i(()=>[p("共"),n(l,{class:"device-count"},{default:i(()=>[p(w(e.count),1)]),_:2},1024),p("台设备")]),_:2},1024),n(s,{class:"mr-1 flex"},{default:i(()=>[n(c,{class:"mr-1",name:"info-circle",size:"16",color:"#FFD700"}),n(l,{class:"text-xs"},{default:i(()=>[p("最终信息以商家确认为准 ")]),_:1})]),_:1})]),_:2},1024))]),_:2},1024))),128)),o(" 空状态 "),0===D.value.length?(r(),d(s,{key:0,class:"empty-state"},{default:i(()=>[n(c,{name:"order",size:"64",color:"#CCCCCC"}),n(l,null,{default:i(()=>[p("暂无订单息")]),_:1})]),_:1})):o("v-if",!0),o(" 加载更多 "),D.value.length>0?(r(),d(s,{key:1,class:"loading-more"},{default:i(()=>[J.value?(r(),d(l,{key:0},{default:i(()=>[p("加载中...")]),_:1})):(r(),d(l,{key:1},{default:i(()=>[p("没有更多了")]),_:1}))]),_:1})):o("v-if",!0)]),_:1},8,["refresher-triggered","class"]),o(" tabbar "),n(z,{addon:"recycle"})]),_:1})]),_:1})}}}),[["__scopeId","data-v-a69bf6a1"]]);export{M as default};
