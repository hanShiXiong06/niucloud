import{d as e,a as l,s as a,r,q as t,t as o,L as s,N as u,E as i,b as n,M as p,x as d,y as m,o as c,c as x,w as f,j as b,e as g,B as _,C as h,f as v,Y as y,i as k,Z as w,A as j,_ as C,G as V,H as T,$ as S,a0 as F,m as A,J as P,k as z,l as B,K as L,p as U,z as q,T as I}from"./index-c3bd19d7.js";import{_ as O}from"./u-input.20a1a434.js";import{_ as R,a as E}from"./u-form.aa4ab398.js";import{_ as G}from"./u-icon.fed07783.js";import{_ as H}from"./sms-code.vue_vue_type_script_setup_true_lang.396ab113.js";import{_ as J}from"./u-checkbox.629328c6.js";import{_ as K}from"./u-checkbox-group.20dda01a.js";import{_ as N}from"./uni-popup.1149496b.js";import{t as $}from"./topTabbar.9a3c8195.js";import{_ as M}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-line.5f9fdeba.js";import"./u-modal.383b850c.js";import"./u-loading-icon.e306857f.js";import"./u-popup.3041e24a.js";import"./u-transition.35c8ef6d.js";import"./u-safe-bottom.d8b3ca1a.js";const Y=M(e({__name:"login",setup(e){const M=l();$().setTopTabbarParam({title:"",topStatusBar:{bgColor:"#fff",textColor:"#333"}}),a(()=>Object.keys(M.menuButtonInfo).length?I(Number(M.menuButtonInfo.height))+I(M.menuButtonInfo.top)+I(8)+"rpx":"auto");const Y=r(!0),Z=t(),D=o(),Q=r(""),W=r(!1),X=r(!1),ee=r(),le=r(!0),ae=()=>{le.value=!le.value},re=()=>{ee.value.close()},te=()=>{W.value=!0,ee.value.close(),de()};s(async e=>{await D.getLoginConfig(),u()||D.login.is_username||D.login.is_mobile||(i({title:"商家未开启普通账号登录",icon:"none"}),setTimeout(()=>{n({url:"/app/pages/index/index",mode:"reLaunch"})},100)),uni.getStorageSync("openid")&&Object.assign(oe,{wx_openid:uni.getStorageSync("openid")}),e.type?"mobile"==e.type?D.login.is_mobile&&(Q.value=e.type,uni.getStorageSync("pid")&&Object.assign(oe,{pid:uni.getStorageSync("pid")})):"username"==e.type&&D.login.is_username&&(Q.value=e.type):D.login.is_username?Q.value="username":D.login.is_mobile&&(Q.value="mobile"),p()&&D.login.is_auth_register?X.value=!0:X.value=!1});const oe=d({username:"",password:"",mobile:"",mobile_code:"",mobile_key:""});m(()=>{setTimeout(()=>{Y.value=!1},800)});const se=()=>{W.value=!W.value},ue=()=>{Q.value="username"==Q.value?"mobile":"username"},ie=r(!1),ne=a(()=>({username:{type:"string",required:"username"==Q.value,message:q("usernamePlaceholder"),trigger:["blur","change"]},password:{type:"string",required:"username"==Q.value,message:q("passwordPlaceholder"),trigger:["blur","change"]},mobile:[{type:"string",required:"mobile"==Q.value,message:q("mobilePlaceholder"),trigger:["blur","change"]},{validator:(e,l)=>"mobile"!=Q.value||uni.$u.test.mobile(l),message:q("mobileError"),trigger:["change","blur"]}],mobile_code:{type:"string",required:"mobile"==Q.value,message:q("codePlaceholder"),trigger:["blur","change"]}})),pe=r(null),de=()=>{pe.value.validate().then(()=>{if(D.login.agreement_show&&!W.value)return ee.value.open(),!1;if(ie.value)return;ie.value=!0;("username"==Q.value?C:V)(oe).then(e=>{Z.setToken(e.data.token),T().handleLoginBack()}).catch(()=>{ie.value=!1})})},me=()=>{const e=S();if(e.length>1){"app/pages/auth/index"==e[e.length-2].route?F({delta:1}):n({url:"/app/pages/auth/index",mode:"redirectTo"})}else n({url:"/app/pages/auth/index",mode:"redirectTo"})},ce=()=>{"username"==Q.value&&n({url:"/app/pages/auth/resetpwd"})};return(e,l)=>{const a=A,r=P,t=z(B("u-input"),O),o=z(B("u-form-item"),R),s=z(B("u-icon"),G),u=z(B("sms-code"),H),i=z(B("u-form"),E),p=L,d=z(B("u-checkbox"),J),m=z(B("u-checkbox-group"),K),C=z(B("uni-popup"),N),V=U("layout-default-uni");return c(),x(V,null,{default:f(()=>[Q.value?(c(),x(a,{key:0,class:"w-screen h-screen flex flex-col",style:b(e.themeColor())},{default:f(()=>[g(a,{class:"mx-[60rpx]"},{default:f(()=>[g(a,{class:"pt-[140rpx] text-[44rpx] font-500 text-[#333]"},{default:f(()=>[_(h("username"==Q.value?v(q)("accountLogin"):v(q)("mobileLogin")),1)]),_:1}),g(a,{class:"text-[26rpx] text-[#333] leading-[34rpx] mt-[24rpx] mb-[90rpx]",onClick:l[0]||(l[0]=e=>v(n)({url:"/app/pages/auth/register",param:{type:Q.value}}))},{default:f(()=>[g(r,null,{default:f(()=>[_(h(v(q)("noAccount"))+",",1)]),_:1}),g(r,{class:"text-primary"},{default:f(()=>[_(h(v(q)("toRegister")),1)]),_:1})]),_:1}),g(i,{labelPosition:"left",model:oe,errorType:"toast",rules:v(ne),ref_key:"formRef",ref:pe},{default:f(()=>["username"==Q.value?(c(),y(w,{key:0},[g(a,{class:"h-[88rpx] flex w-full items-center px-[30rpx] rounded-[40rpx] box-border bg-[#F6F6F6]"},{default:f(()=>[g(o,{label:"",prop:"username","border-bottom":!1},{default:f(()=>[g(t,{modelValue:oe.username,"onUpdate:modelValue":l[1]||(l[1]=e=>oe.username=e),border:"none",maxlength:"40",placeholder:v(q)("usernamePlaceholder"),autocomplete:"off",class:"!bg-transparent",disabled:Y.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]"},null,8,["modelValue","placeholder","disabled"])]),_:1})]),_:1}),g(a,{class:"h-[88rpx] flex w-full items-center px-[30rpx] rounded-[40rpx] box-border bg-[#F6F6F6] mt-[40rpx]"},{default:f(()=>[g(o,{label:"",prop:"password","border-bottom":!1},{default:f(()=>[g(t,{modelValue:oe.password,"onUpdate:modelValue":l[2]||(l[2]=e=>oe.password=e),border:"none",password:le.value,maxlength:"40",placeholder:v(q)("passwordPlaceholder"),autocomplete:"new-password",class:"!bg-transparent",disabled:Y.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]"},{suffix:f(()=>[oe.password?(c(),x(a,{key:0,onClick:ae},{default:f(()=>[le.value?(c(),x(s,{key:0,name:"eye-off",color:"#b9b9b9",size:"20"})):(c(),x(s,{key:1,name:"eye-fill",color:"#b9b9b9",size:"20"}))]),_:1})):k("v-if",!0)]),_:1},8,["modelValue","password","placeholder","disabled"])]),_:1})]),_:1})],64)):k("v-if",!0),"mobile"==Q.value?(c(),y(w,{key:1},[g(a,{class:"h-[88rpx] flex w-full items-center px-[30rpx] rounded-[40rpx] box-border bg-[#F6F6F6]"},{default:f(()=>[g(o,{label:"",prop:"mobile","border-bottom":!1},{default:f(()=>[g(t,{modelValue:oe.mobile,"onUpdate:modelValue":l[3]||(l[3]=e=>oe.mobile=e),type:"number",maxlength:"11",border:"none",placeholder:v(q)("mobilePlaceholder"),autocomplete:"off",class:"!bg-transparent",disabled:Y.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]"},null,8,["modelValue","placeholder","disabled"])]),_:1})]),_:1}),g(a,{class:"h-[88rpx] flex w-full items-center px-[30rpx] rounded-[40rpx] box-border bg-[#F6F6F6] mt-[40rpx]"},{default:f(()=>[g(o,{label:"",prop:"mobile_code","border-bottom":!1},{default:f(()=>[g(t,{modelValue:oe.mobile_code,"onUpdate:modelValue":l[6]||(l[6]=e=>oe.mobile_code=e),type:"number",maxlength:"4",border:"none",class:"!bg-transparent",fontSize:"26rpx",disabled:Y.value,placeholder:v(q)("codePlaceholder"),placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]"},{suffix:f(()=>[v(D).login.agreement_show?(c(),x(u,{key:0,mobile:oe.mobile,type:"login",modelValue:oe.mobile_key,"onUpdate:modelValue":l[4]||(l[4]=e=>oe.mobile_key=e),isAgree:W.value},null,8,["mobile","modelValue","isAgree"])):(c(),x(u,{key:1,mobile:oe.mobile,type:"login",modelValue:oe.mobile_key,"onUpdate:modelValue":l[5]||(l[5]=e=>oe.mobile_key=e)},null,8,["mobile","modelValue"]))]),_:1},8,["modelValue","disabled","placeholder"])]),_:1})]),_:1})],64)):k("v-if",!0)]),_:1},8,["model","rules"]),g(a,{class:"h-[34rpx] text-right text-[24rpx] text-[var(--text-color-light6)] leading-[34rpx] mt-[20rpx]",onClick:ce},{default:f(()=>[_(h("username"==Q.value?v(q)("resetpwd"):""),1)]),_:1}),g(a,{class:"mt-[106rpx]"},{default:f(()=>[g(p,{class:"w-full h-[80rpx] !bg-[var(--primary-color)] text-[26rpx] rounded-[40rpx] leading-[80rpx] font-500 !text-[#fff] !mx-[0]",loadingText:v(q)("logining"),onClick:de},{default:f(()=>[_(h(v(q)("login")),1)]),_:1},8,["loadingText"]),v(D).login.agreement_show?(c(),x(a,{key:0,class:"flex items-center mt-[20rpx] py-[14rpx]",onClick:j(se,["stop"])},{default:f(()=>[g(m,{onChange:se},{default:f(()=>[g(d,{activeColor:"var(--primary-color)",checked:W.value,shape:"circle",size:"24rpx"},null,8,["checked"])]),_:1}),g(a,{class:"text-[24rpx] text-[var(--text-color-light6)] flex items-center flex-wrap leading-[30rpx]"},{default:f(()=>[g(r,null,{default:f(()=>[_(h(v(q)("agreeTips")),1)]),_:1}),g(r,{onClick:l[7]||(l[7]=j(e=>v(n)({url:"/app/pages/auth/agreement?key=privacy"}),["stop"])),class:"text-primary"},{default:f(()=>[_("《"+h(v(q)("privacyAgreement"))+"》",1)]),_:1}),g(r,null,{default:f(()=>[_(h(v(q)("and")),1)]),_:1}),g(r,{onClick:l[8]||(l[8]=j(e=>v(n)({url:"/app/pages/auth/agreement?key=service"}),["stop"])),class:"text-primary"},{default:f(()=>[_("《"+h(v(q)("userAgreement"))+"》",1)]),_:1})]),_:1})]),_:1},8,["onClick"])):k("v-if",!0)]),_:1})]),_:1}),g(C,{ref_key:"popupRef",ref:ee,type:"dialog"},{default:f(()=>[g(a,{class:"bg-[#fff] flex flex-col justify-between w-[600rpx] min-h-[280rpx] rounded-[var(--rounded-big)] box-border px-[35rpx] pt-[35rpx] pb-[8rpx] relative"},{default:f(()=>[g(a,{class:"flex justify-center"},{default:f(()=>[g(r,{class:"text-[33rpx] font-700"},{default:f(()=>[_(" 用户协议及隐私保护")]),_:1})]),_:1}),g(a,{class:"flex items-center mb-[20rpx] mt-[20rpx] py-[20rpx]",onClick:j(se,["stop"])},{default:f(()=>[g(a,{class:"text-[26rpx] text-[var(--text-color-light6)] flex items-center flex-wrap"},{default:f(()=>[g(r,null,{default:f(()=>[_(h(v(q)("agreeTips")),1)]),_:1}),g(r,{onClick:l[9]||(l[9]=j(e=>v(n)({url:"/app/pages/auth/agreement?key=privacy"}),["stop"])),class:"text-primary"},{default:f(()=>[_("《"+h(v(q)("privacyAgreement"))+"》",1)]),_:1}),g(r,null,{default:f(()=>[_(h(v(q)("and")),1)]),_:1}),g(r,{onClick:l[10]||(l[10]=j(e=>v(n)({url:"/app/pages/auth/agreement?key=service"}),["stop"])),class:"text-primary"},{default:f(()=>[_("《"+h(v(q)("userAgreement"))+"》",1)]),_:1})]),_:1})]),_:1},8,["onClick"]),g(a,null,{default:f(()=>[g(a,{class:"w-[100%] flex justify-center bg-[var(--primary-color)] h-[70rpx] leading-[70rpx] text-[#fff] text-[26rpx] border-[0] font-500 rounded-[50rpx]",onClick:te},{default:f(()=>[_("同意并登录")]),_:1}),g(a,{class:"w-[100%] flex justify-center h-[70rpx] leading-[70rpx] text-[#999] text-[24rpx] border-[0] font-500 rounded-[50rpx]",onClick:re},{default:f(()=>[_("不同意")]),_:1})]),_:1})]),_:1})]),_:1},512),"mobile"==Q.value&&v(D).login.is_username||"username"==Q.value&&v(D).login.is_mobile||X.value?(c(),x(a,{key:0,class:"footer w-full"},{default:f(()=>[g(a,{class:"text-[26rpx] leading-[36rpx] text-[#666] text-center mb-[30rpx] font-400"},{default:f(()=>[_("其他登录方式")]),_:1}),g(a,{class:"flex justify-center gap-[40rpx]"},{default:f(()=>["mobile"==Q.value&&v(D).login.is_username?(c(),x(r,{key:0,onClick:ue,class:"w-[66rpx] h-[66rpx] flex items-center justify-center iconfont iconmima6Vmm border-[2rpx] rounded-[50%] border-solid border-[#ddd] !text-[26rpx]"})):k("v-if",!0),"username"==Q.value&&v(D).login.is_mobile?(c(),x(r,{key:1,onClick:ue,class:"w-[66rpx] h-[66rpx] flex items-center justify-center iconfont iconshouji6Vmm border-[2rpx] rounded-[50%] border-solid border-[#ddd] !text-[26rpx]"})):k("v-if",!0),X.value?(c(),x(r,{key:2,onClick:me,class:"w-[66rpx] h-[66rpx] !text-[#1AAB37] flex items-center justify-center iconfont iconweixinV6mm1 border-[2rpx] rounded-[50%] border-solid border-[#ddd] !text-[26rpx]"})):k("v-if",!0)]),_:1})]),_:1})):k("v-if",!0)]),_:1},8,["style"])):k("v-if",!0)]),_:1})}}}),[["__scopeId","data-v-b5ad74bb"]]);export{Y as default};
