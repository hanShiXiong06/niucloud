import{d as e,r as t,q as a,s as r,t as l,x as o,y as n,z as i,k as s,l as u,o as p,c,w as d,e as m,A as g,B as x,C as f,f as _,b,i as y,D as v,E as h,F as k,G as S,H as w,m as j,I as C,J as A,K as T,a as V,L,M as B,N as I,O as M,j as O,P,Q as z,R as F,p as q,S as E,T as R}from"./index-0259f5df.js";import{_ as U,a as N}from"./u-checkbox-group.22792735.js";import{_ as D}from"./uni-popup.c69c35d2.js";import{_ as G,a as H}from"./u-form.acd3204a.js";import{_ as J}from"./sms-code.vue_vue_type_script_setup_true_lang.ce0a56c0.js";import{_ as K}from"./u-popup.6f1fa414.js";import{_ as Q}from"./_plugin-vue_export-helper.1b428a4d.js";import{t as $}from"./topTabbar.6a4f0c22.js";import"./u-icon.e993510c.js";import"./u-line.2127c15d.js";import"./u-input.8fd8730e.js";import"./u-modal.11814531.js";import"./u-loading-icon.d4562dd7.js";import"./u-transition.9813ca7a.js";const W=Q(e({__name:"bind-mobile",setup(e,{expose:V}){const L=t(!1),B=a(),I=r(()=>B.info),M=r(()=>l().login),O=t(!1),P=t(!1),z=o({mobile:"",mobile_code:"",mobile_key:""}),F=t(!0);n(()=>{setTimeout(()=>{F.value=!1},800),uni.getStorageSync("pid")&&Object.assign(z,{pid:uni.getStorageSync("pid")}),uni.getStorageSync("openid")&&Object.assign(z,{openid:uni.getStorageSync("openid")}),uni.getStorageSync("unionid")&&Object.assign(z,{unionid:uni.getStorageSync("unionid")}),uni.getStorageSync("nickname")&&Object.assign(z,{nickname:uni.getStorageSync("nickname")}),uni.getStorageSync("avatar")&&Object.assign(z,{headimg:uni.getStorageSync("avatar")})});const q={mobile:[{type:"string",required:!0,message:i("mobilePlaceholder"),trigger:["blur","change"]},{validator(e,t,a){uni.$u.test.mobile(t)?a():a(new Error("请输入正确的手机号"))},message:i("mobileError"),trigger:["change","blur"]}],mobile_code:{type:"string",required:!0,message:i("codePlaceholder"),trigger:["blur","change"]}},E=()=>{P.value=!P.value},R=t(null),D=()=>{R.value.validate().then(()=>{if(!P.value&&M.value.agreement_show)return void h({title:i("isAgreeTips"),icon:"none"});if(O.value)return;O.value=!0;const e=I.value?k:S;uni.getStorageSync("avatar")&&uni.getStorageSync("nickname")&&uni.getStorageSync("openid")&&uni.getStorageSync("unionid")&&(z.avatar=uni.getStorageSync("avatar"),z.nickname=uni.getStorageSync("nickname"),z.openid=uni.getStorageSync("openid"),z.unionid=uni.getStorageSync("unionid")),e(z).then(e=>{I.value?(B.getMemberInfo(),I.value.mobile&&uni.removeStorageSync("isBindMobile")):(B.setToken(e.data.token),w().handleLoginBack()),L.value=!1}).catch(()=>{O.value=!1})})};return V({open:()=>{L.value=!0}}),(e,t)=>{const a=j,r=C,l=s(u("u-form-item"),G),o=s(u("sms-code"),J),n=s(u("u-checkbox"),U),h=s(u("u-checkbox-group"),N),k=A,S=T,w=s(u("u-form"),H),V=s(u("u-popup"),K);return p(),c(V,{show:L.value,onClose:t[7]||(t[7]=e=>L.value=!1),mode:"center",round:10,closeable:!0,safeAreaInsetBottom:!1,zIndex:"10086"},{default:d(()=>[m(a,{onTouchmove:t[6]||(t[6]=g(()=>{},["prevent","stop"])),class:"max-w-[600rpx] w-[600rpx] box-border"},{default:d(()=>[m(a,{class:"text-center py-[var(--pad-top-m)] text-[32rpx] font-500 leading-[46rpx]"},{default:d(()=>[x(f(_(i)("bindMobile")),1)]),_:1}),m(a,{class:"px-[var(--pad-sidebar-m)] pb-[var(--pad-top-m)]"},{default:d(()=>[m(w,{labelPosition:"left",model:z,errorType:"toast",rules:q,ref_key:"formRef",ref:R},{default:d(()=>[m(l,{label:"",prop:"mobile",borderBottom:!0},{default:d(()=>[m(r,{modelValue:z.mobile,"onUpdate:modelValue":t[0]||(t[0]=e=>z.mobile=e),type:"number",maxlength:"11",placeholder:_(i)("mobilePlaceholder"),class:"w-full h-[50rpx] leading-[50rpx] !bg-transparent !px-[20rpx] text-[26rpx] text-[#333]",disabled:F.value,"placeholder-class":"bind-mobile"},null,8,["modelValue","placeholder","disabled"])]),_:1}),m(a,{class:"mt-[20rpx]"},{default:d(()=>[m(l,{label:"",prop:"mobile_code",borderBottom:!0},{right:d(()=>[_(M).agreement_show?(p(),c(o,{key:0,mobile:z.mobile,type:"login",modelValue:z.mobile_key,"onUpdate:modelValue":t[2]||(t[2]=e=>z.mobile_key=e),isAgree:P.value},null,8,["mobile","modelValue","isAgree"])):(p(),c(o,{key:1,mobile:z.mobile,type:"login",modelValue:z.mobile_key,"onUpdate:modelValue":t[3]||(t[3]=e=>z.mobile_key=e)},null,8,["mobile","modelValue"]))]),default:d(()=>[m(r,{modelValue:z.mobile_code,"onUpdate:modelValue":t[1]||(t[1]=e=>z.mobile_code=e),type:"number",maxlength:"6",placeholder:_(i)("codePlaceholder"),class:"box-border w-full h-[50rpx] leading-[50rpx] !bg-transparent !px-[20rpx] text-[26rpx] text-[#333]",disabled:F.value,"placeholder-class":"bind-mobile"},null,8,["modelValue","placeholder","disabled"])]),_:1})]),_:1}),_(M).agreement_show?(p(),c(a,{key:0,class:"flex items-center mt-[30rpx] pl-[10rpx] py-[10rpx]",onClick:g(E,["stop"])},{default:d(()=>[m(h,{onChange:E},{default:d(()=>[m(n,{activeColor:"var(--primary-color)",checked:P.value,shape:"circle",size:"28rpx"},null,8,["checked"])]),_:1}),m(a,{class:"text-[24rpx] text-[var(--text-color-light6)] flex items-center flex-wrap"},{default:d(()=>[m(k,null,{default:d(()=>[x(f(_(i)("agreeTips")),1)]),_:1}),m(k,{onClick:t[4]||(t[4]=g(e=>_(b)({url:"/app/pages/auth/agreement?key=privacy"}),["stop"])),class:"text-primary"},{default:d(()=>[x("《"+f(_(i)("privacyAgreement"))+"》",1)]),_:1}),m(k,null,{default:d(()=>[x(f(_(i)("and")),1)]),_:1}),m(k,{onClick:t[5]||(t[5]=g(e=>_(b)({url:"/app/pages/auth/agreement?key=service"}),["stop"])),class:"text-primary"},{default:d(()=>[x("《"+f(_(i)("userAgreement"))+"》",1)]),_:1})]),_:1})]),_:1},8,["onClick"])):y("v-if",!0),m(a,{class:"mt-[100rpx]"},{default:d(()=>[m(S,{class:v(["primary-btn-bg text-[26rpx] !text-[#fff] !h-[80rpx] leading-[80rpx] rounded-full font-500",{"opacity-50":O.value}]),disabled:O.value,onClick:D},{default:d(()=>[x(f(_(i)("bind")),1)]),_:1},8,["class","disabled"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1},8,["show"])}}}),[["__scopeId","data-v-5402c2a5"]]),X=Q(e({__name:"index",setup(e){const o=V();$().setTopTabbarParam({title:"",topStatusBar:{textColor:"#333"}}),r(()=>Object.keys(o.menuButtonInfo).length?R(Number(o.menuButtonInfo.height))+R(o.menuButtonInfo.top)+R(8)+"rpx":"auto");const n=t(""),v=t(!1),k=l(),S=r(()=>k.login),C=w();a(),r(()=>a().info),r(()=>!v.value&&k.login.agreement_show?"":"getPhoneNumber"),t(null);const G=r(()=>!k.login.is_auth_register),H=t(!1);t(!1);const J=t(),K=()=>{J.value.close()},Q=()=>{v.value=!0,J.value.close(),ee()},X=t(null),Y=()=>{X.value.open()};L(async()=>{await o.getSiteInfoFn(),await o.getMemberMobileExistFn(),await k.getLoginConfig();let e=!k.login.is_username&&!k.login.is_mobile&&!k.login.is_bind_mobile;B()?!I()&&e&&G.value&&(h({title:"商家未开启登录注册",icon:"none"}),setTimeout(()=>{b({url:"/app/pages/index/index",mode:"reLaunch"})},100)):!I()&&e&&(h({title:"商家未开启登录注册",icon:"none"}),setTimeout(()=>{b({url:"/app/pages/index/index",mode:"reLaunch"})},100))}),M(()=>{H.value=!1});const Z=r(()=>{let e="";return k.login.bg_url&&(e+="background-image:url("+E(k.login.bg_url)+");",e+="background-size: 100%;",e+="background-position: top;",e+="background-repeat: no-repeat;"),e}),ee=(e=null,t=null)=>{((e="")=>!(v.value||!k.login.agreement_show||(e?h({title:i("isAgreeTips"),icon:"none"}):J.value.open(),0)))()||H.value||(P({title:"正在登录中",mask:!0}),H.value=!0,e||(e=()=>{H.value=!1,z()}),te())},te=()=>{if(B()){let e=uni.getStorageSync("login_config");if(uni.getStorageSync("member_lock"))return h({title:i("memberLock"),icon:"none"}),void setTimeout(()=>{uni.removeStorageSync("member_lock"),b({url:"/app/pages/index/index",mode:"reLaunch"})},1e3);if(e.wechat_error)return H.value=!1,z(),void h({title:e.wechat_error,icon:"none"});n.value=uni.getStorageSync("member_mobile_exist");let t=uni.getStorageSync("member_exist");e.is_auth_register?!n.value&&e.is_bind_mobile&&!t&&e.is_force_access_user_info?uni.getStorageSync("openid")&&uni.getStorageSync("nickname")&&uni.getStorageSync("avatar")?(Y(),uni.removeStorageSync("mandatory_Mobile")):(uni.setStorageSync("mandatory_Mobile",!0),C.getAuthCode({scopes:"snsapi_userinfo"})):n.value||!e.is_bind_mobile||t?e.is_force_access_user_info?C.getAuthCode({scopes:"snsapi_userinfo"}):e.is_force_access_user_info||C.getAuthCode({scopes:"snsapi_base"}):Y():n.value||!e.is_bind_mobile||t?C.getAuthCode({scopes:"snsapi_base"}):Y(),H.value=!1,z()}},ae=()=>{v.value=!v.value};return(e,t)=>{const a=F,r=j,l=T,n=s(u("u-checkbox"),U),h=s(u("u-checkbox-group"),N),k=A,w=s(u("uni-popup"),D),C=s(u("bind-mobile"),W),V=q("layout-default-uni");return p(),c(V,null,{default:d(()=>[m(r,{class:"w-screen h-screen",style:O(e.themeColor())},{default:d(()=>[m(r,{class:"w-screen h-screen",style:O(_(Z))},{default:d(()=>[m(r,{class:"mx-[var(--sidebar-m)] px-[var(--pad-sidebar-m)]"},{default:d(()=>[m(r,{class:"pt-[154rpx] flex justify-center"},{default:d(()=>{var e,t;return[(null==(e=_(o).site)?void 0:e.front_end_logo)?(p(),c(r,{key:0,class:"h-[90rpx] w-[300rpx]"},{default:d(()=>{var e;return[m(a,{class:"h-[90rpx] w-[300rpx]",src:_(E)(null==(e=_(o).site)?void 0:e.front_end_logo),mode:"aspectFit"},null,8,["src"])]}),_:1})):(null==(t=_(o).site)?void 0:t.front_end_icon)?(p(),c(r,{key:1,class:"h-[250rpx] w-[250rpx]"},{default:d(()=>{var e;return[m(a,{class:"h-[250rpx] w-[250rpx]",src:_(E)(null==(e=_(o).site)?void 0:e.front_end_icon),mode:"aspectFit"},null,8,["src"])]}),_:1})):(p(),c(r,{key:2,class:"h-[90rpx] w-[300rpx]"}))]}),_:1}),m(r,{class:"text-[var(--text-color-light6)]] text-[28rpx] text-center leading-[34rpx] min-h-[34rpx] mt-[40rpx]"},{default:d(()=>[x(f(_(S).desc),1)]),_:1}),m(r,{class:"mt-[181rpx]"},{default:d(()=>[y(" 微信公众号快捷登录，开启自动注册的情况下才能使用 "),_(B)()&&_(S).is_auth_register?(p(),c(r,{key:0,class:"w-full flex items-center justify-center mb-[40rpx]"},{default:d(()=>[m(l,{class:"w-[630rpx] h-[88rpx] !mx-[0] !bg-[var(--primary-color)] text-[26rpx] rounded-[44rpx] leading-[88rpx] font-500 !text-[#fff]",onClick:t[0]||(t[0]=e=>ee())},{default:d(()=>[x(f(_(i)("quickLoginOrLogout")),1)]),_:1})]),_:1})):y("v-if",!0),y(" 手机号登录 "),_(S).is_mobile?(p(),c(r,{key:1,class:"mb-[40rpx] w-full flex items-center justify-center"},{default:d(()=>[m(l,{class:"w-[630rpx] h-[88rpx] !mx-[0] !bg-[#fff] border-[var(--primary-color)] border-solid border-[2rpx] text-[26rpx] rounded-[44rpx] leading-[84rpx] !text-[var(--primary-color)]",onClick:t[1]||(t[1]=e=>_(b)({url:"/app/pages/auth/login",param:{type:"mobile"}}))},{default:d(()=>[x(f(_(i)("mobileLogin")),1)]),_:1})]),_:1})):!_(S).is_mobile&&_(S).is_username?(p(),c(r,{key:2,class:"w-full flex items-center justify-center"},{default:d(()=>[m(l,{class:"w-[630rpx] h-[88rpx] !mx-[0] !bg-[#fff] !border-[var(--primary-color)] border-solid border-[2rpx] text-[26rpx] rounded-[44rpx] leading-[84rpx] !text-[var(--primary-color)]",onClick:t[2]||(t[2]=e=>_(b)({url:"/app/pages/auth/login",param:{type:"username"}}))},{default:d(()=>[x(f(_(i)("accountLogin")),1)]),_:1})]),_:1})):y("v-if",!0),_(S).agreement_show?(p(),c(r,{key:3,class:"w-full flex items-center justify-center mt-[28rpx]"},{default:d(()=>[m(r,{class:"flex items-center justify-center mt-[28rpx] py-[14rpx] px-[50rpx]",onClick:g(ae,["stop"])},{default:d(()=>[m(h,{onChange:ae},{default:d(()=>[m(n,{activeColor:"var(--primary-color)",checked:v.value,shape:"circle",size:"24rpx"},null,8,["checked"])]),_:1}),m(r,{class:"text-[24rpx] -ml-[4rpx] text-[var(--text-color-light6)] flex items-center flex-wrap leading-[30rpx]"},{default:d(()=>[m(k,null,{default:d(()=>[x(f(_(i)("agreeTips")),1)]),_:1}),m(k,{onClick:t[3]||(t[3]=g(e=>_(b)({url:"/app/pages/auth/agreement?key=privacy"}),["stop"])),class:"text-primary"},{default:d(()=>[x("《"+f(_(i)("privacyAgreement"))+"》",1)]),_:1}),m(k,null,{default:d(()=>[x(f(_(i)("and")),1)]),_:1}),m(k,{onClick:t[4]||(t[4]=g(e=>_(b)({url:"/app/pages/auth/agreement?key=service"}),["stop"])),class:"text-primary"},{default:d(()=>[x("《"+f(_(i)("userAgreement"))+"》",1)]),_:1})]),_:1})]),_:1},8,["onClick"])]),_:1})):y("v-if",!0),_(S).is_mobile&&_(S).is_username?(p(),c(r,{key:4,class:"footer w-full"},{default:d(()=>[m(r,{class:"text-[26rpx] leading-[36rpx] text-[#666] text-center mb-[30rpx] font-400"},{default:d(()=>[x("其他登录方式")]),_:1}),m(r,{class:"flex justify-center"},{default:d(()=>[m(k,{onClick:t[5]||(t[5]=e=>_(b)({url:"/app/pages/auth/login",param:{type:"username"}})),class:"w-[66rpx] h-[66rpx] flex items-center justify-center iconfont iconmima6Vmm border-[2rpx] rounded-[50%] border-solid border-[#ddd] !text-[26rpx]"})]),_:1})]),_:1})):y("v-if",!0)]),_:1})]),_:1})]),_:1},8,["style"]),m(w,{ref_key:"popupRef",ref:J,type:"dialog"},{default:d(()=>[m(r,{class:"bg-[#fff] flex flex-col justify-between w-[600rpx] min-h-[280rpx] rounded-[var(--rounded-big)] box-border px-[35rpx] pt-[35rpx] pb-[8rpx] relative"},{default:d(()=>[m(r,{class:"flex justify-center"},{default:d(()=>[m(k,{class:"text-[33rpx] font-700"},{default:d(()=>[x(" 用户协议及隐私保护")]),_:1})]),_:1}),m(r,{class:"flex items-center mb-[20rpx] mt-[20rpx] py-[20rpx]",onClick:g(ae,["stop"])},{default:d(()=>[m(r,{class:"text-[26rpx] text-[var(--text-color-light6)] flex items-center flex-wrap"},{default:d(()=>[m(k,null,{default:d(()=>[x(f(_(i)("agreeTips")),1)]),_:1}),m(k,{onClick:t[6]||(t[6]=g(e=>_(b)({url:"/app/pages/auth/agreement?key=privacy"}),["stop"])),class:"text-primary"},{default:d(()=>[x("《"+f(_(i)("privacyAgreement"))+"》",1)]),_:1}),m(k,null,{default:d(()=>[x(f(_(i)("and")),1)]),_:1}),m(k,{onClick:t[7]||(t[7]=g(e=>_(b)({url:"/app/pages/auth/agreement?key=service"}),["stop"])),class:"text-primary"},{default:d(()=>[x("《"+f(_(i)("userAgreement"))+"》",1)]),_:1})]),_:1})]),_:1},8,["onClick"]),m(r,null,{default:d(()=>[m(r,{class:"w-[100%] flex justify-center bg-[var(--primary-color)] h-[70rpx] leading-[70rpx] text-[#fff] text-[26rpx] border-[0] font-500 rounded-[50rpx]",onClick:Q},{default:d(()=>[x("同意并登录")]),_:1}),m(r,{class:"w-[100%] flex justify-center h-[70rpx] leading-[70rpx] text-[#999] text-[24rpx] border-[0] font-500 rounded-[50rpx]",onClick:K},{default:d(()=>[x("不同意")]),_:1})]),_:1})]),_:1})]),_:1},512),y(" 强制绑定手机号 "),m(C,{ref_key:"bindMobileRef",ref:X},null,512)]),_:1},8,["style"])]),_:1})}}}),[["__scopeId","data-v-28c95d6f"]]);export{X as default};
