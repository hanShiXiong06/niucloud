import{d as e,r as t,L as a,O as l,N as s,E as r,$ as c,a0 as u,b as i,o as n,c as p,w as x,e as o,Y as d,f,B as m,Z as v,a9 as _,C as g,D as h,i as y,j as b,J as j,m as k,R as w,k as C,l as T,p as O,S as E}from"./index-c3bd19d7.js";import{_ as F}from"./loading-page.vue_vue_type_script_setup_true_lang.b745a0f5.js";import{g as I,a as L,v as R}from"./verify.59dac3cc.js";import{_ as z}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-loading-icon.e306857f.js";import"./u-transition.35c8ef6d.js";const B=z(e({__name:"verify",setup(e){const z=t(!0),B=t("");a(e=>{if(e.code&&(B.value=e.code),e.scene){let t=decodeURIComponent(e.scene).split("&");t.length&&t.forEach(e=>{-1!=e.indexOf("code")&&(B.value=e.split("-")[1])})}}),l(()=>{s()&&(D(),N())});const D=()=>{I().then(e=>{e.data?z.value=!1:(r({title:"非核销员无此权限",icon:"none"}),setTimeout(()=>{c().length>1?u({delta:1}):i({url:"/app/pages/member/index",mode:"reLaunch"})},1e3))})},J=t({}),N=()=>{z.value=!0,L({code:B.value}).then(e=>{J.value=e.data,z.value=!1}).catch(()=>{setTimeout(()=>{z.value=!1,i({url:"/app/pages/verify/index",param:{},mode:"redirectTo"})},1e3)})};let S=!1;const U=()=>{if(J.value.is_can_use){if(S)return!1;S=!0,R(B.value).then(e=>{r({title:"核销成功",icon:"none"}),setTimeout(()=>{S=!1,i({url:"/app/pages/verify/index",param:{},mode:"redirectTo"})},1e3)}).catch(()=>{S=!1})}};return(e,t)=>{const a=j,l=k,s=w,r=C(T("loading-page"),F),c=O("layout-default-uni");return n(),p(c,null,{default:x(()=>[o(l,{style:b(e.themeColor()),class:"bg-[var(--page-bg-color)] min-h-[100vh] overflow-hidden"},{default:x(()=>[!z.value&&J.value&&J.value.value?(n(),d(v,{key:0},[o(l,{class:"p-[30rpx] bg-[#fff]"},{default:x(()=>[o(l,{class:"text-[var(--primary-color)] fixed top-[40rpx] right-[30rpx] flex items-center",onClick:t[0]||(t[0]=e=>f(i)({url:"/app/pages/verify/record"}))},{default:x(()=>[o(a,{class:"nc-iconfont nc-icon-lishijiluV6xx !text-[28rpx] -mb-[2rpx]"}),o(a,{class:"text-[26rpx] ml-[8rpx]"},{default:x(()=>[m("核销记录")]),_:1})]),_:1}),o(l,{class:"flex items-center mt-[60rpx] justify-center"},{default:x(()=>[o(l,{class:"flex justify-center items-center flex-col pr-[30rpx]"},{default:x(()=>[o(s,{class:"w-[100rpx] h-[100rpx]",src:f(E)("static/resource/images/verify/yanzhenghexiaoma.png")},null,8,["src"]),o(l,{class:"text-[26rpx] mt-[14rpx] h-[36rpx] leading-[36rpx] flex-shrink-0"},{default:x(()=>[m("验证核销码")]),_:1})]),_:1}),o(s,{class:"w-[74rpx] h-[12rpx] mb-[50rpx]",src:f(E)("static/resource/images/verify/youjiantou.png")},null,8,["src"]),o(l,{class:"flex justify-center items-center flex-col pl-[30rpx]"},{default:x(()=>[o(s,{class:"w-[100rpx] h-[100rpx]",src:f(E)("static/resource/images/verify/hexiao.png")},null,8,["src"]),o(l,{class:"text-[26rpx] mt-[14rpx] h-[36rpx] leading-[36rpx] flex-shrink-0"},{default:x(()=>[m("确定核销")]),_:1})]),_:1})]),_:1})]),_:1}),o(l,{class:"card-template mt-[var(--top-m)] sidebar-margin"},{default:x(()=>[(n(!0),d(v,null,_(J.value.value.list,(e,t)=>(n(),p(l,{class:h(["flex",{"mb-[var(--top-m)]":J.value.value.list.length-1!=t}]),key:t},{default:x(()=>[e.cover?(n(),p(s,{key:0,class:"w-[150rpx] h-[150rpx] rounded-[var(--goods-rounded-big)]",mode:"aspectFill",src:f(E)(e.cover)},null,8,["src"])):(n(),p(s,{key:1,class:"w-[150rpx] h-[150rpx] rounded-[var(--goods-rounded-big)]",mode:"aspectFill",src:f(E)("addon/tourism/tourism/member/hotel.png")},null,8,["src"])),o(l,{class:"flex flex-col flex-1 ml-[20rpx] py-[4rpx]"},{default:x(()=>[o(l,{class:"leading-[1]"},{default:x(()=>[o(l,{class:"leading-[40rpx] truncate max-w-[490rpx] text-[28rpx]"},{default:x(()=>[m(g(e.name),1)]),_:2},1024),e.sub_name?(n(),p(l,{key:0,class:"mt-[14rpx] truncate text-[24rpx] text-[var(--text-color-light9)] leading-[28rpx] max-w-[490rpx]"},{default:x(()=>[m(g(e.sub_name),1)]),_:2},1024)):y("v-if",!0)]),_:2},1024),o(l,{class:"flex items-center mt-[20rpx]"},{default:x(()=>[o(l,{class:"text-[var(--text-color-light6)] text-[28rpx]"},{default:x(()=>[m("x"+g(e.verify_num),1)]),_:2},1024),o(l,{class:"leading-[1] ml-3 text-[var(--price-text-color)] text-[28rpx]"},{default:x(()=>[m(g(e.un_use_msg),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1}),o(l,{class:"card-template mt-[var(--top-m)] sidebar-margin"},{default:x(()=>[o(l,{class:"title"},{default:x(()=>[m("核销信息")]),_:1}),o(l,{class:"card-template-item justify-between"},{default:x(()=>[o(a,{class:"text-[28rpx] text-[#333]"},{default:x(()=>[m("核销类型")]),_:1}),o(l,{class:"text-[28rpx] text-[#333]"},{default:x(()=>[m(g(J.value.type_name),1)]),_:1})]),_:1}),(n(!0),d(v,null,_(J.value.value.content.fixed,(e,t)=>(n(),p(l,{class:"card-template-item justify-between"},{default:x(()=>[o(a,{class:"text-[28rpx] text-[#333]"},{default:x(()=>[m(g(e.title),1)]),_:2},1024),o(l,{class:"text-[28rpx] text-[#333]"},{default:x(()=>[m(g(e.value),1)]),_:2},1024)]),_:2},1024))),256))]),_:1}),(n(!0),d(v,null,_(J.value.value.content.diy,(e,t)=>(n(),p(l,{key:t,class:"card-template mt-[var(--top-m)] sidebar-margin"},{default:x(()=>[o(l,{class:"title"},{default:x(()=>[m(g(e.title),1)]),_:2},1024),(n(!0),d(v,null,_(e.list,(e,t)=>(n(),p(l,{class:"card-template-item justify-between",key:t},{default:x(()=>[o(a,{class:"text-[28rpx] text-[#333]"},{default:x(()=>[m(g(e.title),1)]),_:2},1024),o(a,{class:"text-[28rpx] text-[#333]"},{default:x(()=>[m(g(e.value),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024))),128)),o(l,{class:"common-tab-bar w-[100%]"}),o(l,{class:h(["verify-tab-bar fixed flex-center !text-[26rpx] rounded-[50rpx] h-[80rpx] left-[20rpx] right-[20rpx] text-[#fff] font-500",J.value.is_can_use?"primary-btn-bg":"bg-[#ccc]"]),onClick:U},{default:x(()=>[m("确定")]),_:1},8,["class"])],64)):y("v-if",!0),o(r,{loading:z.value},null,8,["loading"])]),_:1},8,["style"])]),_:1})}}}),[["__scopeId","data-v-bad5fc85"]]);export{B as default};
