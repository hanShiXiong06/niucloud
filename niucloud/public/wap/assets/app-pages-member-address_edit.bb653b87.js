import{d as e,a,r as l,L as t,ci as r,s,bv as d,E as i,cj as o,o as u,c as n,w as c,e as p,f as m,B as v,C as f,A as _,D as x,j as g,ch as b,ck as y,b as h,k,l as S,m as j,J as w,K as A,p as V,z as C}from"./index-5dd3a833.js";import{_ as P}from"./u-input.c864510e.js";import{_ as I,a as q}from"./u-form.8a5e7be8.js";import{_ as z}from"./u-switch.645053b4.js";import{_ as W}from"./area-select.vue_vue_type_script_setup_true_lang.a8a981e0.js";import{m as $}from"./manifest.bb26aff2.js";import{_ as E}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.2d8c39b5.js";import"./u-line.5e2da613.js";import"./u-loading-icon.63963092.js";import"./u-popup.b109731e.js";import"./u-transition.22a584d7.js";import"./u-safe-bottom.94dec507.js";const U=E(e({__name:"address_edit",setup(e){const E=a(),U=l({id:0,name:"",mobile:"",province_id:0,city_id:0,district_id:0,lat:"",lng:"",address:"",address_name:"",full_address:"",is_default:0,area:""}),M=l(),T=l(null),R=l(""),O=l(!1),B=l(!1),D=l("address"),H=l(2);l(null),t(e=>{H.value=e.isSelectMap||"";const a=uni.getStorageSync("selectAddressCallback");if(e.id)r(e.id).then(e=>{e.data&&Object.assign(U.value,e.data),a&&(D.value="express"==a.delivery?"address":"locationAddress")});else if(e.name){uni.getStorageSync("addressInfo")&&Object.assign(U.value,uni.getStorageSync("addressInfo")),Q(e.latng);const a=X("latng").split(",");U.value.lat=a[0],U.value.lng=a[1]}R.value=e.source||"",a&&(D.value="express"==a.delivery?"address":"locationAddress"),Z()});const J=s(()=>({name:{type:"string",required:!0,message:C("namePlaceholder"),trigger:["blur","change"]},mobile:[{type:"string",required:!0,message:C("mobilePlaceholder"),trigger:["blur","change"]},{validator(e,a,l){/^1[3-9]\d{9}$/.test(a)?l():l(new Error(C("mobileError")))}}],area:{validator(){let e=!0;return uni.$u.test.isEmpty(U.value.area)&&uni.$u.test.isEmpty(U.value.address_name)&&(e=!1),e},message:C("selectAreaPlaceholder")},address:{type:"string",required:!0,message:C("addressPlaceholder"),trigger:["blur","change"]}})),K=()=>{B.value=!0,M.value.open()},L=e=>{var a,l,t,r,s,d,i,o,u;!B.value||U.value.province_id!=(null==(a=e.province)?void 0:a.id)&&U.value.city_id==(null==(l=e.city)?void 0:l.id)&&U.value.district_id==(null==(t=e.district)?void 0:t.id)||(U.value.lat="",U.value.lng=""),U.value.province_id=(null==(r=e.province)?void 0:r.id)||0,U.value.city_id=(null==(s=e.city)?void 0:s.id)||0,U.value.district_id=(null==(d=e.district)?void 0:d.id)||0,U.value.area=`${(null==(i=e.province)?void 0:i.name)||""}${(null==(o=e.city)?void 0:o.name)||""}${(null==(u=e.district)?void 0:u.name)||""}`,B.value=!1},F=l(!1),G=()=>{const e=U.value.id?b:y;T.value.validate().then(()=>{if(!F.value){if(F.value=!0,O.value=!0,U.value.full_address=U.value.area+U.value.address,1==H.value&&!U.value.lat&&!U.value.lng)return i({title:"缺少经纬度，请在地图上重新选点",icon:"none"}),F.value=!1,O.value=!1,!1;e(U.value).then(e=>{F.value=!1,setTimeout(()=>{if(O.value=!1,"shop_order_payment"==R.value){const a=uni.getStorageSync("selectAddressCallback");a&&(a.address_id=e.data.id||U.value.id,uni.setStorage({key:"selectAddressCallback",data:a,success(){h({url:a.back,mode:"redirectTo"})}}))}else h({url:"/app/pages/member/address",mode:"redirectTo",param:{source:R.value}})},1e3)}).catch(()=>{F.value=!1,O.value=!1})}})},N=()=>{E.diyAddressInfo&&E.diyAddressInfo.latitude,E.diyAddressInfo&&E.diyAddressInfo.longitude;const e=U.value;uni.setStorageSync("addressInfo",e);let a=location.origin+location.pathname+"?source="+R.value;H.value&&(a=a+"&isSelectMap="+H.value),window.location.href="https://apis.map.qq.com/tools/locpicker?search=1&type=0&backurl="+encodeURIComponent(a)+"&key="+$.h5.sdkConfigs.maps.qqmap.key+"&referer=myapp"},Q=e=>{d({latlng:e}).then(e=>{e.data?(U.value.address=e.data.formatted_addresses.recommend,U.value.full_address="",U.value.full_address+=null!=e.data.province?e.data.province:"",U.value.full_address+=null!=e.data.city?""+e.data.city:"",U.value.full_address+=null!=e.data.district?""+e.data.district:"",U.value.address_name=U.value.full_address.replace(/-/g,""),U.value.area=e.data.province+e.data.city+e.data.district||e.data.full_address,U.value.province_id=null!=e.data.province_id?e.data.province_id:0,U.value.city_id=null!=e.data.city_id?e.data.city_id:0,U.value.district_id=null!=e.data.district_id?e.data.district_id:0):i({title:e.msg,icon:"none"})})},X=e=>{const a=window.location.search.substring(1).split("&");for(let l=0;l<a.length;l++){const t=a[l].split("=");if(t[0]==e)return t[1]}return!1},Y=l([]),Z=()=>{o(3).then(e=>{Y.value=e.data}).catch()};return l(!1),(e,a)=>{const l=k(S("u-input"),P),t=k(S("u-form-item"),I),r=j,s=w,d=k(S("u-switch"),z),i=k(S("u-form"),q),o=A,b=k(S("area-select"),W),y=V("layout-default-uni");return u(),n(y,null,{default:c(()=>[p(r,{class:"bg-[var(--page-bg-color)] min-h-[100vh] overflow-hidden address-edit",style:g(e.themeColor())},{default:c(()=>[p(i,{labelPosition:"left",model:U.value,errorType:"toast",rules:m(J),ref_key:"formRef",ref:T},{default:c(()=>[p(r,{class:"sidebar-margin card-template mt-[var(--top-m)] py-[20rpx]"},{default:c(()=>[p(r,null,{default:c(()=>[p(t,{label:m(C)("name"),prop:"name",labelWidth:"200rpx"},{default:c(()=>[p(l,{fontSize:"28rpx",modelValue:U.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>U.value.name=e),modelModifiers:{trim:!0},border:"none",clearable:"",maxlength:"25",placeholderStyle:"color: #888",placeholder:m(C)("namePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),p(r,{class:"mt-[16rpx]"},{default:c(()=>[p(t,{label:m(C)("mobile"),prop:"mobile",labelWidth:"200rpx"},{default:c(()=>[p(l,{fontSize:"28rpx",modelValue:U.value.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>U.value.mobile=e),modelModifiers:{trim:!0},maxlength:"11",border:"none",clearable:"",placeholder:m(C)("mobilePlaceholder"),placeholderStyle:"color: #888"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),p(r,{class:"mt-[16rpx]"},{default:c(()=>[p(t,{label:m(C)("selectArea"),prop:"area",labelWidth:"200rpx"},{default:c(()=>["address"==D.value&&1!=H.value?(u(),n(r,{key:0,class:"flex w-full items-center h-[52rpx]",onClick:K},{default:c(()=>[U.value.area?(u(),n(r,{key:1,class:"text-[28rpx] flex-1 leading-[1.4]"},{default:c(()=>[v(f(U.value.area),1)]),_:1})):(u(),n(r,{key:0,class:"text-[#888] text-[28rpx] flex-1"},{default:c(()=>[v(f(m(C)("selectAreaPlaceholder")),1)]),_:1})),p(r,{onClick:_(N,["stop"]),class:"flex items-center"},{default:c(()=>[p(s,{class:"nc-iconfont nc-icon-dizhiguanliV6xx mr-[4rpx] text-[32rpx] text-[var(--primary-color)]"}),p(s,{class:"text-[24rpx] whitespace-nowrap text-[var(--primary-color)]"},{default:c(()=>[v("定位")]),_:1})]),_:1},8,["onClick"])]),_:1})):(u(),n(r,{key:1,class:"flex justify-between items-center flex-1 h-[52rpx]",onClick:N},{default:c(()=>[U.value.area||U.value.address_name?(u(),n(r,{key:0,class:"text-[28rpx] text-[#303133] leading-[1.4]"},{default:c(()=>[v(f(U.value.area||U.value.address_name),1)]),_:1})):(u(),n(r,{key:1,class:"text-[#888] text-[28rpx]"},{default:c(()=>[v(f(m(C)("selectAddressPlaceholder")),1)]),_:1})),p(r,{class:"flex items-center"},{default:c(()=>[p(s,{class:"nc-iconfont nc-icon-dizhiguanliV6xx text-[32rpx] mr-[4rpx] text-[var(--primary-color)]"}),p(s,{class:"text-[24rpx] whitespace-nowrap text-[var(--primary-color)]"},{default:c(()=>[v("定位")]),_:1})]),_:1})]),_:1}))]),_:1},8,["label"])]),_:1}),p(r,{class:"mt-[16rpx]"},{default:c(()=>[p(t,{label:m(C)("address"),prop:"address",labelWidth:"200rpx"},{default:c(()=>[p(l,{fontSize:"28rpx",modelValue:U.value.address,"onUpdate:modelValue":a[2]||(a[2]=e=>U.value.address=e),border:"none",clearable:"",maxlength:"120",placeholder:m(C)("addressPlaceholder"),placeholderStyle:"color: #888"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),p(r,{class:"sidebar-margin card-template mt-[var(--top-m)] py-[10rpx]"},{default:c(()=>[p(t,{label:m(C)("defaultAddress"),prop:"name","border-bottom":!1,labelWidth:"200rpx"},{default:c(()=>[p(d,{modelValue:U.value.is_default,"onUpdate:modelValue":a[3]||(a[3]=e=>U.value.is_default=e),size:"20",activeValue:1,inactiveValue:0,activeColor:"var(--primary-color)",inactiveColor:"var(--temp-bg)"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["model","rules"]),p(r,{class:"w-full footer"},{default:c(()=>[p(r,{class:"py-[var(--top-m)] px-[var(--sidebar-m)] footer w-full fixed bottom-30 left-0 right-0 box-border"},{default:c(()=>[p(o,{"hover-class":"none",class:x(["primary-btn-bg !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500",{"opacity-50":O.value}]),onClick:G,disabled:O.value,loading:F.value},{default:c(()=>[v(f(m(C)("save")),1)]),_:1},8,["disabled","loading","class"])]),_:1})]),_:1}),p(b,{ref_key:"areaRef",ref:M,onComplete:L,"area-id":U.value.district_id||U.value.city_id},null,8,["area-id"])]),_:1},8,["style"])]),_:1})}}}),[["__scopeId","data-v-4920e429"]]);export{U as default};
