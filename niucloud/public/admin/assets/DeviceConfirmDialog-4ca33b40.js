import{d as Q,r as m,R as B,h as u,s as k,w as l,a as v,t as V,e as s,i as g,Z as X,c as f,D as T,v as Y,F as ee,W as te,C as H,u as J,dN as ae,dI as ie,$ as c,ax as x,ah as le,ay as ne,a0 as oe,L as se,aj as ce,a4 as de,a1 as re,E as ue,dU as ve,ak as me,ab as fe,V as pe,a3 as _e,p as ge,g as ye}from"./index-9cfed1fc.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                        *//* empty css                  *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                        */import{a as he}from"./recycle_order-54bfc2b8.js";import{_ as De}from"./_plugin-vue_export-helper-c27b6911.js";const be=y=>(ge("data-v-b2bf6f78"),y=y(),ye(),y),Ce={class:"flex justify-between items-center"},ke={class:"text-lg font-bold"},Ve={key:0,class:"imei-input-container"},Ie=be(()=>v("svg",{viewBox:"0 0 1024 1024",width:"16",height:"16"},[v("path",{d:"M864 64H160C107 64 64 107 64 160v128c0 17.7 14.3 32 32 32s32-14.3 32-32V160c0-17.7 14.3-32 32-32h704c17.7 0 32 14.3 32 32v128c0 17.7 14.3 32 32 32s32-14.3 32-32V160c0-53-43-96-96-96z",fill:"currentColor"}),v("path",{d:"M864 896H160c-17.7 0-32-14.3-32-32V736c0-17.7-14.3-32-32-32s-32 14.3-32 32v128c0 53 43 96 96 96h704c53 0 96-43 96-96V736c0-17.7-14.3-32-32-32s-32 14.3-32 32v128c0 17.7-14.3 32-32 32zM640 288c0 17.7 14.3 32 32 32s32-14.3 32-32-14.3-32-32-32-32 14.3-32 32z",fill:"currentColor"}),v("path",{d:"M352 320h160c17.7 0 32-14.3 32-32s-14.3-32-32-32H352c-17.7 0-32 14.3-32 32s14.3 32 32 32zM544 704H160c-17.7 0-32-14.3-32-32V352c0-17.7 14.3-32 32-32h128c17.7 0 32-14.3 32-32s-14.3-32-32-32H160c-53 0-96 43-96 96v320c0 53 43 96 96 96h384c17.7 0 32-14.3 32-32s-14.3-32-32-32z",fill:"currentColor"}),v("path",{d:"M864.2 384c-17.7 0-32 14.3-32 32v256c0 17.7 14.3 32 32 32 17.7 0 32-14.3 32-32V416c0-17.7-14.3-32-32-32zM96 576c-17.7 0-32 14.3-32 32s14.3 32 32 32h64c17.7 0 32-14.3 32-32s-14.3-32-32-32H96zM736 576c-17.7 0-32 14.3-32 32s14.3 32 32 32h64c17.7 0 32-14.3 32-32s-14.3-32-32-32h-64z",fill:"currentColor"})],-1)),Ee={key:1},Me={key:0},Ne={key:1},ze={key:0,class:"category-tip"},Se={key:0},Be={key:0,class:"empty-data"},xe={class:"dialog-footer"},Oe=Q({__name:"DeviceConfirmDialog",props:{visible:{type:Boolean,default:!1},deviceList:{type:Array,default:()=>[]},orderId:{type:[Number,String],required:!0}},emits:["update:visible","confirm","cancel","add-device","edit-device","remove-device"],setup(y,{emit:b}){const h=y,K=m([{id:1,name:"手机"},{id:2,name:"平板"},{id:3,name:"笔记本"},{id:4,name:"手表"},{id:5,name:"其他"}]),D=m(h.visible),a=m([]),$=m(!1),I=m(!1),O=m([]),p=m(null),C=m(null);B(()=>h.visible,e=>{D.value=e,e&&U()}),B(()=>h.deviceList,()=>{D.value&&a.value.length===0&&U()},{deep:!0});const U=()=>{try{const e=JSON.parse(JSON.stringify(h.deviceList||[]));console.log(e),a.value=e.map(t=>({...t,editing:!1,category:t.category_id||1,_originalData:null})),O.value=JSON.parse(JSON.stringify(a.value))}catch(e){console.error("设备数据同步失败:",e),a.value=[],O.value=[]}};B(D,e=>{b("update:visible",e)});const j=e=>{e.imei&&e.imei.length>0&&(he(e.imei).then(t=>{t.code===1&&t.data.name?e.model=t.data.name:c.warning("未找到设备信息,请手动输入型号")}),x(()=>{C.value&&C.value.focus&&C.value.focus()}))},q=e=>{if(e.model&&e.model.length>0){const t=a.value.findIndex(d=>d===e);t!==-1&&L(e,t)}},A=()=>{if(a.value.find(d=>d.editing)){c.warning("请先保存正在编辑的设备");return}const t={imei:"",model:"",initial_price:0,editing:!0,category:1,isNew:!0};a.value.push(t),x(()=>{p.value&&p.value.focus&&p.value.focus()})},F=(e,t)=>{if(a.value.find(n=>n.editing)){c.warning("请先保存正在编辑的设备");return}a.value[t]._originalData=JSON.parse(JSON.stringify(e)),a.value[t].editing=!0,b("edit-device",e),x(()=>{p.value&&p.value.focus&&p.value.focus()})},L=(e,t)=>{if(!e.imei||!e.model){c.warning("IMEI和型号不能为空");return}if(!e.category||e.category===0){c.warning("请选择设备分类，建议选择手机");return}a.value[t].editing=!1,a.value[t]._originalData=null,c.success("设备信息已保存")},w=(e,t)=>{if(e.isNew)a.value.splice(t,1);else if(e._originalData){const{editing:d,_originalData:n,...r}=e._originalData;Object.assign(a.value[t],r),a.value[t].editing=!1,a.value[t]._originalData=null}else a.value[t].editing=!1},G=async(e,t)=>{try{await le.confirm("确定要删除该设备吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),a.value.splice(t,1),e.id&&b("remove-device",e),c.success("设备已删除")}catch(d){if(d==="cancel")return;console.error("删除设备失败:",d),c.error("删除失败："+(d.message||"未知错误"))}},P=async()=>{if(a.value.length===0){c.warning("请添加设备");return}if(a.value.find(n=>n.editing)){c.warning("请先保存或取消正在编辑的设备");return}if(a.value.find(n=>!n.imei||!n.model)){c.warning("请填写完整的设备信息（IMEI和型号）");return}if(a.value.find(n=>!n.category||n.category===0)){c.warning("请为所有设备选择分类，建议选择手机");return}I.value=!0;try{const n=a.value.filter(r=>!r.editing&&r.imei&&r.model).map(r=>{const E=ne(r),{editing:R,_originalData:_,isNew:M,category:N,...z}=E;return{...z,category_id:N||1}});b("confirm",{orderId:h.orderId,devices:n})}catch(n){console.error("确认提交失败:",n),c.error("提交失败，请重试")}finally{I.value=!1}};return(e,t)=>{const d=oe,n=se,r=ce,E=de,R=re,_=ue,M=ve,N=me,z=fe,W=pe,Z=_e;return u(),k(W,{modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=i=>D.value=i),title:"设备信息确认",width:"800",center:""},{header:l(()=>[v("div",Ce,[v("span",ke,"设备信息确认 , 共 "+V(a.value.length)+" 台 ",1)])]),footer:l(()=>[v("div",xe,[s(_,{type:"success",onClick:A},{default:l(()=>[g("添加设备")]),_:1}),s(_,{type:"primary",onClick:P,loading:I.value},{default:l(()=>[g(" 确认并签收 ")]),_:1},8,["loading"])])]),default:l(()=>[X((u(),k(N,{data:a.value,border:""},{default:l(()=>[s(r,{label:"IMEI|支持扫码枪直接输入，输入完成会自动跳转到型号输入"},{default:l(({row:i})=>[i.editing?(u(),f("div",Ve,[s(n,{modelValue:i.imei,"onUpdate:modelValue":o=>i.imei=o,placeholder:"请输入或扫描IMEI",ref_key:"imeiInputRef",ref:p,autofocus:"",onKeydown:T(o=>j(i),["enter"]),class:"imei-input"},{suffix:l(()=>[s(d,{title:"支持扫码枪输入",class:"scanner-icon"},{default:l(()=>[Ie]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onKeydown"])])):(u(),f("span",Ee,V(i.imei),1))]),_:1}),s(r,{label:"型号"},{default:l(({row:i})=>[i.editing?(u(),f("div",Me,[s(n,{modelValue:i.model,"onUpdate:modelValue":o=>i.model=o,placeholder:"请输入型号",ref_key:"modelInputRef",ref:C,onKeydown:T(o=>q(i),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeydown"])])):(u(),f("span",Ne,V(i.model),1))]),_:1}),s(r,{label:"设备分类"},{default:l(({row:i})=>[s(R,{modelValue:i.category,"onUpdate:modelValue":o=>i.category=o,placeholder:"请选择设备分类",class:Y({"category-required":!i.category||i.category===0})},{default:l(()=>[(u(!0),f(ee,null,te(K.value,o=>(u(),k(E,{key:o.id,label:o.name,value:o.id},{default:l(()=>[v("span",null,V(o.name),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","class"]),!i.category||i.category===0?(u(),f("div",ze," 请选择分类，建议选择手机 ")):H("",!0)]),_:1}),s(r,{label:"操作",width:"160"},{default:l(({row:i,$index:o})=>[i.editing?(u(),f("div",Se,[s(M,null,{default:l(()=>[s(_,{type:"success",size:"small",onClick:S=>L(i,o)},{default:l(()=>[g(" 保存 ")]),_:2},1032,["onClick"]),s(_,{type:"info",size:"small",onClick:S=>w(i,o)},{default:l(()=>[g(" 取消 ")]),_:2},1032,["onClick"])]),_:2},1024)])):(u(),k(M,{key:1},{default:l(()=>[s(_,{type:"primary",size:"small",icon:J(ae),onClick:S=>F(i,o)},{default:l(()=>[g(" 编辑 ")]),_:2},1032,["icon","onClick"]),s(_,{type:"danger",size:"small",icon:J(ie),onClick:S=>G(i,o)},{default:l(()=>[g(" 删除 ")]),_:2},1032,["icon","onClick"])]),_:2},1024))]),_:1})]),_:1},8,["data"])),[[Z,$.value]]),a.value.length===0?(u(),f("div",Be,[s(z,{description:"暂无设备数据。Tips 请将设备清点完毕后，再进行确认。不支持签收后添加设备！"})])):H("",!0)]),_:1},8,["modelValue"])}}});const Ye=De(Oe,[["__scopeId","data-v-b2bf6f78"]]);export{Ye as default};
