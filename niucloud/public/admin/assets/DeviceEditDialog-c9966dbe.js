import{d as U,r as c,n as v,R as D,h as k,s as N,w as o,a as G,e as r,i as p,Z as M,t as T,$ as f,L as F,M as P,as as B,N as A,E as O,V as q,a3 as Y}from"./index-0b74b7aa.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                  *//* empty css                */import $ from"./index-50c1a6c1.js";/* empty css               */import"./el-form-item-4ed993c7.js";/* empty css                 */import{u as j}from"./recycle_order-d9d63f63.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                        */import"./index.vue_vue_type_style_index_0_lang-d61b6ebc.js";import"./attachment-c8c37cd4.js";import"./index.vue_vue_type_script_setup_true_lang-832af570.js";/* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                      *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css                  *//* empty css                    *//* empty css                        *//* empty css                         */import"./index.vue_vue_type_script_setup_true_lang-00957a82.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-cb8d7a65.js";import"./sortable.esm-be94e56d.js";const z={class:"dialog-footer"},J=U({__name:"DeviceEditDialog",props:{visible:{type:Boolean,default:!1},deviceData:{type:Object,default:()=>({})}},emits:["update:visible","success","closed"],setup(b,{emit:_}){const l=b,a={PENDING_CHECK:1,CHECKING:2,CHECKED:3,CONFIRMED:4,RECYCLED:5,RETURNED:6,CANCELLED:7},d=c(l.visible),V=c(!1),E=c(!1),m=c(),e=v({id:0,order_id:0,imei:"",model:"",currentStatus:a.PENDING_CHECK,check_result:"",check_images:"",initial_price:0,final_price:0,price_remark:""}),y=v({check_result:[{required:!0,message:"请输入验机结果",trigger:"blur"}],final_price:[{required:!0,message:"请输入最终价格",trigger:"blur"},{type:"number",min:0,message:"价格必须大于等于0",trigger:"blur",transform:s=>Number(s)}],price_remark:[{required:!0,message:"请输入价格备注",trigger:"blur"}]});D(()=>l.visible,s=>{d.value=s,s&&C()}),D(d,s=>{_("update:visible",s)});const C=()=>{l.deviceData&&(e.id=l.deviceData.id||0,e.order_id=l.deviceData.order_id||0,e.imei=l.deviceData.imei||"",e.model=l.deviceData.model||"",e.currentStatus=l.deviceData.status||a.PENDING_CHECK,e.check_result=l.deviceData.check_result||"",e.check_images=l.deviceData.check_images||"",e.initial_price=l.deviceData.initial_price||0,e.final_price=l.deviceData.final_price||0,e.price_remark=l.deviceData.price_remark||"")},I=s=>({[a.PENDING_CHECK]:"warning",[a.CHECKING]:"primary",[a.CHECKED]:"success",[a.CONFIRMED]:"warning",[a.RECYCLED]:"success",[a.RETURNED]:"danger",[a.CANCELLED]:"info"})[s]||"info",R=s=>({[a.PENDING_CHECK]:"待验机",[a.CHECKING]:"验机中",[a.CHECKED]:"已验机",[a.CONFIRMED]:"已确认价格",[a.RECYCLED]:"已回收",[a.RETURNED]:"已退回",[a.CANCELLED]:"已取消"})[s]||"未知状态",H=async s=>{if(m.value)try{E.value=!0,e.currentStatus===a.PENDING_CHECK?s==="CHECK_PRICE"&&await m.value.validate():e.currentStatus===a.CHECKING&&await m.value.validate();let t={order_id:e.order_id,status:a.CHECKED,check_result:e.check_result,check_images:e.check_images,final_price:e.final_price,price_remark:e.price_remark,check_status:1};const u=await j(String(e.id),t);u.code===1?(f.success("更新设备信息成功"),d.value=!1,_("success")):f.error(u.message||"更新设备信息失败")}catch(t){console.error("更新设备信息失败:",t),f.error(t.message||"更新设备信息失败")}finally{E.value=!1}},K=()=>{m.value&&m.value.resetFields(),_("closed")};return l.visible&&C(),(s,t)=>{const u=F,n=P,S=B,w=$,L=A,g=O,h=q,x=Y;return k(),N(h,{modelValue:d.value,"onUpdate:modelValue":t[8]||(t[8]=i=>d.value=i),title:"设备验机结果和定价",width:"600px","destroy-on-close":!0,onClosed:K},{footer:o(()=>[G("span",z,[r(g,{onClick:t[6]||(t[6]=i=>d.value=!1)},{default:o(()=>[p("取消")]),_:1}),r(g,{type:"success",onClick:t[7]||(t[7]=i=>H("CHECK_PRICE")),loading:E.value},{default:o(()=>[p(" 确认质检并定价 ")]),_:1},8,["loading"])])]),default:o(()=>[M((k(),N(L,{model:e,"label-width":"100px",rules:y,ref_key:"formRef",ref:m},{default:o(()=>[r(n,{label:"IMEI"},{default:o(()=>[r(u,{modelValue:e.imei,"onUpdate:modelValue":t[0]||(t[0]=i=>e.imei=i),disabled:""},null,8,["modelValue"])]),_:1}),r(n,{label:"型号"},{default:o(()=>[r(u,{modelValue:e.model,"onUpdate:modelValue":t[1]||(t[1]=i=>e.model=i)},null,8,["modelValue"])]),_:1}),r(n,{label:"当前状态"},{default:o(()=>[r(S,{type:I(e.currentStatus)},{default:o(()=>[p(T(R(e.currentStatus)),1)]),_:1},8,["type"])]),_:1}),r(n,{label:"验机结果",prop:"check_result"},{default:o(()=>[r(u,{modelValue:e.check_result,"onUpdate:modelValue":t[2]||(t[2]=i=>e.check_result=i),type:"textarea",rows:3,placeholder:"请输入验机结果"},null,8,["modelValue"])]),_:1}),r(n,{label:"外观照片"},{default:o(()=>[r(w,{modelValue:e.check_images,"onUpdate:modelValue":t[3]||(t[3]=i=>e.check_images=i),limit:10},null,8,["modelValue"])]),_:1}),r(n,{label:"最终报价",prop:"final_price"},{default:o(()=>[r(u,{modelValue:e.final_price,"onUpdate:modelValue":t[4]||(t[4]=i=>e.final_price=i),type:"number"},{append:o(()=>[p("元")]),_:1},8,["modelValue"])]),_:1}),r(n,{label:"价格备注",prop:"price_remark"},{default:o(()=>[r(u,{modelValue:e.price_remark,"onUpdate:modelValue":t[5]||(t[5]=i=>e.price_remark=i),type:"textarea",rows:2,placeholder:"请输入价格备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[x,V.value]])]),_:1},8,["modelValue"])}}});const Se=Z(J,[["__scopeId","data-v-742b5eea"]]);export{Se as default};
