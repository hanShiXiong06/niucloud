import{d as de,y as ue,r as f,n as $,q as t,h as r,c as m,Z,s as b,w as l,e as d,a as u,t as s,u as n,bY as ce,C as x,F as z,W as G,i as h,a6 as v,b7 as _e,M as pe,L as me,aj as fe,E as ve,ak as ge,a9 as ye,N as we,V as be,a3 as xe,p as he,g as Se}from"./index-0b74b7aa.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                *//* empty css                *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                  *//* empty css                        *//* empty css               *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                  */import{l as ke,n as K,s as Ce}from"./member-cf62c19b.js";import Ve from"./sign-day-da7fbb3d.js";import Ee from"./sign-continue-9a941c31.js";import{_ as Ae}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                 */const W=O=>(he("data-v-ec1b1152"),O=O(),Se(),O),De={class:"main-container"},Te={class:"text-page-title"},$e=W(()=>u("span",{class:"ml-[10px]"},"天",-1)),Oe={key:0},Pe={key:1,class:"flex ml-[5px]"},Ne=W(()=>u("span",{class:"ml-[5px] mr-[5px]"},"|",-1)),Re={class:"form-tip"},Be={class:"form-tip"},Fe={class:"mt-[10px]"},Me={key:0},Ue={key:0},Ie={key:1},Le={class:"flex mt-[10px]"},je={class:"form-tip"},qe={class:"flex"},Ze={class:"dialog-footer"},ze={class:"dialog-footer"},Ge={class:"fixed-footer-wrap"},Ke={class:"fixed-footer"},We=de({__name:"sign_config",setup(O){ue().meta.title,f("signSet");const A=f(!0),D=f(!1),k=f(!1),B=f(),c=f({});let P=!1,N=0;const Y={required:/[\S]+/,number:/^\d{0,10}$/,digit:/^\d{0,10}(.?\d{0,2})$/,special:/^\d{0,10}(.?\d{0,3})$/},H=$({day_award:[{required:!0,trigger:"change",validator:(o,e,p)=>{let _=!1;T.value.forEach(C=>{C.is_use&&(_=!0)}),_?p():p(t("daySignAwardPlaceholder"))}}],sign_period:[{required:!0,trigger:"blur",validator:(o,e,p)=>{e===null||e===""?p(t("signPeriodTip")):isNaN(e)||!Y.number.test(e)?p(t("signPeriodLimitTips")):e<2||e>365?p(t("signPeriodMustZeroTips")):p()}}]}),g=$({gifts:[]}),R=f([]),a=$({is_use:0,sign_period:30,day_award:"",continue_award:[],rule_explain:""}),S=$({receive_num:"",continue_sign:"",receive_limit:"",continue_award:[]}),y=$({loading:!1,data:[]});(async()=>{const o=await(await ke()).data;Object.keys(a).forEach(e=>{o[e]!=null&&(a[e]=o[e])}),a.day_award&&(g.gifts=a.day_award,F()),a.continue_award&&a.continue_award.forEach((e,p)=>{y.data.push(v(e)),g.gifts=[];const _=v(e);delete _.continue_sign,delete _.continue_tag,delete _.receive_limit,delete _.receive_num,g.gifts=_,M(g,e,p)}),A.value=!1})();const T=f([]),F=async()=>{const o=await(await K(g)).data;T.value=[],Object.values(o).forEach(e=>{T.value.push(e)})},M=async(o,e,p=0,_=0)=>{const C=await(await K(o)).data;R.value=[],Object.values(C).forEach(V=>{R.value.push(V)}),S.receive_num=e.receive_num,S.continue_sign=e.continue_sign,S.receive_limit=e.receive_limit,S.continue_award=R.value,P?y.data.splice(N,1,v(S)):_==0?y.data.splice(p,1,v(S)):y.data.push(v(S)),P=!1,N=0},J=async o=>{A.value||!o||await o.validate(e=>{if(e){const p=v(a);Ce(p).then(()=>{A.value=!1}).catch(()=>{A.value=!1})}})},U=()=>{D.value=!0},I=f(null),Q=async()=>{var o;await((o=I.value)==null?void 0:o.verify())&&(D.value=!1,!a.day_award.hasOwnProperty("balance")&&!a.day_award.hasOwnProperty("point")&&a.day_award.shop_coupon.is_use==0&&(a.day_award=""),a.day_award.hasOwnProperty("balance")&&a.day_award.balance.is_use==1&&(a.day_award.balance.money=Number(a.day_award.balance.money)),g.gifts=a.day_award,F())},X=()=>{a.day_award="",T.value=[]},ee=()=>{c.value="",k.value=!0},ae=(o,e)=>{P=o,N=e,c.value=a.continue_award[e],k.value=!0},L=f(null),te=async()=>{var o;if(await((o=L.value)==null?void 0:o.verify())&&(k.value=!1,!c.value.hasOwnProperty("balance")&&!c.value.hasOwnProperty("point")&&c.value.shop_coupon.is_use==0&&(c.value=""),c.value.hasOwnProperty("balance")&&c.value.balance.is_use==1&&(c.value.balance.money=Number(c.value.balance.money)),Object.keys(c.value).length>0)){const e=v(c.value);delete e.continue_sign,delete e.continue_tag,delete e.receive_limit,delete e.receive_num,g.gifts=e,a.continue_award.length>0&&a.continue_award.length-1,M(g,c.value,0,1),P?a.continue_award.splice(N,1,v(c.value)):a.continue_award.push(v(c.value))}},ne=o=>{y.data.splice(o,1),a.continue_award.splice(o,1)},ie=()=>{a.rule_explain=t("ruleExplainDefault")};return(o,e)=>{const p=_e,_=pe,C=me,V=fe,w=ve,le=ge,oe=ye,se=we,j=be,q=xe;return r(),m("div",De,[Z((r(),b(se,{class:"page-form",model:a,"label-width":"150px",ref_key:"ruleFormRef",ref:B,rules:H},{default:l(()=>[d(oe,{class:"box-card !border-none",shadow:"never"},{default:l(()=>[u("h3",Te,s(n(t)("signRule")),1),d(_,{label:n(t)("isUse")},{default:l(()=>[d(p,{modelValue:a.is_use,"onUpdate:modelValue":e[0]||(e[0]=i=>a.is_use=i)},null,8,["modelValue"])]),_:1},8,["label"]),a.is_use?(r(),b(_,{key:0,label:n(t)("signPeriod"),prop:"sign_period"},{default:l(()=>[d(C,{modelValue:a.sign_period,"onUpdate:modelValue":e[1]||(e[1]=i=>a.sign_period=i),modelModifiers:{trim:!0},onKeyup:e[2]||(e[2]=i=>n(ce)(i)),maxlength:"3",clearable:"",class:"input-width"},null,8,["modelValue"]),$e]),_:1},8,["label"])):x("",!0),a.is_use?(r(),b(_,{key:1,label:n(t)("daySignAward"),prop:"day_award"},{default:l(()=>[(r(!0),m(z,null,G(T.value,(i,E)=>(r(),m("div",{key:E},[i.is_use=="1"?(r(),m("span",Oe,s(i.content)+"  ",1)):x("",!0)]))),128)),a.day_award==""?(r(),m("span",{key:0,class:"cursor-pointer tutorial-btn ml-[5px]",onClick:U},s(n(t)("set")),1)):(r(),m("div",Pe,[u("span",{class:"cursor-pointer tutorial-btn",onClick:U},s(n(t)("modify")),1),Ne,u("span",{class:"cursor-pointer tutorial-btn",onClick:X},s(n(t)("delete")),1)])),u("div",Re,s(n(t)("daySignAwardTip")),1)]),_:1},8,["label"])):x("",!0),a.is_use?(r(),b(_,{key:2,label:n(t)("continueSignAward"),prop:"continue_award"},{default:l(()=>[u("div",null,[u("div",Be,s(n(t)("continueSignAwardTipTop")),1),u("div",Fe,[Z((r(),b(le,{data:y.data,size:"large"},{empty:l(()=>[u("span",null,s(y.loading?"":n(t)("emptyData")),1)]),default:l(()=>[d(V,{prop:"continue_sign",label:n(t)("continueSign"),"min-width":"120"},null,8,["label"]),d(V,{label:n(t)("continueSignAward"),"min-width":"300"},{default:l(({row:i})=>[(r(!0),m(z,null,G(i.continue_award,(E,re)=>(r(),m("div",{key:re},[E.is_use=="1"?(r(),m("span",Me,s(E.content),1)):x("",!0)]))),128))]),_:1},8,["label"]),d(V,{label:n(t)("receiveLimit"),"min-width":"120"},{default:l(({row:i})=>[i.receive_limit==1?(r(),m("span",Ue,s(n(t)("noLimit")),1)):(r(),m("span",Ie,s(n(t)("everyOneLimit"))+s(i.receive_num)+s(n(t)("time")),1))]),_:1},8,["label"]),d(V,{label:n(t)("operation"),align:"right",fixed:"right",width:"130"},{default:l(i=>[d(w,{type:"primary",link:"",onClick:E=>ae(!0,i.$index)},{default:l(()=>[h(s(n(t)("modify")),1)]),_:2},1032,["onClick"]),d(w,{type:"primary",link:"",onClick:E=>ne(i.$index)},{default:l(()=>[h(s(n(t)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[q,y.loading]])]),u("div",Le,[u("span",{class:"cursor-pointer tutorial-btn",onClick:ee},s(n(t)("add")),1)]),u("div",je,s(n(t)("continueSignAwardTipBottom")),1)])]),_:1},8,["label"])):x("",!0),a.is_use?(r(),b(_,{key:3,label:n(t)("ruleExplain"),prop:"rule_explain"},{default:l(()=>[u("div",qe,[d(C,{modelValue:a.rule_explain,"onUpdate:modelValue":e[3]||(e[3]=i=>a.rule_explain=i),modelModifiers:{trim:!0},placeholder:n(t)("ruleExplainTip"),type:"textarea",maxlength:"500","show-word-limit":"",rows:"5",class:"textarea-width",clearable:""},null,8,["modelValue","placeholder"]),d(w,{class:"ml-[20px]",type:"primary",onClick:e[4]||(e[4]=i=>ie()),plain:""},{default:l(()=>[h(s(n(t)("useDefaultExplain")),1)]),_:1})])]),_:1},8,["label"])):x("",!0)]),_:1})]),_:1},8,["model","rules"])),[[q,A.value]]),a.is_use?(r(),b(j,{key:0,modelValue:D.value,"onUpdate:modelValue":e[8]||(e[8]=i=>D.value=i),title:n(t)("daySignTitle"),width:"1000px","destroy-on-close":!0},{footer:l(()=>[u("span",Ze,[d(w,{onClick:e[6]||(e[6]=i=>D.value=!1)},{default:l(()=>[h(s(n(t)("cancel")),1)]),_:1}),d(w,{type:"primary",onClick:e[7]||(e[7]=i=>Q())},{default:l(()=>[h(s(n(t)("confirm")),1)]),_:1})])]),default:l(()=>[d(Ve,{ref_key:"benefitsRef",ref:I,modelValue:a.day_award,"onUpdate:modelValue":e[5]||(e[5]=i=>a.day_award=i)},null,8,["modelValue"])]),_:1},8,["modelValue","title"])):x("",!0),a.is_use?(r(),b(j,{key:1,modelValue:k.value,"onUpdate:modelValue":e[12]||(e[12]=i=>k.value=i),title:n(t)("continueSignTitle"),width:"1200px","destroy-on-close":!0},{footer:l(()=>[u("span",ze,[d(w,{onClick:e[10]||(e[10]=i=>k.value=!1)},{default:l(()=>[h(s(n(t)("cancel")),1)]),_:1}),d(w,{type:"primary",onClick:e[11]||(e[11]=i=>te())},{default:l(()=>[h(s(n(t)("confirm")),1)]),_:1})])]),default:l(()=>[d(Ee,{ref_key:"continueRef",ref:L,modelValue:c.value,"onUpdate:modelValue":e[9]||(e[9]=i=>c.value=i),sign_period:a.sign_period},null,8,["modelValue","sign_period"])]),_:1},8,["modelValue","title"])):x("",!0),u("div",Ge,[u("div",Ke,[d(w,{type:"primary",onClick:e[13]||(e[13]=i=>J(B.value))},{default:l(()=>[h(s(n(t)("save")),1)]),_:1})])])])}}});const wa=Ae(We,[["__scopeId","data-v-ec1b1152"]]);export{wa as default};
