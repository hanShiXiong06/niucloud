import{d as G,f as H,y as U,j as N,G as W,l as x,r as M,R as Z,H as k,aZ as z,o as P,u as i,h as o,c as p,s as v,w as g,C as f,a as E,t as b,F as A,W as Q,dy as T,dq as X,dr as Y}from"./index-6a69b8ba.js";import"./el-sub-menu-4ed993c7.js";import{_ as D}from"./index.vue_vue_type_script_setup_true_lang-44397317.js";const ee={key:0,class:"w-[16px] h-[16px] relative flex items-center"},te={class:"ml-[10px]"},ne={key:0,class:"w-[16px] h-[16px] relative flex items-center"},se={class:"ml-[10px]"},re={key:0,class:"w-[16px] h-[16px] relative flex items-center"},ae={class:"ml-[10px]"},oe={key:2,class:"!border-0 !border-t-[1px] border-solid mx-[25px] bg-[#f7f7f7] my-[5px]"},R=G({__name:"menu-item",props:{routes:{type:Object,required:!0},level:{type:Number,default:1}},setup(d){const a=d,j=H(),h=U(),S=N(),B=N().routers;W();const c=x(()=>a.routes.meta),C=M([]),K=M([]);x(()=>{var t,r;const e={};return(t=S.siteInfo)==null||t.apps.forEach(n=>{e[n.key]=n}),(r=S.siteInfo)==null||r.site_addons.forEach(n=>{e[n.key]=n}),e});const O=x(()=>{var e;return(e=S.siteInfo)==null?void 0:e.site_addons.map(t=>t.key)}),$=x(()=>!a.routes.children||!Array.isArray(a.routes.children)?!1:a.routes.children.some(e=>{var t;return((t=e.meta)==null?void 0:t.show)===1})),_={};B.forEach(e=>{e.original_name=e.name,e.meta.addon&&(_[e.meta.addon]=e),e.meta.attr&&(_[e.meta.attr]=e)});const y=M(null),J=e=>{const t=[],r=n=>{n.forEach(s=>{s.name&&t.push(s.name),s.children&&Array.isArray(s.children)&&r(s.children)})};return e.forEach(n=>{n.children&&Array.isArray(n.children)&&r(n.children)}),t},V=e=>{const t=[];return e.forEach(r=>{r.name&&t.push(r.name)}),t},q=e=>{if(!e||typeof e!="object")return[];const t=[];return Object.values(e).forEach(r=>{Array.isArray(r.list)&&r.list.forEach(n=>{n.key&&t.push(n.key)})}),t},w=()=>{const e=k.get("specialAppList");if(Array.isArray(e)&&e.length){const t=JSON.parse(JSON.stringify(e)),r=k.get("activeAppKey");t.forEach(s=>{s.children&&Array.isArray(s.children)&&(l=>{l.forEach(m=>{m&&m.is_show!==void 0&&(m.is_show=m.menu_key===r?1:0)})})(s.children)});const n=t.filter(s=>s.children&&s.children.length>0);return T(n)}return[]},I=e=>{C.value.includes(e)||k.remove("activeAppKey"),K.value.includes(e)&&(e="addon_list"),j.push({name:e})};return Z(h,()=>{var n;const e=k.get("defaultAppList");if(a.routes.name=="addon_list"){const s=q(e);if(a.routes.children){a.routes.children=a.routes.children.filter(l=>!l.name||!s.includes(l.name));const u=w();if(u.length){const l=[...a.routes.children||[]];u.forEach(m=>{const L=l.findIndex(F=>F.name===m.name);L!==-1?l[L]=m:l.push(m)}),a.routes.children=l}}O.value.includes(h.meta.addon)&&_[h.meta.addon]?y.value=_[h.meta.addon]:h.meta.attr&&_[h.meta.attr]?y.value=_[h.meta.attr]:y.value=null}const t=k.get("defaultMarketingKeys"),r=(n=h.matched[1])==null?void 0:n.name;a.routes.name=="marketing_list"&&(t&&t.includes(r)?(y.value=h.matched[1]??[],y.value.meta.show=1):y.value=null)},{immediate:!0}),z(()=>{const e=w();C.value=J(e),K.value=V(e);const t=r=>{if(r.key==="activeAppKey"&&a.routes.name=="addon_list"){const n=w();if(n.length&&a.routes.children){const s=[...a.routes.children||[]];n.forEach(u=>{const l=s.findIndex(m=>m.name===u.name);l!==-1?s[l]=u:s.push(u)}),a.routes.children=s}}};window.addEventListener("storage",t),P(()=>{window.removeEventListener("storage",t)})}),(e,t)=>{const r=D,n=X,s=Y;return i(c).show?(o(),p(A,{key:0},[i($)?(o(),v(n,{key:0,index:String(d.routes.name)},{title:g(()=>[a.level==1?(o(),p("div",ee,[i(c).icon?(o(),v(r,{key:0,name:i(c).icon,class:"absolute !w-auto"},null,8,["name"])):f("",!0)])):f("",!0),E("span",te,b(i(c).title),1)]),default:g(()=>[(o(!0),p(A,null,Q(d.routes.children,(u,l)=>(o(),v(R,{routes:u,key:l,level:a.level+1},null,8,["routes","level"]))),128)),d.routes.name=="addon_list"||d.routes.name=="marketing_list"?(o(),p(A,{key:0},[y.value?(o(),v(R,{routes:y.value,key:e.index,level:a.level+1},null,8,["routes","level"])):f("",!0)],64)):f("",!0)]),_:1},8,["index"])):(o(),p(A,{key:1},[i(c).addon&&i(c).parent_route&&i(c).parent_route.addon==""?(o(),v(s,{key:0,index:String(d.routes.name),onClick:t[0]||(t[0]=u=>I(d.routes.name))},{title:g(()=>[a.level==1?(o(),p("div",ne,[i(c).icon?(o(),v(r,{key:0,name:i(c).icon,class:"absolute !w-auto"},null,8,["name"])):f("",!0)])):f("",!0),E("span",se,b(i(c).title),1)]),_:1},8,["index"])):(o(),v(s,{key:1,index:String(d.routes.name),onClick:t[1]||(t[1]=u=>I(d.routes.name))},{title:g(()=>[a.level==1?(o(),p("div",re,[i(c).icon?(o(),v(r,{key:0,name:i(c).icon,class:"absolute !w-auto"},null,8,["name"])):f("",!0)])):f("",!0),E("span",ae,b(i(c).title),1)]),_:1},8,["index"]))],64)),d.routes.is_border?(o(),p("div",oe)):f("",!0)],64)):f("",!0)}}});export{R as _};
