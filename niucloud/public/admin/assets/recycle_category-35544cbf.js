import{d as J,y as Q,d5 as X,n as U,aZ as Y,ax as ee,r as R,a6 as T,f as te,a5 as ae,h as V,c as oe,e as o,w as i,a as c,t as f,u as r,i as D,q as n,Z as le,s as L,B as j,C as se,ah as ne,E as ie,aH as re,aI as ce,aj as de,K as pe,b7 as _e,ak as me,a9 as ue,bx as ge,a3 as he,p as fe,g as ye}from"./index-28ce54e5.js";/* empty css                   *//* empty css                        *//* empty css                *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                    *//* empty css                  */import{k as ve,u as xe,f as we,l as be}from"./recycle_category-d4beaca3.js";import{_ as Ce}from"./recycle-category-edit.vue_vue_type_style_index_0_lang-4c91163b.js";import{S as ke}from"./sortable.esm-be94e56d.js";import{_ as Ie}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                  *//* empty css                   *//* empty css                */import"./index-16133bab.js";import"./index.vue_vue_type_style_index_0_lang-36d764c9.js";import"./attachment-6a2633f2.js";import"./index.vue_vue_type_script_setup_true_lang-101fc01a.js";import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                  *//* empty css                  *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                    *//* empty css                        *//* empty css                         */import"./index.vue_vue_type_script_setup_true_lang-e5b6971a.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-83b7ba07.js";const F=""+new URL("category_default-74216c25.png",import.meta.url).href,S=x=>(fe("data-v-80df7327"),x=x(),ye(),x),Ee={class:"recycle-category"},Re={class:"flex justify-between items-center mb-[5px]"},Te={class:"text-page-title"},Ve={class:"flex items-center"},De={class:"mt-[10px]"},Se=S(()=>c("i",{class:"order-0 iconfont icontuodong vues-rank mr-[8px]"},null,-1)),Be={class:"order-2"},$e={class:"h-[30px]"},Ne=S(()=>c("div",{class:"image-slot"},[c("img",{class:"w-[30px] h-[30px]",src:F})],-1)),Ue={class:"h-[30px]"},Le=S(()=>c("div",{class:"image-slot"},[c("img",{class:"w-[30px] h-[30px]",src:F})],-1)),je=J({__name:"recycle_category",setup(x){const M=Q().meta.title,B=X(),s=U({loading:!0,data:[]});Y(()=>{ee(()=>{q()}),I()});const _=R([]),q=()=>{const e=B.value.$el.querySelector(".el-table__body-wrapper tbody");ke.create(e,{handle:".vues-rank",animation:300,onMove:({dragged:l,related:d})=>{const m=_.value[l.rowIndex],u=_.value[d.rowIndex];if(m.pid!==u.pid)return!1},onStart:()=>{_.value=z(T(s.data))},onEnd:l=>{var k;const d=_.value[l.oldIndex],m=_.value[l.newIndex];if(l.oldIndex===l.newIndex||d.pid!==m.pid||_.value.indexOf(d)<0)return!1;const a=_.value.splice(l.oldIndex,1)[0];_.value.splice(l.newIndex,0,a);const b=m.pid,C=(k=_.value.filter(p=>p.pid===b))==null?void 0:k.map((p,v)=>{if(p.level===1&&p.category_id===a.category_id&&(s.data=s.data.filter(g=>g.category_id!==a.category_id),s.data.splice(v,0,a)),p.level===2&&p.category_id===a.category_id){const g=s.data.findIndex(t=>t.category_id===p.pid),E=T(s.data[g].child_list.filter(t=>t.category_id!==a.category_id));s.data[g].child_list=[],s.data[g].child_list.push(...E),s.data[g].child_list.splice(v,0,a)}return{category_id:p.category_id,sort:9999-v}});P({category_sort_array:C})}})},z=(e,l="child_list")=>{const d=[],m=u=>{u&&u.length>0&&u.filter(a=>a).forEach(a=>{d.push(a),m(a[l]||[])})};return m(e),d},I=()=>{s.loading=!0,ve().then(e=>{s.loading=!1,s.data=e.data}).catch(()=>{s.loading=!1})},P=e=>{xe(e).then(l=>{})},w=U({show:!1,index:0}),$=R([]),W=e=>{w.show=!0,$.value=[Z(e.images)]},Z=e=>e.startsWith("http://")||e.startsWith("https://")?e:""+e,N=e=>{const l=T(e);delete l.child_list,we(l)},y=R(null),H=()=>{y.value.setFormData(),y.value.showDialog=!0},K=e=>{y.value.setFormData(e),y.value.showDialog=!0},O=e=>{ne.confirm(!e.child_list||!e.child_list.length?n("categoryDeleteTips"):n("categoryDeleteTips1"),n("warning"),{confirmButtonText:n("confirm"),cancelButtonText:n("cancel"),type:"warning"}).then(()=>{be(e.category_id).then(()=>{I()}).catch(()=>{})})},A=te(),G=e=>{A.push({path:e})};return(e,l)=>{const d=ie,m=re,u=ce,a=de,b=pe,C=_e,k=me,p=ue,v=ae("goods-category-spread-popup"),g=ge,E=he;return V(),oe("div",Ee,[o(p,{shadow:"never"},{default:i(()=>[c("div",Re,[c("span",Te,f(r(M)),1),c("div",Ve,[o(d,{class:"ml-2 mr-2",type:"primary",onClick:H},{default:i(()=>[D(f(r(n)("添加报价单")),1)]),_:1})])]),o(u,{class:"demo-tabs","model-value":"/recycle/goods/category",onTabChange:G},{default:i(()=>[o(m,{label:r(n)("报价分类"),name:"/recycle/goods/category"},null,8,["label"])]),_:1}),c("div",De,[le((V(),L(k,{data:s.data,ref_key:"tableRef",ref:B,size:"large","row-key":"category_id","tree-props":{hasChildren:"hasChildren",children:"child_list"}},{empty:i(()=>[c("span",null,f(s.loading?"":r(n)("emptyData")),1)]),default:i(()=>[o(a,{label:r(n)("categoryName"),"min-width":"120"},{default:i(({row:t})=>[Se,c("span",Be,f(t.category_name),1)]),_:1},8,["label"]),o(a,{label:r(n)("image"),width:"170",align:"left"},{default:i(({row:t})=>[c("div",$e,[o(b,{class:"w-[30px] h-[30px]",src:r(j)(t.image),fit:"contain"},{error:i(()=>[Ne]),_:2},1032,["src"])])]),_:1},8,["label"]),o(a,{prop:"is_show",label:r(n)("是否显示")},{default:i(({row:t})=>[o(C,{modelValue:t.is_show,"onUpdate:modelValue":h=>t.is_show=h,"active-value":1,"inactive-value":0,onChange:h=>N(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),o(a,{prop:"need_vip",label:r(n)("热门")},{default:i(({row:t})=>[o(C,{modelValue:t.need_vip,"onUpdate:modelValue":h=>t.need_vip=h,"active-value":1,"inactive-value":0,onChange:h=>N(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),o(a,{label:r(n)("报价"),width:"170",align:"left"},{default:i(({row:t})=>[c("div",Ue,[o(b,{class:"w-[30px] h-[30px]",onClick:h=>W(t),src:r(j)(t.images),fit:"contain"},{error:i(()=>[Le]),_:2},1032,["onClick","src"])])]),_:1},8,["label"]),o(a,{label:r(n)("operation"),fixed:"right",align:"right",width:"200"},{default:i(({row:t})=>[o(d,{type:"primary",link:"",onClick:h=>K(t)},{default:i(()=>[D(f(r(n)("edit")),1)]),_:2},1032,["onClick"]),o(d,{type:"primary",link:"",onClick:h=>O(t)},{default:i(()=>[D(f(r(n)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[E,s.loading]])]),o(Ce,{ref_key:"editCategoryDialog",ref:y,onComplete:I},null,512)]),_:1}),o(v,{ref:"goodsCategorySpreadPopupRef"},null,512),w.show?(V(),L(g,{key:0,"url-list":$.value,onClose:l[0]||(l[0]=t=>w.show=!1),"initial-index":w.index,"zoom-rate":1},null,8,["url-list","initial-index"])):se("",!0)])}}});const kt=Ie(je,[["__scopeId","data-v-80df7327"]]);export{kt as default};
