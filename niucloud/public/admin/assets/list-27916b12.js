import{d as Lt,y as zt,r as u,l as _e,n as De,aZ as Bt,h as m,c as T,e as r,w as n,a as o,u as v,dW as Pt,i as b,F as ee,W as te,s as h,Y as pe,dp as Ut,dr as Rt,bb as we,t as _,C as D,Z as $t,dZ as Ee,dF as Ve,dK as Te,dN as Ot,dP as Se,d_ as Ft,dA as Ie,dJ as Nt,B as jt,dY as Yt,$ as c,du as Ht,ah as P,bE as ae,bh as Jt,E as Qt,L as Wt,M as Zt,a4 as qt,a1 as Gt,bV as Kt,N as Xt,a0 as ea,aH as ta,d$ as aa,aI as sa,aj as la,as as ia,dU as ra,ak as na,cQ as oa,a2 as ca,a9 as da,ae as ua,af as ma,V as _a,a3 as pa,p as va,g as fa,e0 as ya,e1 as ga,dt as ha,e2 as ba}from"./index-0b74b7aa.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                         *//* empty css                *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                        *//* empty css                    *//* empty css                 *//* empty css                *//* empty css                       *//* empty css                  */import"./el-form-item-4ed993c7.js";import{u as ka}from"./usePageState-e311bc43.js";import{d as xa,e as Ca,f as Da,b as se,h as wa,i as Ea,j as ve,k as Va,l as Ta,m as Me,n as Sa,p as Ia,o as Ma}from"./recycle_order-d9d63f63.js";import{d as Aa}from"./device_query_api-5498e400.js";import{_ as La}from"./printer-2aeedafc.js";import za from"./AddOrderDialog-de2bf42a.js";import Ba from"./PaymentMethodDialog-3271383d.js";import Pa from"./OrderDetailDialog-d923ff82.js";import Ua from"./PriceFormDialog-8f7fb62e.js";import Ra from"./CheckDeviceDialog-6a9dad6a.js";import $a from"./DeviceConfirmDialog-21de72be.js";import Oa from"./DeviceDetailDialog-18b04c3f.js";import Fa from"./index-3c067a5c.js";import{_ as Na}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                        *//* empty css                       *//* empty css                 *//* empty css                 *//* empty css                 *//* empty css                        *//* empty css                        *//* empty css                         *//* empty css                   *//* empty css                             */import"./index-50c1a6c1.js";import"./index.vue_vue_type_style_index_0_lang-d61b6ebc.js";import"./attachment-c8c37cd4.js";import"./index.vue_vue_type_script_setup_true_lang-832af570.js";/* empty css               *//* empty css                  *//* empty css                    *//* empty css                         */import"./index.vue_vue_type_script_setup_true_lang-00957a82.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-cb8d7a65.js";import"./sortable.esm-be94e56d.js";/* empty css                  */import"./browser-a1ac24ac.js";import"./WarrantyInfoDisplay-6347b608.js";import"./member-cf62c19b.js";const A=Q=>(va("data-v-23af1580"),Q=Q(),fa(),Q),ja={class:"recycle-order-list h-full"},Ya={class:"flex justify-between items-center mb-4"},Ha=A(()=>o("span",{class:"text-xl font-semibold text-gray-800"},"📱 回收订单管理",-1)),Ja={class:"btn-wrap"},Qa={class:"mb-3 sticky top-30 z-50 bg-white/95 backdrop-blur-sm shadow-lg rounded-lg p-2 -mx-2"},Wa={class:"p-2"},Za={class:"flex justify-center pt-4 border-t border-orange-200"},qa={class:"flex gap-3"},Ga={class:"flex items-center"},Ka=A(()=>o("span",null,"全部",-1)),Xa={class:"flex items-center"},es={class:"device-expansion-panel"},ts={class:"panel-header mb-3"},as=A(()=>o("h4",{class:"text-lg font-medium text-gray-800"},"📱 设备列表",-1)),ss={class:"text-sm text-gray-500"},ls={class:"price-text"},is={key:0,class:"flex justify-end mt-3"},rs={class:"order-info-cell"},ns={class:"info-row"},os=A(()=>o("span",{class:"label"},"订单号：",-1)),cs={class:"value"},ds={class:"info-row"},us=A(()=>o("span",{class:"label"},"配送：",-1)),ms={class:"value"},_s={key:0,class:"info-row"},ps=A(()=>o("span",{class:"text-gray-500 text-xs min-w-16"},"快递单号：",-1)),vs=["onClick"],fs={key:0,class:"font-mono font-medium"},ys={class:"user-info-cell"},gs={class:"user-avatar"},hs={class:"user-details"},bs={class:"user-name"},ks={class:"user-phone"},xs=A(()=>o("div",{class:"text-xs"},"提交数量/签收数量",-1)),Cs={class:"flex justify-between items-center mt-4"},Ds={class:"text-sm text-gray-500"},ws={key:0,class:"express-info-container"},Es={class:"express-header mb-4"},Vs={class:"flex items-center justify-between"},Ts={class:"text-lg font-medium"},Ss={class:"text-sm text-gray-600"},Is={class:"mt-2"},Ms={class:"text-sm text-gray-600"},As={class:"text-xs text-gray-500"},Ls={class:"express-trace"},zs=A(()=>o("h4",{class:"text-md font-medium mb-3"},"物流轨迹",-1)),Bs={class:"trace-item"},Ps={class:"trace-location"},Us={class:"trace-desc"},Rs={key:1,class:"text-center py-8 text-gray-500"},$s=Lt({__name:"list",setup(Q){zt();const $=u({}),le=u(!1),I=u([]),{expandedRows:Ae,pagination:f,setExpandedRows:Le,setPagination:L,applyExpandedRows:Os}=ka("recycle_order_list"),ze=_e(()=>Ae.value||[]),z=u(!1),W=u(!1),O=u(0),w=u([]),ie=u(!1),fe=u(null);u([]);const B=u([]),Z=u(0),q=u({}),re=u(!1),S=u(null),Be=u(null),U=u(null),Pe=()=>{w.value.push({imei:"",model:"",initial_price:0,editing:!0,category_id:1})},Ue=t=>{const e=w.value.findIndex(l=>l===t||l.id===t.id);e!==-1&&(w.value[e].editing=!0)},Re=async t=>{try{t.id&&(await xa(t.id),c.success("删除成功"),await y(),z.value=!1),w.value=w.value.filter(e=>e!==t&&e.id!==t.id)}catch(e){console.error("删除设备失败：",e),c.error("删除失败："+(e.message||"未知错误"))}},$e=()=>{z.value=!1,w.value=[],O.value=0},E=De({keyword:"",status:"",delivery_type:""}),i=De({order_id:"",express_no:"",status:[],member_id:"",user_mobile:"",delivery_type:[],device_imei:"",device_model:"",device_count_min:null,device_count_max:null,amount_min:null,amount_max:null,create_time_range:[],update_time_range:[]});u(!0);const Oe=async()=>{try{const t=await Ca();t.code===1&&($.value=t.data)}catch(t){console.error("获取状态列表失败:",t)}},Fe=u(null),y=async(t=1)=>{le.value=!0;try{const e={page:f.value.page,limit:f.value.limit};E.keyword&&(e.keyword=E.keyword),E.status&&(e.status=E.status),E.delivery_type&&(e.delivery_type=E.delivery_type),i.order_id&&(e.order_id=i.order_id),i.express_no&&(e.express_no=i.express_no),i.status&&i.status.length>0&&(e.status=i.status.join(",")),i.member_id&&(e.member_id=i.member_id),i.user_mobile&&(e.user_mobile=i.user_mobile),i.delivery_type&&i.delivery_type.length>0&&(e.delivery_type=i.delivery_type.join(",")),i.device_imei&&(e.device_imei=i.device_imei),i.device_model&&(e.device_model=i.device_model),i.device_count_min&&(e.device_count_min=i.device_count_min),i.device_count_max&&(e.device_count_max=i.device_count_max),i.amount_min&&(e.amount_min=i.amount_min),i.amount_max&&(e.amount_max=i.amount_max),i.create_time_range&&i.create_time_range.length===2&&(e.create_time_start=i.create_time_range[0],e.create_time_end=i.create_time_range[1]),i.update_time_range&&i.update_time_range.length===2&&(e.update_time_start=i.update_time_range[0],e.update_time_end=i.update_time_range[1]);const l=await Da(e);l.data.data?I.value=l.data.data:l.data.list?I.value=l.data.list:(I.value=[],console.error("API返回的数据结构不符合预期:",l.data));const s=l.data.total||l.data.count||0;ye.value=l.data.status_counts,L({total:s})}catch(e){console.error("获取列表失败:",e),c.error("获取列表失败")}finally{le.value=!1}},Ne=t=>{L({limit:t,page:f.value.page}),y(1)},je=t=>{L({page:t,limit:f.value.limit}),y(t)};u(!1);const ye=u({}),Ye=t=>t==="all"?f.value.total:ye.value[t]||0,He=t=>({1:"warning",2:"warning",3:"primary",4:"success",5:"warning",6:"primary",7:"success",8:"info",9:"danger",10:"danger"})[t]||"info",Je=t=>({1:"light",2:"light",3:"light",4:"light",5:"light",6:"dark",7:"dark",8:"plain",9:"dark",10:"dark"})[t]||"plain",Qe=t=>({1:"info",2:"warning",3:"primary",4:"success",5:"success",6:"danger"})[t]||"info",ge=t=>{switch(t){case 1:return"Clock";case 2:return"Finished";case 3:return"Loading";case 4:return"DocumentChecked";case 5:return"CircleCheck";case 6:return"Money";case 7:return"CircleCheckFilled";case 8:return"CircleClose";default:return"QuestionFilled"}},We=t=>({1:"warning",2:"info",3:"primary",4:"success",5:"warning",6:"primary",7:"success",8:"info",9:"danger",10:"danger"})[t]||"info",Ze=t=>({order_sign:"primary",order_check:"success",order_price:"warning",order_payment:"primary",order_complete:"success",order_cancel:"danger",order_delete:"danger",order_detail:"info"})[t]||"default",qe=t=>({order_sign:Ee,order_check:pe,order_price:Ve,order_payment:ya,order_complete:ga,order_cancel:ha,order_delete:Se,order_detail:Ie,order_push_notify:ba})[t]||Ht,Ge=t=>t?`¥${(typeof t=="string"?parseFloat(t):t).toFixed(2)}`:"¥0.00",Ke=async t=>{try{await P.confirm("确定要推送订单确认通知给用户吗？","推送通知",{confirmButtonText:"确定推送",cancelButtonText:"取消",type:"info"});const e=ae.service({lock:!0,text:"正在发送通知...",background:"rgba(0, 0, 0, 0.7)"});await Ma(t.id),e.close(),c.success("推送通知已发送")}catch(e){e!=="cancel"&&(console.error("推送通知失败：",e),c.error(e.message||"推送通知失败"))}},Xe=async(t,e)=>{try{if(e.key==="order_cancel")await P.confirm("确定要取消该订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await se(t.id,{action:"order_cancel"}),c.success("订单已取消"),await y(f.value.page);else if(e.key==="order_delete")await P.confirm("确定要删除该订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await wa(t.id),c.success("订单已删除"),await y(f.value.page);else if(e.key==="order_complete")await P.confirm("确定要完成该订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await se(t.id,{action:"order_complete"}),c.success("操作成功，订单已完成"),await y(f.value.page);else if(e.key==="order_sign")O.value=t.id,w.value=t.devices||[],z.value=!0;else if(e.key==="order_check")O.value=t.id,w.value=t.devices||[],F.value=!0;else if(e.key==="order_price")O.value=t.id,w.value=t.devices||[],N.value=!0;else if(e.key=="order_payment"){W.value=!0;const l=await Ea(t.member_id);if(l.data&&Array.isArray(l.data)){const s=I.value.find(p=>p.id===t.id);let g=0;s&&s.devices&&Array.isArray(s.devices)&&(g=s.devices.filter(p=>p.status===6).length);let C=0;s&&s.devices&&Array.isArray(s.devices)&&(C=s.devices.filter(p=>p.status>=4).length);let H=0;s&&s.devices&&Array.isArray(s.devices)&&(H=s.devices.filter(p=>p.status>=5).length);let K=0;s&&s.devices&&Array.isArray(s.devices)&&(K=s.devices.filter(p=>p.status==5).length);let X=0;s&&s.devices&&Array.isArray(s.devices)&&(X=s.devices.filter(p=>p.status==5).reduce((p,ue)=>p+ +ue.final_price,0));const M={order_id:s?s.id:t.id,delivery_type:s?s.delivery_type_text:"",device_count:s&&s.devices?s.devices.length:0,confirmed_count:H,checked_count:C,success_count:K,returned_count:g,price_per_device:s?s.price_per_device:0,total_amount:s?X:0,customer_name:s?s.member.nickname:"",customer_mobile:s?s.member.mobile:"",delivery_type_name:s?s.delivery_type_name:"",devices:s&&s.devices?s.devices.map(p=>({id:p.id,model:p.model,imei:p.imei,final_price:p.final_price||0,status:p.status,status_name:p.status_name||""})):[]},J=l.data.map(p=>({...p,order_summary:M}));B.value=J,Z.value=J.length>0?0:-1}else B.value=[]}else if(e.key=="order_detail"){const l=I.value.find(s=>s.id===t.id);l?(fe.value=l,ie.value=!0):c.warning("未找到订单信息")}else e.key=="order_push_notify"?await Ke(t):(await se(t.id,{action:e.key}),c.success("操作成功"),await y())}catch(l){console.error("操作失败：",l),c.error(l.message||"操作失败")}},ne=t=>t?t.length:0,et=()=>{at(),Y.value="",L({page:1}),y(1)},tt=()=>{st(),Y.value="",L({page:1}),y(1)},at=()=>{E.keyword="",E.status="",E.delivery_type=""},st=()=>{i.order_id="",i.express_no="",i.status=[],i.member_id="",i.user_mobile="",i.delivery_type=[],i.device_imei="",i.device_model="",i.device_count_min=null,i.device_count_max=null,i.amount_min=null,i.amount_max=null,i.create_time_range=[],i.update_time_range=[]},lt=(t,e)=>{i.member_id=t,L({page:1}),y(1)},it=t=>{const e=I.value.find(l=>l.id===t);return e?e.status:0},G=u({id:0,imei:"",model:"",initial_price:"",check_result:"",check_images:"",remark:"",status:0,final_price:"",check_status:0}),F=u(!1),N=u(!1);u({});const rt=async t=>{const e=t.order_id,l=I.value.find(g=>g.id===e);if(l&&l.status===1){c.warning("请先签收订单后再进行质检");return}F.value=!0;const s=await ve(t.id);s.code===1&&(G.value={id:s.data.id,imei:s.data.imei,model:s.data.model,initial_price:s.data.initial_price,check_result:s.data.check_result||"",check_images:s.data.check_images||"",final_price:s.data.final_price||"",remark:s.data.remark||"",status:s.data.status,check_status:s.data.check_status})},he=async t=>{try{const e=await ve(t.id);e.code===1&&(G.value={id:e.data.id,imei:e.data.imei,model:e.data.model,initial_price:e.data.initial_price,check_result:e.data.check_result||"",check_images:e.data.check_images||"",final_price:e.data.final_price||"",before_price:e.data.before_price||"",remark:e.data.remark||"",status:e.data.status,check_status:e.data.check_status},N.value=!0)}catch(e){console.error("获取设备信息失败:",e),c.error("获取设备信息失败")}},nt=async t=>{var e,l;try{if(!t.check_result){c.warning("请填写质检结果");return}await Va(t.id,{check_result:t.check_result,check_images:t.check_images,remark:t.remark,check_status:1,final_price:t.final_price,action:"check",imei:t.imei,info:t.info,model:t.model}),c.success("质检信息提交成功"),F.value=!1,await y(f.value.page)}catch(s){console.error("提交质检信息失败：",s),c.error(((l=(e=s.response)==null?void 0:e.data)==null?void 0:l.message)||"提交失败，请重试")}},ot=async t=>{try{if(!t||!t.final_price||t.final_price<=0){c.warning("请输入有效的价格");return}await Ta(t.id,t),c.success("定价信息提交成功"),N.value=!1,await y(f.value.page)}catch(e){console.error("提交定价信息失败：",e),c.error("提交失败，请重试")}},j=u({}),ct=(t,e)=>{j.value[e]=t},dt=async t=>{t||c.warning("请选择设备");try{await Me({ids:t+"",remark:"管理员确认"}),y(f.value.page)}catch{c.error("确认失败")}},ut=async t=>{if(!t){c.warning("请选择设备");return}try{const{value:e}=await P.prompt(`确定要拒绝回收该设备吗？将创建退货订单处理该设备。
请输入拒绝回收原因：`,"拒绝回收确认",{confirmButtonText:"确定拒绝",cancelButtonText:"取消",type:"warning",inputPlaceholder:"请输入拒绝回收原因"}),l=ae.service({lock:!0,text:"正在处理...",background:"rgba(0, 0, 0, 0.7)"});await Sa({ids:t+"",remark:e||"商户拒绝回收"}),l.close(),c.success("拒绝成功，已创建退货订单"),y(f.value.page)}catch(e){if(e==="cancel")return;console.error("拒绝失败:",e)}},mt=async t=>{try{const e=j.value[t].map(s=>s.id);if(e.length===0){c.warning("请选择设备");return}const{value:l}=await P.prompt("请输入操作备注","批量确认设备",{confirmButtonText:"确认",cancelButtonText:"取消",inputPlaceholder:"请输入备注信息（可选）"});await Me({ids:e.join(","),remark:l||""}),c.success("批量确认成功"),await y(f.value.page)}catch(e){e!=="cancel"&&(console.error("批量确认失败：",e),c.error("批量确认失败"))}},_t=(t,e)=>{const l=e.map(s=>s.id);Le(l)},oe=u(!1),be=u({}),pt=async t=>{try{const e=await ve(t.id);if(e.code!==1){c.error(e.msg||"获取设备详情失败");return}de.value=e.data,oe.value=!0}catch(e){console.error("获取设备详情失败:",e),c.error("获取设备详情失败")}},ce=u(!1),vt=()=>{ce.value=!0},ft=async()=>{await y()};Bt(async()=>{await Oe(),await y(f.value.page)}),_e(()=>B.value&&B.value.length>0&&Z.value>=0&&Z.value<B.value.length?B.value[Z.value]:null);const Y=u(""),yt=t=>{Y.value=t.props.name,E.status=t.props.name,i.status=[],L({page:1}),y(1)},gt=async t=>{try{await Ia(t.orderId,{pay_type:t.payType,remark:"财务已确认打款"}),c.success("确认打款成功"),W.value=!1,await y()}catch(e){console.error("确认打款失败",e),c.error("确认打款失败")}},de=u(null),ht=()=>{de.value=null},bt=async t=>{const e=ae.service({lock:!0,text:"正在保存...",background:"rgba(0, 0, 0, 0.7)"});try{const l=await se(t.orderId,{action:"order_sign",devices:t.devices.map(s=>({id:s.id,imei:s.imei,model:s.model,initial_price:s.initial_price,category_id:s.category_id}))});if(l.code!==1)throw e.close(),z.value=!1,new Error(l.message||"操作失败");c.success("订单签收成功"),z.value=!1,await y(),e.close()}catch{e.close()}};_e(()=>{var t,e;return(e=(t=be.value)==null?void 0:t.data)!=null&&e.check_images?be.value.data.check_images.split(",").filter(l=>l):[]});const kt=async t=>{try{const e=ae.service({lock:!0,text:"正在打印标签...",background:"rgba(0, 0, 0, 0.7)"}),l=await La(t.id);if(e.close(),l.code===1)c.success("标签打印成功"),l.data&&l.data.simulated&&(Jt({title:"模拟打印",message:"已生成打印内容，但未连接实际打印机",type:"warning",duration:5e3}),P.alert(`<pre style="white-space: pre-wrap; font-family: monospace; font-size: 12px;">${l.data.content}</pre>`,"打印内容预览",{dangerouslyUseHTMLString:!0,confirmButtonText:"关闭",callback:()=>{}}));else{const s=l.message||"打印失败",g=l.debug_info?JSON.stringify(l.debug_info):"";c.error(`${s} ${g}`),console.error("打印失败:",l)}}catch(e){console.error("打印过程异常:",e),c.error(`打印过程异常: ${e.message||"未知错误"}`)}},xt=async(t,e)=>{try{return(await Aa(t,e)).data}catch(l){throw console.error("查询快递信息失败:",l),l}},Ct=async t=>{!t.express_no||t.express_no==="暂无"||(U.value&&clearTimeout(U.value),U.value=setTimeout(async()=>{var e,l;try{q.value[t.id]=!0;const g=(((e=t.member)==null?void 0:e.mobile)||((l=t.recycleUserAddress)==null?void 0:l.mobile)||"").slice(-4);if(!g){c.warning("无法获取用户手机号，无法查询快递信息");return}const C=await xt(t.express_no,g);if(!C||!C.data||!C.data.logisticsTraceDetailList||C.data.logisticsTraceDetailList.length===0){c.info("暂无物流信息");return}S.value=C.data,Be.value=t,re.value=!0}catch(s){console.error("查询快递信息失败:",s),c.error("查询快递信息失败")}finally{q.value[t.id]=!1}},500))},Dt=()=>{U.value&&(clearTimeout(U.value),U.value=null)},wt=t=>{switch(t){case"ACCEPT":return"info";case"TRANSPORT":return"warning";case"DELIVER":return"primary";case"SIGN":return"success";case"REJECT":case"EXCEPTION":return"danger";default:return"info"}};return(t,e)=>{const l=Qt,s=Wt,g=Zt,C=qt,H=Gt,K=Kt,X=Xt,M=ea,J=ta,p=aa,ue=sa,x=la,R=ia,me=ra,ke=na,Et=oa,Vt=ca,Tt=da,St=ua,It=ma,Mt=_a,At=pa;return m(),T("div",ja,[r(Tt,{class:"box-card !border-none h-full relative",shadow:"never"},{default:n(()=>[o("div",Ya,[Ha,o("div",Ja,[r(l,{type:"primary",icon:v(Pt),onClick:vt},{default:n(()=>[b("代下单")]),_:1},8,["icon"])])]),o("div",Qa,[o("div",Wa,[r(X,{inline:!0,model:i},{default:n(()=>[r(g,{label:"订单编号"},{default:n(()=>[r(s,{modelValue:i.order_id,"onUpdate:modelValue":e[0]||(e[0]=a=>i.order_id=a),placeholder:"输入精确订单号",clearable:"",class:"w-full"},null,8,["modelValue"])]),_:1}),r(g,{label:"快递单号"},{default:n(()=>[r(s,{modelValue:i.express_no,"onUpdate:modelValue":e[1]||(e[1]=a=>i.express_no=a),placeholder:"输入快递单号",clearable:"",class:"w-full"},null,8,["modelValue"])]),_:1}),r(g,{label:"订单状态"},{default:n(()=>[r(H,{modelValue:i.status,"onUpdate:modelValue":e[2]||(e[2]=a=>i.status=a),placeholder:"选择状态",clearable:"",multiple:"","collapse-tags":"",class:"w-full"},{default:n(()=>[(m(!0),T(ee,null,te($.value,(a,k)=>(m(),h(C,{key:k,label:a.name,value:a.status},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(g,{label:"用户搜索"},{default:n(()=>[r(Fa,{modelValue:i.member_id,"onUpdate:modelValue":e[3]||(e[3]=a=>i.member_id=a),placeholder:"🔍 输入用户昵称、手机号或用户编号",onChange:lt,class:"w-full"},null,8,["modelValue"])]),_:1}),r(g,{label:"用户手机号"},{default:n(()=>[r(s,{modelValue:i.user_mobile,"onUpdate:modelValue":e[4]||(e[4]=a=>i.user_mobile=a),placeholder:"输入用户手机号",clearable:"",class:"w-full"},null,8,["modelValue"])]),_:1}),r(g,{label:"配送方式"},{default:n(()=>[r(H,{modelValue:i.delivery_type,"onUpdate:modelValue":e[5]||(e[5]=a=>i.delivery_type=a),placeholder:"选择配送方式",clearable:"",multiple:"",class:"w-full"},{default:n(()=>[r(C,{label:"📦 快递配送",value:"1"}),r(C,{label:"🚗 自送到店",value:"2"})]),_:1},8,["modelValue"])]),_:1}),r(g,{label:"设备IMEI"},{default:n(()=>[r(s,{modelValue:i.device_imei,"onUpdate:modelValue":e[6]||(e[6]=a=>i.device_imei=a),placeholder:"输入设备IMEI号",clearable:"",class:"w-full"},null,8,["modelValue"])]),_:1}),r(g,{label:"设备型号"},{default:n(()=>[r(s,{modelValue:i.device_model,"onUpdate:modelValue":e[7]||(e[7]=a=>i.device_model=a),placeholder:"输入设备型号",clearable:"",class:"w-full"},null,8,["modelValue"])]),_:1}),r(g,{label:"创建时间"},{default:n(()=>[r(K,{modelValue:i.create_time_range,"onUpdate:modelValue":e[8]||(e[8]=a=>i.create_time_range=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"w-full"},null,8,["modelValue"])]),_:1}),o("div",Za,[o("div",qa,[r(l,{type:"primary",icon:v(pe),onClick:et,class:"bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 border-0 shadow-sm px-6"},{default:n(()=>[b(" 执行高级搜索 ")]),_:1},8,["icon"]),r(l,{icon:v(Ut),onClick:tt,class:"border-gray-300 text-gray-600 hover:border-gray-400 px-6"},{default:n(()=>[b(" 重置所有条件 ")]),_:1},8,["icon"])])])]),_:1},8,["model"])])]),r(ue,{modelValue:Y.value,"onUpdate:modelValue":e[9]||(e[9]=a=>Y.value=a),onTabClick:yt,class:"order-tabs"},{default:n(()=>[r(J,{name:""},{label:n(()=>[o("div",Ga,[r(M,{class:"mr-1"},{default:n(()=>[r(v(Rt))]),_:1}),Ka])]),_:1}),(m(!0),T(ee,null,te($.value,(a,k)=>(m(),h(J,{key:k,name:a.status},{label:n(()=>[o("div",Xa,[r(M,{class:"mr-1"},{default:n(()=>[(m(),h(we(ge(a.status))))]),_:2},1024),o("span",null,_(a.name),1),a.status<7?(m(),h(p,{key:0,value:Ye(a.status),class:"ml-1",type:We(a.status)},null,8,["value","type"])):D("",!0)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),$t((m(),h(ke,{ref_key:"orderTable",ref:Fe,data:I.value,"expand-row-keys":v(ze),"row-key":"id",style:{width:"100%"},onExpandChange:_t,class:"order-table"},{default:n(()=>[r(x,{type:"expand"},{default:n(({row:a})=>{var k;return[o("div",es,[o("div",ts,[as,o("span",ss,"共 "+_(((k=a.devices)==null?void 0:k.length)||0)+" 台设备",1)]),r(ke,{data:a.devices,border:"",size:"small",onSelectionChange:d=>ct(d,a.id),class:"device-table"},{default:n(()=>[r(x,{type:"selection",width:"55"}),r(x,{prop:"imei",label:"IMEI","min-width":"150"}),r(x,{prop:"model",label:"设备型号","min-width":"120"}),r(x,{prop:"final_price",label:"最终价格",width:"100"},{default:n(({row:d})=>[o("span",ls,_(Ge(d.final_price)),1)]),_:2},1024),r(x,{prop:"status_name",label:"状态",width:"100"},{default:n(({row:d})=>[r(R,{type:Qe(d.status),size:"small"},{default:n(()=>[b(_(d.status_name),1)]),_:2},1032,["type"])]),_:2},1024),r(x,{label:"操作","min-width":"280"},{default:n(({row:d})=>[r(me,null,{default:n(()=>[d.status===1&&it(d.order_id)>1?(m(),h(l,{key:0,type:"primary",size:"small",icon:v(Ee),onClick:V=>rt(d)},{default:n(()=>[b(" 开始质检 ")]),_:2},1032,["icon","onClick"])):D("",!0),d.status==2||d.status==3?(m(),h(l,{key:1,type:"success",size:"small",icon:v(Ve),onClick:V=>he(d)},{default:n(()=>[b(" 定价 ")]),_:2},1032,["icon","onClick"])):D("",!0),d.status==4?(m(),h(l,{key:2,type:"primary",size:"small",icon:v(Te),onClick:V=>dt(d.id)},{default:n(()=>[b(" 确认 ")]),_:2},1032,["icon","onClick"])):D("",!0),d.status==4?(m(),h(l,{key:3,type:"warning",size:"small",icon:v(Ot),onClick:V=>he(d)},{default:n(()=>[b(" 重新定价 ")]),_:2},1032,["icon","onClick"])):D("",!0),d.status==4?(m(),h(l,{key:4,type:"danger",size:"small",icon:v(Se),onClick:V=>ut(d.id)},{default:n(()=>[b(" 拒绝 ")]),_:2},1032,["icon","onClick"])):D("",!0),d.status>=3?(m(),h(l,{key:5,type:"info",size:"small",icon:v(Ft),onClick:V=>kt(d)},{default:n(()=>[b(" 打印标签 ")]),_:2},1032,["icon","onClick"])):D("",!0)]),_:2},1024),r(l,{type:"primary",link:"",icon:v(Ie),onClick:V=>pt(d),size:"small",class:"ml-2"},{default:n(()=>[b(" 查看详情 ")]),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:2},1032,["data","onSelectionChange"]),j.value[a.id]&&j.value[a.id].length>0&&a.status==4?(m(),T("div",is,[r(me,null,{default:n(()=>[r(l,{type:"primary",size:"small",icon:v(Te),onClick:d=>mt(a.id)},{default:n(()=>[b(" 批量确认 ("+_(j.value[a.id].length)+") ",1)]),_:2},1032,["icon","onClick"])]),_:2},1024)])):D("",!0)])]}),_:1}),r(x,{label:"订单信息","min-width":"200"},{default:n(({row:a})=>[o("div",rs,[o("div",ns,[os,o("span",cs,_(a.order_no),1)]),o("div",ds,[us,o("span",ms,[r(R,{size:"small",type:a.delivery_type==="1"?"warning":"success"},{default:n(()=>[b(_(a.delivery_type==="1"?"📦 快递":"🚗 自送"),1)]),_:2},1032,["type"])])]),a.delivery_type==="1"?(m(),T("div",_s,[ps,o("span",{class:"flex-1 cursor-pointer transition-all duration-300 ease-in-out rounded px-1 py-0.5 hover:bg-blue-50 hover:text-blue-600 text-gray-800 text-sm break-all",onClick:k=>Ct(a),onMouseleave:Dt},[q.value[a.id]?(m(),h(M,{key:1,class:"animate-spin text-blue-500"},{default:n(()=>[r(v(Nt))]),_:1})):(m(),T("span",fs,_(a.express_no||"暂无"),1)),a.express_no&&!q.value[a.id]?(m(),h(M,{key:2,class:"ml-1 text-gray-400 text-xs"},{default:n(()=>[r(v(pe))]),_:1})):D("",!0)],40,vs)])):D("",!0)])]),_:1}),r(x,{label:"用户信息","min-width":"150"},{default:n(({row:a})=>{var k,d,V,xe,Ce;return[o("div",ys,[o("div",gs,[r(Et,{size:32,src:(k=a.member)!=null&&k.headimg?v(jt)(a.member.headimg):"",class:"mr-2"},{default:n(()=>[r(M,null,{default:n(()=>[r(v(Yt))]),_:1})]),_:2},1032,["src"])]),o("div",hs,[o("div",bs,_(((d=a.recycleUserAddress)==null?void 0:d.name)||((V=a.member)==null?void 0:V.nickname)||"未知用户"),1),o("div",ks,_(((xe=a.member)==null?void 0:xe.mobile)||((Ce=a.recycleUserAddress)==null?void 0:Ce.mobile)||"暂无联系方式"),1)])])]}),_:1}),r(x,{width:"140",align:"center"},{header:n(()=>[xs]),default:n(({row:a})=>[a.count==ne(a.devices)?(m(),h(R,{key:0,type:"success",class:"device-count-tag"},{default:n(()=>[b(_(a.count)+"/ "+_(ne(a.devices))+"台 ",1)]),_:2},1024)):(m(),h(R,{key:1,type:"danger",class:"device-count-tag"},{default:n(()=>[b(_(a.count?a.count:"1")+"/ "+_(ne(a.devices))+"台 ",1)]),_:2},1024))]),_:1}),r(x,{label:"状态",width:"120",align:"center"},{default:n(({row:a})=>[r(R,{type:He(a.status),effect:Je(a.status)},{default:n(()=>[r(M,{class:"mr-1"},{default:n(()=>[(m(),h(we(ge(a.status))))]),_:2},1024),b(" "+_(a.status_name),1)]),_:2},1032,["type","effect"])]),_:1}),r(x,{prop:"create_at",label:"创建时间",width:"180"}),r(x,{label:"操作",width:"200",fixed:"right"},{default:n(({row:a})=>{var k;return[(k=$.value[a.status])!=null&&k.action?(m(),h(me,{key:0},{default:n(()=>[(m(!0),T(ee,null,te($.value[a.status].action,d=>(m(),h(l,{key:d.key,size:"small",type:Ze(d.key),icon:qe(d.key),onClick:V=>Xe(a,d)},{default:n(()=>[b(_(d.value),1)]),_:2},1032,["type","icon","onClick"]))),128))]),_:2},1024)):D("",!0)]}),_:1})]),_:1},8,["data","expand-row-keys"])),[[At,le.value]]),o("div",Cs,[o("div",Ds," 共 "+_(v(f).total)+" 条记录，当前第 "+_(v(f).page)+" 页 ",1),r(Vt,{"current-page":v(f).page,"onUpdate:current-page":e[10]||(e[10]=a=>v(f).page=a),"page-sizes":[15,30,50,100],"page-size":v(f).limit,total:v(f).total,"hide-on-single-page":!1,layout:"  sizes, prev, pager, next, jumper",onSizeChange:Ne,onCurrentChange:je},null,8,["current-page","page-size","total"])])]),_:1}),r(za,{visible:ce.value,"onUpdate:visible":e[11]||(e[11]=a=>ce.value=a),onSuccess:ft},null,8,["visible"]),r($a,{visible:z.value,"onUpdate:visible":e[12]||(e[12]=a=>z.value=a),"device-list":w.value,"order-id":O.value,onConfirm:bt,onAddDevice:Pe,onEditDevice:Ue,onRemoveDevice:Re,onCancel:$e},null,8,["visible","device-list","order-id"]),r(Ra,{visible:F.value,"onUpdate:visible":e[13]||(e[13]=a=>F.value=a),device:G.value,onConfirm:nt},null,8,["visible","device"]),r(Ua,{visible:N.value,"onUpdate:visible":e[14]||(e[14]=a=>N.value=a),device:G.value,onConfirm:ot},null,8,["visible","device"]),r(Oa,{visible:oe.value,"onUpdate:visible":e[15]||(e[15]=a=>oe.value=a),device:de.value,onClosed:ht},null,8,["visible","device"]),r(Pa,{visible:ie.value,"onUpdate:visible":e[16]||(e[16]=a=>ie.value=a),"order-detail":fe.value},null,8,["visible","order-detail"]),r(Ba,{visible:W.value,"onUpdate:visible":e[17]||(e[17]=a=>W.value=a),"payment-info":B.value,onPaymentConfirmed:gt},null,8,["visible","payment-info"]),r(Mt,{modelValue:re.value,"onUpdate:modelValue":e[18]||(e[18]=a=>re.value=a),title:"快递物流信息",width:"600px","destroy-on-close":!0},{default:n(()=>[S.value?(m(),T("div",ws,[o("div",Es,[o("div",Vs,[o("div",null,[o("h3",Ts,_(S.value.logisticsCompanyName),1),o("p",Ss,"运单号："+_(S.value.mailNo),1)]),r(R,{type:wt(S.value.logisticsStatus),size:"large"},{default:n(()=>[b(_(S.value.logisticsStatusDesc),1)]),_:1},8,["type"])]),o("div",Is,[o("p",Ms," 最新状态："+_(S.value.theLastMessage),1),o("p",As," 更新时间："+_(S.value.theLastTime),1)])]),o("div",Ls,[zs,r(It,null,{default:n(()=>[(m(!0),T(ee,null,te(S.value.logisticsTraceDetailList,(a,k)=>(m(),h(St,{key:k,timestamp:a.timeDesc,type:k===0?"primary":"info",size:k===0?"large":"normal"},{default:n(()=>[o("div",Bs,[o("div",Ps,_(a.areaName),1),o("div",Us,_(a.desc),1)])]),_:2},1032,["timestamp","type","size"]))),128))]),_:1})])])):(m(),T("div",Rs," 暂无快递信息 "))]),_:1},8,["modelValue"])])}}});const Gl=Na($s,[["__scopeId","data-v-23af1580"]]);export{Gl as default};
