import{d as ie,y as de,r as j,n as $,dk as N,aZ as oe,cA as re,dl as ne,l as se,q as r,R as A,az as ce,h as g,c as S,e as n,w as v,u as p,Z as U,s as B,a as C,_ as W,bY as ue,F as D,W as F,i as Y,t as J,b4 as pe,a9 as me,aF as fe,M as _e,L as ve,a4 as be,a1 as ye,N as ge,E as he,a3 as we}from"./index-9cfed1fc.js";/* empty css                   *//* empty css                  *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                    *//* empty css                *//* empty css                   *//* empty css                       */import{g as ke,e as Le,a as Ve}from"./shop_address-23b224f2.js";function O(c,o){c=c.replace(/=/g,"");var u=[];switch(o.constructor){case String:case Number:case Boolean:u.push(encodeURIComponent(c)+"="+encodeURIComponent(o));break;case Array:o.forEach(function(f){u=u.concat(O(c+"[]=",f))});break;case Object:Object.keys(o).forEach(function(f){var L=o[f];u=u.concat(O(c+"["+f+"]",L))})}return u}function X(c){var o=[];return c.forEach(function(u){typeof u=="string"?o.push(u):o=o.concat(X(u))}),o}function ee(c,o,u){if(o===void 0&&(o={}),typeof c!="string")throw new Error('[Vue-jsonp] Type of param "url" is not string.');if(typeof o!="object"||!o)throw new Error("[Vue-jsonp] Invalid params, should be an object.");return u=typeof u=="number"?u:5e3,new Promise(function(f,L){var _=typeof o.callbackQuery=="string"?o.callbackQuery:"callback",h=typeof o.callbackName=="string"?o.callbackName:"jsonp_"+(Math.floor(1e5*Math.random())*Date.now()).toString(16);o[_]=h,delete o.callbackQuery,delete o.callbackName;var w=[];Object.keys(o).forEach(function(m){w=w.concat(O(m,o[m]))});var R=X(w).join("&"),V=function(){y(),clearTimeout(x),L({status:400,statusText:"Bad Request"})},y=function(){k.removeEventListener("error",V)},E=function(){document.body.removeChild(k),delete window[h]},x=null;u>-1&&(x=setTimeout(function(){y(),E(),L({statusText:"Request Timeout",status:408})},u)),window[h]=function(m){clearTimeout(x),y(),E(),f(m)};var k=document.createElement("script");k.addEventListener("error",V),k.src=c+(/\?/.test(c)?"&":"?")+R,document.body.appendChild(k)})}const Ee=c=>{const o=window.TMap;return o.LatLng,new o.MultiMarker({map:c,geometries:[{id:"center",position:c.getCenter()}]})},xe=c=>ee(`https://apis.map.qq.com/ws/geocoder/v1/?key=${c.mapKey}&location=${c.lat},${c.lng}&output=jsonp&callback=latLngToAddress`,{callbackName:"latLngToAddress"}),Te=c=>ee(`https://apis.map.qq.com/ws/geocoder/v1/?key=${c.mapKey}&address=${c.address}&output=jsonp&callback=addressToLatLng`,{callbackName:"addressToLatLng"}),Me={class:"main-container"},je={class:"flex flex-col"},Ae={id:"container",class:"w-[800px] h-[520px] relative"},Ce={class:"fixed-footer-wrap"},Re={class:"fixed-footer !z-[9999]"},We=ie({__name:"edit",setup(c){const o=de(),u=parseInt(o.query.id),f=j(!1),L=o.meta.title,_=$({province:[],city:[],district:[]}),h=j(),w=j(),R=j();N(0).then(l=>{_.province=l.data});let V="";oe(()=>{const l=document.createElement("script");re().then(t=>{V=t.data.key,l.type="text/javascript",l.src="https://map.qq.com/api/gljs?libraries=tools,service&v=1.exp&key="+t.data.key,document.body.appendChild(l)}),l.onload=()=>{setTimeout(()=>{k()},500)}});let y,E;const x=j(!0),k=()=>{const l=window.TMap,t=l.LatLng,a=new t(e.lat,e.lng);y=new l.Map("container",{center:a,zoom:14}),y.on("tilesloaded",()=>{x.value=!1}),E=Ee(y),y.on("click",s=>{y.setCenter(s.latLng),E.updateGeometries({id:"center",position:s.latLng}),K(s.latLng.lat,s.latLng.lng)}),K(a.lat,a.lng)},m=$({province_id:0,city_id:0,district_id:0}),K=(l,t)=>{xe({mapKey:V,lat:l,lng:t}).then(({message:a,result:s})=>{a=="query ok"||a=="Success"?(e.lat=s.location.lat,e.lng=s.location.lng,e.address=s.formatted_addresses.recommend,ne(s.ad_info.adcode).then(({data:d})=>{m.province_id=d.province?d.province.id:0,m.city_id=d.city?d.city.id:0,m.district_id=d.district?d.district.id:0})):console.error(a,s)}).catch(a=>{console.log(a)})},z={id:0,contact_name:"",mobile:"",province_id:0,city_id:0,district_id:0,address:"",full_address:"",lat:39.908626,lng:116.39719,is_delivery_address:0,is_refund_address:0,is_default_delivery:0,is_default_refund:0},e=$({...z});u&&(async(l=0)=>{f.value=!0,Object.assign(e,z);const t=await(await ke(l)).data;Object.keys(e).forEach(a=>{t[a]!=null&&(e[a]=t[a])}),f.value=!1})(u);const Q=j(),te=se(()=>({address_type:[{validator:(l,t,a)=>{!e.is_delivery_address&&!e.is_refund_address&&a(new Error(r("addressTypeRequire"))),a()}}],contact_name:[{required:!0,message:r("contactNamePlaceholder"),trigger:"blur"}],mobile:[{required:!0,message:r("mobilePlaceholder"),trigger:"blur"},{trigger:"blur",validator:(l,t,a)=>{t&&!/^1[3-9]\d{9}$/.test(t)&&a(new Error(r("mobileTips"))),a()}}],address_area:[{validator:(l,t,a)=>{e.province_id||a(new Error(r("provincePlaceholder"))),e.city_id||a(new Error(r("cityPlaceholder"))),_.district.length&&!e.district_id&&a(new Error(r("districtPlaceholder"))),a()}}],address:[{required:!0,message:r("addressPlaceholder"),trigger:"blur"}]}));A(()=>e.province_id,l=>{l?N(e.province_id).then(t=>{_.city=t.data;const a=e.city_id;if(a){let s=!1;for(let d=0;d<t.data.length;d++)if(a==t.data[d].id){s=!0;break}if(s){e.city_id=a;return}}e.city_id=0,P()}):e.city_id=0}),A(()=>e.city_id,l=>{l?N(e.city_id).then(t=>{_.district=t.data;const a=e.district_id;if(a){let s=!1;for(let d=0;d<t.data.length;d++)if(a==t.data[d].id){s=!0;break}if(s){e.district_id=a;return}}P(),e.district_id=0}):e.district_id=0}),A(()=>e.district_id,l=>{l&&P()});const P=ce(()=>{setTimeout(()=>{let l=_.province.map(d=>{if(d.id==e.province_id)return d.name}),t=_.city.map(d=>{if(d.id==e.city_id)return d.name}),a=_.district.map(d=>{if(d.id==e.district_id)return d.name});const s=[e.province_id?h.value.selectedLabel||l:"",e.city_id?w.value.selectedLabel||t:"",e.district_id?R.value.selectedLabel||a:"",e.address];Te({mapKey:V,address:s.join("")}).then(({message:d,result:b})=>{if(d=="Success"||d=="query ok"){const T=new window.TMap.LatLng(b.location.lat,b.location.lng);y.setCenter(T),E.updateGeometries({id:"center",position:T}),e.lat=b.location.lat,e.lng=b.location.lng}else console.error(d,b)})},500)},500);A(()=>m.province_id,l=>{l&&N(m.province_id).then(t=>{_.city=t.data,e.province_id=m.province_id,e.city_id=m.city_id})}),A(()=>m.city_id,l=>{l&&N(m.city_id).then(t=>{_.district=t.data,e.city_id=m.city_id,e.district_id=m.district_id})}),A(()=>m.district_id,l=>{l&&(e.district_id=m.district_id)});const ae=async l=>{f.value||!l||await l.validate(async t=>{if(t){f.value=!0;const a=e,s=[a.province_id?h.value.selectedLabel:"",a.city_id?w.value.selectedLabel:"",a.district_id?R.value.selectedLabel:"",a.address];a.full_address=s.join(""),(u?Le:Ve)(a).then(b=>{f.value=!1,history.back()}).catch(()=>{f.value=!1})}})},G=()=>{history.back()};return(l,t)=>{const a=pe,s=me,d=fe,b=_e,T=ve,M=be,I=ye,le=ge,Z=he,H=we;return g(),S("div",Me,[n(s,{class:"card !border-none mb-[15px]",shadow:"never"},{default:v(()=>[n(a,{content:p(L),icon:l.ArrowLeft,onBack:G},null,8,["content","icon"])]),_:1}),U((g(),B(s,{class:"box-card !border-none",shadow:"never"},{default:v(()=>[n(le,{model:e,"label-width":"90px",ref_key:"formRef",ref:Q,rules:p(te),class:"page-form"},{default:v(()=>[n(b,{label:p(r)("addressType"),prop:"address_type"},{default:v(()=>[C("div",je,[C("div",null,[n(d,{modelValue:e.is_delivery_address,"onUpdate:modelValue":t[0]||(t[0]=i=>e.is_delivery_address=i),label:p(r)("deliveryAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),U(n(d,{modelValue:e.is_default_delivery,"onUpdate:modelValue":t[1]||(t[1]=i=>e.is_default_delivery=i),label:p(r)("defaultDeliveryAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),[[W,e.is_delivery_address]])]),C("div",null,[n(d,{modelValue:e.is_refund_address,"onUpdate:modelValue":t[2]||(t[2]=i=>e.is_refund_address=i),label:p(r)("refundAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),U(n(d,{modelValue:e.is_default_refund,"onUpdate:modelValue":t[3]||(t[3]=i=>e.is_default_refund=i),label:p(r)("defaultRefundAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),[[W,e.is_refund_address]])])])]),_:1},8,["label"]),n(b,{label:p(r)("contactName"),prop:"contact_name"},{default:v(()=>[n(T,{modelValue:e.contact_name,"onUpdate:modelValue":t[4]||(t[4]=i=>e.contact_name=i),modelModifiers:{trim:!0},clearable:"",placeholder:p(r)("contactNamePlaceholder"),class:"input-width",maxlength:"10"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(b,{label:p(r)("mobile"),prop:"mobile"},{default:v(()=>[n(T,{modelValue:e.mobile,"onUpdate:modelValue":t[5]||(t[5]=i=>e.mobile=i),modelModifiers:{trim:!0},clearable:"",placeholder:p(r)("mobilePlaceholder"),class:"input-width",onKeyup:t[6]||(t[6]=i=>p(ue)(i)),onBlur:t[7]||(t[7]=i=>e.mobile=i.target.value)},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(b,{label:p(r)("fullAddress"),prop:"address_area"},{default:v(()=>[n(I,{modelValue:e.province_id,"onUpdate:modelValue":t[8]||(t[8]=i=>e.province_id=i),"value-key":"id",clearable:"",class:"w-[200px]",ref_key:"provinceRef",ref:h},{default:v(()=>[n(M,{label:p(r)("provincePlaceholder"),value:0},null,8,["label"]),(g(!0),S(D,null,F(_.province,(i,q)=>(g(),B(M,{key:q,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n(I,{modelValue:e.city_id,"onUpdate:modelValue":t[9]||(t[9]=i=>e.city_id=i),"value-key":"id",clearable:"",class:"w-[200px] ml-3",ref_key:"cityRef",ref:w},{default:v(()=>[n(M,{label:p(r)("cityPlaceholder"),value:0},null,8,["label"]),(g(!0),S(D,null,F(_.city,(i,q)=>(g(),B(M,{key:q,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n(I,{modelValue:e.district_id,"onUpdate:modelValue":t[10]||(t[10]=i=>e.district_id=i),"value-key":"id",clearable:"",class:"w-[200px] ml-3",ref_key:"districtRef",ref:R},{default:v(()=>[n(M,{label:p(r)("districtPlaceholder"),value:0},null,8,["label"]),(g(!0),S(D,null,F(_.district,(i,q)=>(g(),B(M,{key:q,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),n(b,{prop:"address"},{default:v(()=>[n(T,{modelValue:e.address,"onUpdate:modelValue":t[11]||(t[11]=i=>e.address=i),modelModifiers:{trim:!0},clearable:"",placeholder:p(r)("addressPlaceholder"),onInput:t[12]||(t[12]=i=>p(P)()),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1}),n(b,null,{default:v(()=>[U(C("div",Ae,null,512),[[H,x.value]])]),_:1})]),_:1},8,["model","rules"])]),_:1})),[[H,f.value]]),C("div",Ce,[C("div",Re,[n(Z,{type:"primary",onClick:t[13]||(t[13]=i=>ae(Q.value))},{default:v(()=>[Y(J(p(r)("save")),1)]),_:1}),n(Z,{onClick:t[14]||(t[14]=i=>G())},{default:v(()=>[Y(J(p(r)("cancel")),1)]),_:1})])])])}}});export{We as default};
