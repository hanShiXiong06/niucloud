import{d as ie,y as de,n as q,r as w,f as ue,l as me,q as t,h as _,c as C,e as l,w as o,a as c,t as u,u as s,i as f,F as E,W as T,s as v,Z as I,C as D,d7 as pe,d8 as ce,d9 as _e,da as fe,db as ye,dc as ve,ah as $,dd as ge,de as be,df as ke,$ as we,E as he,b6 as xe,a4 as Ce,a1 as Ve,M as Ee,N as Te,a9 as De,aj as Be,bt as Ue,bu as $e,bv as Fe,ak as Le,a2 as Pe,L as Re,aD as Me,aE as ze,V as Ne,a3 as Oe}from"./index-0b74b7aa.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                       *//* empty css                 *//* empty css                 *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                        *//* empty css                         *//* empty css                        *//* empty css                *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                 */import{_ as je}from"./cron-info.vue_vue_type_script_setup_true_lang-475f04be.js";/* empty css                 *//* empty css                   */const qe={class:"main-container"},Ie={class:"flex justify-between items-center mb-[20px]"},Se={class:"text-page-title"},We={class:"flex items-center"},Ae={class:"mt-2"},Ge={class:"flex justify-between"},Ze={class:"mt-[20px]"},He={class:"flex items-center"},Je={class:"el-dropdown-link text-primary"},Ke={class:"mt-[16px] flex justify-end"},Qe={class:"flex"},Xe={class:"input-width flex items-center text-sm"},Ye={class:"dialog-footer"},$t=ie({__name:"schedule",setup(et){const S=de().meta.title,i=q({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{type:"",status:"all"}}),B=w([]),F=w([]),L=w([]),P=w(),W=r=>{r&&(r.resetFields(),b())};(async()=>{B.value=await(await pe()).data,F.value=await(await ce()).data,L.value=await(await _e()).data})();const b=(r=1)=>{i.loading=!0,i.page=r,fe({page:i.page,limit:i.limit,...i.searchParam}).then(a=>{i.loading=!1,i.data=a.data.data,i.total=a.data.total}).catch(()=>{i.loading=!1})};b();const A=ue(),h=w(!1),n=q({...{id:0,key:"",status:2,time:{type:"min",week:"",day:"",hour:"",min:""}}}),R=w(),G=()=>{n.id=0,n.key="",n.status=2,n.time.type="min",n.time.week="",n.time.day="",n.time.hour="",n.time.min="",h.value=!0},Z=me(()=>({key:[{required:!0,message:t("titlePlaceholder"),trigger:"blur"}],timeDate:[{required:!0,validator:H,trigger:"blur"}]})),H=(r,a,m)=>{const p=n.time,d=k=>/^[1-9]\d*$/.test(k),y=()=>m(new Error(t("cronTimeTips")));switch(p.type){case"min":return d(p.min)?m():y();case"hour":return d(p.hour)&&d(p.min)?m():y();case"day":return d(p.day)&&d(p.hour)&&d(p.min)?m():y();case"week":return p.week!==""&&d(p.hour)&&d(p.min)?m():y();case"month":return d(p.day)&&d(p.hour)&&d(p.min)?m():y();default:return y()}},V=w(!1),J=async r=>{V.value||!r||await r.validate(async a=>{if(a){V.value=!0;const m=n;(n.id>0?ye:ve)(m).then(d=>{V.value=!1,h.value=!1,b()}).catch(()=>{V.value=!1})}})},K=r=>{n.id=r.id,n.key=r.key,n.status=r.status,n.time=r.time,h.value=!0},Q=r=>{$.confirm(t("cronDeleteTips"),t("warning"),{confirmButtonText:t("confirm"),cancelButtonText:t("cancel"),type:"warning"}).then(()=>{ge(r).then(()=>{b()}).catch(()=>{})})},X=r=>{$.confirm(t(`确认要立即执行一次"${r.name}"任务吗？`),t("warning"),{confirmButtonText:t("confirm"),cancelButtonText:t("cancel"),type:"warning"}).then(()=>{be({id:r.id}).then(a=>{}).catch(()=>{})})},Y=r=>{$.confirm(t("确认要重置计划任务吗？"),t("warning"),{confirmButtonText:t("confirm"),cancelButtonText:t("cancel"),type:"warning"}).then(()=>{ke().then(a=>{we.success(a.msg)}).catch(()=>{})})},ee=w(null),te=r=>{A.push({path:"/tools/schedule_log",query:{id:r}})};return(r,a)=>{const m=he,p=xe,d=Ce,y=Ve,k=Ee,M=Te,z=De,x=Be,N=Ue,ae=$e,le=Fe,oe=Le,ne=Pe,U=Re,O=Me,se=ze,re=Ne,j=Oe;return _(),C("div",qe,[l(z,{class:"box-card !border-none",shadow:"never"},{default:o(()=>[c("div",Ie,[c("span",Se,u(s(S)),1),c("div",null,[l(m,{type:"primary",onClick:G},{default:o(()=>[f(u(s(t)("addCron")),1)]),_:1}),l(m,{type:"primary",onClick:Y},{default:o(()=>[f(u(s(t)("重置计划任务")),1)]),_:1})])]),l(p,{type:"info"},{default:o(()=>[c("div",We,[c("div",null,[c("p",null,u(s(t)("cronTipsOne")),1),c("p",Ae,u(s(t)("cronTipsTwo")),1)])])]),_:1}),l(z,{class:"box-card !border-none mb-[10px] table-search-wrap",shadow:"never"},{default:o(()=>[c("div",Ge,[l(M,{inline:!0,model:i.searchParam,ref_key:"searchFormRef",ref:P},{default:o(()=>[l(k,{label:s(t)("title"),prop:"key"},{default:o(()=>[l(y,{modelValue:i.searchParam.key,"onUpdate:modelValue":a[0]||(a[0]=e=>i.searchParam.key=e),placeholder:"全部",filterable:"",remote:"",clearable:""},{default:o(()=>[l(d,{label:"全部",value:"all"}),(_(!0),C(E,null,T(B.value,e=>(_(),v(d,{key:e.key,label:e.name,value:e.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(k,{label:s(t)("status"),prop:"status"},{default:o(()=>[l(y,{modelValue:i.searchParam.status,"onUpdate:modelValue":a[1]||(a[1]=e=>i.searchParam.status=e),placeholder:"全部",clearable:""},{default:o(()=>[l(d,{label:"全部",value:"all"}),l(d,{label:"启用",value:"1"}),l(d,{label:"关闭",value:"0"})]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(k,null,{default:o(()=>[l(m,{type:"primary",onClick:a[2]||(a[2]=e=>b())},{default:o(()=>[f(u(s(t)("search")),1)]),_:1}),l(m,{onClick:a[3]||(a[3]=e=>W(P.value))},{default:o(()=>[f(u(s(t)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1}),c("div",Ze,[I((_(),v(oe,{data:i.data,size:"large"},{empty:o(()=>[c("span",null,u(i.loading?"":s(t)("emptyData")),1)]),default:o(()=>[l(x,{prop:"key",label:s(t)("key"),"min-width":"150"},null,8,["label"]),l(x,{prop:"name",label:s(t)("title"),"min-width":"150"},null,8,["label"]),l(x,{label:s(t)("crondType"),"min-width":"150"},{default:o(({row:e})=>[f(u(e.crontab_content),1)]),_:1},8,["label"]),l(x,{prop:"status_name",label:s(t)("openStatus"),"min-width":"100"},null,8,["label"]),l(x,{label:s(t)("operation"),align:"right",fixed:"right",width:"180"},{default:o(({row:e})=>[c("div",He,[l(m,{type:"primary",link:"",onClick:g=>K(e)},{default:o(()=>[f(u(s(t)("edit")),1)]),_:2},1032,["onClick"]),l(m,{type:"primary",link:"",onClick:g=>Q(e.id)},{default:o(()=>[f(u(s(t)("delete")),1)]),_:2},1032,["onClick"]),l(le,{class:"ml-[12px]"},{dropdown:o(()=>[l(ae,null,{default:o(()=>[l(N,{onClick:g=>X(e)},{default:o(()=>[f(u(s(t)("doOne")),1)]),_:2},1032,["onClick"]),l(N,{onClick:g=>te(e.id)},{default:o(()=>[f(u(s(t)("cronLog")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[c("span",Je,u(s(t)("more")),1)]),_:2},1024)])]),_:1},8,["label"])]),_:1},8,["data"])),[[j,i.loading]]),c("div",Ke,[l(ne,{"current-page":i.page,"onUpdate:current-page":a[4]||(a[4]=e=>i.page=e),"page-size":i.limit,"onUpdate:page-size":a[5]||(a[5]=e=>i.limit=e),layout:"total, sizes, prev, pager, next, jumper",total:i.total,onSizeChange:a[6]||(a[6]=e=>b()),onCurrentChange:b},null,8,["current-page","page-size","total"])])])]),_:1}),l(je,{ref_key:"cronDialog",ref:ee,onComplete:b},null,512),l(re,{modelValue:h.value,"onUpdate:modelValue":a[15]||(a[15]=e=>h.value=e),title:s(t)("editCron"),width:"750px","destroy-on-close":!0},{footer:o(()=>[c("span",Ye,[l(m,{type:"primary",onClick:a[14]||(a[14]=e=>J(R.value))},{default:o(()=>[f(u(s(t)("confirm")),1)]),_:1})])]),default:o(()=>[I((_(),v(M,{model:n,"label-width":"110px",ref_key:"formRef",ref:R,rules:s(Z),class:"page-form"},{default:o(()=>[l(k,{label:s(t)("cronTemplate"),class:"items-center",prop:"key"},{default:o(()=>[l(y,{modelValue:n.key,"onUpdate:modelValue":a[7]||(a[7]=e=>n.key=e)},{default:o(()=>[(_(!0),C(E,null,T(B.value,e=>(_(),v(d,{key:e.key,label:e.name,value:e.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(k,{label:s(t)("cronTime"),prop:"timeDate"},{default:o(()=>[l(y,{modelValue:n.time.type,"onUpdate:modelValue":a[8]||(a[8]=e=>n.time.type=e),class:"w-[150px]"},{default:o(()=>[(_(!0),C(E,null,T(F.value,(e,g)=>(_(),v(d,{key:g,label:e,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),c("div",Qe,[n.time.type=="week"?(_(),v(y,{key:0,modelValue:n.time.week,"onUpdate:modelValue":a[9]||(a[9]=e=>n.time.week=e),class:"ml-2 w-[120px]"},{default:o(()=>[(_(!0),C(E,null,T(L.value,(e,g)=>(_(),v(d,{key:g,label:e,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):D("",!0),["month","day"].indexOf(n.time.type)!=-1?(_(),v(U,{key:1,modelValue:n.time.day,"onUpdate:modelValue":a[10]||(a[10]=e=>n.time.day=e),modelModifiers:{trim:!0},class:"ml-2 w-[120px]"},{append:o(()=>[f(u(s(t)("day")),1)]),_:1},8,["modelValue"])):D("",!0),["month","day","hour","week"].indexOf(n.time.type)!=-1?(_(),v(U,{key:2,modelValue:n.time.hour,"onUpdate:modelValue":a[11]||(a[11]=e=>n.time.hour=e),modelModifiers:{trim:!0},class:"ml-2 w-[120px]"},{append:o(()=>[f(u(s(t)("hour")),1)]),_:1},8,["modelValue"])):D("",!0),["month","day","hour","week","min"].indexOf(n.time.type)!=-1?(_(),v(U,{key:3,modelValue:n.time.min,"onUpdate:modelValue":a[12]||(a[12]=e=>n.time.min=e),modelModifiers:{trim:!0},class:"ml-2 w-[120px]"},{append:o(()=>[f(u(s(t)("min")),1)]),_:1},8,["modelValue"])):D("",!0)])]),_:1},8,["label"]),l(k,{label:s(t)("isopen")},{default:o(()=>[c("div",Xe,[l(se,{modelValue:n.status,"onUpdate:modelValue":a[13]||(a[13]=e=>n.status=e)},{default:o(()=>[l(O,{label:1},{default:o(()=>[f(u(s(t)("yes")),1)]),_:1}),l(O,{label:2},{default:o(()=>[f(u(s(t)("no")),1)]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["label"])]),_:1},8,["model","rules"])),[[j,r.loading]])]),_:1},8,["modelValue","title"])])}}});export{$t as default};
