import{d as be,r as y,n as R,aZ as ye,R as we,$ as x,a5 as ke,h as w,c as P,a as e,e as t,w as s,u as V,dC as Ve,i as k,dD as G,dj as Ee,dE as Ce,t as i,dF as De,dG as Pe,dr as Se,F as $,W as z,s as H,Z as Le,v as S,C as W,P as E,ah as Ue,a0 as je,E as Me,a4 as Be,a1 as Ye,L as Ne,bV as Fe,aj as Te,ak as Re,V as $e,aN as ze,M as He,N as Oe,a3 as Ze,p as qe,g as Ae}from"./index-28ce54e5.js";/* empty css                   *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                        *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                        *//* empty css               *//* empty css                       *//* empty css                  *//* empty css                  *//* empty css                  */import Ge from"./ExcelUpload-ba3918d5.js";import{_ as We}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                  *//* empty css                    *//* empty css                  *//* empty css                 */const v=M=>(qe("data-v-8d7def14"),M=M(),Ae(),M),Je={class:"min-h-screen bg-gray-50"},Ke={class:"bg-white border-b border-gray-200 px-6 py-4 mb-6"},Qe={class:"flex items-center justify-between"},Xe=v(()=>e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"Excel数据管理"),e("p",{class:"text-sm text-gray-600 mt-1"},"查看和管理Excel导入的设备价格数据")],-1)),Ie={class:"flex space-x-3"},et={class:"px-6 mb-6"},tt={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},lt={class:"bg-white rounded-lg shadow p-6"},at={class:"flex items-center"},st={class:"flex-shrink-0"},ot={class:"w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center"},ct={class:"ml-4"},nt=v(()=>e("p",{class:"text-sm font-medium text-gray-600"},"设备总数",-1)),it={class:"text-2xl font-bold text-gray-900"},dt={class:"bg-white rounded-lg shadow p-6"},rt={class:"flex items-center"},_t={class:"flex-shrink-0"},ut={class:"w-8 h-8 bg-green-500 rounded-md flex items-center justify-center"},mt={class:"ml-4"},pt=v(()=>e("p",{class:"text-sm font-medium text-gray-600"},"价格记录",-1)),vt={class:"text-2xl font-bold text-gray-900"},ft={class:"bg-white rounded-lg shadow p-6"},ht={class:"flex items-center"},gt={class:"flex-shrink-0"},xt={class:"w-8 h-8 bg-purple-500 rounded-md flex items-center justify-center"},bt={class:"ml-4"},yt=v(()=>e("p",{class:"text-sm font-medium text-gray-600"},"品牌数量",-1)),wt={class:"text-2xl font-bold text-gray-900"},kt={class:"bg-white rounded-lg shadow p-6"},Vt={class:"flex items-center"},Et={class:"flex-shrink-0"},Ct={class:"w-8 h-8 bg-orange-500 rounded-md flex items-center justify-center"},Dt={class:"ml-4"},Pt=v(()=>e("p",{class:"text-sm font-medium text-gray-600"},"导入记录",-1)),St={class:"text-2xl font-bold text-gray-900"},Lt={class:"bg-white mx-6 mb-6 p-6 rounded-lg shadow"},Ut={class:"grid grid-cols-1 md:grid-cols-6 gap-4"},jt=v(()=>e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"设备类型",-1)),Mt=v(()=>e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"品牌筛选",-1)),Bt=v(()=>e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"关键词搜索",-1)),Yt=v(()=>e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"报价时间",-1)),Nt={class:"flex items-end"},Ft={class:"bg-white mx-6 mb-6 rounded-lg shadow"},Tt={class:"px-6 py-4 border-b border-gray-200"},Rt={class:"flex items-center justify-between"},$t=v(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"设备列表",-1)),zt={class:"flex space-x-2"},Ht={class:"overflow-x-auto"},Ot={class:"text-center"},Zt={class:"text-center"},qt={class:"text-center"},At={class:"text-center text-gray-500"},Gt={class:"flex justify-center space-x-2"},Wt={key:0,class:"space-y-6"},Jt=v(()=>e("h4",{class:"text-lg font-medium mb-3"},"基本信息",-1)),Kt={class:"grid grid-cols-2 gap-4"},Qt=v(()=>e("label",{class:"block text-sm font-medium text-gray-700"},"设备型号",-1)),Xt={class:"mt-1"},It=v(()=>e("label",{class:"block text-sm font-medium text-gray-700"},"网络型号",-1)),el={class:"mt-1"},tl=v(()=>e("label",{class:"block text-sm font-medium text-gray-700"},"容量",-1)),ll={class:"mt-1"},al=v(()=>e("label",{class:"block text-sm font-medium text-gray-700"},"设备类型",-1)),sl={class:"mt-1"},ol=v(()=>e("h4",{class:"text-lg font-medium mb-3"},"价格信息",-1)),cl={class:"grid grid-cols-3 gap-4"},nl={class:"block text-sm font-medium text-gray-700"},il={class:"text-lg font-bold text-red-600"},dl={key:0},rl={class:"mb-4"},_l={class:"text-lg font-medium"},ul={class:"flex justify-end space-x-3 mt-6"},ml=be({__name:"recycle_excel",setup(M){const N=y(!1),r=y([]),O=y([]),L=y([]),U=y({}),Z=y(!1),j=y(!1),b=y(null),F=y(!1),T=y(!1),g=R({brand_id:"",device_type:"",keyword:""}),B=R({page:1,limit:20,total:0}),C=R({device_id:0,price_data:{}}),J=({row:a,column:n,rowIndex:o,columnIndex:p})=>{if(p===1){if(o>0&&r.value[o].model_name===r.value[o-1].model_name)return{rowspan:0,colspan:0};{let f=1;for(let _=o+1;_<r.value.length&&r.value[_].model_name===a.model_name;_++)f++;return{rowspan:f,colspan:1}}}if(p===3){if(o>0&&r.value[o].model_name===r.value[o-1].model_name&&r.value[o].capacity===r.value[o-1].capacity)return{rowspan:0,colspan:0};{let f=1;for(let _=o+1;_<r.value.length&&(r.value[_].model_name===a.model_name&&r.value[_].capacity===a.capacity);_++)f++;return{rowspan:f,colspan:1}}}if(p===2){if(o>0&&r.value[o].model_name===r.value[o-1].model_name&&r.value[o].network_model===r.value[o-1].network_model)return{rowspan:0,colspan:0};{let f=1;for(let _=o+1;_<r.value.length&&(r.value[_].model_name===a.model_name&&r.value[_].network_model===a.network_model);_++)f++;return{rowspan:f,colspan:1}}}return{rowspan:1,colspan:1}},K=async a=>await E.get("recycle/excel/lists",{params:a}),Q=async()=>await E.get("recycle/excel/brands"),X=async()=>await E.get("recycle/excel/statistics"),I=async a=>await E.put("recycle/excel/price",a),ee=async a=>await E.delete("recycle/excel/batch",a),te=async()=>await E.post("recycle/price_image/generate");(async()=>await E.get("recycle/price_image/test_mapping"))(),ye(()=>{D(),le(),Y()}),we([()=>g.brand_id,()=>g.device_type],()=>{B.page=1,D()});const D=async()=>{try{N.value=!0;const a={page:B.page,limit:B.limit,...g},n=await K(a);n.code===1&&(r.value=n.data||[])}catch(a){x.error("加载设备列表失败"),console.error(a)}finally{N.value=!1}},le=async()=>{try{const a=await Q();a.code===1&&(O.value=a.data||[])}catch(a){console.error("加载品牌列表失败:",a)}},Y=async()=>{try{const a=await X();a.code===1&&(U.value=a.data||{})}catch(a){console.error("加载统计信息失败:",a)}},ae=()=>{B.page=1,D()},se=()=>{D(),Y()},oe=a=>{L.value=a},ce=a=>{b.value=a,C.device_id=a.id,C.price_data={...a.price_detail},j.value=!0},ne=async()=>{try{F.value=!0;const a=await I(C);a.code===1?(x.success("价格更新成功"),j.value=!1,D()):x.error(a.msg||"价格更新失败")}catch(a){x.error("价格更新失败"),console.error(a)}finally{F.value=!1}},ie=async()=>{if(L.value.length===0){x.warning("请选择要删除的设备");return}try{await Ue.confirm(`确定要删除选中的 ${L.value.length} 个设备吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"});const a=L.value.map(o=>o.id),n=await ee({ids:a});n.code===1?(x.success(n.msg||"批量删除成功"),D(),Y()):x.error(n.msg||"批量删除失败")}catch(a){a!=="cancel"&&(x.error("批量删除失败"),console.error(a))}},de=()=>{T.value=!0},re=()=>{D(),Y(),x.success("数据导入成功")},_e=async()=>{try{const a={...g},n=await E.get("recycle/excel/export",{params:a,responseType:"blob"}),o=new Blob([n.data]),p=window.URL.createObjectURL(o),f=document.createElement("a");f.href=p,f.download=`设备价格数据_${new Date().toISOString().slice(0,10)}.xlsx`,f.click(),window.URL.revokeObjectURL(p),x.success("数据导出成功")}catch(a){x.error("数据导出失败"),console.error(a)}},ue=a=>({phone:"手机",tablet:"平板",watch:"手表"})[a]||a;return(a,n)=>{const o=je,p=Me,f=ke("Clear"),_=Be,q=Ye,me=Ne,pe=Fe,h=Te,ve=Re,A=$e,fe=ze,he=He,ge=Oe,xe=Ze;return w(),P("div",Je,[e("div",Ke,[e("div",Qe,[Xe,e("div",Ie,[t(p,{type:"primary",onClick:de},{default:s(()=>[t(o,null,{default:s(()=>[t(V(Ve))]),_:1}),k(" 导入数据 ")]),_:1}),t(p,{type:"success",onClick:_e},{default:s(()=>[t(o,null,{default:s(()=>[t(V(G))]),_:1}),k(" 导出数据 ")]),_:1}),t(p,{type:"success",onClick:V(Ee)},{default:s(()=>[t(o,null,{default:s(()=>[t(f)]),_:1}),k(" 清理缓存 ")]),_:1},8,["onClick"]),t(p,{type:"success",onClick:te},{default:s(()=>[t(o,null,{default:s(()=>[t(V(G))]),_:1}),k(" 存为图片 ")]),_:1})])])]),e("div",et,[e("div",tt,[e("div",lt,[e("div",at,[e("div",st,[e("div",ot,[t(o,{class:"text-white"},{default:s(()=>[t(V(Ce))]),_:1})])]),e("div",ct,[nt,e("p",it,i(U.value.total_devices||0),1)])])]),e("div",dt,[e("div",rt,[e("div",_t,[e("div",ut,[t(o,{class:"text-white"},{default:s(()=>[t(V(De))]),_:1})])]),e("div",mt,[pt,e("p",vt,i(U.value.total_prices||0),1)])])]),e("div",ft,[e("div",ht,[e("div",gt,[e("div",xt,[t(o,{class:"text-white"},{default:s(()=>[t(V(Pe))]),_:1})])]),e("div",bt,[yt,e("p",wt,i(U.value.total_brands||0),1)])])]),e("div",kt,[e("div",Vt,[e("div",Et,[e("div",Ct,[t(o,{class:"text-white"},{default:s(()=>[t(V(Se))]),_:1})])]),e("div",Dt,[Pt,e("p",St,i(U.value.import_records||0),1)])])])])]),e("div",Lt,[e("div",Ut,[e("div",null,[jt,t(q,{modelValue:g.device_type,"onUpdate:modelValue":n[0]||(n[0]=l=>g.device_type=l),placeholder:"选择类型",clearable:"",class:"w-full"},{default:s(()=>[t(_,{label:"全部类型",value:""}),t(_,{label:"手机",value:"phone"}),t(_,{label:"平板",value:"tablet"}),t(_,{label:"手表",value:"watch"})]),_:1},8,["modelValue"])]),e("div",null,[Mt,t(q,{modelValue:g.brand_id,"onUpdate:modelValue":n[1]||(n[1]=l=>g.brand_id=l),placeholder:"选择品牌",clearable:"",class:"w-full"},{default:s(()=>[t(_,{label:"全部品牌",value:""}),(w(!0),P($,null,z(O.value,l=>(w(),H(_,{key:l.id,label:l.brand_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e("div",null,[Bt,t(me,{modelValue:g.keyword,"onUpdate:modelValue":n[2]||(n[2]=l=>g.keyword=l),placeholder:"搜索型号、网络型号、容量",clearable:"",class:"w-full"},null,8,["modelValue"])]),e("div",null,[Yt,t(pe,{modelValue:g.create_at,"onUpdate:modelValue":n[3]||(n[3]=l=>g.create_at=l),"value-format":"YYYY-MM-DD HH:mm:ss","start-placeholder":"startDate","end-placeholder":"endDate",format:"YYYY-MM-DD HH:mm","date-format":"YYYY/MM/DD ddd","time-format":"A hh:mm"},null,8,["modelValue"])]),e("div",Nt,[t(p,{type:"primary",onClick:ae,class:"w-full"},{default:s(()=>[k("搜索")]),_:1})])])]),e("div",Ft,[e("div",Tt,[e("div",Rt,[$t,e("div",zt,[t(p,{size:"small",onClick:se},{default:s(()=>[k("刷新")]),_:1}),t(p,{size:"small",type:"danger",disabled:L.value.length===0,onClick:ie},{default:s(()=>[k(" 批量删除 ("+i(L.value.length)+") ",1)]),_:1},8,["disabled"])])])]),e("div",Ht,[Le((w(),H(ve,{data:r.value,onSelectionChange:oe,"span-method":J,border:"",class:"w-full"},{default:s(()=>[t(h,{type:"selection",width:"55",align:"center"}),t(h,{label:"型号","min-width":"180",align:"center"},{default:s(({row:l})=>[e("div",Ot,i(l.model_name),1)]),_:1}),t(h,{label:"网络型号","min-width":"120",align:"center"},{default:s(({row:l})=>[e("div",Zt,i(l.network_model),1)]),_:1}),t(h,{label:"容量","min-width":"150",align:"center"},{default:s(({row:l})=>[e("div",qt,i(l.capacity),1)]),_:1}),t(h,{label:"高保充新","min-width":"100",align:"center"},{default:s(({row:l})=>{var c,d,u,m;return[e("div",{class:S(["text-center font-medium",(d=(c=l.currentPrice)==null?void 0:c.price_data)!=null&&d.高保充新?"text-red-600":"text-gray-400"])},i(((m=(u=l.currentPrice)==null?void 0:u.price_data)==null?void 0:m.高保充新)||"-"),3)]}),_:1}),t(h,{label:"充新","min-width":"100",align:"center"},{default:s(({row:l})=>{var c,d,u,m;return[e("div",{class:S(["text-center font-medium",(d=(c=l.currentPrice)==null?void 0:c.price_data)!=null&&d.充新?"text-orange-600":"text-gray-400"])},i(((m=(u=l.currentPrice)==null?void 0:u.price_data)==null?void 0:m.充新)||"-"),3)]}),_:1}),t(h,{label:"靓机","min-width":"100",align:"center"},{default:s(({row:l})=>{var c,d,u,m;return[e("div",{class:S(["text-center font-medium",(d=(c=l.currentPrice)==null?void 0:c.price_data)!=null&&d.靓机?"text-green-600":"text-gray-400"])},i(((m=(u=l.currentPrice)==null?void 0:u.price_data)==null?void 0:m.靓机)||"-"),3)]}),_:1}),t(h,{label:"小花","min-width":"100",align:"center"},{default:s(({row:l})=>{var c,d,u,m;return[e("div",{class:S(["text-center font-medium",(d=(c=l.currentPrice)==null?void 0:c.price_data)!=null&&d.小花?"text-blue-600":"text-gray-400"])},i(((m=(u=l.currentPrice)==null?void 0:u.price_data)==null?void 0:m.小花)||"-"),3)]}),_:1}),t(h,{label:"大花","min-width":"100",align:"center"},{default:s(({row:l})=>{var c,d,u,m;return[e("div",{class:S(["text-center font-medium",(d=(c=l.currentPrice)==null?void 0:c.price_data)!=null&&d.大花?"text-purple-600":"text-gray-400"])},i(((m=(u=l.currentPrice)==null?void 0:u.price_data)==null?void 0:m.大花)||"-"),3)]}),_:1}),t(h,{label:"外爆","min-width":"100",align:"center"},{default:s(({row:l})=>{var c,d,u,m;return[e("div",{class:S(["text-center font-medium",(d=(c=l.currentPrice)==null?void 0:c.price_data)!=null&&d.外壳?"text-yellow-600":"text-gray-400"])},i(((m=(u=l.currentPrice)==null?void 0:u.price_data)==null?void 0:m.外爆)||"-"),3)]}),_:1}),t(h,{label:"内爆","min-width":"100",align:"center"},{default:s(({row:l})=>{var c,d,u,m;return[e("div",{class:S(["text-center font-medium",(d=(c=l.currentPrice)==null?void 0:c.price_data)!=null&&d.内爆?"text-indigo-600":"text-gray-400"])},i(((m=(u=l.currentPrice)==null?void 0:u.price_data)==null?void 0:m.内爆)||"-"),3)]}),_:1}),t(h,{label:"备注","min-width":"120",align:"center"},{default:s(({row:l})=>[e("div",At,i(l.remark||"-"),1)]),_:1}),t(h,{label:"操作",width:"120",fixed:"right",align:"center"},{default:s(({row:l})=>[e("div",Gt,[t(p,{size:"small",type:"primary",plain:"",onClick:c=>ce(l)},{default:s(()=>[k(" 编辑 ")]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[xe,N.value]])])]),t(A,{modelValue:Z.value,"onUpdate:modelValue":n[4]||(n[4]=l=>Z.value=l),title:"设备详情",width:"800px"},{default:s(()=>[b.value?(w(),P("div",Wt,[e("div",null,[Jt,e("div",Kt,[e("div",null,[Qt,e("p",Xt,i(b.value.model_name),1)]),e("div",null,[It,e("p",el,i(b.value.network_model),1)]),e("div",null,[tl,e("p",ll,i(b.value.capacity),1)]),e("div",null,[al,e("p",sl,i(ue(b.value.device_type)),1)])])]),e("div",null,[ol,e("div",cl,[(w(!0),P($,null,z(b.value.price_detail,(l,c)=>(w(),P("div",{key:c,class:"bg-gray-50 p-3 rounded"},[e("label",nl,i(c),1),e("p",il,"¥"+i(l),1)]))),128))])])])):W("",!0)]),_:1},8,["modelValue"]),t(A,{modelValue:j.value,"onUpdate:modelValue":n[6]||(n[6]=l=>j.value=l),title:"编辑价格",width:"600px"},{default:s(()=>[b.value?(w(),P("div",dl,[t(ge,{model:C,"label-width":"100px"},{default:s(()=>[e("div",rl,[e("h4",_l,i(b.value.model_name)+" - "+i(b.value.capacity),1)]),(w(!0),P($,null,z(C.price_data,(l,c)=>(w(),H(he,{key:c,label:c},{default:s(()=>[t(fe,{modelValue:C.price_data[c],"onUpdate:modelValue":d=>C.price_data[c]=d,min:0,precision:0,"controls-position":"right",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1},8,["model"]),e("div",ul,[t(p,{onClick:n[5]||(n[5]=l=>j.value=!1)},{default:s(()=>[k("取消")]),_:1}),t(p,{type:"primary",onClick:ne,loading:F.value},{default:s(()=>[k("保存")]),_:1},8,["loading"])])])):W("",!0)]),_:1},8,["modelValue"]),t(Ge,{modelValue:T.value,"onUpdate:modelValue":n[7]||(n[7]=l=>T.value=l),onSuccess:re},null,8,["modelValue"])])}}});const $l=We(ml,[["__scopeId","data-v-8d7def14"]]);export{$l as default};
