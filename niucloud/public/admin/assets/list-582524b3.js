import{d as ze,y as Ne,f as Oe,r as u,n as P,l as ae,q as a,bS as w,h as c,c as U,e as t,w as o,a as f,t as m,u as n,i as p,F as le,W as oe,s as h,Z as je,C as S,v as Le,B as qe,bT as We,ah as j,$ as Ye,E as Ae,L as He,M as Je,a4 as Ze,a1 as Ge,N as Ke,a9 as Qe,aF as Xe,aj as et,as as tt,bt as at,bu as lt,bv as ot,ak as nt,a2 as rt,V as st,aH as it,aI as mt,a3 as pt}from"./index-9cfed1fc.js";/* empty css                   */import{_ as ut}from"./index.vue_vue_type_script_setup_true_lang-16e58e5b.js";import dt from"./index-a4ad10ba.js";/* empty css                    *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                        *//* empty css                         *//* empty css                        *//* empty css                *//* empty css                */import"./el-form-item-4ed993c7.js";import{k as ct,a as ft,l as _t,m as vt,n as ne,o as gt}from"./diy_form-c6e22de9.js";import{_ as yt}from"./records.vue_vue_type_style_index_0_lang-7d77e2e1.js";import{f as ht}from"./form-submit-popup-ab879b81.js";import{_ as bt}from"./form-write-popup.vue_vue_type_style_index_0_lang-e035e81e.js";import{_ as kt}from"./index.vue_vue_type_script_setup_true_lang-183fc498.js";import{_ as Ct}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                        */import"./index.vue_vue_type_style_index_0_lang-fad85f8a.js";import"./attachment-4de82df9.js";import"./index.vue_vue_type_script_setup_true_lang-c04cd2bb.js";/* empty css                 *//* empty css               *//* empty css                  *//* empty css                    */import"./index.vue_vue_type_script_setup_true_lang-218b436b.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-e50d9a7c.js";import"./sortable.esm-be94e56d.js";/* empty css                  *//* empty css                         *//* empty css                       */import"./member_head-d9fd7b2c.js";/* empty css                       *//* empty css                 */import"./browser-a1ac24ac.js";/* empty css                       */import"./member-80ec2b68.js";const wt={class:"main-container"},xt={class:"flex justify-between items-center"},Ft={class:"text-page-title"},Dt={class:"mb-[10px] flex items-center"},Pt={class:"flex items-center justify-end"},Tt={class:"mt-[16px] flex justify-end"},Vt={class:"image-selection-container"},Et=["onClick"],$t=["src"],St={class:"option-title"},Rt={class:"dialog-footer"},Bt={class:"dialog-footer"},Ut=ze({__name:"list",setup(It){const re=Ne(),L=Oe(),se=re.meta.title,b=u(!1),x=P({}),C=P({title:"",type:""}),I=u(null),ie=r=>{const e={form_id:r.form_id};I.value.setFormData(e),I.value.showDialog=!0},me=ae(()=>({title:[{required:!0,message:a("titlePlaceholder"),trigger:"blur"}],type:[{required:!0,message:a("formTypePlaceholder"),trigger:"blur"}]})),q=u(),T=u(!1),pe=async r=>{r&&await r.validate(async e=>{if(e){const i={type:C.type},k=L.resolve({path:"/decorate/form/edit",query:i});window.open(k.href),T.value=!1,C.title="",C.type=""}})},W=r=>{const e=r.status===1?0:1,i={form_id:r.form_id,status:e};ct(i).then(k=>{r.status=e})};((r="")=>{ft().then(e=>{for(const i in x)delete x[i];for(const i in e.data)x[i]=e.data[i];C.type=Object.keys(x)[0]})})(),P({});const s=P({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{title:"",type:"",mode:"",addon_name:""}}),Y=u(),_=(r=1)=>{s.loading=!0,s.page=r,_t({page:s.page,limit:s.limit,...s.searchParam}).then(e=>{s.loading=!1,s.data=e.data.data,s.total=e.data.total,We(s.page,s.limit,s.searchParam)}).catch(()=>{s.loading=!1})};_(w(s.searchParam).page);const ue=r=>{C.type=r.toString()},de=r=>{r&&(r.resetFields(),_())},ce=r=>{const e=L.resolve({path:"/decorate/form/edit",query:{form_id:r.form_id}});window.open(e.href)},fe=r=>{j.confirm(a("diyFormCopyTips"),a("warning"),{confirmButtonText:a("confirm"),cancelButtonText:a("cancel"),type:"warning"}).then(()=>{b.value||(b.value=!0,vt({form_id:r}).then(e=>{e.code==1&&_(w(s.searchParam).page),b.value=!1}).catch(()=>{b.value=!1}))})},_e=r=>{j.confirm(a("diyFormDeleteTips"),a("warning"),{confirmButtonText:a("confirm"),cancelButtonText:a("cancel"),type:"warning"}).then(()=>{ne({form_ids:[r]}).then(()=>{_(w(s.searchParam).page)}).catch(()=>{})})},R=u(),B=u(!1),ve=r=>{B.value=!1,A.value.toggleAllSelection()},A=u(),F=u([]),ge=r=>{F.value=r,R.value=!1,F.value.length>0&&F.value.length<s.data.length?B.value=!0:B.value=!1,F.value.length==s.data.length&&(R.value=!0)},ye=()=>{if(F.value.length==0){Ye({type:"warning",message:`${a("batchEmptySelectedFormsTips")}`});return}j.confirm(a("batchFormsDeleteTips"),a("warning"),{confirmButtonText:a("confirm"),cancelButtonText:a("cancel"),type:"warning"}).then(()=>{if(b.value)return;b.value=!0;const r=[];F.value.forEach(e=>{r.push(e.form_id)}),ne({form_ids:r}).then(()=>{_(w(s.searchParam).page),b.value=!1}).catch(()=>{b.value=!1})})},v=u("wechat"),H=u(""),J=u(0),g=P({wechat:{title:"",desc:"",url:""},weapp:{title:"",url:""}}),V=u(!1),he=ae(()=>({})),Z=u(),be=async r=>{J.value=r.form_id,H.value=r.title;const e=r.share;g.wechat=e.wechat,g.weapp=e.weapp,V.value=!0},ke=async r=>{r&&await r.validate(async e=>{e&&gt({form_id:J.value,share:JSON.stringify(g)}).then(()=>{_(w(s.searchParam).page),V.value=!1}).catch(()=>{})})},G=u(null),Ce=r=>{var E;const e="/app/pages/index/diy_form",i=[{name:"form_id",value:r.form_id}],k="表单推广",y="diy_form";(E=G.value)==null||E.show(e,i,k,y)},M=u(null),we=r=>{M.value.setFormData(r),M.value.showDialog=!0},z=u(null),xe=r=>{z.value.setFormData(r),z.value.showDialog=!0},Fe=u(null),N=u(!1),De=r=>{N.value=r},K=P({form_id:0}),Pe=r=>{K.form_id=r.form_id,N.value=!0};return(r,e)=>{const i=Ae,k=He,y=Je,E=Ze,Te=Ge,O=Ke,Q=Qe,Ve=Xe,D=et,X=tt,$=at,Ee=lt,$e=ot,Se=nt,Re=rt,ee=st,te=it,Be=mt,Ue=dt,Ie=ut,Me=pt;return c(),U("div",wt,[t(Q,{class:"box-card !border-none",shadow:"never"},{default:o(()=>[f("div",xt,[f("span",Ft,m(n(se)),1),t(i,{type:"primary",class:"w-[100px]",onClick:e[0]||(e[0]=l=>T.value=!0)},{default:o(()=>[p(m(n(a)("addDiyForm")),1)]),_:1})]),t(Q,{class:"box-card !border-none my-[10px] table-search-wrap",shadow:"never"},{default:o(()=>[t(O,{inline:!0,model:s.searchParam,ref_key:"searchFormDiyFormRef",ref:Y},{default:o(()=>[t(y,{label:n(a)("title"),prop:"title"},{default:o(()=>[t(k,{modelValue:s.searchParam.title,"onUpdate:modelValue":e[1]||(e[1]=l=>s.searchParam.title=l),modelModifiers:{trim:!0},placeholder:n(a)("titlePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(y,{label:n(a)("typeName"),prop:"type"},{default:o(()=>[t(Te,{modelValue:s.searchParam.type,"onUpdate:modelValue":e[2]||(e[2]=l=>s.searchParam.type=l),placeholder:n(a)("formTypePlaceholder")},{default:o(()=>[t(E,{label:n(a)("all"),value:""},null,8,["label"]),(c(!0),U(le,null,oe(x,(l,d)=>(c(),h(E,{label:l.title,value:d,key:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(y,null,{default:o(()=>[t(i,{type:"primary",onClick:e[3]||(e[3]=l=>_())},{default:o(()=>[p(m(n(a)("search")),1)]),_:1}),t(i,{onClick:e[4]||(e[4]=l=>de(Y.value))},{default:o(()=>[p(m(n(a)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),f("div",Dt,[t(Ve,{modelValue:R.value,"onUpdate:modelValue":e[5]||(e[5]=l=>R.value=l),size:"large",class:"px-[14px]",onChange:ve,indeterminate:B.value},null,8,["modelValue","indeterminate"]),t(i,{onClick:ye,size:"small"},{default:o(()=>[p(m(n(a)("batchDeletion")),1)]),_:1})]),je((c(),h(Se,{data:s.data,size:"large",ref_key:"diyFormListTableRef",ref:A,onSelectionChange:ge},{empty:o(()=>[f("span",null,m(s.loading?"":n(a)("emptyData")),1)]),default:o(()=>[t(D,{type:"selection",width:"55"}),t(D,{prop:"page_title",label:n(a)("title"),"min-width":"120"},null,8,["label"]),t(D,{prop:"type_name",label:n(a)("typeName"),"min-width":"80"},null,8,["label"]),t(D,{label:n(a)("status"),"min-width":"80"},{default:o(({row:l})=>[l.status==1?(c(),h(X,{key:0,type:"success",class:"cursor-pointer",onClick:d=>W(l)},{default:o(()=>[p(m(n(a)("statusOn")),1)]),_:2},1032,["onClick"])):(c(),h(X,{key:1,type:"info",class:"cursor-pointer",onClick:d=>W(l)},{default:o(()=>[p(m(n(a)("statusOff")),1)]),_:2},1032,["onClick"]))]),_:1},8,["label"]),t(D,{prop:"update_time",label:n(a)("updateTime"),"min-width":"120"},null,8,["label"]),t(D,{label:n(a)("operation"),fixed:"right",align:"right","min-width":"130"},{default:o(({row:l})=>[f("div",Pt,[l.status==1&&l.type=="DIY_FORM"?(c(),h(i,{key:0,type:"primary",link:"",onClick:d=>Ce(l)},{default:o(()=>[p(m(n(a)("promotion")),1)]),_:2},1032,["onClick"])):S("",!0),t(i,{type:"primary",link:"",onClick:d=>ce(l)},{default:o(()=>[p(m(n(a)("edit")),1)]),_:2},1032,["onClick"]),l.status==0?(c(),h(i,{key:1,type:"primary",link:"",onClick:d=>_e(l.form_id)},{default:o(()=>[p(m(n(a)("delete")),1)]),_:2},1032,["onClick"])):S("",!0),t(i,{type:"primary",link:"",onClick:d=>ie(l)},{default:o(()=>[p(m(n(a)("detail")),1)]),_:2},1032,["onClick"]),t($e,{placement:"bottom",trigger:"click",class:"ml-[12px]"},{dropdown:o(()=>[t(Ee,null,{default:o(()=>[l.type=="DIY_FORM"?(c(),h($,{key:0},{default:o(()=>[t(i,{type:"primary",class:"w-full",link:"",onClick:d=>we(l)},{default:o(()=>[p(m(n(a)("submitSuccess")),1)]),_:2},1032,["onClick"])]),_:2},1024)):S("",!0),t($,null,{default:o(()=>[t(i,{type:"primary",class:"w-full",link:"",onClick:d=>xe(l)},{default:o(()=>[p(m(n(a)("writeSet")),1)]),_:2},1032,["onClick"])]),_:2},1024),l.type=="DIY_FORM"?(c(),h($,{key:1},{default:o(()=>[t(i,{type:"primary",class:"w-full",link:"",onClick:d=>be(l)},{default:o(()=>[p(m(n(a)("shareSet")),1)]),_:2},1032,["onClick"])]),_:2},1024)):S("",!0),t($,null,{default:o(()=>[t(i,{type:"primary",class:"w-full",link:"",onClick:d=>Pe(l)},{default:o(()=>[p(m(n(a)("export")),1)]),_:2},1032,["onClick"])]),_:2},1024),t($,null,{default:o(()=>[t(i,{type:"primary",class:"w-full",link:"",onClick:d=>fe(l.form_id)},{default:o(()=>[p(m(n(a)("copy")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),default:o(()=>[t(i,{type:"primary",link:""},{default:o(()=>[p(m(n(a)("more")),1)]),_:1})]),_:2},1024)])]),_:1},8,["label"])]),_:1},8,["data"])),[[Me,s.loading]]),f("div",Tt,[t(Re,{"current-page":s.page,"onUpdate:current-page":e[6]||(e[6]=l=>s.page=l),"page-size":s.limit,"onUpdate:page-size":e[7]||(e[7]=l=>s.limit=l),layout:"total, sizes, prev, pager, next, jumper",total:s.total,onSizeChange:e[8]||(e[8]=l=>_()),onCurrentChange:_},null,8,["current-page","page-size","total"])])]),_:1}),t(ee,{modelValue:T.value,"onUpdate:modelValue":e[11]||(e[11]=l=>T.value=l),title:n(a)("addFormTips"),width:"980px"},{footer:o(()=>[f("span",Rt,[t(i,{onClick:e[9]||(e[9]=l=>T.value=!1)},{default:o(()=>[p(m(n(a)("cancel")),1)]),_:1}),t(i,{type:"primary",onClick:e[10]||(e[10]=l=>pe(q.value))},{default:o(()=>[p(m(n(a)("confirm")),1)]),_:1})])]),default:o(()=>[t(O,{model:C,ref_key:"formRef",ref:q,rules:n(me)},{default:o(()=>[t(y,{prop:"type"},{default:o(()=>[f("div",Vt,[(c(!0),U(le,null,oe(x,(l,d)=>(c(),U("div",{key:d,class:Le(["image-option",{selected:C.type===d}]),onClick:zt=>ue(d)},[f("img",{src:n(qe)(l.preview),class:"option-image"},null,8,$t),f("div",St,m(l.title),1)],10,Et))),128))])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(ee,{modelValue:V.value,"onUpdate:modelValue":e[18]||(e[18]=l=>V.value=l),title:n(a)("shareSet"),width:"30%"},{footer:o(()=>[f("span",Bt,[t(i,{onClick:e[16]||(e[16]=l=>V.value=!1)},{default:o(()=>[p(m(n(a)("cancel")),1)]),_:1}),t(i,{type:"primary",onClick:e[17]||(e[17]=l=>ke(Z.value))},{default:o(()=>[p(m(n(a)("confirm")),1)]),_:1})])]),default:o(()=>[t(Be,{modelValue:v.value,"onUpdate:modelValue":e[12]||(e[12]=l=>v.value=l)},{default:o(()=>[t(te,{label:n(a)("wechat"),name:"wechat"},null,8,["label"]),t(te,{label:n(a)("weapp"),name:"weapp"},null,8,["label"])]),_:1},8,["modelValue"]),t(O,{model:g[v.value],"label-width":"90px",ref_key:"shareFormRef",ref:Z,rules:n(he)},{default:o(()=>[t(y,{label:n(a)("sharePage")},{default:o(()=>[f("span",null,m(H.value),1)]),_:1},8,["label"]),t(y,{label:n(a)("shareTitle"),prop:"title"},{default:o(()=>[t(k,{modelValue:g[v.value].title,"onUpdate:modelValue":e[13]||(e[13]=l=>g[v.value].title=l),modelModifiers:{trim:!0},placeholder:n(a)("shareTitlePlaceholder"),clearable:"",maxlength:"30","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),v.value=="wechat"?(c(),h(y,{key:0,label:n(a)("shareDesc"),prop:"desc"},{default:o(()=>[t(k,{modelValue:g[v.value].desc,"onUpdate:modelValue":e[14]||(e[14]=l=>g[v.value].desc=l),modelModifiers:{trim:!0},placeholder:n(a)("shareDescPlaceholder"),type:"textarea",rows:"4",clearable:"",maxlength:"100","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):S("",!0),t(y,{label:n(a)("shareImageUrl"),prop:"url"},{default:o(()=>[t(Ue,{modelValue:g[v.value].url,"onUpdate:modelValue":e[15]||(e[15]=l=>g[v.value].url=l),limit:1},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(kt,{ref_key:"spreadPopupRef",ref:G},null,512),t(ht,{ref_key:"formSubmitPopupRef",ref:M,onComplete:e[19]||(e[19]=l=>_(n(w)(s.searchParam).page))},null,512),t(bt,{ref_key:"formWritePopupRef",ref:z,onComplete:e[20]||(e[20]=l=>_(n(w)(s.searchParam).page))},null,512),t(yt,{ref_key:"recordsDetailDialog",ref:I},null,512),t(Ie,{ref_key:"exportSureDialog",ref:Fe,show:N.value,type:"diy_form_records",searchParam:K,onClose:De},null,8,["show","searchParam"])])}}});const Ia=Ct(Ut,[["__scopeId","data-v-a4caff4e"]]);export{Ia as default};
