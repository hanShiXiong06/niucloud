import{d as J,r as g,n as O,h as t,c as a,a as i,b as Q,e as o,w as r,i as B,t as m,u as _,q as E,Z as D,F as z,W as R,s as H,B as T,C as N,_ as M,x as X,v as Y,az as ee,E as te,b0 as le,b1 as ae,K as se,ab as oe,U as ne,a2 as ie,V as re,a3 as ce,ax as de}from"./index-0b74b7aa.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 */import{_ as ue}from"./index.vue_vue_type_script_setup_true_lang-cb8d7a65.js";/* empty css                 *//* empty css                        *//* empty css               *//* empty css                  */import{_ as pe}from"./upload-media.vue_vue_type_script_setup_true_lang-98e5f0e9.js";import{a as fe,s as me}from"./wechat-0cb071c4.js";const _e={class:"flex border-t border-b main-wrap border-color w-full h-[40vh]"},ve={class:"attachment-list-wrap flex flex-col p-[15px] flex-1 overflow-hidden"},he={key:0,class:"flex"},ge={key:1,class:"flex"},ye={class:"flex-1 my-[15px] h-0"},we={key:0},xe={key:0,class:"flex flex-wrap"},be=["onClick"],ke={class:"attachment-wrap w-full rounded cursor-pointer overflow-hidden relative flex items-center justify-center h-[120px]"},Ce=["src"],Ee={class:"absolute z-[1] flex items-center justify-center w-full h-full inset-0 bg-black bg-opacity-60"},ze=["onClick"],Se={class:"relative"},Ve={class:"w-full h-[130px] relative"},$e={key:0,class:"absolute left-0 bottom-0 p-[10px] w-full truncate text-white leading-none"},Be={key:0},Ne={class:"flex-1 w-0 truncate"},je={class:"w-[50px] h-[50px] ml-[10px]"},Le={key:1,class:"px-[15px] py-[10px]"},We={class:"absolute z-[1] flex items-center justify-center w-full h-full inset-0 bg-black bg-opacity-60"},De={key:1,class:"flex items-center justify-center"},Re={class:"flex h-full justify-end items-center"},Ie={class:"dialog-footer"},at=J({__name:"select-wechat-media",props:{type:{type:String,default:"image"}},emits:["success"],setup(y,{emit:P}){const v=y,S=g(!1),q=()=>{v.type=="news"&&L(),S.value=!0},s=O({loading:!0,page:1,total:0,limit:10,data:[]}),w=(k=1)=>{s.loading=!0,s.page=k,fe({page:s.page,limit:s.limit,type:v.type}).then(l=>{s.data=l.data.data,s.total=l.data.total,s.loading=!1,v.type=="news"&&L()}).catch(()=>{s.loading=!1})};w();const x=g({}),A=()=>{P("success",x.value)},h=g(!1),K=()=>{h.value||(h.value=!0,me().then(()=>{h.value=!1,w()}).catch(()=>{h.value=!1}))},j=document.createElement("meta");j.content="same-origin",j.name="referrer",document.getElementsByTagName("head")[0].appendChild(j);const I=g(null),U=g([]),b=g([]),L=ee(()=>{de(()=>{const k=I.value.clientWidth,l=parseInt(k/292),d=[],u=[];U.value.forEach((p,n)=>{if(n<l){const c={};c.top="0px",n%l==0?c.left=p.clientWidth*n+"px":c.left=p.clientWidth*n+n%l*10+"px",u[n]=c,d[n]=p.clientHeight+10}else{const c=Math.min(...d),V=d.findIndex(W=>W===c),C={};C.top=c+10+"px",C.left=u[V].left,u[n]=C,d[V]+=p.clientHeight+10}}),b.value=u})},800);return window.addEventListener("resize",()=>L()),(k,l)=>{const d=te,u=le,p=ae,n=se,c=ue,V=oe,C=ne,W=ie,Z=re,G=ce;return t(),a(z,null,[i("div",{onClick:q},[Q(k.$slots,"default")]),o(Z,{modelValue:S.value,"onUpdate:modelValue":l[5]||(l[5]=e=>S.value=e),title:_(E)("upload.select"+y.type),width:"60%",class:"attachment-dialog","destroy-on-close":!0},{footer:r(()=>[i("span",Ie,[o(d,{onClick:l[4]||(l[4]=e=>S.value=!1)},{default:r(()=>[B(m(_(E)("cancel")),1)]),_:1}),o(d,{type:"primary",onClick:A},{default:r(()=>[B(m(_(E)("confirm")),1)]),_:1})])]),default:r(()=>[i("div",_e,[i("div",ve,[o(p,{gutter:15,class:"h-[32px]"},{default:r(()=>[o(u,{span:10},{default:r(()=>[v.type!="news"?(t(),a("div",he,[o(pe,{type:v.type,onSuccess:l[0]||(l[0]=e=>w())},{default:r(()=>[o(d,{type:"primary"},{default:r(()=>[B(m(_(E)("upload.upload"+y.type)),1)]),_:1})]),_:1},8,["type"])])):(t(),a("div",ge,[o(d,{type:"primary",loading:h.value,onClick:K},{default:r(()=>[B(m(h.value?"同步中":"同步微信图文"),1)]),_:1},8,["loading"])]))]),_:1})]),_:1}),D((t(),a("div",ye,[o(C,null,{default:r(()=>[s.data.length?(t(),a("div",we,[v.type!="news"?(t(),a("div",xe,[(t(!0),a(z,null,R(s.data,(e,f)=>(t(),a("div",{class:"attachment-item mr-[10px] mb-[10px] w-[120px]",key:f,onClick:$=>x.value=e},[i("div",ke,[y.type=="image"?(t(),H(n,{key:0,src:_(T)(e.value),fit:"contain","preview-src-list":e.image_list},null,8,["src","preview-src-list"])):y.type=="video"?(t(),a("video",{key:1,src:_(T)(e.value)},null,8,Ce)):N("",!0),D(i("div",Ee,[o(c,{name:"element Select",color:"#fff",size:"40px"})],512),[[M,x.value.id==e.id]])])],8,be))),128))])):(t(),a("div",{key:1,class:"relative",ref_key:"waterfallContainerRef",ref:I},[(t(!0),a(z,null,R(s.data,(e,f)=>(t(),a("div",{ref_for:!0,ref_key:"waterfallItemRef",ref:U,class:"absolute attachment-item mr-[10px] mb-[10px] w-[280px] rounded-lg overflow-hidden border border-color",style:X({left:b.value[f]?b.value[f].left:"",top:b.value[f]?b.value[f].top:""}),key:f,onClick:$=>x.value=e},[i("div",Se,[i("div",Ve,[o(n,{src:e.value.news_item[0].thumb_url,class:"w-full h-full"},null,8,["src"]),e.value.news_item.length>1?(t(),a("div",$e,m(e.value.news_item[0].title),1)):N("",!0)]),e.value.news_item.length>1?(t(),a("div",Be,[(t(!0),a(z,null,R(e.value.news_item,($,F)=>(t(),a(z,null,[F>0?(t(),a("div",{key:0,class:Y(["px-[15px] py-[10px] flex",{"border-b border-color":F<e.value.news_item.length-1}])},[i("div",Ne,m($.title),1),i("div",je,[o(n,{src:$.thumb_url,class:"w-full h-full"},null,8,["src"])])],2)):N("",!0)],64))),256))])):(t(),a("div",Le,m(e.value.news_item[0].title),1)),D(i("div",We,[o(c,{name:"element Select",color:"#fff",size:"40px"})],512),[[M,x.value.id==e.id]])])],12,ze))),128))],512))])):(t(),a("div",De,[s.loading?N("",!0):(t(),H(V,{key:0,description:_(E)("upload.mediaEmpty"),"image-size":100},null,8,["description"]))]))]),_:1})])),[[G,s.loading]]),o(p,{gutter:20},{default:r(()=>[o(u,{span:"24"},{default:r(()=>[i("div",Re,[o(W,{"current-page":s.page,"onUpdate:current-page":l[1]||(l[1]=e=>s.page=e),small:!0,"page-size":s.limit,"onUpdate:page-size":l[2]||(l[2]=e=>s.limit=e),"page-sizes":[10,20,30,40,60],layout:"total, sizes, prev, pager, next, jumper",total:s.total,onSizeChange:l[3]||(l[3]=e=>w()),onCurrentChange:w},null,8,["current-page","page-size","total"])])]),_:1})]),_:1})])])]),_:1},8,["modelValue","title"])],64)}}});export{at as _};
