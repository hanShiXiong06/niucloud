import{d as U,r as _,n as V,R as I,l as w,h as i,s as d,w as o,a as x,e as l,i as C,Z as F,t as H,c as K,F as B,W as h,u as Y,C as $,$ as c,as as j,M as W,a4 as Z,a1 as q,L as z,N as J,E as Q,V as X,a3 as ee}from"./index-28ce54e5.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                  *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-form-item-4ed993c7.js";import{b as te}from"./recycle_order-836dc5c1.js";import{_ as ae}from"./_plugin-vue_export-helper-c27b6911.js";const se={class:"dialog-footer"},re=U({__name:"OrderStatusDialog",props:{visible:{type:Boolean,default:!1},orderData:{type:Object,default:()=>({})}},emits:["update:visible","success","closed"],setup(v,{emit:E}){const n=v,e={PENDING_CONFIRM:1,CHECKING:2,CHECKED:3,PAYING:4,PAID:5,COMPLETED:6,CANCELLED:7,RETURNING:8,RETURNED:9},u=_(n.visible),R=_(!1),p=_(!1),t=V({id:0,currentStatus:0,status:0,remark:""});I(()=>n.visible,s=>{u.value=s,s&&N()}),I(u,s=>{E("update:visible",s)});const N=()=>{n.orderData&&(t.id=n.orderData.id||0,t.currentStatus=n.orderData.status||0,t.status=0,t.remark="")},L=w(()=>D(t.currentStatus)),D=s=>{switch(s){case e.PENDING_CONFIRM:return[e.CHECKING,e.CANCELLED];case e.CHECKING:return[e.CHECKED,e.CANCELLED];case e.CHECKED:return[e.PAYING,e.CANCELLED];case e.PAYING:return[e.PAID,e.CANCELLED,e.RETURNING];case e.PAID:return[e.COMPLETED,e.CANCELLED];case e.COMPLETED:return[];case e.CANCELLED:return[];case e.RETURNING:return[e.RETURNED];case e.RETURNED:return[];default:return[]}},b=s=>({[e.PENDING_CONFIRM]:"warning",[e.CHECKING]:"primary",[e.CHECKED]:"success",[e.PAYING]:"warning",[e.PAID]:"warning",[e.COMPLETED]:"success",[e.CANCELLED]:"info",[e.RETURNING]:"warning",[e.RETURNED]:"info"})[s]||"info",f=s=>({[e.PENDING_CONFIRM]:"待确认",[e.CHECKING]:"检测中",[e.CHECKED]:"已检测",[e.PAYING]:"待付款",[e.PAID]:"已付款",[e.COMPLETED]:"已完成",[e.CANCELLED]:"已取消",[e.RETURNING]:"退货中",[e.RETURNED]:"已退货"})[s]||"未知状态",T=async()=>{if(!t.status){c.warning("请选择目标状态");return}if(!D(t.currentStatus).includes(t.status)){c.error("不允许的状态变更");return}try{p.value=!0;const a=await te(String(t.id),{status:t.status,old_status:t.currentStatus,remark:t.remark});a.code===1?(c.success("状态更新成功"),u.value=!1,E("success")):c.error(a.message||"状态更新失败")}catch(a){console.error("更新状态失败:",a),c.error(a.message||"状态更新失败")}finally{p.value=!1}},y=()=>{t.status=0,t.remark="",E("closed")};return n.visible&&N(),(s,a)=>{const A=j,m=W,S=Z,G=q,P=z,O=J,g=Q,M=X,k=ee;return i(),d(M,{modelValue:u.value,"onUpdate:modelValue":a[3]||(a[3]=r=>u.value=r),title:"修改订单状态",width:"400px","destroy-on-close":!0,onClosed:y},{footer:o(()=>[x("span",se,[l(g,{onClick:a[2]||(a[2]=r=>u.value=!1)},{default:o(()=>[C("取消")]),_:1}),l(g,{type:"primary",onClick:T,disabled:!t.status,loading:p.value},{default:o(()=>[C(" 确定 ")]),_:1},8,["disabled","loading"])])]),default:o(()=>[F((i(),d(O,{model:t,"label-width":"100px"},{default:o(()=>[l(m,{label:"当前状态"},{default:o(()=>[l(A,{type:b(t.currentStatus)},{default:o(()=>[C(H(f(t.currentStatus)),1)]),_:1},8,["type"])]),_:1}),l(m,{label:"目标状态"},{default:o(()=>[l(G,{modelValue:t.status,"onUpdate:modelValue":a[0]||(a[0]=r=>t.status=r),placeholder:"请选择状态"},{default:o(()=>[(i(!0),K(B,null,h(Y(L),r=>(i(),d(S,{key:r,label:f(r),value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t.status?(i(),d(m,{key:0,label:"备注"},{default:o(()=>[l(P,{modelValue:t.remark,"onUpdate:modelValue":a[1]||(a[1]=r=>t.remark=r),type:"textarea",rows:3,placeholder:"请输入状态变更备注（可选）"},null,8,["modelValue"])]),_:1})):$("",!0)]),_:1},8,["model"])),[[k,R.value]])]),_:1},8,["modelValue"])}}});const ge=ae(re,[["__scopeId","data-v-91ea08a7"]]);export{ge as default};
