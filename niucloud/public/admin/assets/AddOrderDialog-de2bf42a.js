import{d as se,r as n,R as A,aZ as te,cF as ne,a5 as re,h as m,s as K,w as o,a as r,e,i as x,u as F,Y as ue,c as b,F as ie,W as de,t as I,C as k,dI as ce,D as me,dJ as ve,$ as c,ah as _e,a0 as pe,E as fe,L as be,cQ as ye,M as he,aD as ge,aE as we,aN as xe,N as ke,V as Ve,p as Ee,g as Ce}from"./index-0b74b7aa.js";/* empty css                  *//* empty css                   *//* empty css                *//* empty css                 *//* empty css                        *//* empty css                       *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                  *//* empty css                  */import{g as Ie,c as Me}from"./recycle_order-d9d63f63.js";import{_ as Be}from"./_plugin-vue_export-helper-c27b6911.js";const Se=y=>(Ee("data-v-de95bc3a"),y=y(),Ce(),y),Te={class:"member-select"},De={key:0,class:"search-results"},Fe=["onClick"],Ne={class:"flex items-center"},Ue={class:"member-info"},Oe={class:"member-name"},Re={class:"member-mobile"},$e={key:1,class:"selected-member transition-all duration-300"},ze={class:"flex items-center justify-between transition-all duration-300"},Ae={class:"flex items-center"},Ke={class:"member-info"},Le={class:"member-name"},Ze={class:"member-mobile"},qe={class:"express-input-wrapper"},Pe={key:0,class:"scan-tip"},je=Se(()=>r("span",null,"准备扫码中，请对准条码...",-1)),Ge={class:"dialog-footer"},Je=se({__name:"AddOrderDialog",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","success","closed"],setup(y,{emit:M}){const B=y,p=n(B.visible),S=n(!1),a=n({member_id:"",delivery_type:"1",express_no:"",count:1}),f=n(""),v=n([]),V=n(1),N=n(10),U=n(!1),u=n(null),h=n(null),T=n(null),d=n(!1),E=n(""),g=n(null);A(()=>B.visible,s=>{p.value=s}),A(p,s=>{M("update:visible",s)});const L=()=>{h.value&&clearTimeout(h.value),h.value=window.setTimeout(()=>{f.value?D():v.value=[]},300)},D=async()=>{if(!f.value){v.value=[];return}try{const s={page:V.value,page_size:N.value,keyword:f.value},l=await Ie(s.keyword);l.code===1?(v.value=l.data.data||[],U.value=l.data.count>V.value*N.value):c.error(l.message||"搜索会员失败")}catch(s){console.error("搜索会员失败:",s),c.error("搜索会员失败")}},Z=async()=>{V.value++,await D()},q=s=>{u.value=s,a.value.member_id=s.member_id,v.value=[]},P=()=>{u.value=null,a.value.member_id=""},j=()=>{T.value&&(T.value.$el.querySelector("input").focus(),d.value=!0,c.info("请将扫码枪对准条码进行扫描"))},G=()=>{d.value=!0},J=()=>{window.setTimeout(()=>{d.value=!1},100)},Q=s=>{d.value&&s.key==="Enter"&&a.value.express_no&&(c.success("扫码成功："+a.value.express_no),d.value=!1)},O=s=>{d.value&&(g.value&&clearTimeout(g.value),g.value=window.setTimeout(()=>{E.value&&(a.value.express_no=E.value,E.value="",c.success("扫码成功："+a.value.express_no),d.value=!1)},100))};te(()=>{window.addEventListener("keydown",O)}),ne(()=>{window.removeEventListener("keydown",O),g.value&&clearTimeout(g.value),h.value&&clearTimeout(h.value)});const W=async()=>{var s,l;if(!a.value.member_id){c.warning("请选择会员");return}if(a.value.delivery_type==="1"&&!a.value.express_no){c.warning("请输入快递单号");return}try{S.value=!0;const i=((s=u.value)==null?void 0:s.nickname)||((l=u.value)==null?void 0:l.username)||"所选会员";await _e.confirm(`确定要为用户 "${i}" 创建回收订单吗？`,"创建订单确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const _={member_id:a.value.member_id,delivery_type:a.value.delivery_type,express_no:a.value.delivery_type==="1"?a.value.express_no:""},w=await Me(_);if(w.code!==1)throw new Error(w.message||"创建订单失败");c.success("创建订单成功"),R(),p.value=!1,M("success")}catch(i){if(i==="cancel")return;console.error("创建订单失败:",i),c.error(i.message||"创建订单失败")}finally{S.value=!1}},R=()=>{a.value={member_id:"",delivery_type:"1",express_no:""},u.value=null,f.value="",v.value=[],V.value=1,d.value=!1,E.value=""},Y=()=>{R(),M("closed")};return B.visible,(s,l)=>{const i=pe,_=fe,w=be,$=ye,C=he,z=ge,H=we,X=re("ZoomOut"),ee=xe,ae=ke,le=Ve;return m(),K(le,{modelValue:p.value,"onUpdate:modelValue":l[5]||(l[5]=t=>p.value=t),title:"代客户下单",width:"600px","destroy-on-close":!0,onClosed:Y},{footer:o(()=>[r("span",Ge,[e(_,{onClick:l[4]||(l[4]=t=>p.value=!1)},{default:o(()=>[x("取消")]),_:1}),e(_,{type:"primary",onClick:W,loading:S.value},{default:o(()=>[x("确定")]),_:1},8,["loading"])])]),default:o(()=>[e(ae,{ref:"formRef",model:a.value,"label-width":"100px"},{default:o(()=>[e(C,{label:"选择会员",required:""},{default:o(()=>[r("div",Te,[e(w,{modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=t=>f.value=t),placeholder:"输入会员手机号/昵称/用户名搜索",clearable:"",onInput:L},{append:o(()=>[e(_,{onClick:D},{default:o(()=>[e(i,null,{default:o(()=>[e(F(ue))]),_:1})]),_:1})]),_:1},8,["modelValue"]),v.value.length>0?(m(),b("div",De,[(m(!0),b(ie,null,de(v.value,(t,oe)=>(m(),b("div",{key:oe,class:"search-result-item",onClick:Qe=>q(t)},[r("div",Ne,[e($,{size:30,src:t.headimg||""},null,8,["src"]),r("div",Ue,[r("div",Oe,I(t.nickname||t.username||"未设置昵称"),1),r("div",Re,I(t.mobile||"未绑定手机"),1)])])],8,Fe))),128)),U.value?(m(),b("div",{key:0,class:"search-result-more",onClick:Z}," 加载更多... ")):k("",!0)])):k("",!0),a.value.member_id&&u.value?(m(),b("div",$e,[r("div",ze,[r("div",Ae,[e($,{size:40,src:u.value.headimg||""},null,8,["src"]),r("div",Ke,[r("div",Le,I(u.value.nickname||u.value.username||"未设置昵称"),1),r("div",Ze,I(u.value.mobile||"未绑定手机"),1)])]),e(_,{link:"",type:"danger",onClick:P},{default:o(()=>[e(i,null,{default:o(()=>[e(F(ce))]),_:1})]),_:1})])])):k("",!0)])]),_:1}),e(C,{label:"下单方式"},{default:o(()=>[e(H,{modelValue:a.value.delivery_type,"onUpdate:modelValue":l[1]||(l[1]=t=>a.value.delivery_type=t)},{default:o(()=>[e(z,{label:"1"},{default:o(()=>[x("快递")]),_:1}),e(z,{label:"2"},{default:o(()=>[x("门店")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a.value.delivery_type==="1"?(m(),K(C,{key:0,label:"快递单号"},{default:o(()=>[r("div",qe,[e(w,{ref_key:"expressInput",ref:T,modelValue:a.value.express_no,"onUpdate:modelValue":l[2]||(l[2]=t=>a.value.express_no=t),placeholder:"请输入快递单号或使用扫码枪",onKeydown:me(Q,["enter"]),onFocus:G,onBlur:J},null,8,["modelValue","onKeydown"]),e(_,{type:"primary",onClick:j},{default:o(()=>[e(i,null,{default:o(()=>[e(X)]),_:1}),x(" 扫码 ")]),_:1})]),d.value?(m(),b("div",Pe,[e(i,null,{default:o(()=>[e(F(ve),{class:"is-loading"})]),_:1}),je])):k("",!0)]),_:1})):k("",!0),e(C,{label:"数量"},{default:o(()=>[e(ee,{modelValue:a.value.count,"onUpdate:modelValue":l[3]||(l[3]=t=>a.value.count=t),min:1,max:100},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}});const ia=Be(Je,[["__scopeId","data-v-de95bc3a"]]);export{ia as default};
