import{d as ae,r as v,n as le,aZ as re,h as g,c as C,e as t,w as s,a as b,t as n,u as l,q as e,i as c,Z as se,s as I,C as Q,ah as j,$ as E,L as oe,M as ue,a4 as ne,a1 as ie,E as ce,N as de,a9 as pe,aj as _e,as as ye,ak as me,a2 as ve,al as be,am as fe,aH as qe,aI as ge,V as he,a3 as we}from"./index-0b74b7aa.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                    *//* empty css                             *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                *//* empty css                *//* empty css                  */import"./el-form-item-4ed993c7.js";import{D as Te,g as xe,a as Ce,d as De,b as ke,r as Ee}from"./DataStatistics-aeae45dc.js";import Ne from"./WarrantyInfoDisplay-6347b608.js";import{_ as Se}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                       */const Ve={class:"main-container"},Be={class:"flex justify-between items-center"},Re={class:"text-page-title"},Ie={class:"mt-[10px]"},Qe={class:"mt-[16px] flex justify-between"},je={key:0},ze={key:0,class:"warranty-result-container"},Fe={key:1},Oe={class:"mt-4"},Pe={class:"bg-gray-100 p-4 rounded max-h-96 overflow-auto"},Ue={class:"bg-gray-100 p-4 rounded max-h-96 overflow-auto"},Le={name:"DeviceQueryResult"},$e=ae({...Le,setup(Me){const D=v(!1),N=v([]),S=v(0),k=v(!1),d=v(null),f=v([]),z=v(),F=v(),i=le({query_code:"",query_type:"",status:"",page:1,limit:10,create_at:[]}),_=async()=>{D.value=!0;try{const r=await xe(i);N.value=r.data.data,S.value=r.data.total}catch(r){console.error(r)}D.value=!1},O=async r=>{try{const o=await Ce(r.id);d.value=o.data,k.value=!0}catch(o){console.error(o)}},P=r=>{j.confirm(e("device_query.result.deleteConfirm"),e("device_query.result.warning"),{confirmButtonText:e("device_query.result.confirmText"),cancelButtonText:e("device_query.result.cancelText"),type:"warning"}).then(async()=>{try{await De(r),E.success(e("device_query.result.deleteSuccess")),await _()}catch(o){console.error(o)}})},U=()=>{f.value.length!==0&&j.confirm(e("device_query.result.batchDeleteConfirm").replace("{count}",f.value.length.toString()),e("device_query.result.batchDeleteTitle"),{confirmButtonText:e("device_query.result.confirmText"),cancelButtonText:e("device_query.result.cancelText"),type:"warning"}).then(async()=>{try{await ke(f.value),E.success(e("device_query.result.deleteSuccess")),f.value=[],await _()}catch(r){console.error(r)}})},L=async r=>{try{await Ee(r.id),E.success(e("device_query.result.requerySuccess")),await _()}catch(o){console.error(o)}},$=()=>{i.query_code="",i.query_type="",i.status="",i.create_at=[],_()},M=r=>{f.value=r.map(o=>o.id)},W=r=>new Date(r*1e3).toLocaleString(),J=r=>{if(!r.query_result||typeof r.query_result!="object")return!1;const o=r.query_result;return o.sn&&o.model&&o.coverage&&o.purchase},Z=r=>{var o,T,q,p,h,y,x,w;if(!r||typeof r!="object")return V();try{const a=typeof r=="string"?JSON.parse(r):r;return{sn:a.sn||"",model:a.model||"未知型号",capacity:a.capacity||"",color:a.color||"",modelnumber:a.modelnumber||"",identifier:a.identifier||"",activated:Boolean(a.activated),image:a.image||"",fmi:a.fmi||"",locked:a.locked||"",purchase:{date:((o=a.purchase)==null?void 0:o.date)||"",validated:Boolean((T=a.purchase)==null?void 0:T.validated)},activation:{date:((q=a.activation)==null?void 0:q.date)||""},coverage:{status:((p=a.coverage)==null?void 0:p.status)||"未知",description:((h=a.coverage)==null?void 0:h.description)||"",date:((y=a.coverage)==null?void 0:y.date)||"","days-remaining":Number((x=a.coverage)==null?void 0:x["days-remaining"])||0},support:a.support||"",applecare:Boolean(a.applecare),"applecare-eligible":a["applecare-eligible"]||"N",brightstar:a.brightstar||"No","pre-activated":Boolean(a["pre-activated"]),registered:a.registered||"N",loaner:a.loaner||"N",replaced:Boolean(a.replaced),manufacture:{date:((w=a.manufacture)==null?void 0:w.date)||""},manufacturer:a.manufacturer||"",source:a.source||"",balance:Number(a.balance)||0,maintenance:Boolean(a.maintenance)}}catch(a){return console.error("解析保修数据失败:",a),V()}},V=()=>({sn:"",model:"未知型号",capacity:"",color:"",modelnumber:"",identifier:"",activated:!1,image:"",fmi:"",locked:"",purchase:{date:"",validated:!1},activation:{date:""},coverage:{status:"未知",description:"",date:"","days-remaining":0},support:"",applecare:!1,"applecare-eligible":"N",brightstar:"No","pre-activated":!1,registered:"N",loaner:"N",replaced:!1,manufacture:{date:""},manufacturer:"",source:"",balance:0,maintenance:!1}),H=r=>{r.dateRange&&r.dateRange.length===2?(i.create_at=r.dateRange,console.log("日期范围:",r.dateRange)):i.create_at=[],r.queryType&&(i.query_type=r.queryType),r.status!==""&&(i.status=r.status),_()};return re(()=>{_()}),(r,o)=>{const T=oe,q=ue,p=ne,h=ie,y=ce,x=de,w=pe,a=_e,A=ye,G=me,K=ve,m=be,X=fe,B=qe,Y=ge,ee=he,te=we;return g(),C("div",Ve,[t(Te,{"auto-refresh":!1,onFilterChange:H,ref_key:"dataStatisticsRef",ref:F},null,512),t(w,{class:"box-card rounded-lg !border-none",shadow:"never"},{default:s(()=>[b("div",Be,[b("span",Re,n(l(e)("device_query.result.title")),1)]),t(w,{class:"box-card !border-none my-[10px] table-search-wrap",shadow:"never"},{default:s(()=>[t(x,{inline:!0,model:i,ref_key:"searchFormRef",ref:z,class:"search-form"},{default:s(()=>[t(q,{label:l(e)("device_query.result.queryCode"),prop:"query_code"},{default:s(()=>[t(T,{modelValue:i.query_code,"onUpdate:modelValue":o[0]||(o[0]=u=>i.query_code=u),placeholder:l(e)("device_query.result.queryCodePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(q,{label:l(e)("device_query.result.queryType"),prop:"query_type"},{default:s(()=>[t(h,{modelValue:i.query_type,"onUpdate:modelValue":o[1]||(o[1]=u=>i.query_type=u),placeholder:l(e)("device_query.result.queryTypePlaceholder"),class:"input-width"},{default:s(()=>[t(p,{label:l(e)("device_query.result.all"),value:""},null,8,["label"]),t(p,{label:l(e)("device_query.result.queryTypes.imei"),value:"imei"},null,8,["label"]),t(p,{label:l(e)("device_query.result.queryTypes.serial"),value:"serial"},null,8,["label"]),t(p,{label:l(e)("device_query.result.queryTypes.model"),value:"model"},null,8,["label"]),t(p,{label:l(e)("device_query.result.queryTypes.coverage"),value:"coverage"},null,8,["label"]),t(p,{label:l(e)("device_query.result.queryTypes.activationlock"),value:"activationlock"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(q,{label:l(e)("device_query.result.status"),prop:"status"},{default:s(()=>[t(h,{modelValue:i.status,"onUpdate:modelValue":o[2]||(o[2]=u=>i.status=u),placeholder:l(e)("device_query.result.statusPlaceholder"),class:"input-width"},{default:s(()=>[t(p,{label:l(e)("device_query.result.all"),value:""},null,8,["label"]),t(p,{label:l(e)("device_query.result.statusOptions.success"),value:1},null,8,["label"]),t(p,{label:l(e)("device_query.result.statusOptions.failed"),value:0},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(q,null,{default:s(()=>[t(y,{type:"primary",onClick:o[3]||(o[3]=u=>_())},{default:s(()=>[c(n(l(e)("device_query.result.search")),1)]),_:1}),t(y,{onClick:$},{default:s(()=>[c(n(l(e)("device_query.result.reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),b("div",Ie,[se((g(),I(G,{data:N.value,size:"large",onSelectionChange:M},{default:s(()=>[t(a,{type:"selection",width:"55"}),t(a,{label:l(e)("device_query.result.queryCode"),prop:"query_code","min-width":"150"},null,8,["label"]),t(a,{label:l(e)("device_query.result.queryType"),prop:"query_type_name","min-width":"100"},null,8,["label"]),t(a,{label:l(e)("device_query.result.api_endpoint"),prop:"api_endpoint","min-width":"200"},null,8,["label"]),t(a,{label:l(e)("device_query.result.status"),prop:"status","min-width":"80"},{default:s(({row:u})=>[t(A,{type:u.status===1?"success":"danger"},{default:s(()=>[c(n(u.status_name),1)]),_:2},1032,["type"])]),_:1},8,["label"]),t(a,{label:l(e)("device_query.result.cost"),prop:"cost_amount","min-width":"80"},{default:s(({row:u})=>[c(" ¥"+n(u.cost_amount),1)]),_:1},8,["label"]),t(a,{label:l(e)("device_query.result.responseTime"),prop:"response_time","min-width":"80"},{default:s(({row:u})=>[c(n(u.response_time)+"ms ",1)]),_:1},8,["label"]),t(a,{label:l(e)("device_query.result.operator"),prop:"operator_name","min-width":"100"},null,8,["label"]),t(a,{label:l(e)("device_query.result.queryTime"),prop:"create_at","min-width":"160"},{default:s(({row:u})=>[c(n(W(u.create_at)),1)]),_:1},8,["label"]),t(a,{label:l(e)("device_query.result.operation"),fixed:"right",width:"180"},{default:s(({row:u})=>[t(y,{type:"primary",link:"",onClick:R=>O(u)},{default:s(()=>[c(n(l(e)("device_query.result.view")),1)]),_:2},1032,["onClick"]),u.status!==1?(g(),I(y,{key:0,type:"warning",link:"",onClick:R=>L(u)},{default:s(()=>[c(n(l(e)("device_query.result.requery")),1)]),_:2},1032,["onClick"])):Q("",!0),t(y,{type:"danger",link:"",onClick:R=>P(u.id)},{default:s(()=>[c(n(l(e)("device_query.result.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[te,D.value]]),b("div",Qe,[b("div",null,[t(y,{type:"danger",onClick:U,disabled:f.value.length===0},{default:s(()=>[c(n(l(e)("device_query.result.batchDelete"))+" ("+n(f.value.length)+") ",1)]),_:1},8,["disabled"])]),t(K,{"current-page":i.page,"onUpdate:current-page":o[4]||(o[4]=u=>i.page=u),"page-size":i.limit,"onUpdate:page-size":o[5]||(o[5]=u=>i.limit=u),layout:"total, sizes, prev, pager, next, jumper",total:S.value,onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","total"])])])]),_:1}),t(ee,{modelValue:k.value,"onUpdate:modelValue":o[6]||(o[6]=u=>k.value=u),title:l(e)("device_query.result.detailDialog"),width:"90%","max-height":"80vh"},{default:s(()=>[d.value?(g(),C("div",je,[J(d.value)?(g(),C("div",ze,[t(Ne,{warrantyData:Z(d.value.query_result)},null,8,["warrantyData"])])):(g(),C("div",Fe,[t(X,{column:2,border:""},{default:s(()=>[t(m,{label:l(e)("device_query.result.queryCode")},{default:s(()=>[c(n(d.value.query_code),1)]),_:1},8,["label"]),t(m,{label:l(e)("device_query.result.queryType")},{default:s(()=>[c(n(d.value.query_type_name),1)]),_:1},8,["label"]),t(m,{label:l(e)("device_query.result.apiEndpoint")},{default:s(()=>[c(n(d.value.api_endpoint),1)]),_:1},8,["label"]),t(m,{label:l(e)("device_query.result.apiName")},{default:s(()=>[c(n(d.value.api_name),1)]),_:1},8,["label"]),t(m,{label:l(e)("device_query.result.status")},{default:s(()=>[c(n(d.value.status_name),1)]),_:1},8,["label"]),t(m,{label:l(e)("device_query.result.cost")},{default:s(()=>[c("¥"+n(d.value.cost_amount),1)]),_:1},8,["label"]),t(m,{label:l(e)("device_query.result.responseTime")},{default:s(()=>[c(n(d.value.response_time)+"ms",1)]),_:1},8,["label"]),t(m,{label:l(e)("device_query.result.operator")},{default:s(()=>[c(n(d.value.operator_name),1)]),_:1},8,["label"])]),_:1}),b("div",Oe,[t(Y,null,{default:s(()=>[t(B,{label:l(e)("device_query.result.queryResult")},{default:s(()=>[b("pre",Pe,n(JSON.stringify(d.value.query_result,null,2)),1)]),_:1},8,["label"]),t(B,{label:l(e)("device_query.result.rawResponse")},{default:s(()=>[b("pre",Ue,n(JSON.stringify(d.value.raw_response,null,2)),1)]),_:1},8,["label"])]),_:1})])]))])):Q("",!0)]),_:1},8,["modelValue","title"])])}}});const vt=Se($e,[["__scopeId","data-v-ee653a6e"]]);export{vt as default};
