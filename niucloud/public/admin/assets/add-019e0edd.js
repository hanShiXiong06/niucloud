import{f as F,r as n,n as R,l as K,aZ as L,h as _,c as y,e as a,w as r,a as c,i as d,F as P,W as Y,s as D,C as M,t as T,u as G,$ as w,E as H,a4 as O,a1 as W,M as Z,L as $,aD as j,aE as z,N as A,a9 as J,p as Q,g as X}from"./index-9cfed1fc.js";/* empty css                *//* empty css                *//* empty css                       *//* empty css                 *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                  */import{g as ee,b as ae,t as re}from"./printer-6e82347a.js";import{_ as te}from"./_plugin-vue_export-helper-c27b6911.js";const le=i=>(Q("data-v-c07b0d28"),i=i(),X(),i),se={class:"printer-add-wrap"},oe={class:"card-header"},ne=le(()=>c("span",null,"绑定打印机",-1)),de={class:"brand-option"},ue=["src"],ie={__name:"add",setup(i){const k=F(),m=n(null),f=n(!1),b=n(!1),v=n([]);n(""),n([]);const e=R({brand:"xpyun",printer_name:"",sn:"",user_key:"",user_name:"",type:"label",selectedUsers:[]}),x={brand:[{required:!0,message:"请选择打印机品牌",trigger:"change"}],printer_name:[{required:!0,message:"请输入打印机名称",trigger:"blur"}],sn:[{required:!0,message:"请输入打印机序列号",trigger:"blur"}],user_key:[{required:!0,message:"请输入用户KEY",trigger:"blur"}],user_name:[{required:!0,message:"请输入用户名",trigger:"blur"}]},V=K(()=>e.sn&&e.user_key&&e.user_name),U=async()=>{try{const s=await ee();s.code===1&&(v.value=s.data)}catch(s){console.error("获取打印机品牌列表失败",s)}},B=async()=>{m.value&&await m.value.validate(async s=>{if(s)try{f.value=!0;const l={brand:e.brand,printer_name:e.printer_name,sn:e.sn,user_key:e.user_key,user_name:e.user_name,type:e.type};e.selectedUsers.length>0&&(l.user_ids=e.selectedUsers.map(g=>g.uid)),(await ae(l)).code===1&&k.push("/recycle/printer/list")}catch(l){console.error("绑定打印机失败",l)}finally{f.value=!1}})},C=async()=>{if(!V.value){w.warning("请先填写打印机序列号、用户名和用户KEY");return}try{b.value=!0,(await re({sn:e.sn,user_name:e.user_name,user_key:e.user_key})).code===1&&w.success("测试打印成功")}catch(s){console.error("测试打印失败",s)}finally{b.value=!1}},E=()=>{k.push("/recycle/printer/list")};return L(()=>{U()}),(s,l)=>{const u=H,g=O,I=W,o=Z,p=$,h=j,N=z,S=A,q=J;return _(),y("div",se,[a(q,{class:"box-card"},{header:r(()=>[c("div",oe,[ne,a(u,{text:"",onClick:E},{default:r(()=>[d("返回列表")]),_:1})])]),default:r(()=>[a(S,{ref_key:"formRef",ref:m,model:e,rules:x,"label-width":"120px","label-position":"right",class:"printer-form"},{default:r(()=>[a(o,{label:"打印机品牌",prop:"brand"},{default:r(()=>[a(I,{modelValue:e.brand,"onUpdate:modelValue":l[0]||(l[0]=t=>e.brand=t),placeholder:"请选择打印机品牌",style:{width:"100%"}},{default:r(()=>[(_(!0),y(P,null,Y(v.value,t=>(_(),D(g,{key:t.brand,label:t.name,value:t.brand},{default:r(()=>[c("div",de,[t.logo?(_(),y("img",{key:0,src:t.logo,alt:"",class:"brand-logo"},null,8,ue)):M("",!0),c("span",null,T(t.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(o,{label:"打印机名称",prop:"printer_name"},{default:r(()=>[a(p,{modelValue:e.printer_name,"onUpdate:modelValue":l[1]||(l[1]=t=>e.printer_name=t),placeholder:"为打印机取个名字，方便识别"},null,8,["modelValue"])]),_:1}),a(o,{label:"打印机序列号",prop:"sn"},{default:r(()=>[a(p,{modelValue:e.sn,"onUpdate:modelValue":l[2]||(l[2]=t=>e.sn=t),placeholder:"打印机SN码"},null,8,["modelValue"])]),_:1}),a(o,{label:"用户KEY",prop:"user_key"},{default:r(()=>[a(p,{modelValue:e.user_key,"onUpdate:modelValue":l[3]||(l[3]=t=>e.user_key=t),placeholder:"云打印服务用户KEY"},null,8,["modelValue"])]),_:1}),a(o,{label:"用户名",prop:"user_name"},{default:r(()=>[a(p,{modelValue:e.user_name,"onUpdate:modelValue":l[4]||(l[4]=t=>e.user_name=t),placeholder:"云打印服务用户名"},null,8,["modelValue"])]),_:1}),a(o,{label:"打印机类型",prop:"type"},{default:r(()=>[a(N,{modelValue:e.type,"onUpdate:modelValue":l[5]||(l[5]=t=>e.type=t)},{default:r(()=>[a(h,{label:"label"},{default:r(()=>[d("标签打印机")]),_:1}),a(h,{label:"ticket"},{default:r(()=>[d("小票打印机")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(o,null,{default:r(()=>[a(u,{type:"primary",onClick:B,loading:f.value},{default:r(()=>[d("保存")]),_:1},8,["loading"]),a(u,{onClick:C,disabled:!G(V),loading:b.value},{default:r(()=>[d("测试打印")]),_:1},8,["disabled","loading"]),a(u,{onClick:E},{default:r(()=>[d("取消")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},Ue=te(ie,[["__scopeId","data-v-c07b0d28"]]);export{Ue as default};
