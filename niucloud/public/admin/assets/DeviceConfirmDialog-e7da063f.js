import{d as X,r as m,R as B,h as v,s as k,w as l,a as d,t as V,e as s,i as g,Z as Y,c as _,D as H,v as ee,F as te,W as ae,C as J,u as K,dN as ie,dI as le,$ as c,ax as O,ah as ne,ay as oe,a0 as se,L as ce,aj as de,a4 as re,a1 as ue,E as ve,dU as me,ak as _e,ab as pe,V as fe,a3 as ge,p as ye,g as he}from"./index-28ce54e5.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                        *//* empty css                  *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                        */import{a as De}from"./recycle_order-836dc5c1.js";import{_ as Ce}from"./_plugin-vue_export-helper-c27b6911.js";const I=y=>(ye("data-v-fb6d362a"),y=y(),he(),y),be={class:"flex justify-between items-center"},ke={class:"text-lg font-bold"},Ve=I(()=>d("span",null,"IMEI",-1)),Ie=I(()=>d("span",{class:"text-sm text-gray-500"},"支持扫码枪输入 ",-1)),Ee={key:0,class:"imei-input-container"},Me=I(()=>d("svg",{viewBox:"0 0 1024 1024",width:"16",height:"16"},[d("path",{d:"M864 64H160C107 64 64 107 64 160v128c0 17.7 14.3 32 32 32s32-14.3 32-32V160c0-17.7 14.3-32 32-32h704c17.7 0 32 14.3 32 32v128c0 17.7 14.3 32 32 32s32-14.3 32-32V160c0-53-43-96-96-96z",fill:"currentColor"}),d("path",{d:"M864 896H160c-17.7 0-32-14.3-32-32V736c0-17.7-14.3-32-32-32s-32 14.3-32 32v128c0 53 43 96 96 96h704c53 0 96-43 96-96V736c0-17.7-14.3-32-32-32s-32 14.3-32 32v128c0 17.7-14.3 32-32 32zM640 288c0 17.7 14.3 32 32 32s32-14.3 32-32-14.3-32-32-32-32 14.3-32 32z",fill:"currentColor"}),d("path",{d:"M352 320h160c17.7 0 32-14.3 32-32s-14.3-32-32-32H352c-17.7 0-32 14.3-32 32s14.3 32 32 32zM544 704H160c-17.7 0-32-14.3-32-32V352c0-17.7 14.3-32 32-32h128c17.7 0 32-14.3 32-32s-14.3-32-32-32H160c-53 0-96 43-96 96v320c0 53 43 96 96 96h384c17.7 0 32-14.3 32-32s-14.3-32-32-32z",fill:"currentColor"}),d("path",{d:"M864.2 384c-17.7 0-32 14.3-32 32v256c0 17.7 14.3 32 32 32 17.7 0 32-14.3 32-32V416c0-17.7-14.3-32-32-32zM96 576c-17.7 0-32 14.3-32 32s14.3 32 32 32h64c17.7 0 32-14.3 32-32s-14.3-32-32-32H96zM736 576c-17.7 0-32 14.3-32 32s14.3 32 32 32h64c17.7 0 32-14.3 32-32s-14.3-32-32-32h-64z",fill:"currentColor"})],-1)),Ne={key:1},ze={key:0},Se={key:1},xe={key:0,class:"category-tip"},Be={key:0},Oe={key:0,class:"empty-data"},Ue=I(()=>d("div",null,[d("div",{class:"text-sm text-red-400"},"Tips 请将设备清点完毕后，再进行确认。")],-1)),Le={class:"dialog-footer"},Re=X({__name:"DeviceConfirmDialog",props:{visible:{type:Boolean,default:!1},deviceList:{type:Array,default:()=>[]},orderId:{type:[Number,String],required:!0}},emits:["update:visible","confirm","cancel","add-device","edit-device","remove-device"],setup(y,{emit:C}){const h=y,$=m([{id:1,name:"手机"},{id:2,name:"平板"},{id:3,name:"笔记本"},{id:4,name:"手表"},{id:5,name:"其他"}]),D=m(h.visible),a=m([]),j=m(!1),E=m(!1),U=m([]),p=m(null),b=m(null);B(()=>h.visible,e=>{D.value=e,e&&L()}),B(()=>h.deviceList,()=>{D.value&&a.value.length===0&&L()},{deep:!0});const L=()=>{try{const e=JSON.parse(JSON.stringify(h.deviceList||[]));console.log(e),a.value=e.map(t=>({...t,editing:!1,category:t.category_id||1,_originalData:null})),U.value=JSON.parse(JSON.stringify(a.value))}catch(e){console.error("设备数据同步失败:",e),a.value=[],U.value=[]}};B(D,e=>{C("update:visible",e)});const q=e=>{e.imei&&e.imei.length>0&&(De(e.imei).then(t=>{t.code===1&&t.data.name?e.model=t.data.name:c.warning("未找到设备信息,请手动输入型号")}),O(()=>{b.value&&b.value.focus&&b.value.focus()}))},A=e=>{if(e.model&&e.model.length>0){const t=a.value.findIndex(r=>r===e);t!==-1&&R(e,t)}},F=()=>{if(a.value.find(r=>r.editing)){c.warning("请先保存正在编辑的设备");return}const t={imei:"",model:"",initial_price:0,editing:!0,category:1,isNew:!0};a.value.push(t),O(()=>{p.value&&p.value.focus&&p.value.focus()})},w=(e,t)=>{if(a.value.find(n=>n.editing)){c.warning("请先保存正在编辑的设备");return}a.value[t]._originalData=JSON.parse(JSON.stringify(e)),a.value[t].editing=!0,C("edit-device",e),O(()=>{p.value&&p.value.focus&&p.value.focus()})},R=(e,t)=>{if(!e.imei||!e.model){c.warning("IMEI和型号不能为空");return}if(!e.category||e.category===0){c.warning("请选择设备分类，建议选择手机");return}a.value[t].editing=!1,a.value[t]._originalData=null,c.success("设备信息已保存")},G=(e,t)=>{if(e.isNew)a.value.splice(t,1);else if(e._originalData){const{editing:r,_originalData:n,...u}=e._originalData;Object.assign(a.value[t],u),a.value[t].editing=!1,a.value[t]._originalData=null}else a.value[t].editing=!1},P=async(e,t)=>{try{await ne.confirm("确定要删除该设备吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),a.value.splice(t,1),e.id&&C("remove-device",e),c.success("设备已删除")}catch(r){if(r==="cancel")return;console.error("删除设备失败:",r),c.error("删除失败："+(r.message||"未知错误"))}},W=async()=>{if(a.value.length===0){c.warning("请添加设备");return}if(a.value.find(n=>n.editing)){c.warning("请先保存或取消正在编辑的设备");return}if(a.value.find(n=>!n.imei||!n.model)){c.warning("请填写完整的设备信息（IMEI和型号）");return}if(a.value.find(n=>!n.category||n.category===0)){c.warning("请为所有设备选择分类，建议选择手机");return}E.value=!0;try{const n=a.value.filter(u=>!u.editing&&u.imei&&u.model).map(u=>{const M=oe(u),{editing:T,_originalData:f,isNew:N,category:z,...S}=M;return{...S,category_id:z||1}});C("confirm",{orderId:h.orderId,devices:n})}catch(n){console.error("确认提交失败:",n),c.error("提交失败，请重试")}finally{E.value=!1}};return(e,t)=>{const r=se,n=ce,u=de,M=re,T=ue,f=ve,N=me,z=_e,S=pe,Z=fe,Q=ge;return v(),k(Z,{modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=i=>D.value=i),title:"设备信息确认",width:"800",center:""},{header:l(()=>[d("div",be,[d("span",ke,"设备信息确认 , 共 "+V(a.value.length)+" 台 ",1)])]),footer:l(()=>[d("div",Le,[s(f,{type:"success",onClick:F},{default:l(()=>[g("添加设备")]),_:1}),s(f,{type:"primary",onClick:W,loading:E.value},{default:l(()=>[g(" 确认并签收 ")]),_:1},8,["loading"])])]),default:l(()=>[Y((v(),k(z,{data:a.value,border:""},{default:l(()=>[s(u,null,{header:l(()=>[Ve,Ie]),default:l(({row:i})=>[i.editing?(v(),_("div",Ee,[s(n,{modelValue:i.imei,"onUpdate:modelValue":o=>i.imei=o,placeholder:"请输入或扫描IMEI",ref_key:"imeiInputRef",ref:p,autofocus:"",onKeydown:H(o=>q(i),["enter"]),class:"imei-input"},{suffix:l(()=>[s(r,{title:"支持扫码枪输入",class:"scanner-icon"},{default:l(()=>[Me]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onKeydown"])])):(v(),_("span",Ne,V(i.imei),1))]),_:1}),s(u,{label:"型号"},{default:l(({row:i})=>[i.editing?(v(),_("div",ze,[s(n,{modelValue:i.model,"onUpdate:modelValue":o=>i.model=o,placeholder:"请输入型号",ref_key:"modelInputRef",ref:b,onKeydown:H(o=>A(i),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeydown"])])):(v(),_("span",Se,V(i.model),1))]),_:1}),s(u,{label:"设备分类"},{default:l(({row:i})=>[s(T,{modelValue:i.category,"onUpdate:modelValue":o=>i.category=o,placeholder:"请选择设备分类",class:ee({"category-required":!i.category||i.category===0})},{default:l(()=>[(v(!0),_(te,null,ae($.value,o=>(v(),k(M,{key:o.id,label:o.name,value:o.id},{default:l(()=>[d("span",null,V(o.name),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","class"]),!i.category||i.category===0?(v(),_("div",xe," 请选择分类，建议选择手机 ")):J("",!0)]),_:1}),s(u,{label:"操作",width:"160"},{default:l(({row:i,$index:o})=>[i.editing?(v(),_("div",Be,[s(N,null,{default:l(()=>[s(f,{type:"success",size:"small",onClick:x=>R(i,o)},{default:l(()=>[g(" 保存 ")]),_:2},1032,["onClick"]),s(f,{type:"info",size:"small",onClick:x=>G(i,o)},{default:l(()=>[g(" 取消 ")]),_:2},1032,["onClick"])]),_:2},1024)])):(v(),k(N,{key:1},{default:l(()=>[s(f,{type:"primary",size:"small",icon:K(ie),onClick:x=>w(i,o)},{default:l(()=>[g(" 编辑 ")]),_:2},1032,["icon","onClick"]),s(f,{type:"danger",size:"small",icon:K(le),onClick:x=>P(i,o)},{default:l(()=>[g(" 删除 ")]),_:2},1032,["icon","onClick"])]),_:2},1024))]),_:1})]),_:1},8,["data"])),[[Q,j.value]]),a.value.length===0?(v(),_("div",Oe,[s(S,null,{default:l(()=>[Ue]),_:1})])):J("",!0)]),_:1},8,["modelValue"])}}});const at=Ce(Re,[["__scopeId","data-v-fb6d362a"]]);export{at as default};
