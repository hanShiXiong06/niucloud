import{d as $e,r as u,n as Te,f as Le,R as oe,a5 as se,h as d,c as k,e as t,w as l,a as c,u as n,q as o,s as f,C as D,F as N,W as q,i as p,t as r,v as Ue,Z as Me,B as je,cM as Ae,cW as Be,cX as Ye,cY as ze,cZ as Re,T as ne,j as ie,$ as Ne,ah as qe,c_ as He,c$ as Oe,d0 as Ge,d1 as Je,L as Qe,M as We,a4 as Ze,a1 as Xe,bV as Ke,E as ea,N as aa,a0 as ta,b9 as la,b7 as oa,a9 as sa,aj as na,as as ia,ak as ra,a2 as ca,V as da,a3 as ua}from"./index-9cfed1fc.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                *//* empty css                  *//* empty css                *//* empty css                  *//* empty css                       */import"./el-form-item-4ed993c7.js";import{_ as pa}from"./site_default-a8703942.js";import{J as re}from"./notice-840d1ff0.js";import{_ as ma}from"./edit-site.vue_vue_type_script_setup_true_lang-eed60f71.js";import{a as _a}from"./addon-8efce1c8.js";import{_ as fa}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                  */import"./member_head-d9fd7b2c.js";import"./user-9d7f6a26.js";const va={class:"main-container"},ha={class:"flex justify-between items-start"},ga={class:"flex justify-end items-center flex-1"},ya={class:"right-btn-group"},wa={class:"text-[14px] mr-[10px] flex items-center"},ka={class:"mt-[20px]"},xa={class:"flex items-center"},ba=["src"],Ca={key:1,class:"w-[54px] h-[54px] mr-[10px] rounded-[4px]",src:pa,alt:""},Va={class:"flex flex-col"},Sa={class:"flex items-center"},Pa={class:"flex flex-col"},Ia={key:0},Da={key:1},Ea={class:"operation-buttons"},Fa={class:"button-row"},$a={class:"button-row"},Ta={class:"mt-[16px] flex justify-end"},La={class:"flex items-center"},Ua=["src"],Ma={class:"dialog-footer"},ja={class:"flex items-center"},Aa=["src"],Ba={class:"dialog-footer"},Ya=$e({__name:"list",props:{status:{type:String,default:""}},setup(ce){const de=ce,E=u(5),M=u(!1);let T=null;const F=u(5),j=u(!1);let L=null;const C=u(!1),ue=()=>{E.value=5,M.value=!1,T&&clearInterval(T),T=setInterval(()=>{E.value>0?E.value--:(M.value=!0,clearInterval(T))},1e3)},pe=()=>{F.value=5,j.value=!1,L&&clearInterval(L),L=setInterval(()=>{F.value>0?F.value--:(j.value=!0,clearInterval(L))},1e3)},V=u({all:[]}),b=u(!1),H=u([]),i=Te({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{keywords:"",group_id:"",app:"all",status:"",site_domain:"",create_time:[],expire_time:[]}});i.searchParam.status=de.status||"",(async()=>{const s=await(await Ae({})).data;V.value.all=s,s.forEach((a,y)=>{V.value[a.app]||(V.value[a.app]=[]),V.value[a.app].push(a)})})();const U=u(0),O=()=>{Be().then(({data:s})=>{U.value=s.is_allow;let a=!!U.value;localStorage.setItem("isAllowChange",a.toString())})};O();const me=s=>{Ye({is_allow:s?1:0}).then(()=>{O()})};(async()=>{H.value=await(await ze()).data})();const G=u(),_e=s=>{s&&(s.resetFields(),v())},fe=()=>{i.searchParam.group_id=""},J=u([]);_a().then(({data:s})=>{J.value=s}).catch();const v=(s=1)=>{i.loading=!0,i.page=s,i.searchParam.app=i.searchParam.app=="all"?"":i.searchParam.app,Re({page:i.page,limit:i.limit,...i.searchParam}).then(a=>{i.loading=!1,i.data=a.data.data,i.total=a.data.total}).catch(()=>{i.loading=!1})};v();const Q=Le(),$=u(null),ve=s=>{$.value.setFormData(),$.value.showDialog=!0},he=s=>{Q.push({path:"/admin/site/info",query:{id:s.site_id}})},ge=s=>{$.value.setFormData(s),$.value.showDialog=!0},W=(s=0)=>{if(window.localStorage.setItem("site.token",ne()),window.localStorage.setItem("site.comparisonTokenStorage",ne()),window.localStorage.setItem("site.userinfo",JSON.stringify(ie().userInfo)),s){const a=ie().userInfo;if(a.is_super_admin!=null&&!a.is_super_admin&&(a.site_ids||[]).indexOf(s)==-1){Ne({message:o("noPermission"),type:"warning"});return}window.localStorage.setItem("site.siteId",s),window.localStorage.setItem("site.comparisonSiteIdStorage",s),window.open(`${location.origin}/site/`)}else Q.push({path:"/home/index"})},ye=(s,a)=>{s==1&&qe.confirm(o("closeSiteTips"),o("warning"),{confirmButtonText:o("confirm"),cancelButtonText:o("cancel"),type:"warning"}).then(()=>{He({site_id:a}).then(y=>{v()})}),s==3&&Oe({site_id:a}).then(y=>{v()})},S=u(!1),Z=u({}),P=u(!1),X=u({}),K=u(),h=u({captcha_code:"",captcha_key:"",captcha_img:""}),ee=u(),g=u({captcha_code:"",captcha_key:"",captcha_img:""});oe(S,s=>{s&&(ue(),A())}),oe(P,s=>{s&&(pe(),B())});const A=()=>{re().then(s=>{h.value.captcha_key=s.data.captcha_key,h.value.captcha_img=s.data.img,h.value.captcha_code=""}).catch(()=>{})},B=()=>{re().then(s=>{g.value.captcha_key=s.data.captcha_key,g.value.captcha_img=s.data.img,g.value.captcha_code=""}).catch(()=>{})},we=s=>{S.value=!0,Z.value=s},ke=s=>{P.value=!0,X.value=s},xe=()=>{K.value.validate(s=>{if(!s)return;C.value=!0;const a={site_id:Z.value.site_id,captcha_code:h.value.captcha_code,captcha_key:h.value.captcha_key};Ge(a).then(y=>{v(),S.value=!1}).catch(()=>{A()}).finally(()=>{C.value=!1})})},be=()=>{ee.value.validate(s=>{if(!s)return;C.value=!0;const a={site_id:X.value.site_id,captcha_code:g.value.captcha_code,captcha_key:g.value.captcha_key};Je(a).then(y=>{v(),P.value=!1}).catch(()=>{B()}).finally(()=>{C.value=!1})})};return(s,a)=>{const y=Qe,w=We,I=Ze,Y=Xe,ae=Ke,m=ea,z=aa,Ce=se("QuestionFilled"),Ve=ta,Se=la,Pe=oa,Ie=se("tempalte"),te=sa,x=na,R=ia,De=ra,Ee=ca,le=da,Fe=ua;return d(),k("div",va,[t(te,{class:"box-card !border-none setting-card",shadow:"never"},{default:l(()=>[t(te,{class:"box-card !border-none my-[10px] table-search-wrap",shadow:"never"},{default:l(()=>[c("div",ha,[t(z,{inline:!0,model:i.searchParam,ref_key:"searchFormRef",ref:G,class:"search-form"},{default:l(()=>[t(w,{prop:"keywords"},{default:l(()=>[t(y,{modelValue:i.searchParam.keywords,"onUpdate:modelValue":a[0]||(a[0]=e=>i.searchParam.keywords=e),modelModifiers:{trim:!0},placeholder:n(o)("siteNamePlaceholder")},null,8,["modelValue","placeholder"])]),_:1}),b.value?(d(),f(w,{key:0,prop:"site_domain"},{default:l(()=>[t(y,{modelValue:i.searchParam.site_domain,"onUpdate:modelValue":a[1]||(a[1]=e=>i.searchParam.site_domain=e),modelModifiers:{trim:!0},placeholder:n(o)("siteDomainPlaceholder")},null,8,["modelValue","placeholder"])]),_:1})):D("",!0),t(w,{prop:"app"},{default:l(()=>[t(Y,{modelValue:i.searchParam.app,"onUpdate:modelValue":a[2]||(a[2]=e=>i.searchParam.app=e),clearable:"",onChange:fe,placeholder:n(o)("appIdPlaceholder"),class:"input-width"},{default:l(()=>[t(I,{label:n(o)("selectPlaceholder"),value:"all"},null,8,["label"]),(d(!0),k(N,null,q(Object.values(J.value),(e,_)=>(d(),f(I,{label:e.title,value:e.key,key:_},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1}),t(w,{prop:"group_id"},{default:l(()=>[t(Y,{modelValue:i.searchParam.group_id,"onUpdate:modelValue":a[3]||(a[3]=e=>i.searchParam.group_id=e),clearable:"",placeholder:n(o)("groupIdPlaceholder"),class:"input-width"},{default:l(()=>[t(I,{label:n(o)("selectPlaceholder"),value:""},null,8,["label"]),(d(!0),k(N,null,q(V.value.all,(e,_)=>(d(),f(I,{label:e.group_name,value:e.group_id,key:_},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1}),t(w,{prop:"status"},{default:l(()=>[t(Y,{modelValue:i.searchParam.status,"onUpdate:modelValue":a[4]||(a[4]=e=>i.searchParam.status=e),clearable:"",placeholder:n(o)("请选择状态"),class:"input-width"},{default:l(()=>[t(I,{label:n(o)("selectPlaceholder"),value:""},null,8,["label"]),(d(!0),k(N,null,q(H.value,(e,_)=>(d(),f(I,{label:e,value:_,key:_},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1}),b.value?(d(),f(w,{key:1,prop:"create_time"},{default:l(()=>[t(ae,{modelValue:i.searchParam.create_time,"onUpdate:modelValue":a[5]||(a[5]=e=>i.searchParam.create_time=e),type:"datetimerange","value-format":"YYYY-MM-DD HH:mm:ss","start-placeholder":n(o)("startDate"),"end-placeholder":n(o)("endDate")},null,8,["modelValue","start-placeholder","end-placeholder"])]),_:1})):D("",!0),b.value?(d(),f(w,{key:2,prop:"expire_time"},{default:l(()=>[t(ae,{modelValue:i.searchParam.expire_time,"onUpdate:modelValue":a[6]||(a[6]=e=>i.searchParam.expire_time=e),type:"datetimerange","value-format":"YYYY-MM-DD HH:mm:ss","start-placeholder":n(o)("startDate"),"end-placeholder":n(o)("endDate")},null,8,["modelValue","start-placeholder","end-placeholder"])]),_:1})):D("",!0),t(w,null,{default:l(()=>[t(m,{type:"primary",onClick:a[7]||(a[7]=e=>v())},{default:l(()=>[p(r(n(o)("search")),1)]),_:1}),t(m,{onClick:a[8]||(a[8]=e=>_e(G.value))},{default:l(()=>[p(r(n(o)("reset")),1)]),_:1}),t(m,{type:"primary",link:"",onClick:a[9]||(a[9]=e=>b.value=!b.value)},{default:l(()=>[p(r(b.value?n(o)("收起"):n(o)("更多"))+" ",1),c("span",{class:Ue(["iconfont iconjiantouxia ml-[4px] !text-[10px] mr-[10px] transition-transform duration-300",{"rotate-180":b.value}])},null,2)]),_:1})]),_:1})]),_:1},8,["model"]),c("div",ga,[c("div",ya,[t(Ie,{class:"flex items-center"},{default:l(()=>[t(Se,{class:"box-item",effect:"dark",content:"前台用户登录某站点后，是否允许切换至站点管理列表或进入其他站点",placement:"top-start"},{default:l(()=>[c("span",wa,[p("允许切换站点 "),t(Ve,null,{default:l(()=>[t(Ce)]),_:1})])]),_:1}),t(Pe,{modelValue:U.value,"onUpdate:modelValue":a[10]||(a[10]=e=>U.value=e),onChange:me,lazy:"",class:"mr-[25px]","active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),t(m,{type:"primary",class:"w-[100px]",onClick:ve},{default:l(()=>[p(r(n(o)("addSite")),1)]),_:1}),t(m,{class:"w-[100px]",onClick:a[11]||(a[11]=e=>W())},{default:l(()=>[p(r(n(o)("toSite")),1)]),_:1})])])])]),_:1}),c("div",ka,[Me((d(),f(De,{data:i.data,size:"large"},{empty:l(()=>[c("span",null,r(i.loading?"":n(o)("emptyData")),1)]),default:l(()=>[t(x,{prop:"site_id",label:n(o)("siteId"),width:"100","show-overflow-tooltip":!0},null,8,["label"]),t(x,{label:n(o)("siteInfo"),width:"300",align:"left"},{default:l(({row:e})=>[c("div",xa,[e.logo?(d(),k("img",{key:0,class:"w-[54px] h-[54px] mr-[10px] rounded-[4px]",src:n(je)(e.logo),alt:""},null,8,ba)):(d(),k("img",Ca)),c("div",Va,[c("span",null,r(e.site_name||""),1)])])]),_:1},8,["label"]),t(x,{label:n(o)("manager"),width:"150",align:"left"},{default:l(({row:e})=>[c("div",Sa,[c("div",Pa,[c("span",null,r(e.admin.username||""),1)])])]),_:1},8,["label"]),t(x,{prop:"group_name",label:n(o)("groupId"),width:"150","show-overflow-tooltip":!0},null,8,["label"]),t(x,{prop:"site_domain",label:n(o)("siteDomain"),width:"250","show-overflow-tooltip":!0},null,8,["label"]),t(x,{prop:"create_time",label:n(o)("createTime"),width:"200","show-overflow-tooltip":!0},null,8,["label"]),t(x,{prop:"expire_time",label:n(o)("expireTime"),width:"200","show-overflow-tooltip":!0},{default:l(({row:e})=>[e.expire_time==0?(d(),k("div",Ia,"永久")):(d(),k("div",Da,r(e.expire_time),1))]),_:1},8,["label"]),t(x,{label:n(o)("status"),width:"100",align:"center"},{default:l(({row:e})=>[e.status==1?(d(),f(R,{key:0,class:"ml-2",type:"success"},{default:l(()=>[p(r(e.status_name),1)]),_:2},1024)):e.status==3?(d(),f(R,{key:1,class:"ml-2",type:"error"},{default:l(()=>[p(r(e.status_name),1)]),_:2},1024)):(d(),f(R,{key:2,class:"ml-2",type:"error"},{default:l(()=>[p(r(e.status_name),1)]),_:2},1024))]),_:1},8,["label"]),t(x,{label:n(o)("operation"),"min-width":"250",align:"right",fixed:"right"},{default:l(({row:e})=>[c("div",Ea,[c("div",Fa,[t(m,{type:"primary",link:"",onClick:_=>W(e.site_id)},{default:l(()=>[p(r(n(o)("toSite")),1)]),_:2},1032,["onClick"]),e.status==1||e.status==3?(d(),f(m,{key:0,type:"primary",link:"",onClick:_=>ye(e.status,e.site_id)},{default:l(()=>[p(r(e.status==1?n(o)("closeTxt"):n(o)("openTxt")),1)]),_:2},1032,["onClick"])):D("",!0),t(m,{type:"primary",link:"",onClick:_=>he(e)},{default:l(()=>[p(r(n(o)("info")),1)]),_:2},1032,["onClick"])]),c("div",$a,[t(m,{type:"primary",link:"",onClick:_=>ke(e)},{default:l(()=>[p(r(n(o)("站点初始化")),1)]),_:2},1032,["onClick"]),t(m,{type:"primary",link:"",onClick:_=>ge(e)},{default:l(()=>[p(r(n(o)("edit")),1)]),_:2},1032,["onClick"]),t(m,{type:"primary",link:"",onClick:_=>we(e)},{default:l(()=>[p(r(n(o)("delete")),1)]),_:2},1032,["onClick"])])])]),_:1},8,["label"])]),_:1},8,["data"])),[[Fe,i.loading]]),c("div",Ta,[t(Ee,{"current-page":i.page,"onUpdate:current-page":a[12]||(a[12]=e=>i.page=e),"page-size":i.limit,"onUpdate:page-size":a[13]||(a[13]=e=>i.limit=e),layout:"total, sizes, prev, pager, next, jumper",total:i.total,onSizeChange:a[14]||(a[14]=e=>v()),onCurrentChange:v},null,8,["current-page","page-size","total"])])])]),_:1}),t(ma,{ref_key:"addSiteDialog",ref:$,onComplete:a[15]||(a[15]=e=>v())},null,512),t(le,{modelValue:S.value,"onUpdate:modelValue":a[18]||(a[18]=e=>S.value=e),title:n(o)("warning"),width:"500px","destroy-on-close":!0},{footer:l(()=>[c("span",Ma,[t(m,{onClick:a[17]||(a[17]=e=>S.value=!1)},{default:l(()=>[p(r(n(o)("cancel")),1)]),_:1}),t(m,{type:"primary",onClick:xe,disabled:!M.value,loading:C.value},{default:l(()=>[p(r(n(o)("confirm")+(E.value>0?` (${E.value}s)`:"")),1)]),_:1},8,["disabled","loading"])])]),default:l(()=>[c("div",null,r(n(o)("siteDeleteTips")),1),t(z,{model:h.value,ref_key:"captchaFormRef",ref:K,class:"mt-4"},{default:l(()=>[t(w,{label:"验证码",prop:"captcha_code",rules:[{required:!0,message:"请输入验证码",trigger:"blur"}]},{default:l(()=>[c("div",La,[t(y,{placeholder:"请输入验证码",class:"w-[200px]",maxlength:"4","show-word-limit":"",modelValue:h.value.captcha_code,"onUpdate:modelValue":a[16]||(a[16]=e=>h.value.captcha_code=e)},null,8,["modelValue"]),h.value.captcha_img?(d(),k("img",{key:0,src:h.value.captcha_img,alt:"验证码",class:"w-[100px] h-[32px] cursor-pointer ml-[10px]",onClick:A},null,8,Ua)):D("",!0)])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(le,{modelValue:P.value,"onUpdate:modelValue":a[21]||(a[21]=e=>P.value=e),title:n(o)("warning"),width:"500px","destroy-on-close":!0},{footer:l(()=>[c("span",Ba,[t(m,{onClick:a[20]||(a[20]=e=>P.value=!1)},{default:l(()=>[p(r(n(o)("cancel")),1)]),_:1}),t(m,{type:"primary",onClick:be,disabled:!j.value,loading:C.value},{default:l(()=>[p(r(n(o)("confirm")+(F.value>0?` (${F.value}s)`:"")),1)]),_:1},8,["disabled","loading"])])]),default:l(()=>[c("div",null,r(n(o)("siteInitTips")),1),t(z,{model:g.value,ref_key:"initCaptchaFormRef",ref:ee,class:"mt-4"},{default:l(()=>[t(w,{label:"验证码",prop:"captcha_code",rules:[{required:!0,message:"请输入验证码",trigger:"blur"}]},{default:l(()=>[c("div",ja,[t(y,{placeholder:"请输入验证码",class:"w-[200px]",maxlength:"4","show-word-limit":"",modelValue:g.value.captcha_code,"onUpdate:modelValue":a[19]||(a[19]=e=>g.value.captcha_code=e)},null,8,["modelValue"]),g.value.captcha_img?(d(),k("img",{key:0,src:g.value.captcha_img,alt:"验证码",class:"w-[100px] h-[32px] cursor-pointer ml-[10px]",onClick:B},null,8,Aa)):D("",!0)])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const gt=fa(Ya,[["__scopeId","data-v-74d2c84c"]]);export{gt as default};
