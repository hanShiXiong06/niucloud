import{f as A,r as c,aZ as F,h as _,c as G,Z as X,s as y,w as t,a as m,e as a,i as n,t as C,C as j,ah as R,$ as x,E as q,ab as H,as as J,aj as K,b7 as O,ak as Q,a9 as W,L as Y,M as ee,N as te,V as ae,a3 as le,p as se,g as ne}from"./index-28ce54e5.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                  *//* empty css                        *//* empty css               *//* empty css                 *//* empty css                  */import{c as oe,d as re,e as ie,t as ce}from"./printer-81c32d8c.js";import{_ as de}from"./_plugin-vue_export-helper-c27b6911.js";const ue=f=>(se("data-v-e26c1efc"),f=f(),ne(),f),pe={class:"printer-list-wrap"},_e={class:"card-header"},me=ue(()=>m("span",null,"打印机管理",-1)),fe={class:"printer-name"},ve={class:"dialog-footer"},ye={__name:"list",setup(f){const b=A(),h=c([]),i=c(!1),g=c(!1),d=c(!1),u=c(null),v=c({content:`<PAGE>
                    <SIZE>40,30</SIZE>
                    <TEXT x="8" y="8" w="1" h="1" r="0">
                    这是由 芯烨云 打印的标签 后台默认（测试标签），
                    </TEXT>
                    </PAGE`}),E=async()=>{try{i.value=!0;const e=await oe();e.code===1&&e.data&&e.data.data&&(h.value=e.data.data.map(s=>({...s,statusLoading:!1})))}catch(e){console.error("获取打印机列表失败",e)}finally{i.value=!1}},k=()=>{b.push("/recycle/printer/add")},V=e=>{b.push(`/recycle/printer/edit/${e.printer_id}`)},w=e=>{R.confirm(`确定要删除打印机"${e.printer_name}"吗？删除后无法恢复。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{i.value=!0,(await re(e.printer_id)).code===1&&await E()}catch(s){console.error("删除打印机失败",s)}finally{i.value=!1}}).catch(()=>{})},T=async e=>{try{e.statusLoading=!0,(await ie(e.printer_id,e.status)).code===1?e.status&&await E():e.status=e.status?0:1}catch(s){console.error("切换打印机状态失败",s),e.status=e.status?0:1}finally{e.statusLoading=!1}},L=e=>{if(!e.status){x.warning("请先激活打印机");return}u.value=e,d.value=!0},S=async()=>{if(!u.value){x.warning("请选择要测试的打印机");return}try{g.value=!0,(await ce({sn:u.value.sn,user_name:u.value.user_name,user_key:u.value.user_key,content:v.value.content})).code===1&&(d.value=!1)}catch(e){console.error("测试打印失败",e)}finally{g.value=!1}};return F(()=>{E()}),(e,s)=>{const o=q,B=H,I=J,r=K,P=O,$=Q,U=W,D=Y,N=ee,z=te,M=ae,Z=le;return _(),G("div",pe,[X((_(),y(U,{class:"box-card"},{header:t(()=>[m("div",_e,[me,a(o,{type:"primary",onClick:k},{default:t(()=>[n("添加打印机")]),_:1})])]),default:t(()=>[h.value.length===0&&!i.value?(_(),y(B,{key:0,description:"暂无打印机"},{default:t(()=>[a(o,{type:"primary",onClick:k},{default:t(()=>[n("添加打印机")]),_:1})]),_:1})):(_(),y($,{key:1,data:h.value,style:{width:"100%"},border:""},{default:t(()=>[a(r,{prop:"printer_name",label:"打印机名称","min-width":"120"},{default:t(({row:l})=>[m("div",fe,[m("span",null,C(l.printer_name),1),l.is_default?(_(),y(I,{key:0,type:"success",size:"small",style:{"margin-left":"8px"}},{default:t(()=>[n("当前使用")]),_:1})):j("",!0)])]),_:1}),a(r,{prop:"brand_name",label:"品牌",width:"100"}),a(r,{prop:"type_name",label:"类型",width:"100"},{default:t(({row:l})=>[n(C(l.type_name||"标签打印机"),1)]),_:1}),a(r,{prop:"sn",label:"序列号","min-width":"150"}),a(r,{prop:"status",label:"状态",width:"80"},{default:t(({row:l})=>[a(P,{modelValue:l.status,"onUpdate:modelValue":p=>l.status=p,"active-value":1,"inactive-value":0,onChange:p=>T(l),loading:l.statusLoading},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),_:1}),a(r,{prop:"create_time",label:"添加时间",width:"160"}),a(r,{label:"操作",width:"200",fixed:"right"},{default:t(({row:l})=>[a(o,{type:"primary",size:"small",onClick:p=>L(l)},{default:t(()=>[n("测试")]),_:2},1032,["onClick"]),a(o,{type:"warning",size:"small",onClick:p=>V(l)},{default:t(()=>[n("编辑")]),_:2},1032,["onClick"]),a(o,{type:"danger",size:"small",onClick:p=>w(l)},{default:t(()=>[n("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]))]),_:1})),[[Z,i.value]]),a(M,{modelValue:d.value,"onUpdate:modelValue":s[2]||(s[2]=l=>d.value=l),title:"测试打印",width:"500px"},{footer:t(()=>[m("span",ve,[a(o,{onClick:s[1]||(s[1]=l=>d.value=!1)},{default:t(()=>[n("取 消")]),_:1}),a(o,{type:"primary",onClick:S,loading:g.value},{default:t(()=>[n("测试打印")]),_:1},8,["loading"])])]),default:t(()=>[a(z,{model:v.value,"label-width":"100px"},{default:t(()=>[a(N,{label:"打印内容"},{default:t(()=>[a(D,{modelValue:v.value.content,"onUpdate:modelValue":s[0]||(s[0]=l=>v.value.content=l),type:"textarea",rows:3,placeholder:"请输入测试打印内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Me=de(ye,[["__scopeId","data-v-e26c1efc"]]);export{Me as default};
