import{d as Ut,y as Rt,r as u,l as pe,n as De,aZ as $t,h as _,c as S,e as o,w as n,a as s,u as p,dW as Ot,i as b,Z as Ee,dX as Nt,F as X,W as ee,s as y,bb as ve,t as m,dY as Te,Y as fe,dp as jt,_ as Ft,dr as Yt,C as D,dZ as Ve,dF as Se,dK as Ie,dN as Ht,dP as Me,d_ as Jt,dA as Ae,dJ as Qt,B as Wt,$ as c,du as Zt,ah as B,bE as te,bh as qt,E as Gt,a0 as Kt,L as Xt,a4 as ea,a1 as ta,bV as aa,N as sa,dT as ia,aH as la,d$ as ra,aI as oa,aj as na,as as ca,dU as da,ak as ua,cQ as _a,a2 as ma,a9 as pa,ae as va,af as fa,V as ga,a3 as ya,p as ha,g as ba,e0 as xa,e1 as ka,dt as Ca,e2 as wa}from"./index-28ce54e5.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                         *//* empty css                *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                        *//* empty css                    *//* empty css                 */import Da from"./CheckDeviceDialog-ba81649e.js";/* empty css                *//* empty css                       *//* empty css                  */import{u as Ea}from"./usePageState-a359535e.js";import{d as Ta,e as Va,f as Sa,b as ae,h as Ia,i as Ma,j as ge,k as Aa,l as za,m as ze,n as La,p as Ba,o as Pa}from"./recycle_order-836dc5c1.js";import{d as Ua}from"./device_query_api-f0f16bfa.js";import{_ as Ra}from"./printer-81c32d8c.js";import $a from"./AddOrderDialog-39430724.js";import Oa from"./PaymentMethodDialog-e054831b.js";import Na from"./OrderDetailDialog-53264be0.js";import ja from"./PriceFormDialog-3527153f.js";import Fa from"./DeviceConfirmDialog-e7da063f.js";import Ya from"./DeviceDetailDialog-404d314a.js";import Ha from"./index-aa3445f1.js";import{_ as Ja}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-16133bab.js";/* empty css                        */import"./index.vue_vue_type_style_index_0_lang-36d764c9.js";import"./attachment-6a2633f2.js";import"./index.vue_vue_type_script_setup_true_lang-101fc01a.js";import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css                  *//* empty css                    *//* empty css                         */import"./index.vue_vue_type_script_setup_true_lang-e5b6971a.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-83b7ba07.js";import"./sortable.esm-be94e56d.js";/* empty css                  *//* empty css                        */import"./browser-a1ac24ac.js";import"./WarrantyInfoDisplay-fbb9d7b5.js";/* empty css                       *//* empty css                 *//* empty css                 *//* empty css                        *//* empty css                         *//* empty css                   *//* empty css                             */import"./member-fc2e9a4b.js";const h=J=>(ha("data-v-277457e7"),J=J(),ba(),J),Qa={class:"recycle-order-list h-full"},Wa={class:"flex justify-between items-center mb-4"},Za=h(()=>s("span",{class:"text-xl font-semibold text-gray-800"},"ğŸ“± å›æ”¶è®¢å•ç®¡ç†",-1)),qa={class:"btn-wrap"},Ga={class:"mb-6 sticky top-30 z-50 bg-white/95 backdrop-blur-sm shadow-lg rounded-lg p-2 -mx-2"},Ka=h(()=>s("div",{class:"mb-4"},[s("div",{class:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100 shadow-sm hover:shadow-md transition-all duration-300"})],-1)),Xa={class:"bg-gradient-to-br from-orange-50 to-amber-50 rounded-xl border border-orange-100 shadow-sm"},es={class:"bg-gradient-to-r from-orange-100 to-amber-100 px-5 py-3 rounded-t-xl border-b border-orange-200"},ts={class:"flex items-center"},as={class:"w-8 h-8 bg-orange-200 rounded-full flex items-center justify-center mr-3"},ss=h(()=>s("span",{class:"font-semibold text-orange-800"},"é«˜çº§æœç´¢æ¡ä»¶",-1)),is={class:"p-6"},ls={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6"},rs={class:"space-y-2"},os=h(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"è®¢å•ç¼–å·",-1)),ns={class:"space-y-2"},cs=h(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"å¿«é€’å•å·",-1)),ds={class:"space-y-2"},us=h(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"è®¢å•çŠ¶æ€",-1)),_s={class:"flex items-center justify-between"},ms={class:"flex items-center"},ps={class:"text-xs text-gray-400"},vs={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6"},fs={class:"space-y-2"},gs=h(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"ç”¨æˆ·æœç´¢",-1)),ys={class:"relative"},hs={class:"absolute right-7 top-1/2 transform -translate-y-1/2 text-blue-400 pointer-events-none"},bs={class:"space-y-2"},xs=h(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"é…é€æ–¹å¼",-1)),ks=h(()=>s("div",{class:"flex items-center justify-between"},[s("div",{class:"flex items-center"},[s("span",{class:"mr-2"},"ğŸ“¦"),s("span",null,"å¿«é€’é…é€")]),s("span",{class:"text-xs text-gray-400"},"ç”¨æˆ·é‚®å¯„è®¾å¤‡")],-1)),Cs=h(()=>s("div",{class:"flex items-center justify-between"},[s("div",{class:"flex items-center"},[s("span",{class:"mr-2"},"ğŸš—"),s("span",null,"è‡ªé€åˆ°åº—")]),s("span",{class:"text-xs text-gray-400"},"ç”¨æˆ·ä¸Šé—¨äº¤ä»˜")],-1)),ws={class:"space-y-2"},Ds=h(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"è®¾å¤‡IMEI",-1)),Es={class:"space-y-2"},Ts=h(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"è®¾å¤‡å‹å·",-1)),Vs={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},Ss={class:"space-y-2"},Is=h(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"åˆ›å»ºæ—¶é—´",-1)),Ms={class:"flex justify-center pt-4 border-t border-orange-200"},As={class:"flex gap-3"},zs={class:"flex items-center"},Ls=h(()=>s("span",null,"å…¨éƒ¨",-1)),Bs={class:"flex items-center"},Ps={class:"device-expansion-panel"},Us={class:"panel-header mb-3"},Rs=h(()=>s("h4",{class:"text-lg font-medium text-gray-800"},"ğŸ“± è®¾å¤‡åˆ—è¡¨",-1)),$s={class:"text-sm text-gray-500"},Os={class:"price-text"},Ns={key:0,class:"flex justify-end mt-3"},js={class:"order-info-cell"},Fs={class:"info-row"},Ys=h(()=>s("span",{class:"label"},"è®¢å•å·ï¼š",-1)),Hs={class:"value"},Js={class:"info-row"},Qs=h(()=>s("span",{class:"label"},"é…é€ï¼š",-1)),Ws={class:"value"},Zs={key:0,class:"info-row"},qs=h(()=>s("span",{class:"text-gray-500 text-xs min-w-16"},"å¿«é€’å•å·ï¼š",-1)),Gs=["onClick"],Ks={key:0,class:"font-mono font-medium"},Xs={class:"user-info-cell"},ei={class:"user-avatar"},ti={class:"user-details"},ai={class:"user-name"},si={class:"user-phone"},ii=h(()=>s("div",{class:"text-xs"},"æäº¤æ•°é‡/ç­¾æ”¶æ•°é‡",-1)),li={class:"flex justify-between items-center mt-4"},ri={class:"text-sm text-gray-500"},oi={key:0,class:"express-info-container"},ni={class:"express-header mb-4"},ci={class:"flex items-center justify-between"},di={class:"text-lg font-medium"},ui={class:"text-sm text-gray-600"},_i={class:"mt-2"},mi={class:"text-sm text-gray-600"},pi={class:"text-xs text-gray-500"},vi={class:"express-trace"},fi=h(()=>s("h4",{class:"text-md font-medium mb-3"},"ç‰©æµè½¨è¿¹",-1)),gi={class:"trace-item"},yi={class:"trace-location"},hi={class:"trace-desc"},bi={key:1,class:"text-center py-8 text-gray-500"},xi=Ut({__name:"list copy",setup(J){Rt();const R=u({}),se=u(!1),M=u([]),{expandedRows:Le,pagination:f,setExpandedRows:Be,setPagination:A,applyExpandedRows:ki}=Ea("recycle_order_list"),Pe=pe(()=>Le.value||[]),z=u(!1),Q=u(!1),$=u(0),E=u([]),ie=u(!1),ye=u(null);u([]);const L=u([]),W=u(0),Z=u({}),le=u(!1),I=u(null),Ue=u(null),P=u(null),Re=()=>{E.value.push({imei:"",model:"",initial_price:0,editing:!0,category_id:1})},$e=t=>{const e=E.value.findIndex(l=>l===t||l.id===t.id);e!==-1&&(E.value[e].editing=!0)},Oe=async t=>{try{t.id&&(await Ta(t.id),c.success("åˆ é™¤æˆåŠŸ"),await g(),z.value=!1),E.value=E.value.filter(e=>e!==t&&e.id!==t.id)}catch(e){console.error("åˆ é™¤è®¾å¤‡å¤±è´¥ï¼š",e),c.error("åˆ é™¤å¤±è´¥ï¼š"+(e.message||"æœªçŸ¥é”™è¯¯"))}},Ne=()=>{z.value=!1,E.value=[],$.value=0},T=De({keyword:"",status:"",delivery_type:""}),r=De({order_id:"",express_no:"",status:[],member_id:"",user_mobile:"",delivery_type:[],device_imei:"",device_model:"",device_count_min:null,device_count_max:null,amount_min:null,amount_max:null,create_time_range:[],update_time_range:[]}),je=u(!1),Fe=async()=>{try{const t=await Va();t.code===1&&(R.value=t.data)}catch(t){console.error("è·å–çŠ¶æ€åˆ—è¡¨å¤±è´¥:",t)}},Ye=u(null),g=async(t=1)=>{se.value=!0;try{const e={page:f.value.page,limit:f.value.limit};T.keyword&&(e.keyword=T.keyword),T.status&&(e.status=T.status),T.delivery_type&&(e.delivery_type=T.delivery_type),r.order_id&&(e.order_id=r.order_id),r.express_no&&(e.express_no=r.express_no),r.status&&r.status.length>0&&(e.status=r.status.join(",")),r.member_id&&(e.member_id=r.member_id),r.user_mobile&&(e.user_mobile=r.user_mobile),r.delivery_type&&r.delivery_type.length>0&&(e.delivery_type=r.delivery_type.join(",")),r.device_imei&&(e.device_imei=r.device_imei),r.device_model&&(e.device_model=r.device_model),r.device_count_min&&(e.device_count_min=r.device_count_min),r.device_count_max&&(e.device_count_max=r.device_count_max),r.amount_min&&(e.amount_min=r.amount_min),r.amount_max&&(e.amount_max=r.amount_max),r.create_time_range&&r.create_time_range.length===2&&(e.create_time_start=r.create_time_range[0],e.create_time_end=r.create_time_range[1]),r.update_time_range&&r.update_time_range.length===2&&(e.update_time_start=r.update_time_range[0],e.update_time_end=r.update_time_range[1]);const l=await Sa(e);l.data.data?M.value=l.data.data:l.data.list?M.value=l.data.list:(M.value=[],console.error("APIè¿”å›çš„æ•°æ®ç»“æ„ä¸ç¬¦åˆé¢„æœŸ:",l.data));const i=l.data.total||l.data.count||0;he.value=l.data.status_counts,A({total:i})}catch(e){console.error("è·å–åˆ—è¡¨å¤±è´¥:",e),c.error("è·å–åˆ—è¡¨å¤±è´¥")}finally{se.value=!1}},He=t=>{A({limit:t,page:f.value.page}),g(1)},Je=t=>{A({page:t,limit:f.value.limit}),g(t)};u(!1);const he=u({}),Qe=t=>t==="all"?f.value.total:he.value[t]||0,We=t=>({1:"warning",2:"warning",3:"primary",4:"success",5:"warning",6:"primary",7:"success",8:"info",9:"danger",10:"danger"})[t]||"info",Ze=t=>({1:"light",2:"light",3:"light",4:"light",5:"light",6:"dark",7:"dark",8:"plain",9:"dark",10:"dark"})[t]||"plain",qe=t=>({1:"info",2:"warning",3:"primary",4:"success",5:"success",6:"danger"})[t]||"info",re=t=>{switch(t){case 1:return"Clock";case 2:return"Finished";case 3:return"Loading";case 4:return"DocumentChecked";case 5:return"CircleCheck";case 6:return"Money";case 7:return"CircleCheckFilled";case 8:return"CircleClose";default:return"QuestionFilled"}},Ge=t=>({1:"warning",2:"info",3:"primary",4:"success",5:"warning",6:"primary",7:"success",8:"info",9:"danger",10:"danger"})[t]||"info",Ke=t=>({order_sign:"primary",order_check:"success",order_price:"warning",order_payment:"primary",order_complete:"success",order_cancel:"danger",order_delete:"danger",order_detail:"info"})[t]||"default",Xe=t=>({order_sign:Ve,order_check:fe,order_price:Se,order_payment:xa,order_complete:ka,order_cancel:Ca,order_delete:Me,order_detail:Ae,order_push_notify:wa})[t]||Zt,et=t=>t?`Â¥${(typeof t=="string"?parseFloat(t):t).toFixed(2)}`:"Â¥0.00",tt=async t=>{try{await B.confirm("ç¡®å®šè¦æ¨é€è®¢å•ç¡®è®¤é€šçŸ¥ç»™ç”¨æˆ·å—ï¼Ÿ","æ¨é€é€šçŸ¥",{confirmButtonText:"ç¡®å®šæ¨é€",cancelButtonText:"å–æ¶ˆ",type:"info"});const e=te.service({lock:!0,text:"æ­£åœ¨å‘é€é€šçŸ¥...",background:"rgba(0, 0, 0, 0.7)"});await Pa(t.id),e.close(),c.success("æ¨é€é€šçŸ¥å·²å‘é€")}catch(e){e!=="cancel"&&(console.error("æ¨é€é€šçŸ¥å¤±è´¥ï¼š",e),c.error(e.message||"æ¨é€é€šçŸ¥å¤±è´¥"))}},at=async(t,e)=>{try{if(e.key==="order_cancel")await B.confirm("ç¡®å®šè¦å–æ¶ˆè¯¥è®¢å•å—ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await ae(t.id,{action:"order_cancel"}),c.success("è®¢å•å·²å–æ¶ˆ"),await g(f.value.page);else if(e.key==="order_delete")await B.confirm("ç¡®å®šè¦åˆ é™¤è¯¥è®¢å•å—ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await Ia(t.id),c.success("è®¢å•å·²åˆ é™¤"),await g(f.value.page);else if(e.key==="order_complete")await B.confirm("ç¡®å®šè¦å®Œæˆè¯¥è®¢å•å—ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await ae(t.id,{action:"order_complete"}),c.success("æ“ä½œæˆåŠŸï¼Œè®¢å•å·²å®Œæˆ"),await g(f.value.page);else if(e.key==="order_sign")$.value=t.id,E.value=t.devices||[],z.value=!0;else if(e.key==="order_check")$.value=t.id,E.value=t.devices||[],O.value=!0;else if(e.key==="order_price")$.value=t.id,E.value=t.devices||[],N.value=!0;else if(e.key=="order_payment"){Q.value=!0;const l=await Ma(t.member_id);if(l.data&&Array.isArray(l.data)){const i=M.value.find(v=>v.id===t.id);let k=0;i&&i.devices&&Array.isArray(i.devices)&&(k=i.devices.filter(v=>v.status===6).length);let w=0;i&&i.devices&&Array.isArray(i.devices)&&(w=i.devices.filter(v=>v.status>=4).length);let Y=0;i&&i.devices&&Array.isArray(i.devices)&&(Y=i.devices.filter(v=>v.status>=5).length);let G=0;i&&i.devices&&Array.isArray(i.devices)&&(G=i.devices.filter(v=>v.status==5).length);let K=0;i&&i.devices&&Array.isArray(i.devices)&&(K=i.devices.filter(v=>v.status==5).reduce((v,_e)=>v+ +_e.final_price,0));const ue={order_id:i?i.id:t.id,delivery_type:i?i.delivery_type_text:"",device_count:i&&i.devices?i.devices.length:0,confirmed_count:Y,checked_count:w,success_count:G,returned_count:k,price_per_device:i?i.price_per_device:0,total_amount:i?K:0,customer_name:i?i.member.nickname:"",customer_mobile:i?i.member.mobile:"",delivery_type_name:i?i.delivery_type_name:"",devices:i&&i.devices?i.devices.map(v=>({id:v.id,model:v.model,imei:v.imei,final_price:v.final_price||0,status:v.status,status_name:v.status_name||""})):[]},H=l.data.map(v=>({...v,order_summary:ue}));L.value=H,W.value=H.length>0?0:-1}else L.value=[]}else if(e.key=="order_detail"){const l=M.value.find(i=>i.id===t.id);l?(ye.value=l,ie.value=!0):c.warning("æœªæ‰¾åˆ°è®¢å•ä¿¡æ¯")}else e.key=="order_push_notify"?await tt(t):(await ae(t.id,{action:e.key}),c.success("æ“ä½œæˆåŠŸ"),await g())}catch(l){console.error("æ“ä½œå¤±è´¥ï¼š",l),c.error(l.message||"æ“ä½œå¤±è´¥")}},oe=t=>t?t.length:0,st=()=>{lt(),F.value="",A({page:1}),g(1)},it=()=>{rt(),F.value="",A({page:1}),g(1)},lt=()=>{T.keyword="",T.status="",T.delivery_type=""},rt=()=>{r.order_id="",r.express_no="",r.status=[],r.member_id="",r.user_mobile="",r.delivery_type=[],r.device_imei="",r.device_model="",r.device_count_min=null,r.device_count_max=null,r.amount_min=null,r.amount_max=null,r.create_time_range=[],r.update_time_range=[]},ot=(t,e)=>{r.member_id=t,A({page:1}),g(1)},nt=t=>{const e=M.value.find(l=>l.id===t);return e?e.status:0},q=u({id:0,imei:"",model:"",initial_price:"",check_result:"",check_images:"",remark:"",status:0,final_price:"",check_status:0}),O=u(!1),N=u(!1);u({});const ct=async t=>{const e=t.order_id,l=M.value.find(k=>k.id===e);if(l&&l.status===1){c.warning("è¯·å…ˆç­¾æ”¶è®¢å•åå†è¿›è¡Œè´¨æ£€");return}O.value=!0;const i=await ge(t.id);i.code===1&&(q.value={id:i.data.id,imei:i.data.imei,model:i.data.model,initial_price:i.data.initial_price,check_result:i.data.check_result||"",check_images:i.data.check_images||"",final_price:i.data.final_price||"",remark:i.data.remark||"",status:i.data.status,check_status:i.data.check_status})},be=async t=>{try{const e=await ge(t.id);e.code===1&&(q.value={id:e.data.id,imei:e.data.imei,model:e.data.model,initial_price:e.data.initial_price,check_result:e.data.check_result||"",check_images:e.data.check_images||"",final_price:e.data.final_price||"",before_price:e.data.before_price||"",remark:e.data.remark||"",status:e.data.status,check_status:e.data.check_status},N.value=!0)}catch(e){console.error("è·å–è®¾å¤‡ä¿¡æ¯å¤±è´¥:",e),c.error("è·å–è®¾å¤‡ä¿¡æ¯å¤±è´¥")}},dt=async t=>{var e,l;try{if(!t.check_result){c.warning("è¯·å¡«å†™è´¨æ£€ç»“æœ");return}await Aa(t.id,{check_result:t.check_result,check_images:t.check_images,remark:t.remark,check_status:1,final_price:t.final_price,action:"check",imei:t.imei,info:t.info,model:t.model}),c.success("è´¨æ£€ä¿¡æ¯æäº¤æˆåŠŸ"),O.value=!1,await g(f.value.page)}catch(i){console.error("æäº¤è´¨æ£€ä¿¡æ¯å¤±è´¥ï¼š",i),c.error(((l=(e=i.response)==null?void 0:e.data)==null?void 0:l.message)||"æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•")}},ut=async t=>{try{if(!t||!t.final_price||t.final_price<=0){c.warning("è¯·è¾“å…¥æœ‰æ•ˆçš„ä»·æ ¼");return}await za(t.id,t),c.success("å®šä»·ä¿¡æ¯æäº¤æˆåŠŸ"),N.value=!1,await g(f.value.page)}catch(e){console.error("æäº¤å®šä»·ä¿¡æ¯å¤±è´¥ï¼š",e),c.error("æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•")}},j=u({}),_t=(t,e)=>{j.value[e]=t},mt=async t=>{t||c.warning("è¯·é€‰æ‹©è®¾å¤‡");try{await ze({ids:t+"",remark:"ç®¡ç†å‘˜ç¡®è®¤"}),g(f.value.page)}catch{c.error("ç¡®è®¤å¤±è´¥")}},pt=async t=>{if(!t){c.warning("è¯·é€‰æ‹©è®¾å¤‡");return}try{const{value:e}=await B.prompt(`ç¡®å®šè¦æ‹’ç»å›æ”¶è¯¥è®¾å¤‡å—ï¼Ÿå°†åˆ›å»ºé€€è´§è®¢å•å¤„ç†è¯¥è®¾å¤‡ã€‚
è¯·è¾“å…¥æ‹’ç»å›æ”¶åŸå› ï¼š`,"æ‹’ç»å›æ”¶ç¡®è®¤",{confirmButtonText:"ç¡®å®šæ‹’ç»",cancelButtonText:"å–æ¶ˆ",type:"warning",inputPlaceholder:"è¯·è¾“å…¥æ‹’ç»å›æ”¶åŸå› "}),l=te.service({lock:!0,text:"æ­£åœ¨å¤„ç†...",background:"rgba(0, 0, 0, 0.7)"});await La({ids:t+"",remark:e||"å•†æˆ·æ‹’ç»å›æ”¶"}),l.close(),c.success("æ‹’ç»æˆåŠŸï¼Œå·²åˆ›å»ºé€€è´§è®¢å•"),g(f.value.page)}catch(e){if(e==="cancel")return;console.error("æ‹’ç»å¤±è´¥:",e)}},vt=async t=>{try{const e=j.value[t].map(i=>i.id);if(e.length===0){c.warning("è¯·é€‰æ‹©è®¾å¤‡");return}const{value:l}=await B.prompt("è¯·è¾“å…¥æ“ä½œå¤‡æ³¨","æ‰¹é‡ç¡®è®¤è®¾å¤‡",{confirmButtonText:"ç¡®è®¤",cancelButtonText:"å–æ¶ˆ",inputPlaceholder:"è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰"});await ze({ids:e.join(","),remark:l||""}),c.success("æ‰¹é‡ç¡®è®¤æˆåŠŸ"),await g(f.value.page)}catch(e){e!=="cancel"&&(console.error("æ‰¹é‡ç¡®è®¤å¤±è´¥ï¼š",e),c.error("æ‰¹é‡ç¡®è®¤å¤±è´¥"))}},ft=(t,e)=>{const l=e.map(i=>i.id);Be(l)},ne=u(!1),xe=u({}),gt=async t=>{try{const e=await ge(t.id);if(e.code!==1){c.error(e.msg||"è·å–è®¾å¤‡è¯¦æƒ…å¤±è´¥");return}de.value=e.data,ne.value=!0}catch(e){console.error("è·å–è®¾å¤‡è¯¦æƒ…å¤±è´¥:",e),c.error("è·å–è®¾å¤‡è¯¦æƒ…å¤±è´¥")}},ce=u(!1),yt=()=>{ce.value=!0},ht=async()=>{await g()};$t(async()=>{await Fe(),await g(f.value.page)}),pe(()=>L.value&&L.value.length>0&&W.value>=0&&W.value<L.value.length?L.value[W.value]:null);const F=u(""),bt=t=>{F.value=t.props.name,T.status=t.props.name,r.status=[],A({page:1}),g(1)},xt=async t=>{try{await Ba(t.orderId,{pay_type:t.payType,remark:"è´¢åŠ¡å·²ç¡®è®¤æ‰“æ¬¾"}),c.success("ç¡®è®¤æ‰“æ¬¾æˆåŠŸ"),Q.value=!1,await g()}catch(e){console.error("ç¡®è®¤æ‰“æ¬¾å¤±è´¥",e),c.error("ç¡®è®¤æ‰“æ¬¾å¤±è´¥")}},de=u(null),kt=()=>{de.value=null},Ct=async t=>{const e=te.service({lock:!0,text:"æ­£åœ¨ä¿å­˜...",background:"rgba(0, 0, 0, 0.7)"});try{const l=await ae(t.orderId,{action:"order_sign",devices:t.devices.map(i=>({id:i.id,imei:i.imei,model:i.model,initial_price:i.initial_price,category_id:i.category_id}))});if(l.code!==1)throw e.close(),z.value=!1,new Error(l.message||"æ“ä½œå¤±è´¥");c.success("è®¢å•ç­¾æ”¶æˆåŠŸ"),z.value=!1,await g(),e.close()}catch{e.close()}};pe(()=>{var t,e;return(e=(t=xe.value)==null?void 0:t.data)!=null&&e.check_images?xe.value.data.check_images.split(",").filter(l=>l):[]});const wt=async t=>{try{const e=te.service({lock:!0,text:"æ­£åœ¨æ‰“å°æ ‡ç­¾...",background:"rgba(0, 0, 0, 0.7)"}),l=await Ra(t.id);if(e.close(),l.code===1)c.success("æ ‡ç­¾æ‰“å°æˆåŠŸ"),l.data&&l.data.simulated&&(qt({title:"æ¨¡æ‹Ÿæ‰“å°",message:"å·²ç”Ÿæˆæ‰“å°å†…å®¹ï¼Œä½†æœªè¿æ¥å®é™…æ‰“å°æœº",type:"warning",duration:5e3}),B.alert(`<pre style="white-space: pre-wrap; font-family: monospace; font-size: 12px;">${l.data.content}</pre>`,"æ‰“å°å†…å®¹é¢„è§ˆ",{dangerouslyUseHTMLString:!0,confirmButtonText:"å…³é—­",callback:()=>{}}));else{const i=l.message||"æ‰“å°å¤±è´¥",k=l.debug_info?JSON.stringify(l.debug_info):"";c.error(`${i} ${k}`),console.error("æ‰“å°å¤±è´¥:",l)}}catch(e){console.error("æ‰“å°è¿‡ç¨‹å¼‚å¸¸:",e),c.error(`æ‰“å°è¿‡ç¨‹å¼‚å¸¸: ${e.message||"æœªçŸ¥é”™è¯¯"}`)}},Dt=async(t,e)=>{try{return(await Ua(t,e)).data}catch(l){throw console.error("æŸ¥è¯¢å¿«é€’ä¿¡æ¯å¤±è´¥:",l),l}},Et=async t=>{!t.express_no||t.express_no==="æš‚æ— "||(P.value&&clearTimeout(P.value),P.value=setTimeout(async()=>{var e,l;try{Z.value[t.id]=!0;const k=(((e=t.member)==null?void 0:e.mobile)||((l=t.recycleUserAddress)==null?void 0:l.mobile)||"").slice(-4);if(!k){c.warning("æ— æ³•è·å–ç”¨æˆ·æ‰‹æœºå·ï¼Œæ— æ³•æŸ¥è¯¢å¿«é€’ä¿¡æ¯");return}const w=await Dt(t.express_no,k);if(!w||!w.data||!w.data.logisticsTraceDetailList||w.data.logisticsTraceDetailList.length===0){c.info("æš‚æ— ç‰©æµä¿¡æ¯");return}I.value=w.data,Ue.value=t,le.value=!0}catch(i){console.error("æŸ¥è¯¢å¿«é€’ä¿¡æ¯å¤±è´¥:",i),c.error("æŸ¥è¯¢å¿«é€’ä¿¡æ¯å¤±è´¥")}finally{Z.value[t.id]=!1}},500))},Tt=()=>{P.value&&(clearTimeout(P.value),P.value=null)},Vt=t=>{switch(t){case"ACCEPT":return"info";case"TRANSPORT":return"warning";case"DELIVER":return"primary";case"SIGN":return"success";case"REJECT":case"EXCEPTION":return"danger";default:return"info"}},St=t=>{switch(t){case 1:return"å¾…ç­¾æ”¶";case 2:return"è´¨æ£€ä¸­";case 3:return"å·²è´¨æ£€";case 4:return"å¾…å®šä»·";case 5:return"å¾…ç”¨æˆ·ç¡®è®¤";case 6:return"å¾…è´¢åŠ¡æ‰“æ¬¾";case 7:return"å·²æ‰“æ¬¾|å®Œæˆâœ…";case 8:return"å·²å–æ¶ˆ";case 9:return"å·²å–æ¶ˆ";case 10:return"å·²åˆ é™¤";default:return"æœªçŸ¥çŠ¶æ€"}};return(t,e)=>{const l=Gt,i=Kt,k=Xt,w=ea,Y=ta,G=aa,K=sa,ue=ia,H=la,v=ra,_e=oa,C=na,U=ca,me=da,ke=ua,It=_a,Mt=ma,At=pa,zt=va,Lt=fa,Bt=ga,Pt=ya;return _(),S("div",Qa,[o(At,{class:"box-card !border-none h-full relative",shadow:"never"},{default:n(()=>[s("div",Wa,[Za,s("div",qa,[o(l,{type:"primary",icon:p(Ot),onClick:yt},{default:n(()=>[b("ä»£ä¸‹å•")]),_:1},8,["icon"])])]),s("div",Ga,[Ka,o(ue,null,{default:n(()=>[Ee(s("div",null,[s("div",Xa,[s("div",es,[s("div",ts,[s("div",as,[o(i,{size:"16",class:"text-orange-600"},{default:n(()=>[o(p(Nt))]),_:1})]),ss])]),s("div",is,[o(K,{model:r},{default:n(()=>[s("div",ls,[s("div",rs,[os,o(k,{modelValue:r.order_id,"onUpdate:modelValue":e[0]||(e[0]=a=>r.order_id=a),placeholder:"è¾“å…¥ç²¾ç¡®è®¢å•å·",clearable:"",class:"w-full"},null,8,["modelValue"])]),s("div",ns,[cs,o(k,{modelValue:r.express_no,"onUpdate:modelValue":e[1]||(e[1]=a=>r.express_no=a),placeholder:"è¾“å…¥å¿«é€’å•å·",clearable:"",class:"w-full"},null,8,["modelValue"])]),s("div",ds,[us,o(Y,{modelValue:r.status,"onUpdate:modelValue":e[2]||(e[2]=a=>r.status=a),placeholder:"é€‰æ‹©çŠ¶æ€",clearable:"",multiple:"","collapse-tags":"",class:"w-full"},{default:n(()=>[(_(!0),S(X,null,ee(R.value,(a,x)=>(_(),y(w,{key:x,label:a.name,value:a.status},{default:n(()=>[s("div",_s,[s("div",ms,[o(i,{class:"mr-2 text-gray-500"},{default:n(()=>[(_(),y(ve(re(a.status))))]),_:2},1024),s("span",null,m(a.name),1)]),s("span",ps,m(St(a.status)),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])])]),s("div",vs,[s("div",fs,[gs,s("div",ys,[o(Ha,{modelValue:r.member_id,"onUpdate:modelValue":e[3]||(e[3]=a=>r.member_id=a),placeholder:"ğŸ” è¾“å…¥ç”¨æˆ·æ˜µç§°ã€æ‰‹æœºå·æˆ–ç”¨æˆ·ç¼–å·",onChange:ot,class:"w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300 shadow-sm hover:shadow-md"},null,8,["modelValue"]),s("div",hs,[o(i,{size:"16"},{default:n(()=>[o(p(Te))]),_:1})])])]),s("div",bs,[xs,o(Y,{modelValue:r.delivery_type,"onUpdate:modelValue":e[4]||(e[4]=a=>r.delivery_type=a),placeholder:"é€‰æ‹©é…é€æ–¹å¼",clearable:"",multiple:"",class:"w-full"},{default:n(()=>[o(w,{label:"ğŸ“¦ å¿«é€’é…é€",value:"1"},{default:n(()=>[ks]),_:1}),o(w,{label:"ğŸš— è‡ªé€åˆ°åº—",value:"2"},{default:n(()=>[Cs]),_:1})]),_:1},8,["modelValue"])]),s("div",ws,[Ds,o(k,{modelValue:r.device_imei,"onUpdate:modelValue":e[5]||(e[5]=a=>r.device_imei=a),placeholder:"è¾“å…¥è®¾å¤‡IMEIå·",clearable:"",class:"w-full"},null,8,["modelValue"])]),s("div",Es,[Ts,o(k,{modelValue:r.device_model,"onUpdate:modelValue":e[6]||(e[6]=a=>r.device_model=a),placeholder:"è¾“å…¥è®¾å¤‡å‹å·",clearable:"",class:"w-full"},null,8,["modelValue"])])]),s("div",Vs,[s("div",Ss,[Is,o(G,{modelValue:r.create_time_range,"onUpdate:modelValue":e[7]||(e[7]=a=>r.create_time_range=a),type:"daterange","range-separator":"è‡³","start-placeholder":"å¼€å§‹æ—¥æœŸ","end-placeholder":"ç»“æŸæ—¥æœŸ",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"w-full"},null,8,["modelValue"])])]),s("div",Ms,[s("div",As,[o(l,{type:"primary",icon:p(fe),onClick:st,class:"bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 border-0 shadow-sm px-6"},{default:n(()=>[b(" æ‰§è¡Œé«˜çº§æœç´¢ ")]),_:1},8,["icon"]),o(l,{icon:p(jt),onClick:it,class:"border-gray-300 text-gray-600 hover:border-gray-400 px-6"},{default:n(()=>[b(" é‡ç½®æ‰€æœ‰æ¡ä»¶ ")]),_:1},8,["icon"])])])]),_:1},8,["model"])])])],512),[[Ft,je.value]])]),_:1})]),o(_e,{modelValue:F.value,"onUpdate:modelValue":e[8]||(e[8]=a=>F.value=a),onTabClick:bt,class:"order-tabs"},{default:n(()=>[o(H,{name:""},{label:n(()=>[s("div",zs,[o(i,{class:"mr-1"},{default:n(()=>[o(p(Yt))]),_:1}),Ls])]),_:1}),(_(!0),S(X,null,ee(R.value,(a,x)=>(_(),y(H,{key:x,name:a.status},{label:n(()=>[s("div",Bs,[o(i,{class:"mr-1"},{default:n(()=>[(_(),y(ve(re(a.status))))]),_:2},1024),s("span",null,m(a.name),1),a.status<7?(_(),y(v,{key:0,value:Qe(a.status),class:"ml-1",type:Ge(a.status)},null,8,["value","type"])):D("",!0)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),Ee((_(),y(ke,{ref_key:"orderTable",ref:Ye,data:M.value,"expand-row-keys":p(Pe),"row-key":"id",style:{width:"100%"},onExpandChange:ft,class:"order-table"},{default:n(()=>[o(C,{type:"expand"},{default:n(({row:a})=>{var x;return[s("div",Ps,[s("div",Us,[Rs,s("span",$s,"å…± "+m(((x=a.devices)==null?void 0:x.length)||0)+" å°è®¾å¤‡",1)]),o(ke,{data:a.devices,border:"",size:"small",onSelectionChange:d=>_t(d,a.id),class:"device-table"},{default:n(()=>[o(C,{type:"selection",width:"55"}),o(C,{prop:"imei",label:"IMEI","min-width":"150"}),o(C,{prop:"model",label:"è®¾å¤‡å‹å·","min-width":"120"}),o(C,{prop:"final_price",label:"æœ€ç»ˆä»·æ ¼",width:"100"},{default:n(({row:d})=>[s("span",Os,m(et(d.final_price)),1)]),_:2},1024),o(C,{prop:"status_name",label:"çŠ¶æ€",width:"100"},{default:n(({row:d})=>[o(U,{type:qe(d.status),size:"small"},{default:n(()=>[b(m(d.status_name),1)]),_:2},1032,["type"])]),_:2},1024),o(C,{label:"æ“ä½œ","min-width":"280"},{default:n(({row:d})=>[o(me,null,{default:n(()=>[d.status===1&&nt(d.order_id)>1?(_(),y(l,{key:0,type:"primary",size:"small",icon:p(Ve),onClick:V=>ct(d)},{default:n(()=>[b(" å¼€å§‹è´¨æ£€ ")]),_:2},1032,["icon","onClick"])):D("",!0),d.status==2||d.status==3?(_(),y(l,{key:1,type:"success",size:"small",icon:p(Se),onClick:V=>be(d)},{default:n(()=>[b(" å®šä»· ")]),_:2},1032,["icon","onClick"])):D("",!0),d.status==4?(_(),y(l,{key:2,type:"primary",size:"small",icon:p(Ie),onClick:V=>mt(d.id)},{default:n(()=>[b(" ç¡®è®¤ ")]),_:2},1032,["icon","onClick"])):D("",!0),d.status==4?(_(),y(l,{key:3,type:"warning",size:"small",icon:p(Ht),onClick:V=>be(d)},{default:n(()=>[b(" é‡æ–°å®šä»· ")]),_:2},1032,["icon","onClick"])):D("",!0),d.status==4?(_(),y(l,{key:4,type:"danger",size:"small",icon:p(Me),onClick:V=>pt(d.id)},{default:n(()=>[b(" æ‹’ç» ")]),_:2},1032,["icon","onClick"])):D("",!0),d.status>=3?(_(),y(l,{key:5,type:"info",size:"small",icon:p(Jt),onClick:V=>wt(d)},{default:n(()=>[b(" æ‰“å°æ ‡ç­¾ ")]),_:2},1032,["icon","onClick"])):D("",!0)]),_:2},1024),o(l,{type:"primary",link:"",icon:p(Ae),onClick:V=>gt(d),size:"small",class:"ml-2"},{default:n(()=>[b(" æŸ¥çœ‹è¯¦æƒ… ")]),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:2},1032,["data","onSelectionChange"]),j.value[a.id]&&j.value[a.id].length>0&&a.status==4?(_(),S("div",Ns,[o(me,null,{default:n(()=>[o(l,{type:"primary",size:"small",icon:p(Ie),onClick:d=>vt(a.id)},{default:n(()=>[b(" æ‰¹é‡ç¡®è®¤ ("+m(j.value[a.id].length)+") ",1)]),_:2},1032,["icon","onClick"])]),_:2},1024)])):D("",!0)])]}),_:1}),o(C,{label:"è®¢å•ä¿¡æ¯","min-width":"200"},{default:n(({row:a})=>[s("div",js,[s("div",Fs,[Ys,s("span",Hs,m(a.order_no),1)]),s("div",Js,[Qs,s("span",Ws,[o(U,{size:"small",type:a.delivery_type==="1"?"warning":"success"},{default:n(()=>[b(m(a.delivery_type==="1"?"ğŸ“¦ å¿«é€’":"ğŸš— è‡ªé€"),1)]),_:2},1032,["type"])])]),a.delivery_type==="1"?(_(),S("div",Zs,[qs,s("span",{class:"flex-1 cursor-pointer transition-all duration-300 ease-in-out rounded px-1 py-0.5 hover:bg-blue-50 hover:text-blue-600 text-gray-800 text-sm break-all",onClick:x=>Et(a),onMouseleave:Tt},[Z.value[a.id]?(_(),y(i,{key:1,class:"animate-spin text-blue-500"},{default:n(()=>[o(p(Qt))]),_:1})):(_(),S("span",Ks,m(a.express_no||"æš‚æ— "),1)),a.express_no&&!Z.value[a.id]?(_(),y(i,{key:2,class:"ml-1 text-gray-400 text-xs"},{default:n(()=>[o(p(fe))]),_:1})):D("",!0)],40,Gs)])):D("",!0)])]),_:1}),o(C,{label:"ç”¨æˆ·ä¿¡æ¯","min-width":"150"},{default:n(({row:a})=>{var x,d,V,Ce,we;return[s("div",Xs,[s("div",ei,[o(It,{size:32,src:(x=a.member)!=null&&x.headimg?p(Wt)(a.member.headimg):"",class:"mr-2"},{default:n(()=>[o(i,null,{default:n(()=>[o(p(Te))]),_:1})]),_:2},1032,["src"])]),s("div",ti,[s("div",ai,m(((d=a.recycleUserAddress)==null?void 0:d.name)||((V=a.member)==null?void 0:V.nickname)||"æœªçŸ¥ç”¨æˆ·"),1),s("div",si,m(((Ce=a.member)==null?void 0:Ce.mobile)||((we=a.recycleUserAddress)==null?void 0:we.mobile)||"æš‚æ— è”ç³»æ–¹å¼"),1)])])]}),_:1}),o(C,{width:"140",align:"center"},{header:n(()=>[ii]),default:n(({row:a})=>[a.count==oe(a.devices)?(_(),y(U,{key:0,type:"success",class:"device-count-tag"},{default:n(()=>[b(m(a.count)+"/ "+m(oe(a.devices))+"å° ",1)]),_:2},1024)):(_(),y(U,{key:1,type:"danger",class:"device-count-tag"},{default:n(()=>[b(m(a.count)+"/ "+m(oe(a.devices))+"å° ",1)]),_:2},1024))]),_:1}),o(C,{label:"çŠ¶æ€",width:"120",align:"center"},{default:n(({row:a})=>[o(U,{type:We(a.status),effect:Ze(a.status)},{default:n(()=>[o(i,{class:"mr-1"},{default:n(()=>[(_(),y(ve(re(a.status))))]),_:2},1024),b(" "+m(a.status_name),1)]),_:2},1032,["type","effect"])]),_:1}),o(C,{prop:"create_at",label:"åˆ›å»ºæ—¶é—´",width:"180"}),o(C,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:n(({row:a})=>{var x;return[(x=R.value[a.status])!=null&&x.action?(_(),y(me,{key:0},{default:n(()=>[(_(!0),S(X,null,ee(R.value[a.status].action,d=>(_(),y(l,{key:d.key,size:"small",type:Ke(d.key),icon:Xe(d.key),onClick:V=>at(a,d)},{default:n(()=>[b(m(d.value),1)]),_:2},1032,["type","icon","onClick"]))),128))]),_:2},1024)):D("",!0)]}),_:1})]),_:1},8,["data","expand-row-keys"])),[[Pt,se.value]]),s("div",li,[s("div",ri," å…± "+m(p(f).total)+" æ¡è®°å½•ï¼Œå½“å‰ç¬¬ "+m(p(f).page)+" é¡µ ",1),o(Mt,{"current-page":p(f).page,"onUpdate:current-page":e[9]||(e[9]=a=>p(f).page=a),"page-sizes":[15,30,50,100],"page-size":p(f).limit,total:p(f).total,"hide-on-single-page":!1,layout:"  sizes, prev, pager, next, jumper",onSizeChange:He,onCurrentChange:Je},null,8,["current-page","page-size","total"])])]),_:1}),o($a,{visible:ce.value,"onUpdate:visible":e[10]||(e[10]=a=>ce.value=a),onSuccess:ht},null,8,["visible"]),o(Fa,{visible:z.value,"onUpdate:visible":e[11]||(e[11]=a=>z.value=a),"device-list":E.value,"order-id":$.value,onConfirm:Ct,onAddDevice:Re,onEditDevice:$e,onRemoveDevice:Oe,onCancel:Ne},null,8,["visible","device-list","order-id"]),o(Da,{visible:O.value,"onUpdate:visible":e[12]||(e[12]=a=>O.value=a),device:q.value,onConfirm:dt},null,8,["visible","device"]),o(ja,{visible:N.value,"onUpdate:visible":e[13]||(e[13]=a=>N.value=a),device:q.value,onConfirm:ut},null,8,["visible","device"]),o(Ya,{visible:ne.value,"onUpdate:visible":e[14]||(e[14]=a=>ne.value=a),device:de.value,onClosed:kt},null,8,["visible","device"]),o(Na,{visible:ie.value,"onUpdate:visible":e[15]||(e[15]=a=>ie.value=a),"order-detail":ye.value},null,8,["visible","order-detail"]),o(Oa,{visible:Q.value,"onUpdate:visible":e[16]||(e[16]=a=>Q.value=a),"payment-info":L.value,onPaymentConfirmed:xt},null,8,["visible","payment-info"]),o(Bt,{modelValue:le.value,"onUpdate:modelValue":e[17]||(e[17]=a=>le.value=a),title:"å¿«é€’ç‰©æµä¿¡æ¯",width:"600px","destroy-on-close":!0},{default:n(()=>[I.value?(_(),S("div",oi,[s("div",ni,[s("div",ci,[s("div",null,[s("h3",di,m(I.value.logisticsCompanyName),1),s("p",ui,"è¿å•å·ï¼š"+m(I.value.mailNo),1)]),o(U,{type:Vt(I.value.logisticsStatus),size:"large"},{default:n(()=>[b(m(I.value.logisticsStatusDesc),1)]),_:1},8,["type"])]),s("div",_i,[s("p",mi," æœ€æ–°çŠ¶æ€ï¼š"+m(I.value.theLastMessage),1),s("p",pi," æ›´æ–°æ—¶é—´ï¼š"+m(I.value.theLastTime),1)])]),s("div",vi,[fi,o(Lt,null,{default:n(()=>[(_(!0),S(X,null,ee(I.value.logisticsTraceDetailList,(a,x)=>(_(),y(zt,{key:x,timestamp:a.timeDesc,type:x===0?"primary":"info",size:x===0?"large":"normal"},{default:n(()=>[s("div",gi,[s("div",yi,m(a.areaName),1),s("div",hi,m(a.desc),1)])]),_:2},1032,["timestamp","type","size"]))),128))]),_:1})])])):(_(),S("div",bi," æš‚æ— å¿«é€’ä¿¡æ¯ "))]),_:1},8,["modelValue"])])}}});const zl=Ja(xi,[["__scopeId","data-v-277457e7"]]);export{zl as default};
