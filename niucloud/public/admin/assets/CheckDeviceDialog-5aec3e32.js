import{d as ke,y as ye,f as be,r as d,n as N,R as S,h as p,s as k,w as i,a,t as g,e as s,i as u,u as v,dK as Ce,C as y,c as x,dL as we,dM as xe,dN as Ie,dv as Ve,dO as Ee,dy as j,dP as Le,dQ as ze,F as B,W as T,dR as Oe,dS as De,$ as c,a0 as Re,E as Me,L as Ae,dT as Ue,aN as $e,b7 as Fe,as as Ne,M as Se,N as Be,V as Te,p as qe,g as Pe}from"./index-9cfed1fc.js";/* empty css                  *//* empty css                   *//* empty css                */import We from"./index-a4ad10ba.js";import"./el-form-item-4ed993c7.js";/* empty css               *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                  */import{a as je,b as Qe,c as He}from"./device_query_api-45f3f1dd.js";import{b as Ke}from"./browser-a1ac24ac.js";import Xe from"./WarrantyInfoDisplay-ff2e290f.js";import{_ as Ze}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                        */import"./index.vue_vue_type_style_index_0_lang-fad85f8a.js";import"./attachment-4de82df9.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-c04cd2bb.js";/* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                      *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css                  *//* empty css                    *//* empty css                        *//* empty css                         */import"./index.vue_vue_type_script_setup_true_lang-218b436b.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-e50d9a7c.js";import"./sortable.esm-be94e56d.js";const m=I=>(qe("data-v-2a9d6995"),I=I(),Pe(),I),Ge={class:"device-info-bar"},Je={class:"device-basic"},Ye=m(()=>a("div",{class:"device-icon"},"📱",-1)),ea={class:"device-details"},aa={class:"device-model"},ta={class:"device-meta"},sa={key:0,class:"imei-display"},la={class:"quick-actions"},oa={class:"smart-check-panel"},ia={class:"panel-header"},na=m(()=>a("span",null,"🔍 智能质检",-1)),ca={class:"header-actions"},ra={key:0,class:"warranty-display-panel"},da={class:"warranty-header"},ua=m(()=>a("span",null,"📱 设备保修信息",-1)),ma={class:"check-grid"},_a={class:"check-card battery-card"},pa={class:"card-header"},fa=m(()=>a("span",null,"电池状态",-1)),va={class:"card-content"},ha={class:"input-row"},ga=m(()=>a("span",{class:"label"},"健康度",-1)),ka=m(()=>a("span",{class:"unit"},"%",-1)),ya={class:"input-row"},ba=m(()=>a("span",{class:"label"},"循环",-1)),Ca=m(()=>a("span",{class:"unit"},"次",-1)),wa={class:"input-row"},xa=m(()=>a("span",{class:"label"},"激活锁",-1)),Ia={class:"input-row"},Va=m(()=>a("span",{class:"label"},"监管锁",-1)),Ea={class:"check-card screen-card"},La={class:"card-header"},za=m(()=>a("span",null,"屏幕状态",-1)),Oa={class:"card-content"},Da={class:"tag-grid"},Ra={class:"check-card appearance-card"},Ma={class:"card-header"},Aa=m(()=>a("span",null,"外观状态",-1)),Ua={class:"card-content"},$a={class:"tag-grid"},Fa={class:"check-card function-card"},Na={class:"card-header"},Sa=m(()=>a("span",null,"功能异常",-1)),Ba={class:"card-content"},Ta={class:"tag-grid"},qa={class:"row-result"},Pa={class:"key-info-row align-center"},Wa={class:"upload-wrapper"},ja={key:0,class:"qr-quick-scan"},Qa=["src"],Ha=m(()=>a("span",null,"手机扫码上传",-1)),Ka={class:"action-bar"},Xa={class:"action-info"},Za={class:"check-count"},Ga={class:"action-buttons"},Ja=ke({__name:"CheckDeviceDialog",props:{visible:{type:Boolean,default:!1},device:{type:Object,default:()=>({})}},emits:["update:visible","confirm","cancel"],setup(I,{emit:A}){const f=I;ye(),be();function Q(e,n){const r=new RegExp(`^(${n.join("|")})`,"i"),_=e.match(r);return _?_[0]:""}const H=["华为","荣耀","小米","OPPO","vivo","三星","realme","努比亚","moto","中兴","HUAWEI","Xiaomi","OPPO","vivo","Samsung","Realme","Nubia","Moto","ZTE","摩托"],K=async()=>{if(!o.imei){c.warning("请先输入IMEI号码");return}E.value=!0;try{const e=await je({imei:o.imei,brand:Q(C.value.model,H)});e.data&&e.data.model?(D.value=e.data,C.value.model=e.data.model+" "+e.data.capacity+" "+e.data.color,o.info=e.data,c.success("保修信息查询成功")):e.data&&Array.isArray(e.data)&&e.data.length>0?c.error("保修查询失败："+(e.data[0]||"未知错误")):e.data&&e.data.msg?c.error("保修查询失败："+e.data.msg):c.warning("未查询到保修信息")}catch(e){console.error("保修查询失败:",e),c.error("保修查询失败，请稍后重试")}finally{E.value=!1}},X=()=>{D.value=null},Z=async()=>{if(!o.imei){c.warning("请先输入IMEI号码");return}L.value=!0;try{const e=await Qe(o.imei);e.data&&e.data.sn?(J.value=e.data,t.activationLock=e.data.locked===!0||e.data.fmi==="On",h(),c.success("激活锁信息查询成功")):e.data&&Array.isArray(e.data)&&e.data.length>0?c.error("激活锁查询失败："+(e.data[0]||"未知错误")):e.data&&e.data.msg?c.error("激活锁查询失败："+e.data.msg):c.warning("未查询到激活锁信息")}catch(e){console.error("激活锁查询失败:",e),c.error("激活锁查询失败，请稍后重试")}finally{L.value=!1}},G=async()=>{if(!o.imei){c.warning("请先输入IMEI号码");return}z.value=!0;try{const e=await He(o.imei);e.data&&e.data.sn?(Y.value=e.data,t.mdmLock=e.data.locked===!0||e.data.mdm==="On"||e.data.mdm===!0,h(),c.success("监管锁信息查询成功")):e.data&&Array.isArray(e.data)&&e.data.length>0?c.error("监管锁查询失败："+(e.data[0]||"未知错误")):e.data&&e.data.msg?c.error("监管锁查询失败："+e.data.msg):c.warning("未查询到监管锁信息")}catch(e){console.error("监管锁查询失败:",e),c.error("监管锁查询失败，请稍后重试")}finally{z.value=!1}},b=d(f.visible),C=d({...f.device}),V=d(!1),U=d(),O=d(),w=d(!1);d([]);const $=d(""),E=d(!1),D=d(null),L=d(!1),J=d(null),z=d(!1),Y=d(null),ee=N({check_result:[{required:!0,message:"请输入质检结果",trigger:"blur"},{min:5,message:"质检结果至少5个字符",trigger:"blur"}]});(async()=>{$.value=await Ke.toDataURL(window.location.origin+"/site/diy/attachment",{errorCorrectionLevel:"L",margin:0,width:100})})();const o=N({check_result:f.device.check_result||"",check_images:f.device.check_images||"",final_price:typeof f.device.final_price=="number"?f.device.final_price:typeof f.device.final_price=="string"&&parseFloat(f.device.final_price)||void 0,remark:f.device.remark||"",imei:f.device.imei||""}),ae=["无划痕","细微划痕","小划痕","明显划痕","硬划痕","外爆","内爆","未知部件","官方提示"],te=["无磕碰","细微划痕","轻微氧化","中度磨损","重度磨损","严重损坏","组装壳","组装后玻璃"],se=["通话","充电","指纹","面容","WiFi","蓝牙","指南针","NFC","振动","重力","wifi","距离感应","光线感应","闪光","触摸","主麦","前麦","后麦","扬声器","听筒","网络锁","按键","前摄","后摄"],t=N({battery:void 0,battery_num:void 0,screen:"",appearance:"",function:[],activationLock:!1,mdmLock:!1}),le=()=>{let e=0;return t.battery&&e++,t.battery_num&&e++,t.screen&&e++,t.appearance&&e++,e+=t.function.length,e},oe=e=>{t.screen=t.screen===e?"":e,h()},ie=e=>{t.appearance=t.appearance===e?"":e,h()},ne=e=>{const n=t.function.indexOf(e);n>-1?t.function.splice(n,1):t.function.push(e),h()},h=()=>{const e=[];t.battery&&e.push(`电池健康度${t.battery}%`),t.battery_num&&e.push(`循环${t.battery_num}次`),t.activationLock&&e.push("激活锁开启"),t.mdmLock&&e.push("监管锁开启"),t.screen&&e.push(`屏幕${t.screen}`),t.appearance&&e.push(`外观${t.appearance}`),t.function.length>0&&e.push(`功能异常: ${t.function.join("、")}`),o.check_result=e.join("; ")},ce=()=>{t.battery=void 0,t.battery_num=void 0,t.activationLock=!1,t.mdmLock=!1,t.screen="",t.appearance="",t.function=[],o.check_result=""},re=()=>{t.battery=85,t.screen="完好",t.appearance="轻微磨损",h()},de=()=>{w.value=!w.value,w.value&&setTimeout(()=>{var e;(e=O.value)==null||e.focus()},100)};S(()=>f.visible,e=>{b.value=e}),S(()=>f.device,e=>{C.value={...e},o.check_result=e.check_result||"",o.check_images=e.check_images||"",o.final_price=typeof e.final_price=="number"?e.final_price:typeof e.final_price=="string"&&parseFloat(e.final_price)||void 0,o.remark=e.remark||"",o.imei=e.imei||""},{deep:!0}),S(b,e=>{A("update:visible",e)});const ue=()=>{b.value=!1,A("cancel")},me=async()=>{U.value&&await U.value.validate(async(e,n)=>{if(e){V.value=!0;try{const r={id:C.value.id,check_result:o.check_result,check_images:o.check_images,remark:o.remark,check_status:1,final_price:o.final_price,action:"check",imei:o.imei,model:C.value.model,info:o.info};A("confirm",r),b.value=!1}finally{V.value=!1}}})},_e=e=>{const n=e.replace(/[^0-9]/g,"");n!==e&&(o.imei=n)},pe=()=>{O.value&&O.value.focus()};return(e,n)=>{const r=Re,_=Me,R=Ae,fe=Ue,q=$e,P=Fe,F=Ne,M=Se,ve=We,he=Be,ge=Te;return p(),k(ge,{modelValue:b.value,"onUpdate:modelValue":n[10]||(n[10]=l=>b.value=l),title:"设备质检",width:"960px","destroy-on-close":!0,class:"check-device-dialog","align-center":""},{footer:i(()=>[a("div",Ka,[a("div",Xa,[a("span",Za,"已检测项目: "+g(le()),1)]),a("div",Ga,[s(_,{size:"large",onClick:ue},{default:i(()=>[u(" 取消 ")]),_:1}),s(_,{type:"primary",size:"large",onClick:me,loading:V.value},{default:i(()=>[V.value?y("",!0):(p(),k(r,{key:0},{default:i(()=>[s(v(Ce))]),_:1})),u(" "+g(V.value?"提交中...":"完成质检"),1)]),_:1},8,["loading"])])])]),default:i(()=>[a("div",Ge,[a("div",Je,[Ye,a("div",ea,[a("h3",aa,g(C.value.model||"未知型号"),1),a("div",ta,[w.value?(p(),k(R,{key:1,modelValue:o.imei,"onUpdate:modelValue":n[0]||(n[0]=l=>o.imei=l),placeholder:"请输入15位IMEI或使用扫码枪",size:"default",clearable:"",maxlength:"15","show-word-limit":"",onInput:_e,onBlur:n[1]||(n[1]=l=>w.value=!1),ref_key:"imeiInputRef",ref:O},{prefix:i(()=>[s(r,null,{default:i(()=>[s(v(we))]),_:1})]),append:i(()=>[s(_,{onClick:pe},{default:i(()=>[s(r,null,{default:i(()=>[s(v(xe))]),_:1}),u(" 扫码 ")]),_:1})]),_:1},8,["modelValue"])):(p(),x("span",sa,"IMEI: "+g(o.imei||"未录入"),1))])])]),a("div",la,[w.value?y("",!0):(p(),k(_,{key:0,size:"small",type:"primary",onClick:de},{default:i(()=>[s(r,null,{default:i(()=>[s(v(Ie))]),_:1}),u(" 修改IMEI ")]),_:1}))])]),a("div",oa,[a("div",ia,[na,a("div",ca,[s(_,{size:"small",text:"",onClick:K,loading:E.value,disabled:!o.imei},{default:i(()=>[E.value?y("",!0):(p(),k(r,{key:0},{default:i(()=>[s(v(Ve))]),_:1})),u(" "+g(E.value?"查询中...":"查询保修"),1)]),_:1},8,["loading","disabled"]),s(_,{text:"",size:"small",onClick:Z,loading:L.value,disabled:!o.imei},{default:i(()=>[L.value?y("",!0):(p(),k(r,{key:0},{default:i(()=>[s(v(Ee))]),_:1})),u(" "+g(L.value?"查询中...":"查询激活锁"),1)]),_:1},8,["loading","disabled"]),s(_,{text:"",size:"small",onClick:G,loading:z.value,disabled:!o.imei},{default:i(()=>[z.value?y("",!0):(p(),k(r,{key:0},{default:i(()=>[s(v(j))]),_:1})),u(" "+g(z.value?"查询中...":"查询监管锁"),1)]),_:1},8,["loading","disabled"]),u(" | "),s(_,{size:"small",text:"",onClick:ce},{default:i(()=>[u("清空")]),_:1}),s(_,{size:"small",text:"",onClick:re},{default:i(()=>[u("常用模板")]),_:1})])]),s(fe,null,{default:i(()=>[D.value?(p(),x("div",ra,[a("div",da,[ua,s(_,{size:"small",text:"",onClick:X},{default:i(()=>[s(r,null,{default:i(()=>[s(v(Le))]),_:1}),u(" 清除 ")]),_:1})]),s(Xe,{warrantyData:D.value},null,8,["warrantyData"])])):y("",!0)]),_:1}),a("div",ma,[a("div",_a,[a("div",pa,[s(r,{class:"header-icon"},{default:i(()=>[s(v(ze))]),_:1}),fa]),a("div",va,[a("div",ha,[ga,s(q,{modelValue:t.battery,"onUpdate:modelValue":n[2]||(n[2]=l=>t.battery=l),min:0,max:100,step:1,size:"small",onChange:h},null,8,["modelValue"]),ka]),a("div",ya,[ba,s(R,{type:"number",modelValue:t.battery_num,"onUpdate:modelValue":n[3]||(n[3]=l=>t.battery_num=l),min:0,max:9999,step:50,size:"small",onChange:h},null,8,["modelValue"]),Ca]),a("div",wa,[xa,s(P,{modelValue:t.activationLock,"onUpdate:modelValue":n[4]||(n[4]=l=>t.activationLock=l),style:{"--el-switch-on-color":"#ff4949","--el-switch-off-color":"#13ce66"},"active-text":"on","inactive-text":"off",size:"small",onChange:h},null,8,["modelValue"])]),a("div",Ia,[Va,s(P,{modelValue:t.mdmLock,"onUpdate:modelValue":n[5]||(n[5]=l=>t.mdmLock=l),style:{"--el-switch-on-color":"#ff4949","--el-switch-off-color":"#13ce66"},"active-text":"on","inactive-text":"off",size:"small",onChange:h},null,8,["modelValue"])])])]),a("div",Ea,[a("div",La,[s(r,{class:"header-icon"},{default:i(()=>[s(v(j))]),_:1}),za]),a("div",Oa,[a("div",Da,[(p(),x(B,null,T(ae,l=>s(F,{key:l,type:t.screen===l?"primary":void 0,effect:t.screen===l?"dark":"plain",size:"small",class:"check-tag",onClick:W=>oe(l)},{default:i(()=>[u(g(l),1)]),_:2},1032,["type","effect","onClick"])),64))])])]),a("div",Ra,[a("div",Ma,[s(r,{class:"header-icon"},{default:i(()=>[s(v(Oe))]),_:1}),Aa]),a("div",Ua,[a("div",$a,[(p(),x(B,null,T(te,l=>s(F,{key:l,type:t.appearance===l?"primary":void 0,effect:t.appearance===l?"dark":"plain",size:"small",class:"check-tag",onClick:W=>ie(l)},{default:i(()=>[u(g(l),1)]),_:2},1032,["type","effect","onClick"])),64))])])]),a("div",Fa,[a("div",Na,[s(r,{class:"header-icon"},{default:i(()=>[s(v(De))]),_:1}),Sa]),a("div",Ba,[a("div",Ta,[(p(),x(B,null,T(se,l=>s(F,{key:l,type:t.function.includes(l)?"danger":void 0,effect:t.function.includes(l)?"dark":"plain",size:"small",class:"check-tag",onClick:W=>ne(l)},{default:i(()=>[u(g(l),1)]),_:2},1032,["type","effect","onClick"])),64))])])])])]),s(he,{model:o,rules:ee,ref_key:"formRef",ref:U,"label-position":"top",class:"core-form"},{default:i(()=>[a("div",qa,[s(M,{class:"flex-column",label:"📋 质检结果",prop:"check_result"},{default:i(()=>[s(R,{type:"textarea",modelValue:o.check_result,"onUpdate:modelValue":n[6]||(n[6]=l=>o.check_result=l),rows:4,placeholder:"详细描述设备状态，或使用上方快速选择...",maxlength:"100","show-word-limit":"",class:"result-textarea"},null,8,["modelValue"])]),_:1}),s(M,{class:"flex-direction-column",label:"📋 扣费说明",prop:"remark"},{default:i(()=>[s(R,{type:"textarea",modelValue:o.remark,"onUpdate:modelValue":n[7]||(n[7]=l=>o.remark=l),rows:4,placeholder:"扣费说明、特殊情况备注等...",maxlength:"200",class:"result-textarea","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(M,{class:"flex-direction-column price-item",label:"💰 最终价格",prop:"final_price"},{default:i(()=>[s(q,{modelValue:o.final_price,"onUpdate:modelValue":n[8]||(n[8]=l=>o.final_price=l),step:10,precision:2,min:0,max:99999,placeholder:"定价",class:"price-input"},null,8,["modelValue"])]),_:1})]),a("div",Pa,[s(M,{label:"📸 质检图片",class:"upload-item"},{default:i(()=>[a("div",Wa,[s(ve,{modelValue:o.check_images,"onUpdate:modelValue":n[9]||(n[9]=l=>o.check_images=l),limit:6},null,8,["modelValue"]),$.value?(p(),x("div",ja,[a("img",{src:$.value,class:"qr-mini",alt:"扫码上传"},null,8,Qa),Ha])):y("",!0)])]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}});const Ft=Ze(Ja,[["__scopeId","data-v-2a9d6995"]]);export{Ft as default};
