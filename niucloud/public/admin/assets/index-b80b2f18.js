import{P as F,d as re,r,l as de,R as _e,h as d,s as j,w as l,Z as T,_ as D,c as b,a as t,t as x,u as _,q as n,e,F as J,W as K,C as O,i as y,ah as X,a5 as L,a0 as ve,b0 as pe,b1 as fe,U as me,E as xe,bi as he,V as ge,a3 as be,p as we,g as ke}from"./index-6a69b8ba.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css               */import{T as ye,_ as Ie,a as Ce,b as Be}from"./dark-e65213b8.js";import{_ as Se}from"./_plugin-vue_export-helper-c27b6911.js";function Te(){return F.post("niucloud/build",{})}function De(){return F.get("niucloud/build")}function Fe(){return F.get("niucloud/build/log")}function q(){return F.post("niucloud/build/clear")}function Ee(){return F.get("niucloud/build/check")}const N=E=>(we("data-v-bc65bed6"),E=E(),ke(),E),$e={class:"h-[50vh]"},Ve={key:0,class:"h-[50vh] flex flex-col"},Me={key:0,class:"bg-[#fff] my-3"},Ne={class:"pl-[20px]"},Re={class:"flex items-center"},je=N(()=>t("span",{class:"ml-[5px] leading-[20px]"},"编译权限错误，查看解决方案",-1)),Le=N(()=>t("div",{class:"border-[1px] border-primary rounded-[3px] w-[72px] h-[26px] leading-[25px] text-center"},"立即查看",-1)),qe={class:"px-[20px] pt-[10px] text-[14px] el-table"},ze={key:0},Pe={key:1},Qe={key:0},Ue={key:1},We={class:"h-[45vh]"},Ze={class:"flex justify-end mt-[20px]"},Ae={class:"h-[50vh] flex flex-col"},Ge={class:"flex-1 h-0 flex justify-center items-center flex-col"},He=N(()=>t("img",{src:Ce,alt:""},null,-1)),Je={class:"h-[50vh] flex flex-col"},Ke={class:"flex-1 h-0 flex justify-center items-center flex-col"},Oe=N(()=>t("img",{src:Be,alt:""},null,-1)),Xe=re({__name:"index",setup(E,{expose:Y}){const s=r(!1),ee=r(Date.now()),p=r(null),v=r("build"),C=r(null),w=r(!1),h=r(null);let B=[];const f=r(null),k=r(0);let c=null;const z=de(()=>{const o=k.value,a=Math.floor(o/60),g=o%60;return a>0?`${a}分${g}秒`:`${g}秒`}),P=()=>{De().then(({data:o})=>{o&&(p.value=o,s.value||localStorage.setItem("cloud_build_task","true"))}).catch()};P();const Q=r(""),$=r(!1),V=()=>{$.value=!0,Fe().then(o=>{if(!o.data){s.value&&B.length&&(v.value="complete",$.value=!1,h.value.execute("clear"),q(),c&&clearInterval(c),localStorage.removeItem("cloud_build_start_time"),localStorage.removeItem("cloud_build_task"));return}const a=o.data.data??[];let g="";if(a[0]&&a[0].length&&s.value){if(B.length==0){const u=localStorage.getItem("cloud_build_start_time");if(u)f.value=Number(u);else{const i=Date.now();f.value=i,localStorage.setItem("cloud_build_start_time",String(i))}k.value=Math.floor((Date.now()-f.value)/1e3),c&&clearInterval(c),c=setInterval(()=>{f.value&&(k.value=Math.floor((Date.now()-f.value)/1e3))},1e3),h.value.execute("clear"),h.value.execute("开始编译")}a[0].forEach(u=>{B.includes(u.action)||(h.value.pushMessage({content:`${u.action}`}),B.push(u.action),u.code==0&&(g=u.msg,h.value.pushMessage({content:u.msg,class:"error"}),$.value=!1,v.value="error",h.value.execute("clear"),q(),Q.value=u.msg,c&&(clearInterval(c),c=null),f.value&&(k.value=Math.floor((Date.now()-f.value)/1e3)),localStorage.removeItem("cloud_build_start_time"),localStorage.removeItem("cloud_build_task")))})}g||setTimeout(()=>{V()},2e3)}).catch()},M=r("normal"),U=()=>{v.value="build",M.value="success"},le=()=>{s.value=!0,v.value="build",V()},te=async()=>{if(w.value=!0,v.value="build",M.value="normal",p.value){s.value=!0,w.value=!1,V();return}Ee().then(async({data:o})=>{o.is_pass?Te().then(({data:a})=>{w.value=!1,p.value=a,s.value=!0,V()}).catch(()=>{s.value=!1,w.value=!1}):(w.value=!1,C.value=o,s.value=!0)}).catch(()=>{s.value=!1})};let R=null;const W=new ye,ae=(o,a,g,u,i)=>{if(a=="开始编译"){g(W);const S=oe(["/","——","\\","|"]);R=setInterval(()=>{W.flush("> "+S.next().value)},150)}},oe=o=>{let a=0;return{next(){return a+1==o.length&&(a=0),{value:o[a++]}}}},se=o=>{v.value=="build"&&p.value&&M.value=="normal"?X.confirm(n("cloudbuild.showDialogCloseTips"),n("warning"),{confirmButtonText:n("confirm"),cancelButtonText:n("cancel"),type:"warning"}).then(()=>{h.value.execute("clear"),localStorage.removeItem("cloud_build_start_time"),localStorage.removeItem("cloud_build_task"),o(),c&&clearInterval(c),c=null,f.value=null,k.value=0}).catch(()=>{}):o()},ue=()=>{v.value=="build"&&p.value&&M.value=="normal"?X.confirm(n("cloudbuild.showDialogCloseTips"),n("warning"),{confirmButtonText:n("confirm"),cancelButtonText:n("cancel"),type:"warning"}).then(()=>{h.value.execute("clear"),localStorage.removeItem("cloud_build_start_time"),localStorage.removeItem("cloud_build_task"),c&&clearInterval(c),c=null,f.value=null,k.value=0,s.value=!1}).catch(()=>{}):s.value=!1},ne=()=>{window.open("https://doc.niucloud.com/v6.html?keywords=/chang-jian-wen-ti-chu-li/er-shi-wu-3001-sheng-7ea7-yun-bian-yi-mu-lu-du-xie-quan-xian-zhuang-tai-bu-tong-guo-ru-he-chu-li")};return _e(()=>s.value,()=>{s.value||(p.value=null,v.value="build",B=[],R&&clearInterval(R),c&&clearInterval(c),f.value=null,k.value=0,q())}),Y({open:te,cloudBuildTask:p,loading:w,elNotificationClick:le,getCloudBuildTaskFn:P}),(o,a)=>{const g=L("QuestionFilled"),u=ve,i=pe,S=fe,Z=L("Select"),A=L("CloseBold"),G=me,I=xe,H=he,ce=ge,ie=be;return d(),j(ce,{modelValue:s.value,"onUpdate:modelValue":a[3]||(a[3]=m=>s.value=m),title:_(n)("cloudbuild.title"),width:"850px","close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":se},{default:l(()=>[T((d(),b("div",$e,[C.value&&!p.value?(d(),b("div",Ve,[C.value.dir?(d(),b("div",Me,[t("div",null,[t("p",Ne,x(_(n)("cloudbuild.dirPermission")),1),t("div",{class:"mt-[10px] mx-[20px] text-[14px] cursor-pointer text-primary flex items-center justify-between bg-[#EFF6FF] rounded-[4px] p-[10px]",onClick:ne},[t("div",Re,[e(u,{size:17},{default:l(()=>[e(g)]),_:1}),je]),Le])]),t("div",qe,[e(S,{class:"py-[10px] items table-head-bg pl-[15px] mb-[10px]"},{default:l(()=>[e(i,{span:18},{default:l(()=>[t("span",null,x(_(n)("cloudbuild.path")),1)]),_:1}),e(i,{span:3},{default:l(()=>[t("span",null,x(_(n)("cloudbuild.demand")),1)]),_:1}),e(i,{span:3},{default:l(()=>[t("span",null,x(_(n)("status")),1)]),_:1})]),_:1}),e(G,{style:{height:"calc(300px)",overflow:"auto"}},{default:l(()=>[(d(!0),b(J,null,K(C.value.dir.is_readable,m=>(d(),j(S,{class:"pb-[10px] items pl-[15px]"},{default:l(()=>[e(i,{span:18},{default:l(()=>[t("span",null,x(m.dir),1)]),_:2},1024),e(i,{span:3},{default:l(()=>[t("span",null,x(_(n)("cloudbuild.readable")),1)]),_:1}),e(i,{span:3},{default:l(()=>[m.status?(d(),b("span",ze,[e(u,{color:"green"},{default:l(()=>[e(Z)]),_:1})])):(d(),b("span",Pe,[e(u,{color:"red"},{default:l(()=>[e(A)]),_:1})]))]),_:2},1024)]),_:2},1024))),256)),(d(!0),b(J,null,K(C.value.dir.is_write,m=>(d(),j(S,{class:"pb-[10px] items pl-[15px]"},{default:l(()=>[e(i,{span:18},{default:l(()=>[t("span",null,x(m.dir),1)]),_:2},1024),e(i,{span:3},{default:l(()=>[t("span",null,x(_(n)("cloudbuild.write")),1)]),_:1}),e(i,{span:3},{default:l(()=>[m.status?(d(),b("span",Qe,[e(u,{color:"green"},{default:l(()=>[e(Z)]),_:1})])):(d(),b("span",Ue,[e(u,{color:"red"},{default:l(()=>[e(A)]),_:1})]))]),_:2},1024)]),_:2},1024))),256))]),_:1})])])):O("",!0)])):O("",!0),T(t("div",We,[e(_(Ie),{ref_key:"terminalRef",ref:h,name:`cloud-build-${ee.value}`,context:"","init-log":null,"show-header":!1,"show-log-time":!0,onExecCmd:ae},null,8,["name"])],512),[[D,p.value]]),T(t("div",Ze,[e(I,{onClick:a[0]||(a[0]=m=>ue()),class:"!w-[90px]"},{default:l(()=>[y("取消")]),_:1}),e(I,{type:"primary",loading:$.value,class:"!w-[140px]"},{default:l(()=>[y("已用时 "+x(_(z)),1)]),_:1},8,["loading"])],512),[[D,p.value]])])),[[D,v.value=="build"],[ie,w.value]]),T(t("div",null,[t("div",Ae,[t("div",Ge,[e(H,{icon:"error",title:_(n)("编译失败")},{icon:l(()=>[He]),extra:l(()=>[e(G,{class:"max-h-[150px] !overflow-auto text-[15px] text-[#4F516D] mb-[15px] mt-[-15px]"},{default:l(()=>[y(x(Q.value),1)]),_:1}),e(I,{onClick:U,class:"!w-[90px]"},{default:l(()=>[y("错误信息")]),_:1}),e(I,{onClick:a[1]||(a[1]=m=>s.value=!1),type:"primary",class:"!w-[90px]"},{default:l(()=>[y("完成")]),_:1})]),_:1},8,["title"])])])],512),[[D,v.value=="error"]]),T(t("div",null,[t("div",Je,[t("div",Ke,[e(H,{icon:"success",title:_(n)("cloudbuild.cloudbuildSuccess"),"sub-title":`编译耗时${_(z)}，成功编译完成。`},{icon:l(()=>[Oe]),extra:l(()=>[e(I,{onClick:U,class:"!w-[90px]"},{default:l(()=>[y("返回")]),_:1}),e(I,{onClick:a[2]||(a[2]=m=>s.value=!1),type:"primary",class:"!w-[90px]"},{default:l(()=>[y("完成")]),_:1})]),_:1},8,["title","sub-title"])])])],512),[[D,v.value=="complete"]])]),_:1},8,["modelValue","title"])}}});const il=Se(Xe,[["__scopeId","data-v-bc65bed6"]]);export{il as default};
