import{d as Ut,y as Lt,r as u,l as pe,n as we,aZ as zt,h as m,c as M,e as i,w as n,a as o,u as v,dW as Bt,i as y,F as te,W as ae,s as b,Y as ve,dp as Pt,dr as Rt,bb as Ve,t as _,C as D,Z as $t,dZ as Ee,dF as Me,dK as Te,dN as Nt,dP as Se,d_ as Ot,dA as Ie,dJ as Ft,B as jt,dY as Ht,$ as c,du as Jt,ah as B,bE as se,bh as Qt,E as Wt,L as Zt,M as qt,a4 as Gt,a1 as Kt,bV as Xt,N as ea,a0 as ta,aH as aa,d$ as sa,aI as la,aj as ia,as as ra,dU as na,ak as oa,cQ as ca,a2 as da,a9 as ua,ae as ma,af as _a,V as pa,a3 as va,p as fa,g as ya,e0 as ga,e1 as ha,dt as ba,e2 as ka}from"./index-28ce54e5.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                         *//* empty css                *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                        *//* empty css                    *//* empty css                 *//* empty css                *//* empty css                       *//* empty css                  */import"./el-form-item-4ed993c7.js";import{u as xa}from"./usePageState-a359535e.js";import{d as Ca,e as Da,f as wa,b as le,h as Va,i as Ea,j as fe,k as Ma,l as Ta,m as Ye,n as Sa,p as Ia,o as Ya}from"./recycle_order-836dc5c1.js";import{d as Aa}from"./device_query_api-f0f16bfa.js";import{_ as Ua}from"./printer-81c32d8c.js";import La from"./AddOrderDialog-39430724.js";import za from"./PaymentMethodDialog-e054831b.js";import Ba from"./OrderDetailDialog-53264be0.js";import Pa from"./PriceFormDialog-3527153f.js";import Ra from"./CheckDeviceDialog-ba81649e.js";import $a from"./DeviceConfirmDialog-e7da063f.js";import Na from"./DeviceDetailDialog-404d314a.js";import Oa from"./index-aa3445f1.js";import{_ as Fa}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                        *//* empty css                       *//* empty css                 *//* empty css                 *//* empty css                 *//* empty css                        *//* empty css                        *//* empty css                         *//* empty css                   *//* empty css                             */import"./index-16133bab.js";import"./index.vue_vue_type_style_index_0_lang-36d764c9.js";import"./attachment-6a2633f2.js";import"./index.vue_vue_type_script_setup_true_lang-101fc01a.js";/* empty css               *//* empty css                  *//* empty css                    *//* empty css                         */import"./index.vue_vue_type_script_setup_true_lang-e5b6971a.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-83b7ba07.js";import"./sortable.esm-be94e56d.js";/* empty css                  */import"./browser-a1ac24ac.js";import"./WarrantyInfoDisplay-fbb9d7b5.js";import"./member-fc2e9a4b.js";const Y=W=>(fa("data-v-2a302f55"),W=W(),ya(),W),ja={class:"recycle-order-list h-full"},Ha={class:"flex justify-between items-center mb-4"},Ja=Y(()=>o("span",{class:"text-xl font-semibold text-gray-800"},"ğŸ“± å›æ”¶è®¢å•ç®¡ç†",-1)),Qa={class:"btn-wrap"},Wa={class:"mb-3 sticky top-30 z-50 bg-white/95 backdrop-blur-sm shadow-lg rounded-lg p-2 -mx-2"},Za={class:"p-2"},qa={class:"flex justify-center pt-4 border-t border-orange-200"},Ga={class:"flex gap-3"},Ka={class:"flex items-center"},Xa=Y(()=>o("span",null,"å…¨éƒ¨",-1)),es={class:"flex items-center"},ts={class:"device-expansion-panel"},as={class:"panel-header mb-3"},ss=Y(()=>o("h4",{class:"text-lg font-medium text-gray-800"},"ğŸ“± è®¾å¤‡åˆ—è¡¨",-1)),ls={class:"text-sm text-gray-500"},is={class:"price-text"},rs={key:0,class:"flex justify-end mt-3"},ns={class:"order-info-cell"},os={class:"info-row"},cs=Y(()=>o("span",{class:"label"},"è®¢å•å·ï¼š",-1)),ds={class:"value"},us={class:"info-row"},ms=Y(()=>o("span",{class:"label"},"é…é€ï¼š",-1)),_s={class:"value"},ps={key:0,class:"info-row"},vs=Y(()=>o("span",{class:"text-gray-500 text-xs min-w-16"},"å¿«é€’å•å·ï¼š",-1)),fs=["onClick"],ys={key:0,class:"font-mono font-medium"},gs={class:"user-info-cell"},hs={class:"user-avatar"},bs={class:"user-details"},ks={class:"user-name"},xs={class:"user-phone"},Cs=Y(()=>o("div",{class:"text-xs"},"æäº¤æ•°é‡/ç­¾æ”¶æ•°é‡",-1)),Ds={class:"flex justify-between items-center mt-4"},ws={class:"text-sm text-gray-500"},Vs={key:0,class:"express-info-container"},Es={class:"express-header mb-4"},Ms={class:"flex items-center justify-between"},Ts={class:"text-lg font-medium"},Ss={class:"text-sm text-gray-600"},Is={class:"mt-2"},Ys={class:"text-sm text-gray-600"},As={class:"text-xs text-gray-500"},Us={class:"express-trace"},Ls=Y(()=>o("h4",{class:"text-md font-medium mb-3"},"ç‰©æµè½¨è¿¹",-1)),zs={class:"trace-item"},Bs={class:"trace-location"},Ps={class:"trace-desc"},Rs={key:1,class:"text-center py-8 text-gray-500"},$s=Ut({__name:"list",setup(W){Lt();const $=u({}),ie=u(!1),S=u([]),{expandedRows:Ae,pagination:g,setExpandedRows:Ue,setPagination:A,applyExpandedRows:Ns}=xa("recycle_order_list"),Le=pe(()=>Ae.value||[]),Z=t=>t?typeof t=="number"?new Date(t*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-"):typeof t=="string"&&t.match(/^\d{4}-\d{2}-\d{2}/)?t:"-":"-",U=u(!1),q=u(!1),N=u(0),w=u([]),re=u(!1),ye=u(null);u([]);const L=u([]),G=u(0),K=u({}),ne=u(!1),T=u(null),ze=u(null),P=u(null),Be=()=>{w.value.push({imei:"",model:"",initial_price:0,editing:!0,category_id:1})},Pe=t=>{const e=w.value.findIndex(r=>r===t||r.id===t.id);e!==-1&&(w.value[e].editing=!0)},Re=async t=>{try{t.id&&(await Ca(t.id),c.success("åˆ é™¤æˆåŠŸ"),await h(),U.value=!1),w.value=w.value.filter(e=>e!==t&&e.id!==t.id)}catch(e){console.error("åˆ é™¤è®¾å¤‡å¤±è´¥ï¼š",e),c.error("åˆ é™¤å¤±è´¥ï¼š"+(e.message||"æœªçŸ¥é”™è¯¯"))}},$e=()=>{U.value=!1,w.value=[],N.value=0},V=we({keyword:"",status:"",delivery_type:""}),s=we({order_id:"",express_no:"",status:[],member_id:"",user_mobile:"",delivery_type:[],device_imei:"",device_model:"",device_count_min:null,device_count_max:null,amount_min:null,amount_max:null,create_time_range:[],update_time_range:[],sign_at:[],complete_at:[],pay_time:[]});u(!0);const Ne=async()=>{try{const t=await Da();t.code===1&&($.value=t.data)}catch(t){console.error("è·å–çŠ¶æ€åˆ—è¡¨å¤±è´¥:",t)}},Oe=u(null),h=async(t=1)=>{ie.value=!0;try{const e={page:g.value.page,limit:g.value.limit};V.keyword&&(e.keyword=V.keyword),V.status&&(e.status=V.status),V.delivery_type&&(e.delivery_type=V.delivery_type),s.order_id&&(e.order_id=s.order_id),s.express_no&&(e.express_no=s.express_no),s.status&&s.status.length>0&&(e.status=s.status.join(",")),s.member_id&&(e.member_id=s.member_id),s.user_mobile&&(e.user_mobile=s.user_mobile),s.delivery_type&&s.delivery_type.length>0&&(e.delivery_type=s.delivery_type.join(",")),s.device_imei&&(e.device_imei=s.device_imei),s.device_model&&(e.device_model=s.device_model),s.device_count_min&&(e.device_count_min=s.device_count_min),s.device_count_max&&(e.device_count_max=s.device_count_max),s.amount_min&&(e.amount_min=s.amount_min),s.amount_max&&(e.amount_max=s.amount_max),s.create_time_range&&s.create_time_range.length===2&&(e.create_time_start=s.create_time_range[0],e.create_time_end=s.create_time_range[1]),s.update_time_range&&s.update_time_range.length===2&&(e.update_time_start=s.update_time_range[0],e.update_time_end=s.update_time_range[1]),s.pay_time&&s.pay_time.length===2&&(e.pay_time=s.pay_time),s.sign_at&&s.sign_at.length===2&&(e.sign_at=s.sign_at),s.complete_at&&s.complete_at.length===2&&(e.complete_at=s.complete_at);const r=await wa(e);r.data.data?S.value=r.data.data:r.data.list?S.value=r.data.list:(S.value=[],console.error("APIè¿”å›çš„æ•°æ®ç»“æ„ä¸ç¬¦åˆé¢„æœŸ:",r.data));const l=r.data.total||r.data.count||0;ge.value=r.data.status_counts,A({total:l})}catch(e){console.error("è·å–åˆ—è¡¨å¤±è´¥:",e),c.error("è·å–åˆ—è¡¨å¤±è´¥")}finally{ie.value=!1}},Fe=t=>{A({limit:t,page:g.value.page}),h(1)},je=t=>{A({page:t,limit:g.value.limit}),h(t)};u(!1);const ge=u({}),He=t=>t==="all"?g.value.total:ge.value[t]||0,Je=t=>({1:"warning",2:"warning",3:"primary",4:"success",5:"warning",6:"primary",7:"success",8:"info",9:"danger",10:"danger"})[t]||"info",Qe=t=>({1:"light",2:"light",3:"light",4:"light",5:"light",6:"dark",7:"dark",8:"plain",9:"dark",10:"dark"})[t]||"plain",We=t=>({1:"info",2:"warning",3:"primary",4:"success",5:"success",6:"danger"})[t]||"info",he=t=>{switch(t){case 1:return"Clock";case 2:return"Finished";case 3:return"Loading";case 4:return"DocumentChecked";case 5:return"CircleCheck";case 6:return"Money";case 7:return"CircleCheckFilled";case 8:return"CircleClose";default:return"QuestionFilled"}},Ze=t=>({1:"warning",2:"info",3:"primary",4:"success",5:"warning",6:"primary",7:"success",8:"info",9:"danger",10:"danger"})[t]||"info",qe=t=>({order_sign:"primary",order_check:"success",order_price:"warning",order_payment:"primary",order_complete:"success",order_cancel:"danger",order_delete:"danger",order_detail:"info"})[t]||"default",Ge=t=>({order_sign:Ee,order_check:ve,order_price:Me,order_payment:ga,order_complete:ha,order_cancel:ba,order_delete:Se,order_detail:Ie,order_push_notify:ka})[t]||Jt,Ke=t=>t?`Â¥${(typeof t=="string"?parseFloat(t):t).toFixed(2)}`:"Â¥0.00",Xe=async t=>{try{await B.confirm("ç¡®å®šè¦æ¨é€è®¢å•ç¡®è®¤é€šçŸ¥ç»™ç”¨æˆ·å—ï¼Ÿ","æ¨é€é€šçŸ¥",{confirmButtonText:"ç¡®å®šæ¨é€",cancelButtonText:"å–æ¶ˆ",type:"info"});const e=se.service({lock:!0,text:"æ­£åœ¨å‘é€é€šçŸ¥...",background:"rgba(0, 0, 0, 0.7)"});await Ya(t.id),e.close(),c.success("æ¨é€é€šçŸ¥å·²å‘é€")}catch(e){e!=="cancel"&&(console.error("æ¨é€é€šçŸ¥å¤±è´¥ï¼š",e),c.error(e.message||"æ¨é€é€šçŸ¥å¤±è´¥"))}},et=async(t,e)=>{try{if(e.key==="order_cancel")await B.confirm("ç¡®å®šè¦å–æ¶ˆè¯¥è®¢å•å—ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await le(t.id,{action:"order_cancel"}),c.success("è®¢å•å·²å–æ¶ˆ"),await h(g.value.page);else if(e.key==="order_delete")await B.confirm("ç¡®å®šè¦åˆ é™¤è¯¥è®¢å•å—ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await Va(t.id),c.success("è®¢å•å·²åˆ é™¤"),await h(g.value.page);else if(e.key==="order_complete")await B.confirm("ç¡®å®šè¦å®Œæˆè¯¥è®¢å•å—ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await le(t.id,{action:"order_complete"}),c.success("æ“ä½œæˆåŠŸï¼Œè®¢å•å·²å®Œæˆ"),await h(g.value.page);else if(e.key==="order_sign")N.value=t.id,w.value=t.devices||[],U.value=!0;else if(e.key==="order_check")N.value=t.id,w.value=t.devices||[],O.value=!0;else if(e.key==="order_price")N.value=t.id,w.value=t.devices||[],F.value=!0;else if(e.key=="order_payment"){q.value=!0;const r=await Ea(t.member_id);if(r.data&&Array.isArray(r.data)){const l=S.value.find(p=>p.id===t.id);let f=0;l&&l.devices&&Array.isArray(l.devices)&&(f=l.devices.filter(p=>p.status===6).length);let C=0;l&&l.devices&&Array.isArray(l.devices)&&(C=l.devices.filter(p=>p.status>=4).length);let J=0;l&&l.devices&&Array.isArray(l.devices)&&(J=l.devices.filter(p=>p.status>=5).length);let z=0;l&&l.devices&&Array.isArray(l.devices)&&(z=l.devices.filter(p=>p.status==5).length);let ee=0;l&&l.devices&&Array.isArray(l.devices)&&(ee=l.devices.filter(p=>p.status==5).reduce((p,me)=>p+ +me.final_price,0));const I={order_id:l?l.id:t.id,delivery_type:l?l.delivery_type_text:"",device_count:l&&l.devices?l.devices.length:0,confirmed_count:J,checked_count:C,success_count:z,returned_count:f,price_per_device:l?l.price_per_device:0,total_amount:l?ee:0,customer_name:l?l.member.nickname:"",customer_mobile:l?l.member.mobile:"",delivery_type_name:l?l.delivery_type_name:"",devices:l&&l.devices?l.devices.map(p=>({id:p.id,model:p.model,imei:p.imei,final_price:p.final_price||0,status:p.status,status_name:p.status_name||""})):[]},Q=r.data.map(p=>({...p,order_summary:I}));L.value=Q,G.value=Q.length>0?0:-1}else L.value=[]}else if(e.key=="order_detail"){const r=S.value.find(l=>l.id===t.id);r?(ye.value=r,re.value=!0):c.warning("æœªæ‰¾åˆ°è®¢å•ä¿¡æ¯")}else e.key=="order_push_notify"?await Xe(t):(await le(t.id,{action:e.key}),c.success("æ“ä½œæˆåŠŸ"),await h())}catch(r){console.error("æ“ä½œå¤±è´¥ï¼š",r),c.error(r.message||"æ“ä½œå¤±è´¥")}},oe=t=>t?t.length:0,tt=()=>{st(),H.value="",A({page:1}),h(1)},at=()=>{lt(),H.value="",A({page:1}),h(1)},st=()=>{V.keyword="",V.status="",V.delivery_type=""},lt=()=>{s.order_id="",s.express_no="",s.status=[],s.member_id="",s.user_mobile="",s.delivery_type=[],s.device_imei="",s.device_model="",s.device_count_min=null,s.device_count_max=null,s.amount_min=null,s.amount_max=null,s.create_time_range=[],s.update_time_range=[],s.sign_at=[],s.complete_at=[],s.pay_time=[]},it=(t,e)=>{s.member_id=t,A({page:1}),h(1)},rt=t=>{const e=S.value.find(r=>r.id===t);return e?e.status:0},X=u({id:0,imei:"",model:"",initial_price:"",check_result:"",check_images:"",remark:"",status:0,final_price:"",check_status:0}),O=u(!1),F=u(!1);u({});const nt=async t=>{const e=t.order_id,r=S.value.find(f=>f.id===e);if(r&&r.status===1){c.warning("è¯·å…ˆç­¾æ”¶è®¢å•åå†è¿›è¡Œè´¨æ£€");return}O.value=!0;const l=await fe(t.id);l.code===1&&(X.value={id:l.data.id,imei:l.data.imei,model:l.data.model,initial_price:l.data.initial_price,check_result:l.data.check_result||"",check_images:l.data.check_images||"",final_price:l.data.final_price||"",remark:l.data.remark||"",status:l.data.status,check_status:l.data.check_status})},be=async t=>{try{const e=await fe(t.id);e.code===1&&(X.value={id:e.data.id,imei:e.data.imei,model:e.data.model,initial_price:e.data.initial_price,check_result:e.data.check_result||"",check_images:e.data.check_images||"",final_price:e.data.final_price||"",before_price:e.data.before_price||"",remark:e.data.remark||"",status:e.data.status,check_status:e.data.check_status},F.value=!0)}catch(e){console.error("è·å–è®¾å¤‡ä¿¡æ¯å¤±è´¥:",e),c.error("è·å–è®¾å¤‡ä¿¡æ¯å¤±è´¥")}},ot=async t=>{var e,r;try{if(!t.check_result){c.warning("è¯·å¡«å†™è´¨æ£€ç»“æœ");return}await Ma(t.id,{check_result:t.check_result,check_images:t.check_images,remark:t.remark,check_status:1,final_price:t.final_price,action:"check",imei:t.imei,info:t.info,model:t.model}),c.success("è´¨æ£€ä¿¡æ¯æäº¤æˆåŠŸ"),O.value=!1,await h(g.value.page)}catch(l){console.error("æäº¤è´¨æ£€ä¿¡æ¯å¤±è´¥ï¼š",l),c.error(((r=(e=l.response)==null?void 0:e.data)==null?void 0:r.message)||"æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•")}},ct=async t=>{try{if(!t||!t.final_price||t.final_price<=0){c.warning("è¯·è¾“å…¥æœ‰æ•ˆçš„ä»·æ ¼");return}await Ta(t.id,t),c.success("å®šä»·ä¿¡æ¯æäº¤æˆåŠŸ"),F.value=!1,await h(g.value.page)}catch(e){console.error("æäº¤å®šä»·ä¿¡æ¯å¤±è´¥ï¼š",e),c.error("æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•")}},j=u({}),dt=(t,e)=>{j.value[e]=t},ut=async t=>{t||c.warning("è¯·é€‰æ‹©è®¾å¤‡");try{await Ye({ids:t+"",remark:"ç®¡ç†å‘˜ç¡®è®¤"}),h(g.value.page)}catch{c.error("ç¡®è®¤å¤±è´¥")}},mt=async t=>{if(!t){c.warning("è¯·é€‰æ‹©è®¾å¤‡");return}try{const{value:e}=await B.prompt(`ç¡®å®šè¦æ‹’ç»å›æ”¶è¯¥è®¾å¤‡å—ï¼Ÿå°†åˆ›å»ºé€€è´§è®¢å•å¤„ç†è¯¥è®¾å¤‡ã€‚
è¯·è¾“å…¥æ‹’ç»å›æ”¶åŸå› ï¼š`,"æ‹’ç»å›æ”¶ç¡®è®¤",{confirmButtonText:"ç¡®å®šæ‹’ç»",cancelButtonText:"å–æ¶ˆ",type:"warning",inputPlaceholder:"è¯·è¾“å…¥æ‹’ç»å›æ”¶åŸå› "}),r=se.service({lock:!0,text:"æ­£åœ¨å¤„ç†...",background:"rgba(0, 0, 0, 0.7)"});await Sa({ids:t+"",remark:e||"å•†æˆ·æ‹’ç»å›æ”¶"}),r.close(),c.success("æ‹’ç»æˆåŠŸï¼Œå·²åˆ›å»ºé€€è´§è®¢å•"),h(g.value.page)}catch(e){if(e==="cancel")return;console.error("æ‹’ç»å¤±è´¥:",e)}},_t=async t=>{try{const e=j.value[t].map(l=>l.id);if(e.length===0){c.warning("è¯·é€‰æ‹©è®¾å¤‡");return}const{value:r}=await B.prompt("è¯·è¾“å…¥æ“ä½œå¤‡æ³¨","æ‰¹é‡ç¡®è®¤è®¾å¤‡",{confirmButtonText:"ç¡®è®¤",cancelButtonText:"å–æ¶ˆ",inputPlaceholder:"è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰"});await Ye({ids:e.join(","),remark:r||""}),c.success("æ‰¹é‡ç¡®è®¤æˆåŠŸ"),await h(g.value.page)}catch(e){e!=="cancel"&&(console.error("æ‰¹é‡ç¡®è®¤å¤±è´¥ï¼š",e),c.error("æ‰¹é‡ç¡®è®¤å¤±è´¥"))}},pt=(t,e)=>{const r=e.map(l=>l.id);Ue(r)},ce=u(!1),ke=u({}),vt=async t=>{try{const e=await fe(t.id);if(e.code!==1){c.error(e.msg||"è·å–è®¾å¤‡è¯¦æƒ…å¤±è´¥");return}ue.value=e.data,ce.value=!0}catch(e){console.error("è·å–è®¾å¤‡è¯¦æƒ…å¤±è´¥:",e),c.error("è·å–è®¾å¤‡è¯¦æƒ…å¤±è´¥")}},de=u(!1),ft=()=>{de.value=!0},yt=async()=>{await h()};zt(async()=>{await Ne(),await h(g.value.page)}),pe(()=>L.value&&L.value.length>0&&G.value>=0&&G.value<L.value.length?L.value[G.value]:null);const H=u(""),gt=t=>{H.value=t.props.name,V.status=t.props.name,s.status=[],A({page:1}),h(1)},ht=async t=>{try{await Ia(t.orderId,{pay_type:t.payType,remark:"è´¢åŠ¡å·²ç¡®è®¤æ‰“æ¬¾"}),c.success("ç¡®è®¤æ‰“æ¬¾æˆåŠŸ"),q.value=!1,await h()}catch(e){console.error("ç¡®è®¤æ‰“æ¬¾å¤±è´¥",e),c.error("ç¡®è®¤æ‰“æ¬¾å¤±è´¥")}},ue=u(null),bt=()=>{ue.value=null},kt=async t=>{const e=se.service({lock:!0,text:"æ­£åœ¨ä¿å­˜...",background:"rgba(0, 0, 0, 0.7)"});try{const r=await le(t.orderId,{action:"order_sign",devices:t.devices.map(l=>({id:l.id,imei:l.imei,model:l.model,initial_price:l.initial_price,category_id:l.category_id}))});if(r.code!==1)throw e.close(),U.value=!1,new Error(r.message||"æ“ä½œå¤±è´¥");c.success("è®¢å•ç­¾æ”¶æˆåŠŸ"),U.value=!1,await h(),e.close()}catch{e.close()}};pe(()=>{var t,e;return(e=(t=ke.value)==null?void 0:t.data)!=null&&e.check_images?ke.value.data.check_images.split(",").filter(r=>r):[]});const xt=async t=>{try{const e=se.service({lock:!0,text:"æ­£åœ¨æ‰“å°æ ‡ç­¾...",background:"rgba(0, 0, 0, 0.7)"}),r=await Ua(t.id);if(e.close(),r.code===1)c.success("æ ‡ç­¾æ‰“å°æˆåŠŸ"),r.data&&r.data.simulated&&(Qt({title:"æ¨¡æ‹Ÿæ‰“å°",message:"å·²ç”Ÿæˆæ‰“å°å†…å®¹ï¼Œä½†æœªè¿æ¥å®é™…æ‰“å°æœº",type:"warning",duration:5e3}),B.alert(`<pre style="white-space: pre-wrap; font-family: monospace; font-size: 12px;">${r.data.content}</pre>`,"æ‰“å°å†…å®¹é¢„è§ˆ",{dangerouslyUseHTMLString:!0,confirmButtonText:"å…³é—­",callback:()=>{}}));else{const l=r.message||"æ‰“å°å¤±è´¥",f=r.debug_info?JSON.stringify(r.debug_info):"";c.error(`${l} ${f}`),console.error("æ‰“å°å¤±è´¥:",r)}}catch(e){console.error("æ‰“å°è¿‡ç¨‹å¼‚å¸¸:",e),c.error(`æ‰“å°è¿‡ç¨‹å¼‚å¸¸: ${e.message||"æœªçŸ¥é”™è¯¯"}`)}},Ct=async(t,e)=>{try{return(await Aa(t,e)).data}catch(r){throw console.error("æŸ¥è¯¢å¿«é€’ä¿¡æ¯å¤±è´¥:",r),r}},Dt=async t=>{!t.express_no||t.express_no==="æš‚æ— "||(P.value&&clearTimeout(P.value),P.value=setTimeout(async()=>{var e,r;try{K.value[t.id]=!0;const f=(((e=t.member)==null?void 0:e.mobile)||((r=t.recycleUserAddress)==null?void 0:r.mobile)||"").slice(-4);if(!f){c.warning("æ— æ³•è·å–ç”¨æˆ·æ‰‹æœºå·ï¼Œæ— æ³•æŸ¥è¯¢å¿«é€’ä¿¡æ¯");return}const C=await Ct(t.express_no,f);if(!C||!C.data||!C.data.logisticsTraceDetailList||C.data.logisticsTraceDetailList.length===0){c.info("æš‚æ— ç‰©æµä¿¡æ¯");return}T.value=C.data,ze.value=t,ne.value=!0}catch(l){console.error("æŸ¥è¯¢å¿«é€’ä¿¡æ¯å¤±è´¥:",l),c.error("æŸ¥è¯¢å¿«é€’ä¿¡æ¯å¤±è´¥")}finally{K.value[t.id]=!1}},500))},wt=()=>{P.value&&(clearTimeout(P.value),P.value=null)},Vt=t=>{switch(t){case"ACCEPT":return"info";case"TRANSPORT":return"warning";case"DELIVER":return"primary";case"SIGN":return"success";case"REJECT":case"EXCEPTION":return"danger";default:return"info"}};return(t,e)=>{const r=Wt,l=Zt,f=qt,C=Gt,J=Kt,z=Xt,ee=ea,I=ta,Q=aa,p=sa,me=la,x=ia,R=ra,_e=na,xe=oa,Et=ca,Mt=da,Tt=ua,St=ma,It=_a,Yt=pa,At=va;return m(),M("div",ja,[i(Tt,{class:"box-card !border-none h-full relative",shadow:"never"},{default:n(()=>[o("div",Ha,[Ja,o("div",Qa,[i(r,{type:"primary",icon:v(Bt),onClick:ft},{default:n(()=>[y("ä»£ä¸‹å•")]),_:1},8,["icon"])])]),o("div",Wa,[o("div",Za,[i(ee,{inline:!0,model:s},{default:n(()=>[i(f,{label:"è®¢å•ç¼–å·"},{default:n(()=>[i(l,{modelValue:s.order_id,"onUpdate:modelValue":e[0]||(e[0]=a=>s.order_id=a),placeholder:"è¾“å…¥ç²¾ç¡®è®¢å•å·",clearable:"",class:"w-full"},null,8,["modelValue"])]),_:1}),i(f,{label:"å¿«é€’å•å·"},{default:n(()=>[i(l,{modelValue:s.express_no,"onUpdate:modelValue":e[1]||(e[1]=a=>s.express_no=a),placeholder:"è¾“å…¥å¿«é€’å•å·",clearable:"",class:"w-full"},null,8,["modelValue"])]),_:1}),i(f,{label:"è®¢å•çŠ¶æ€"},{default:n(()=>[i(J,{modelValue:s.status,"onUpdate:modelValue":e[2]||(e[2]=a=>s.status=a),placeholder:"é€‰æ‹©çŠ¶æ€",clearable:"",multiple:"","collapse-tags":"",class:"w-full"},{default:n(()=>[(m(!0),M(te,null,ae($.value,(a,k)=>(m(),b(C,{key:k,label:a.name,value:a.status},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(f,{label:"ç”¨æˆ·æœç´¢"},{default:n(()=>[i(Oa,{modelValue:s.member_id,"onUpdate:modelValue":e[3]||(e[3]=a=>s.member_id=a),placeholder:"ğŸ” è¾“å…¥ç”¨æˆ·æ˜µç§°ã€æ‰‹æœºå·æˆ–ç”¨æˆ·ç¼–å·",onChange:it,class:"w-full"},null,8,["modelValue"])]),_:1}),i(f,{label:"ç”¨æˆ·æ‰‹æœºå·"},{default:n(()=>[i(l,{modelValue:s.user_mobile,"onUpdate:modelValue":e[4]||(e[4]=a=>s.user_mobile=a),placeholder:"è¾“å…¥ç”¨æˆ·æ‰‹æœºå·",clearable:"",class:"w-full"},null,8,["modelValue"])]),_:1}),i(f,{label:"é…é€æ–¹å¼"},{default:n(()=>[i(J,{modelValue:s.delivery_type,"onUpdate:modelValue":e[5]||(e[5]=a=>s.delivery_type=a),placeholder:"é€‰æ‹©é…é€æ–¹å¼",clearable:"",multiple:"",class:"w-full"},{default:n(()=>[i(C,{label:"ğŸ“¦ å¿«é€’é…é€",value:"1"}),i(C,{label:"ğŸš— è‡ªé€åˆ°åº—",value:"2"})]),_:1},8,["modelValue"])]),_:1}),i(f,{label:"è®¾å¤‡IMEI"},{default:n(()=>[i(l,{modelValue:s.device_imei,"onUpdate:modelValue":e[6]||(e[6]=a=>s.device_imei=a),placeholder:"è¾“å…¥è®¾å¤‡IMEIå·",clearable:"",class:"w-full"},null,8,["modelValue"])]),_:1}),i(f,{label:"è®¾å¤‡å‹å·"},{default:n(()=>[i(l,{modelValue:s.device_model,"onUpdate:modelValue":e[7]||(e[7]=a=>s.device_model=a),placeholder:"è¾“å…¥è®¾å¤‡å‹å·",clearable:"",class:"w-full"},null,8,["modelValue"])]),_:1}),i(f,{label:"åˆ›å»ºæ—¶é—´"},{default:n(()=>[i(z,{modelValue:s.create_time_range,"onUpdate:modelValue":e[8]||(e[8]=a=>s.create_time_range=a),type:"daterange","range-separator":"è‡³","start-placeholder":"å¼€å§‹æ—¥æœŸ","end-placeholder":"ç»“æŸæ—¥æœŸ",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"w-full"},null,8,["modelValue"])]),_:1}),i(f,{label:"ç­¾æ”¶æ—¶é—´"},{default:n(()=>[i(z,{modelValue:s.sign_at,"onUpdate:modelValue":e[9]||(e[9]=a=>s.sign_at=a),type:"daterange","range-separator":"è‡³","start-placeholder":"å¼€å§‹æ—¥æœŸ","end-placeholder":"ç»“æŸæ—¥æœŸ",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"w-full"},null,8,["modelValue"])]),_:1}),i(f,{label:"è´¨æ£€æ—¶é—´"},{default:n(()=>[i(z,{modelValue:s.complete_at,"onUpdate:modelValue":e[10]||(e[10]=a=>s.complete_at=a),type:"daterange","range-separator":"è‡³","start-placeholder":"å¼€å§‹æ—¥æœŸ","end-placeholder":"ç»“æŸæ—¥æœŸ",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"w-full"},null,8,["modelValue"])]),_:1}),i(f,{label:"æ‰“æ¬¾æ—¶é—´"},{default:n(()=>[i(z,{modelValue:s.pay_time,"onUpdate:modelValue":e[11]||(e[11]=a=>s.pay_time=a),type:"daterange","range-separator":"è‡³","start-placeholder":"å¼€å§‹æ—¥æœŸ","end-placeholder":"ç»“æŸæ—¥æœŸ",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"w-full"},null,8,["modelValue"])]),_:1}),o("div",qa,[o("div",Ga,[i(r,{type:"primary",icon:v(ve),onClick:tt,class:"bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 border-0 shadow-sm px-6"},{default:n(()=>[y(" æ‰§è¡Œé«˜çº§æœç´¢ ")]),_:1},8,["icon"]),i(r,{icon:v(Pt),onClick:at,class:"border-gray-300 text-gray-600 hover:border-gray-400 px-6"},{default:n(()=>[y(" é‡ç½®æ‰€æœ‰æ¡ä»¶ ")]),_:1},8,["icon"])])])]),_:1},8,["model"])])]),i(me,{modelValue:H.value,"onUpdate:modelValue":e[12]||(e[12]=a=>H.value=a),onTabClick:gt,class:"order-tabs"},{default:n(()=>[i(Q,{name:""},{label:n(()=>[o("div",Ka,[i(I,{class:"mr-1"},{default:n(()=>[i(v(Rt))]),_:1}),Xa])]),_:1}),(m(!0),M(te,null,ae($.value,(a,k)=>(m(),b(Q,{key:k,name:a.status},{label:n(()=>[o("div",es,[i(I,{class:"mr-1"},{default:n(()=>[(m(),b(Ve(he(a.status))))]),_:2},1024),o("span",null,_(a.name),1),a.status<7?(m(),b(p,{key:0,value:He(a.status),class:"ml-1",type:Ze(a.status)},null,8,["value","type"])):D("",!0)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),$t((m(),b(xe,{ref_key:"orderTable",ref:Oe,data:S.value,"expand-row-keys":v(Le),"row-key":"id",style:{width:"100%"},onExpandChange:pt,class:"order-table"},{default:n(()=>[i(x,{type:"expand"},{default:n(({row:a})=>{var k;return[o("div",ts,[o("div",as,[ss,o("span",ls,"å…± "+_(((k=a.devices)==null?void 0:k.length)||0)+" å°è®¾å¤‡",1)]),i(xe,{data:a.devices,border:"",size:"small",onSelectionChange:d=>dt(d,a.id),class:"device-table"},{default:n(()=>[i(x,{type:"selection",width:"55"}),i(x,{prop:"imei",label:"IMEI","min-width":"150"}),i(x,{prop:"model",label:"è®¾å¤‡å‹å·","min-width":"120"}),i(x,{prop:"final_price",label:"æœ€ç»ˆä»·æ ¼",width:"100"},{default:n(({row:d})=>[o("span",is,_(Ke(d.final_price)),1)]),_:2},1024),i(x,{prop:"status_name",label:"çŠ¶æ€",width:"100"},{default:n(({row:d})=>[i(R,{type:We(d.status),size:"small"},{default:n(()=>[y(_(d.status_name),1)]),_:2},1032,["type"])]),_:2},1024),i(x,{label:"æ“ä½œ","min-width":"280"},{default:n(({row:d})=>[i(_e,null,{default:n(()=>[d.status===1&&rt(d.order_id)>1?(m(),b(r,{key:0,type:"primary",size:"small",icon:v(Ee),onClick:E=>nt(d)},{default:n(()=>[y(" å¼€å§‹è´¨æ£€ ")]),_:2},1032,["icon","onClick"])):D("",!0),d.status==2||d.status==3?(m(),b(r,{key:1,type:"success",size:"small",icon:v(Me),onClick:E=>be(d)},{default:n(()=>[y(" å®šä»· ")]),_:2},1032,["icon","onClick"])):D("",!0),d.status==4?(m(),b(r,{key:2,type:"primary",size:"small",icon:v(Te),onClick:E=>ut(d.id)},{default:n(()=>[y(" ç¡®è®¤ ")]),_:2},1032,["icon","onClick"])):D("",!0),d.status==4?(m(),b(r,{key:3,type:"warning",size:"small",icon:v(Nt),onClick:E=>be(d)},{default:n(()=>[y(" é‡æ–°å®šä»· ")]),_:2},1032,["icon","onClick"])):D("",!0),d.status==4?(m(),b(r,{key:4,type:"danger",size:"small",icon:v(Se),onClick:E=>mt(d.id)},{default:n(()=>[y(" æ‹’ç» ")]),_:2},1032,["icon","onClick"])):D("",!0),d.status>=3?(m(),b(r,{key:5,type:"info",size:"small",icon:v(Ot),onClick:E=>xt(d)},{default:n(()=>[y(" æ‰“å°æ ‡ç­¾ ")]),_:2},1032,["icon","onClick"])):D("",!0)]),_:2},1024),i(r,{type:"primary",link:"",icon:v(Ie),onClick:E=>vt(d),size:"small",class:"ml-2"},{default:n(()=>[y(" æŸ¥çœ‹è¯¦æƒ… ")]),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:2},1032,["data","onSelectionChange"]),j.value[a.id]&&j.value[a.id].length>0&&a.status==4?(m(),M("div",rs,[i(_e,null,{default:n(()=>[i(r,{type:"primary",size:"small",icon:v(Te),onClick:d=>_t(a.id)},{default:n(()=>[y(" æ‰¹é‡ç¡®è®¤ ("+_(j.value[a.id].length)+") ",1)]),_:2},1032,["icon","onClick"])]),_:2},1024)])):D("",!0)])]}),_:1}),i(x,{label:"è®¢å•ä¿¡æ¯","min-width":"200"},{default:n(({row:a})=>[o("div",ns,[o("div",os,[cs,o("span",ds,_(a.order_no),1)]),o("div",us,[ms,o("span",_s,[i(R,{size:"small",type:a.delivery_type==="1"?"warning":"success"},{default:n(()=>[y(_(a.delivery_type==="1"?"ğŸ“¦ å¿«é€’":"ğŸš— è‡ªé€"),1)]),_:2},1032,["type"])])]),a.delivery_type==="1"?(m(),M("div",ps,[vs,o("span",{class:"flex-1 cursor-pointer transition-all duration-300 ease-in-out rounded px-1 py-0.5 hover:bg-blue-50 hover:text-blue-600 text-gray-800 text-sm break-all",onClick:k=>Dt(a),onMouseleave:wt},[K.value[a.id]?(m(),b(I,{key:1,class:"animate-spin text-blue-500"},{default:n(()=>[i(v(Ft))]),_:1})):(m(),M("span",ys,_(a.express_no||"æš‚æ— "),1)),a.express_no&&!K.value[a.id]?(m(),b(I,{key:2,class:"ml-1 text-gray-400 text-xs"},{default:n(()=>[i(v(ve))]),_:1})):D("",!0)],40,fs)])):D("",!0)])]),_:1}),i(x,{label:"ç”¨æˆ·ä¿¡æ¯","min-width":"150"},{default:n(({row:a})=>{var k,d,E,Ce,De;return[o("div",gs,[o("div",hs,[i(Et,{size:32,src:(k=a.member)!=null&&k.headimg?v(jt)(a.member.headimg):"",class:"mr-2"},{default:n(()=>[i(I,null,{default:n(()=>[i(v(Ht))]),_:1})]),_:2},1032,["src"])]),o("div",bs,[o("div",ks,_(((d=a.recycleUserAddress)==null?void 0:d.name)||((E=a.member)==null?void 0:E.nickname)||"æœªçŸ¥ç”¨æˆ·"),1),o("div",xs,_(((Ce=a.member)==null?void 0:Ce.mobile)||((De=a.recycleUserAddress)==null?void 0:De.mobile)||"æš‚æ— è”ç³»æ–¹å¼"),1)])])]}),_:1}),i(x,{width:"140",align:"center"},{header:n(()=>[Cs]),default:n(({row:a})=>[a.count==oe(a.devices)?(m(),b(R,{key:0,type:"success",class:"device-count-tag"},{default:n(()=>[y(_(a.count)+"/ "+_(oe(a.devices))+"å° ",1)]),_:2},1024)):(m(),b(R,{key:1,type:"danger",class:"device-count-tag"},{default:n(()=>[y(_(a.count?a.count:"1")+"/ "+_(oe(a.devices))+"å° ",1)]),_:2},1024))]),_:1}),i(x,{label:"çŠ¶æ€",width:"120",align:"center"},{default:n(({row:a})=>[i(R,{type:Je(a.status),effect:Qe(a.status)},{default:n(()=>[i(I,{class:"mr-1"},{default:n(()=>[(m(),b(Ve(he(a.status))))]),_:2},1024),y(" "+_(a.status_name),1)]),_:2},1032,["type","effect"])]),_:1}),i(x,{prop:"create_at",label:"åˆ›å»ºæ—¶é—´",width:"180"},{default:n(({row:a})=>[y(_(Z(a.create_at)),1)]),_:1}),i(x,{prop:"sign_at",label:"ç­¾æ”¶æ—¶é—´",width:"180"},{default:n(({row:a})=>[y(_(Z(a.sign_at)),1)]),_:1}),i(x,{prop:"complete_at",label:"å®Œæˆæ—¶é—´",width:"180"},{default:n(({row:a})=>[y(_(Z(a.complete_at)),1)]),_:1}),i(x,{prop:"pay_time",label:"æ‰“æ¬¾æ—¶é—´",width:"180"},{default:n(({row:a})=>[y(_(Z(a.pay_time)),1)]),_:1}),i(x,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:n(({row:a})=>{var k;return[(k=$.value[a.status])!=null&&k.action?(m(),b(_e,{key:0},{default:n(()=>[(m(!0),M(te,null,ae($.value[a.status].action,d=>(m(),b(r,{key:d.key,size:"small",type:qe(d.key),icon:Ge(d.key),onClick:E=>et(a,d)},{default:n(()=>[y(_(d.value),1)]),_:2},1032,["type","icon","onClick"]))),128))]),_:2},1024)):D("",!0)]}),_:1})]),_:1},8,["data","expand-row-keys"])),[[At,ie.value]]),o("div",Ds,[o("div",ws," å…± "+_(v(g).total)+" æ¡è®°å½•ï¼Œå½“å‰ç¬¬ "+_(v(g).page)+" é¡µ ",1),i(Mt,{"current-page":v(g).page,"onUpdate:current-page":e[13]||(e[13]=a=>v(g).page=a),"page-sizes":[15,30,50,100],"page-size":v(g).limit,total:v(g).total,"hide-on-single-page":!1,layout:"  sizes, prev, pager, next, jumper",onSizeChange:Fe,onCurrentChange:je},null,8,["current-page","page-size","total"])])]),_:1}),i(La,{visible:de.value,"onUpdate:visible":e[14]||(e[14]=a=>de.value=a),onSuccess:yt},null,8,["visible"]),i($a,{visible:U.value,"onUpdate:visible":e[15]||(e[15]=a=>U.value=a),"device-list":w.value,"order-id":N.value,onConfirm:kt,onAddDevice:Be,onEditDevice:Pe,onRemoveDevice:Re,onCancel:$e},null,8,["visible","device-list","order-id"]),i(Ra,{visible:O.value,"onUpdate:visible":e[16]||(e[16]=a=>O.value=a),device:X.value,onConfirm:ot},null,8,["visible","device"]),i(Pa,{visible:F.value,"onUpdate:visible":e[17]||(e[17]=a=>F.value=a),device:X.value,onConfirm:ct},null,8,["visible","device"]),i(Na,{visible:ce.value,"onUpdate:visible":e[18]||(e[18]=a=>ce.value=a),device:ue.value,onClosed:bt},null,8,["visible","device"]),i(Ba,{visible:re.value,"onUpdate:visible":e[19]||(e[19]=a=>re.value=a),"order-detail":ye.value},null,8,["visible","order-detail"]),i(za,{visible:q.value,"onUpdate:visible":e[20]||(e[20]=a=>q.value=a),"payment-info":L.value,onPaymentConfirmed:ht},null,8,["visible","payment-info"]),i(Yt,{modelValue:ne.value,"onUpdate:modelValue":e[21]||(e[21]=a=>ne.value=a),title:"å¿«é€’ç‰©æµä¿¡æ¯",width:"600px","destroy-on-close":!0},{default:n(()=>[T.value?(m(),M("div",Vs,[o("div",Es,[o("div",Ms,[o("div",null,[o("h3",Ts,_(T.value.logisticsCompanyName),1),o("p",Ss,"è¿å•å·ï¼š"+_(T.value.mailNo),1)]),i(R,{type:Vt(T.value.logisticsStatus),size:"large"},{default:n(()=>[y(_(T.value.logisticsStatusDesc),1)]),_:1},8,["type"])]),o("div",Is,[o("p",Ys," æœ€æ–°çŠ¶æ€ï¼š"+_(T.value.theLastMessage),1),o("p",As," æ›´æ–°æ—¶é—´ï¼š"+_(T.value.theLastTime),1)])]),o("div",Us,[Ls,i(It,null,{default:n(()=>[(m(!0),M(te,null,ae(T.value.logisticsTraceDetailList,(a,k)=>(m(),b(St,{key:k,timestamp:a.timeDesc,type:k===0?"primary":"info",size:k===0?"large":"normal"},{default:n(()=>[o("div",zs,[o("div",Bs,_(a.areaName),1),o("div",Ps,_(a.desc),1)])]),_:2},1032,["timestamp","type","size"]))),128))]),_:1})])])):(m(),M("div",Rs," æš‚æ— å¿«é€’ä¿¡æ¯ "))]),_:1},8,["modelValue"])])}}});const Kl=Fa($s,[["__scopeId","data-v-2a302f55"]]);export{Kl as default};
