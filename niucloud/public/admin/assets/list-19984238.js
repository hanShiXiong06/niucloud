import{d as ce,f as de,y as pe,n as me,r as b,b2 as ue,R as _e,$ as B,q as l,a5 as V,h as m,c as S,e as t,w as n,a as u,t as p,u as s,F as fe,W as he,s as y,i as f,Z as U,C as ge,bT as ve,ah as A,B as be,a4 as ye,a1 as ke,M as xe,L as Ce,E as we,N as Te,a9 as Ee,aj as Fe,ak as Ve,a2 as Pe,a0 as Ne,aG as Be,U as Se,b9 as $e,V as je,a3 as De}from"./index-0b74b7aa.js";/* empty css                   *//* empty css                  *//* empty css                   */import"./el-tooltip-4ed993c7.js";/* empty css                  */import{_ as ze}from"./index.vue_vue_type_script_setup_true_lang-cb8d7a65.js";/* empty css                     *//* empty css                *//* empty css                    *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                *//* empty css                *//* empty css                  */import"./el-form-item-4ed993c7.js";import{t as Le,u as Re,r as Ue,s as Ae,v as Oe}from"./tools-6c47aede.js";const Ge={class:"main-container"},Me={class:"flex justify-between items-center"},Ie={class:"text-page-title"},qe={class:"mt-[16px] flex justify-end"},Ke={class:"flex h-[50vh]"},We={class:"w-[600px]"},Ze={class:"flex items-center"},He={class:"pl-[5px]"},Je={class:"ml-[20px] relative",style:{width:"calc(100% - 285px)"}},kt=ce({__name:"list",setup(Qe){const O=de(),G=pe().meta.title,a=me({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{table_name:"",table_content:"",addon_name:""}}),$=b(),M=i=>{i&&(i.resetFields(),h())},h=(i=1)=>{a.loading=!0,a.page=i,Le({page:a.page,limit:a.limit,...a.searchParam}).then(e=>{a.loading=!1,a.data=e.data.data,a.total=e.data.total,ve(a.page,a.limit,a.searchParam)}).catch(()=>{a.loading=!1})};h();const I=i=>{A.confirm(l("codeDeleteTips"),l("warning"),{confirmButtonText:l("confirm"),cancelButtonText:l("cancel"),type:"warning"}).then(()=>{Re(i).then(()=>{h()}).catch(()=>{})})},q=i=>{O.push("/tools/code/edit?id="+i.id)},K=i=>{Ue({id:i}).then(e=>{a.loading=!1,A.confirm(e.msg!="2"?l("saveAndSyncText"):l("saveAndSyncText1"),l("warning"),{confirmButtonText:l("confirm"),cancelButtonText:l("cancel")}).then(()=>{j(i,3)}).catch(()=>{})}).catch(()=>{a.loading=!1})},j=(i,e)=>{a.loading=!0,Ae({id:i,generate_type:e}).then(r=>{B({type:"success",message:"操作成功"}),e!=3?(a.loading=!1,window.open(be(r.data.file),"_blank")):h()}).catch(()=>{a.loading=!1})},P=b([]),N=b(!1),T=b([]),E=b(!1),w=b(""),F=b(""),W=i=>{N.value=!0,E.value=!0,w.value="",T.value=[],F.value="",Oe(i).then(e=>{P.value=e.data,T.value=H(e.data.map(r=>r.file_dir+r.name)),w.value=P.value[0].content,E.value=!1}).catch(()=>{E.value=!1})},Z=i=>{P.value.forEach(e=>{i.path===e.file_dir+e.name&&(w.value=e.content)})},H=i=>{const e=[];if(Array.isArray(i))for(let g=0;g<i.length;++g){const k=i[g].split("/");let x=e;for(let c=0;c<k.length;++c){const C=k[c];let d=null;for(var r=0;r<x.length;++r){const _=x[r];if(_.name===C){d=_;break}}d||(d={name:C,path:C.indexOf(".")<0?"":i[g],key:"k"+g+c+r},C.indexOf(".")<0&&(d.children=[]),d.path===i[0]&&(F.value=d.key),x.push(d)),d.children&&(x=d.children)}}return e},{copy:J,isSupported:Q,copied:D}=ue(),X=()=>{if(!Q.value){B({message:l("notSupportCopy"),type:"warning"});return}J(w.value)};return _e(D,()=>{D.value&&B({message:l("copySuccess"),type:"success"})}),(i,e)=>{const r=ye,g=ke,k=xe,x=Ce,c=we,C=Te,d=Ee,_=Fe,Y=Ve,ee=Pe,te=V("Folder"),ae=V("FolderOpened"),z=Ne,le=V("Document"),oe=Be,L=Se,ne=V("highlightjs"),ie=ze,se=$e,re=je,R=De;return m(),S("div",Ge,[t(d,{class:"box-card !border-none",shadow:"never"},{default:n(()=>[u("div",Me,[u("span",Ie,p(s(G)),1)]),t(d,{class:"box-card !border-none my-[10px] table-search-wrap",shadow:"never"},{default:n(()=>[t(C,{inline:!0,model:a.searchParam,ref_key:"searchFormRef",ref:$},{default:n(()=>[t(k,{label:s(l)("addonName"),prop:"addon_name"},{default:n(()=>[t(g,{modelValue:a.searchParam.addon_name,"onUpdate:modelValue":e[0]||(e[0]=o=>a.searchParam.addon_name=o),placeholder:"全部",filterable:"",remote:"",clearable:"","remote-method":h},{default:n(()=>[t(r,{label:"全部",value:""}),t(r,{label:"系统",value:"2"}),(m(!0),S(fe,null,he(i.addonList,o=>(m(),y(r,{label:o.title,value:o.key,key:o.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(k,{label:s(l)("tableName"),prop:"table_name"},{default:n(()=>[t(x,{modelValue:a.searchParam.table_name,"onUpdate:modelValue":e[1]||(e[1]=o=>a.searchParam.table_name=o),modelModifiers:{trim:!0},placeholder:s(l)("tableNamePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(k,null,{default:n(()=>[t(c,{type:"primary",onClick:e[2]||(e[2]=o=>h())},{default:n(()=>[f(p(s(l)("search")),1)]),_:1}),t(c,{onClick:e[3]||(e[3]=o=>M($.value))},{default:n(()=>[f(p(s(l)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),u("div",null,[U((m(),y(Y,{data:a.data,size:"large"},{empty:n(()=>[u("span",null,p(a.loading?"":s(l)("emptyData")),1)]),default:n(()=>[t(_,{prop:"table_name","show-overflow-tooltip":!0,label:s(l)("tableName"),"min-width":"120"},null,8,["label"]),t(_,{prop:"title","show-overflow-tooltip":!0,label:s(l)("addonName"),"min-width":"120"},null,8,["label"]),t(_,{prop:"table_content","show-overflow-tooltip":!0,label:s(l)("tableContent"),"min-width":"120"},null,8,["label"]),t(_,{prop:"edit_type",label:s(l)("editType"),"min-width":"150",align:"center"},{default:n(({row:o})=>[f(p(o.edit_type==1?s(l)("popup"):s(l)("page")),1)]),_:1},8,["label"]),t(_,{label:s(l)("createTime"),"min-width":"180",align:"center"},{default:n(({row:o})=>[f(p(o.create_time||""),1)]),_:1},8,["label"]),t(_,{label:s(l)("operation"),fixed:"right",align:"right",width:"330"},{default:n(({row:o})=>[t(c,{type:"primary",link:"",onClick:v=>q(o)},{default:n(()=>[f(p(s(l)("edit")),1)]),_:2},1032,["onClick"]),t(c,{type:"primary",link:"",onClick:v=>W(o.id)},{default:n(()=>[f(p(s(l)("preview")),1)]),_:2},1032,["onClick"]),t(c,{type:"primary",link:"",onClick:v=>K(o.id)},{default:n(()=>[f(p(s(l)("saveAndSync")),1)]),_:2},1032,["onClick"]),t(c,{type:"primary",link:"",onClick:v=>j(o.id,2)},{default:n(()=>[f(p(s(l)("download")),1)]),_:2},1032,["onClick"]),t(c,{type:"primary",link:"",onClick:v=>I(o.id)},{default:n(()=>[f(p(s(l)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[R,a.loading]]),u("div",qe,[t(ee,{"current-page":a.page,"onUpdate:current-page":e[4]||(e[4]=o=>a.page=o),"page-size":a.limit,"onUpdate:page-size":e[5]||(e[5]=o=>a.limit=o),layout:"total, sizes, prev, pager, next, jumper",total:a.total,onSizeChange:e[6]||(e[6]=o=>h()),onCurrentChange:h},null,8,["current-page","page-size","total"])])])]),_:1}),t(re,{modelValue:N.value,"onUpdate:modelValue":e[7]||(e[7]=o=>N.value=o),class:"dialog-visible",width:"70%",title:"代码预览"},{default:n(()=>[U((m(),S("div",Ke,[t(L,{class:"h-[100%] w-[270px]"},{default:n(()=>[u("div",We,[T.value.length&&F.value!=""?(m(),y(oe,{key:0,data:T.value,props:{label:"name",value:"key"},"node-key":"key","current-node-key":F.value,"expand-on-click-node":!1,"highlight-current":"","default-expand-all":"",ref:"treeRef",onNodeClick:Z},{default:n(({node:o,data:v})=>[u("div",Ze,[v.children?(m(),y(z,{key:0},{default:n(()=>[o.expanded?(m(),y(ae,{key:1})):(m(),y(te,{key:0}))]),_:2},1024)):(m(),y(z,{key:1},{default:n(()=>[t(le)]),_:1})),u("span",He,p(v.name),1)])]),_:1},8,["data","current-node-key"])):ge("",!0)])]),_:1}),u("div",Je,[t(L,{class:"h-[100%] w-[100%]"},{default:n(()=>[t(ne,{autodetect:"",class:"h-[100%]",code:w.value},null,8,["code"])]),_:1}),u("div",{class:"absolute top-0 right-[15px] z-5 cursor-pointer hover:text-primary",onClick:X},[t(se,{content:"点击复制",placement:"top"},{default:n(()=>[t(ie,{name:"iconfont icondingdanzhongxinPC-3"})]),_:1})])])])),[[R,E.value]])]),_:1},8,["modelValue"])])}}});export{kt as default};
