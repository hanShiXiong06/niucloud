import{f as Y,y as M,r as s,n as T,l as Z,aZ as G,h as p,c as k,e as r,w as t,a as m,i as d,Z as H,s as I,F as O,W,C as $,t as j,u as z,$ as V,E as A,a4 as J,a1 as Q,M as X,L as ee,aD as ae,aE as re,N as te,a9 as le,a3 as ne,p as oe,g as se}from"./index-0b74b7aa.js";/* empty css                   *//* empty css                *//* empty css                *//* empty css                       *//* empty css                 *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                  */import{g as de,a as ue,u as ie,t as pe}from"./printer-2aeedafc.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";const ce=_=>(oe("data-v-7dda1a34"),_=_(),se(),_),me={class:"printer-edit-wrap"},fe={class:"card-header"},ye=ce(()=>m("span",null,"修改打印机",-1)),ge={class:"brand-option"},be=["src"],ve={__name:"edit",setup(_){const h=Y(),B=M(),f=s(null),y=s(!1),g=s(!1),b=s(!0),E=s([]),v=s(null),e=T({printer_id:null,brand:"xpyun",printer_name:"",sn:"",user_key:"",user_name:"",type:"label"}),C={brand:[{required:!0,message:"请选择打印机品牌",trigger:"change"}],printer_name:[{required:!0,message:"请输入打印机名称",trigger:"blur"}],sn:[{required:!0,message:"请输入打印机序列号",trigger:"blur"}],user_key:[{required:!0,message:"请输入用户KEY",trigger:"blur"}],user_name:[{required:!0,message:"请输入用户名",trigger:"blur"}]},w=Z(()=>e.sn&&e.user_key&&e.user_name),U=async()=>{try{const a=await de();a.code===1&&(E.value=a.data)}catch(a){console.error("获取打印机品牌列表失败",a)}},L=async()=>{try{if(b.value=!0,v.value=B.params.printer_id,!v.value){V.error("打印机ID不存在"),u();return}const a=await ue(v.value);a.code===1&&a.data?(e.printer_id=a.data.printer_id,e.printer_name=a.data.printer_name||"",e.brand=a.data.brand||"xpyun",e.sn=a.data.sn||"",e.user_key=a.data.user_key||"",e.user_name=a.data.user_name||"",e.type=a.data.type||"label"):(V.error("获取打印机信息失败"),u())}catch(a){console.error("获取打印机信息失败",a),u()}finally{b.value=!1}},N=async()=>{f.value&&await f.value.validate(async a=>{if(a)try{y.value=!0;const n={printer_id:e.printer_id,brand:e.brand,printer_name:e.printer_name,sn:e.sn,user_key:e.user_key,user_name:e.user_name,type:e.type};(await ie(n)).code===1&&h.push("/recycle/printer/list")}catch(n){console.error("修改打印机失败",n)}finally{y.value=!1}})},P=async()=>{if(!w.value){V.warning("请先填写打印机序列号、用户名和用户KEY");return}try{g.value=!0;const a=await pe({sn:e.sn,user_name:e.user_name,user_key:e.user_key})}catch(a){console.error("测试打印失败",a)}finally{g.value=!1}},u=()=>{h.push("/recycle/printer/list")};return G(()=>{U(),L()}),(a,n)=>{const i=A,R=J,S=Q,o=X,c=ee,x=ae,q=re,D=te,F=le,K=ne;return p(),k("div",me,[r(F,{class:"box-card"},{header:t(()=>[m("div",fe,[ye,r(i,{text:"",onClick:u},{default:t(()=>[d("返回列表")]),_:1})])]),default:t(()=>[H((p(),I(D,{ref_key:"formRef",ref:f,model:e,rules:C,"label-width":"120px","label-position":"right",class:"printer-form"},{default:t(()=>[r(o,{label:"打印机品牌",prop:"brand"},{default:t(()=>[r(S,{modelValue:e.brand,"onUpdate:modelValue":n[0]||(n[0]=l=>e.brand=l),placeholder:"请选择打印机品牌",style:{width:"100%"}},{default:t(()=>[(p(!0),k(O,null,W(E.value,l=>(p(),I(R,{key:l.brand,label:l.name,value:l.brand},{default:t(()=>[m("div",ge,[l.logo?(p(),k("img",{key:0,src:l.logo,alt:"",class:"brand-logo"},null,8,be)):$("",!0),m("span",null,j(l.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(o,{label:"打印机名称",prop:"printer_name"},{default:t(()=>[r(c,{modelValue:e.printer_name,"onUpdate:modelValue":n[1]||(n[1]=l=>e.printer_name=l),placeholder:"为打印机取个名字，方便识别"},null,8,["modelValue"])]),_:1}),r(o,{label:"打印机序列号",prop:"sn"},{default:t(()=>[r(c,{modelValue:e.sn,"onUpdate:modelValue":n[2]||(n[2]=l=>e.sn=l),placeholder:"打印机SN码"},null,8,["modelValue"])]),_:1}),r(o,{label:"用户KEY",prop:"user_key"},{default:t(()=>[r(c,{modelValue:e.user_key,"onUpdate:modelValue":n[3]||(n[3]=l=>e.user_key=l),placeholder:"云打印服务用户KEY"},null,8,["modelValue"])]),_:1}),r(o,{label:"用户名",prop:"user_name"},{default:t(()=>[r(c,{modelValue:e.user_name,"onUpdate:modelValue":n[4]||(n[4]=l=>e.user_name=l),placeholder:"云打印服务用户名"},null,8,["modelValue"])]),_:1}),r(o,{label:"打印机类型",prop:"type"},{default:t(()=>[r(q,{modelValue:e.type,"onUpdate:modelValue":n[5]||(n[5]=l=>e.type=l)},{default:t(()=>[r(x,{label:"label"},{default:t(()=>[d("标签打印机")]),_:1}),r(x,{label:"ticket"},{default:t(()=>[d("小票打印机")]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(o,null,{default:t(()=>[r(i,{type:"primary",onClick:N,loading:y.value},{default:t(()=>[d("保存")]),_:1},8,["loading"]),r(i,{onClick:P,disabled:!z(w),loading:g.value},{default:t(()=>[d("测试打印")]),_:1},8,["disabled","loading"]),r(i,{onClick:u},{default:t(()=>[d("取消")]),_:1})]),_:1})]),_:1},8,["model"])),[[K,b.value]])]),_:1})])}}},De=_e(ve,[["__scopeId","data-v-7dda1a34"]]);export{De as default};
