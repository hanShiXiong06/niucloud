import{d as j,r,l as q,T as G,H as J,R as S,$ as f,h as p,c as x,e as a,w as o,a as l,i as y,t as n,s as K,C as b,bn as O,u as I,dH as Q,b6 as W,a0 as X,bw as Y,b$ as Z,bi as ee,E as se,V as le,p as te,g as ae}from"./index-9cfed1fc.js";/* empty css                  *//* empty css                   *//* empty css                  *//* empty css                  *//* empty css                    *//* empty css                  *//* empty css                 */import{_ as oe}from"./_plugin-vue_export-helper-c27b6911.js";const h=_=>(te("data-v-2ad19d56"),_=_(),ae(),_),ce={class:"excel-upload"},ue={class:"upload-container"},de={class:"mb-4"},ne=h(()=>l("p",null,"1. 请确保Excel文件格式正确，包含品牌、型号、容量和价格信息",-1)),ie=h(()=>l("p",null,"2. 系统将自动识别工作表中的品牌信息并创建相应的设备型号",-1)),re=h(()=>l("p",null,"3. 支持 .xlsx 和 .xls 格式，文件大小不超过20MB",-1)),pe={class:"text-center"},_e=h(()=>l("div",{class:"el-upload__text"},[y(" 将Excel文件拖到此处，或"),l("em",null,"点击上传")],-1)),ve=h(()=>l("div",{class:"el-upload__tip"}," 只能上传 .xlsx/.xls 文件，且不超过20MB ",-1)),me={key:0,class:"upload-progress mt-4"},fe={class:"text-center mt-2"},xe={key:1,class:"import-result mt-4"},he={key:0},ge={key:1},Ee={class:"text-red-500"},be={class:"dialog-footer"},ye=j({__name:"ExcelUpload",props:{modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(_,{emit:k}){const M=_,v=r(!1),c=r(!1),u=r(0),i=r(void 0),t=r(""),s=r(null),P=q(()=>({action:"/adminapi/recycle/excel_import/upload",headers:{token:G(),["site-id"]:J.get("siteId")||0},beforeUpload:N,onSuccess:R,onError:$,onProgress:T}));S(()=>M.modelValue,e=>{v.value=e}),S(v,e=>{k("update:modelValue",e),e&&V()});const g=()=>{v.value=!1,V()},V=()=>{c.value=!1,u.value=0,i.value=void 0,t.value="",s.value=null},N=e=>{const m=e.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||e.type==="application/vnd.ms-excel",E=e.size/1024/1024<20;return m?E?(c.value=!0,u.value=0,i.value=void 0,t.value="正在上传文件...",s.value=null,!0):(f.error("文件大小不能超过20MB!"),!1):(f.error("只能上传Excel文件(.xlsx, .xls)!"),!1)},T=e=>{e.percent&&(u.value=Math.floor(e.percent),u.value<50?t.value="正在上传文件...":u.value<100?t.value="文件上传中...":t.value="正在处理数据...")},R=async(e,m)=>{c.value=!1,e.code===1?(u.value=100,i.value="success",t.value="导入完成",s.value={success:!0,message:e.msg||"导入成功",stats:e.data.stats,batch_id:e.data.batch_id},f.success("Excel数据导入成功"),k("success")):(i.value="exception",t.value="导入失败",s.value={success:!1,message:e.msg||"导入失败"},f.error(e.msg||"导入失败"))},$=e=>{c.value=!1,i.value="exception",t.value="上传失败",s.value={success:!1,message:"文件上传失败，请重试"},f.error("文件上传失败"),console.error(e)},D=()=>{g()};return(e,m)=>{const E=W,F=X,H=Y,z=Z,A=ee,C=se,L=le;return p(),x("div",ce,[a(L,{modelValue:v.value,"onUpdate:modelValue":m[0]||(m[0]=d=>v.value=d),title:"Excel数据导入",width:"600px","close-on-click-modal":!1,onClose:g},{footer:o(()=>{var d;return[l("div",be,[a(C,{onClick:g,disabled:c.value},{default:o(()=>[y(n(s.value?"关闭":"取消"),1)]),_:1},8,["disabled"]),(d=s.value)!=null&&d.success?(p(),K(C,{key:0,type:"success",onClick:D},{default:o(()=>[y(" 完成 ")]),_:1})):b("",!0)])]}),default:o(()=>[l("div",ue,[l("div",de,[a(E,{title:"导入说明",type:"info","show-icon":"",closable:!1},{default:o(()=>[ne,ie,re]),_:1})]),l("div",pe,[a(H,O(I(P),{class:"upload-excel",drag:"","show-file-list":!1,accept:".xlsx,.xls",disabled:c.value}),{default:o(()=>[a(F,{class:"el-icon--upload"},{default:o(()=>[a(I(Q))]),_:1}),_e,ve]),_:1},16,["disabled"])]),c.value?(p(),x("div",me,[a(z,{percentage:u.value,status:i.value,"stroke-width":8},null,8,["percentage","status"]),l("p",fe,n(t.value),1)])):b("",!0),s.value?(p(),x("div",xe,[a(A,{icon:s.value.success?"success":"error",title:s.value.success?"导入成功":"导入失败"},{"sub-title":o(()=>{var d,w,B,U;return[s.value.success?(p(),x("div",he,[l("p",null,"成功导入品牌: "+n(((d=s.value.stats)==null?void 0:d.brands_inserted)||0)+" 个",1),l("p",null,"成功导入型号: "+n(((w=s.value.stats)==null?void 0:w.models_inserted)||0)+" 个",1),l("p",null,"成功导入价格: "+n(((B=s.value.stats)==null?void 0:B.prices_inserted)||0)+" 条",1),l("p",null,"总处理行数: "+n(((U=s.value.stats)==null?void 0:U.total_processed)||0)+" 行",1)])):(p(),x("div",ge,[l("p",Ee,n(s.value.message),1)]))]}),_:1},8,["icon","title"])])):b("",!0)])]),_:1},8,["modelValue"])])}}});const Pe=oe(ye,[["__scopeId","data-v-2ad19d56"]]);export{Pe as default};
