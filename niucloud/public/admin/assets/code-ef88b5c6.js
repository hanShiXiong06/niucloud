import{d as ue,y as de,f as re,r as u,n as ce,h as v,c as A,e as l,w as n,a as m,t as p,u as o,q as e,i as c,Z as me,s as y,C as x,ah as k,H as P,m as fe,aH as _e,aI as ge,E as ve,aj as he,b9 as be,ak as we,a2 as ye,a9 as ke,L as Te,M as Ce,N as Ve,V as xe,U as Ee,a3 as Be}from"./index-9cfed1fc.js";/* empty css                   *//* empty css                     *//* empty css                  *//* empty css                   *//* empty css                */import{_ as Ue}from"./index.vue_vue_type_style_index_0_lang-98cd6f48.js";import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                  *//* empty css                    */import{g as Le,a as Re,b as Me,s as ze,c as We}from"./weapp-219fdc4c.js";import{g as Ae}from"./module-212dc38c.js";import{u as De,s as Fe}from"./wxoplatform-54bf9ea6.js";/* empty css                  *//* empty css                    */const Ne={class:"main-container"},$e={class:"flex justify-between items-center"},Ie={class:"text-page-title"},Se={key:0,class:"mt-[20px]"},He={key:1,class:"mt-[20px]"},Pe={class:"mt-[16px] flex justify-end"},je={class:"dialog-footer"},Ke=["innerHTML"],qe=["innerHTML"],Ze={class:"flex justify-end"},ya=ue({__name:"code",setup(Ge){const j=de(),E=re(),K=j.meta.title,B=u(!1),h=u(!0),i=ce({page:1,limit:10,total:0,loading:!1,data:[]}),f=u({desc:"",code:"",path:"",content:""}),b=u(!1),U=u("");Ae().then(s=>{s.data.data&&s.data.data.auth_code&&(U.value=s.data.data.auth_code,C()),h.value=!1}).catch(()=>{h.value=!1});const L=u({app_id:"",app_secret:"",is_authorization:0});Le().then(s=>{L.value=s.data});const R=u("/channel/weapp/code"),q=s=>{E.push({path:R.value})},D=u(null),_=(s=1)=>{i.loading=!0,i.page=s,Me({page:i.page,limit:i.limit}).then(t=>{i.loading=!1,i.data=t.data.data,i.total=t.data.total,s==1&&i.data.length&&i.data[0].status==0&&N(i.data[0].task_key)}).catch(()=>{i.loading=!1})};_();const Z=()=>{D.value.clearValidate()},d=u(!1),F=()=>{if(!U.value){J();return}if(!L.value.app_id){O();return}d.value||(d.value=!0,T.value="",ze(f.value).then(s=>{_(),C(),d.value=!1}).catch(()=>{d.value=!1}))},G=()=>{k.alert(e("localInsertTips"),e("warning"),{confirmButtonText:e("confirm")})},T=u(""),C=()=>{U.value&&Re().then(s=>{s.data&&(T.value=`<img src="${s.data}" class="w-[150px]">`)}).catch()},N=s=>{We(s).then(t=>{const g=t.data.data??[];if(g[0]&&g[0].length){const w=g[0][g[0].length-1];if(w.code==0){_();return}if(w.code==1&&w.percent==100){_(),C(),!P.get("weappUploadTipsLock")&&(b.value=!0);return}setTimeout(()=>{N(s)},2e3)}})},J=()=>{fe()=="admin"?k.confirm(e("authTips"),e("warning"),{distinguishCancelAndClose:!0,confirmButtonText:e("toBind"),cancelButtonText:e("toNiucloud")}).then(()=>{E.push({path:"/app/authorize"})}).catch(s=>{s==="cancel"&&window.open("https://www.niucloud.com/app")}):k.alert(e("siteAuthTips"),e("warning"))},O=()=>{k.confirm(e("weappTips"),e("warning"),{confirmButtonText:e("toSetting"),cancelButtonText:e("cancel")}).then(()=>{E.push({path:"/channel/weapp/config"})})},Q=s=>{k.confirm(e("undoAuditTips"),e("warning"),{confirmButtonText:e("confirm"),cancelButtonText:e("cancel")}).then(()=>{De({id:s.id}).then(()=>{_()})})},$=u(""),M=u(!1),X=s=>{$.value=s.fail_reason,M.value=!0},Y=()=>{P.set({key:"weappUploadTipsLock",data:!0}),b.value=!1},I=()=>{d.value||(d.value=!0,Fe().then(()=>{_(),C(),d.value=!1}).catch(()=>{d.value=!1}))};return(s,t)=>{const g=_e,w=ge,r=ve,V=he,ee=be,ae=we,te=ye,le=ke,S=Te,z=Ce,oe=Ue,ne=Ve,W=xe,se=Ee,ie=Be;return v(),A("div",Ne,[l(le,{class:"card !border-none",shadow:"never"},{default:n(()=>[m("div",$e,[m("span",Ie,p(o(K)),1)]),l(w,{modelValue:R.value,"onUpdate:modelValue":t[0]||(t[0]=a=>R.value=a),class:"my-[20px]",onTabChange:q},{default:n(()=>[l(g,{label:o(e)("weappAccessFlow"),name:"/channel/weapp"},null,8,["label"]),l(g,{label:o(e)("subscribeMessage"),name:"/channel/weapp/message"},null,8,["label"]),l(g,{label:o(e)("weappRelease"),name:"/channel/weapp/code"},null,8,["label"])]),_:1},8,["modelValue"]),L.value.is_authorization?(v(),A("div",He,[l(r,{type:"primary",onClick:I,loading:d.value,disabled:h.value},{default:n(()=>[c(p(o(e)("uploadWeapp")),1)]),_:1},8,["loading","disabled"])])):(v(),A("div",Se,[l(r,{type:"primary",onClick:F,loading:d.value,disabled:h.value},{default:n(()=>[c(p(o(e)("cloudRelease")),1)]),_:1},8,["loading","disabled"]),l(r,{onClick:G,disabled:h.value},{default:n(()=>[c(p(o(e)("localRelease")),1)]),_:1},8,["disabled"])])),me((v(),y(ae,{class:"mt-[15px]",data:i.data,size:"default"},{empty:n(()=>[m("span",null,p(o(e)("emptyData")),1)]),default:n(()=>[l(V,{prop:"version",label:o(e)("code"),align:"left"},null,8,["label"]),l(V,{prop:"status_name",label:o(e)("status"),align:"left"},{default:n(({row:a})=>[m("div",null,p(a.status_name),1)]),_:1},8,["label"]),l(V,{prop:"create_time",label:o(e)("createTime"),align:"center"},null,8,["label"]),l(V,{label:o(e)("operation"),fixed:"right",align:"right","min-width":"120"},{default:n(({row:a,$index:pe})=>[T.value&&pe==0&&(a.status==1||a.status==2)&&i.page==1?(v(),y(ee,{key:0,content:T.value,"raw-content":"",effect:"light"},{default:n(()=>[l(r,{type:"primary",link:""},{default:n(()=>[c(p(o(e)("preview")),1)]),_:1})]),_:1},8,["content"])):x("",!0),a.status==-1||a.status==-2?(v(),y(r,{key:1,type:"primary",link:"",onClick:H=>X(a)},{default:n(()=>[c(p(o(e)("failReason")),1)]),_:2},1032,["onClick"])):x("",!0),a.status==-2?(v(),y(r,{key:2,type:"primary",link:"",onClick:H=>I(a),loading:d.value},{default:n(()=>[c(p(o(e)("againUpload")),1)]),_:2},1032,["onClick","loading"])):x("",!0),a.status==2?(v(),y(r,{key:3,type:"primary",link:"",onClick:H=>Q(a)},{default:n(()=>[c(p(o(e)("undoAudit")),1)]),_:2},1032,["onClick"])):x("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[ie,i.loading]]),m("div",Pe,[l(te,{"current-page":i.page,"onUpdate:current-page":t[1]||(t[1]=a=>i.page=a),"page-size":i.limit,"onUpdate:page-size":t[2]||(t[2]=a=>i.limit=a),layout:"total, sizes, prev, pager, next, jumper",total:i.total,onSizeChange:t[3]||(t[3]=a=>_()),onCurrentChange:_},null,8,["current-page","page-size","total"])])]),_:1}),l(W,{modelValue:B.value,"onUpdate:modelValue":t[8]||(t[8]=a=>B.value=a),title:o(e)("codeDownTwoDesc"),width:"30%","before-close":Z},{footer:n(()=>[m("span",je,[l(r,{onClick:t[7]||(t[7]=a=>B.value=!1)},{default:n(()=>[c(p(o(e)("cancel")),1)]),_:1}),l(r,{type:"primary",onClick:F},{default:n(()=>[c(p(o(e)("confirm")),1)]),_:1})])]),default:n(()=>[l(ne,{ref_key:"ruleFormRef",ref:D,model:f.value,"label-width":"120px"},{default:n(()=>[l(z,{prop:"code",label:o(e)("code")},{default:n(()=>[l(S,{modelValue:f.value.code,"onUpdate:modelValue":t[4]||(t[4]=a=>f.value.code=a),modelModifiers:{trim:!0},placeholder:o(e)("codePlaceholder"),onkeyup:"this.value = this.value.replace(/[^\\d\\.]/g,'');"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(z,{prop:"path",label:o(e)("path")},{default:n(()=>[l(oe,{modelValue:f.value.path,"onUpdate:modelValue":t[5]||(t[5]=a=>f.value.path=a),api:"weapp/upload",accept:".zip"},null,8,["modelValue","accept"])]),_:1},8,["label"]),l(z,{label:o(e)("content")},{default:n(()=>[l(S,{type:"textarea",modelValue:f.value.content,"onUpdate:modelValue":t[6]||(t[6]=a=>f.value.content=a),modelModifiers:{trim:!0},placeholder:o(e)("contentPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(W,{modelValue:M.value,"onUpdate:modelValue":t[9]||(t[9]=a=>M.value=a),title:o(e)("failReason"),width:"60%"},{default:n(()=>[l(se,{class:"h-[60vh] w-full whitespace-pre-wrap p-[20px]"},{default:n(()=>[m("div",{innerHTML:$.value},null,8,Ke)]),_:1})]),_:1},8,["modelValue","title"]),l(W,{modelValue:b.value,"onUpdate:modelValue":t[11]||(t[11]=a=>b.value=a),title:o(e)("warning"),width:"500px",draggable:""},{footer:n(()=>[m("div",Ze,[l(r,{onClick:Y,type:"primary"},{default:n(()=>[c(p(o(e)("knownToKnow")),1)]),_:1}),l(r,{onClick:t[10]||(t[10]=a=>b.value=!1),type:"primary",plain:""},{default:n(()=>[c(p(o(e)("confirm")),1)]),_:1})])]),default:n(()=>[m("span",{innerHTML:o(e)("uploadSuccessTips")},null,8,qe)]),_:1},8,["modelValue","title"])])}}});export{ya as default};
