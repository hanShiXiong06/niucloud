import{P as h,r as l,$ as v}from"./index-9cfed1fc.js";import{i as C,L as U}from"./index-8cd15ab6.js";function T(r){return h.get("recycle/stats/getTodayStats",{params:r})}function $(r){return h.get("recycle/stats/getUserStats",{params:r})}function Y(r){return h.get("recycle/stats/getOverviewStats",{params:r})}function q(){return h.get("recycle/stats/getUserList")}function G(r){return h.get("recycle/stats/getUserDetailStats",{params:r})}function N(r){return h.get("recycle/stats/getMemberStatsOverview",{params:r})}function Q(r){return h.get("recycle/stats/getMemberRegisterTrend",{params:r})}function V(r){return h.get("recycle/stats/getMemberChannelStats",{params:r})}function H(r){return h.get("recycle/stats/getMemberInviteRank",{params:r})}function X(r){return h.get("recycle/stats/getMemberActivityStats",{params:r})}function K(){const r=l("user"),b=l(""),g=l(0),y=l({start_time:"",end_time:""}),S=l({signed_order_count:0,signed_device_count:0,sign_category_breakdown:[],check_count:0,check_category_breakdown:[],price_count:0,price_category_breakdown:[],payment_count:0,payment_category_breakdown:[],recycle_count:0,return_count:0,total_amount:0}),w=l({today_order_count:0,yesterday_order_count:0,today_check_count:0,today_check_breakdown:[],today_payment_amount:0,today_payment_count:0,today_return_count:0}),f=l([]),p=l([]),t=l(!1),s=l({total_members:0,new_members:0,active_members:0,invite_members:0}),a=l([]),c=l([]),x=l([]),k=l([]),_=l(!1),L=async()=>{try{const e=await T({});e.data&&(r.value=e.data.user_role||"user",b.value=e.data.user_name||"用户",g.value=e.data.user_id||0)}catch(e){console.error("获取用户角色失败",e)}},B=async()=>{try{const e={...y.value,user_id:g.value},i=await $(e);if(i.data&&i.data.length>0){const o=i.data[0];S.value={signed_order_count:o.signed_order_count||0,signed_device_count:o.signed_device_count||0,sign_category_breakdown:o.sign_category_breakdown||[],check_count:o.check_count||0,check_category_breakdown:o.check_category_breakdown||[],price_count:o.price_count||0,price_category_breakdown:o.price_category_breakdown||[],payment_count:o.payment_count||0,payment_category_breakdown:o.payment_category_breakdown||[],recycle_count:o.recycle_count||0,return_count:o.return_count||0,total_amount:o.total_amount||0}}else S.value={signed_order_count:0,signed_device_count:0,sign_category_breakdown:[],check_count:0,check_category_breakdown:[],price_count:0,price_category_breakdown:[],payment_count:0,payment_category_breakdown:[],recycle_count:0,return_count:0,total_amount:0}}catch(e){console.error("获取用户工作统计失败",e),v.error("获取工作统计失败")}},E=async()=>{try{const e=await Y(y.value);w.value=e.data||{}}catch(e){console.error("获取概况统计失败",e),v.error("获取概况统计失败")}},A=async()=>{try{const e=await q();p.value=e.data||[]}catch(e){console.error("获取用户列表失败",e)}},F=async(e="")=>{t.value=!0;try{const i={...y.value,user_id:e},o=await G(i);f.value=o.data||[]}catch(i){console.error("获取用户详细统计失败",i),v.error("获取用户统计失败")}finally{t.value=!1}},M=async()=>{_.value=!0;try{const e=await N(y.value);s.value=e.data||{}}catch(e){console.error("获取会员统计概览失败",e),v.error("获取会员统计概览失败")}finally{_.value=!1}},O=async()=>{try{const e=await Q(y.value);a.value=e.data||[]}catch(e){console.error("获取会员注册趋势失败",e),v.error("获取会员注册趋势失败")}},D=async()=>{try{const e=await V(y.value);c.value=e.data||[]}catch(e){console.error("获取会员渠道统计失败",e),v.error("获取会员渠道统计失败")}},W=async()=>{try{const e=await H(y.value);x.value=e.data||[]}catch(e){console.error("获取拉新排行榜失败",e),v.error("获取拉新排行榜失败")}},P=async()=>{try{const e=await X(y.value);k.value=e.data||[]}catch(e){console.error("获取会员活跃度统计失败",e),v.error("获取会员活跃度统计失败")}},R=async()=>{await Promise.all([M(),O(),D(),W(),P()])};return{userRole:r,currentUserName:b,currentUserId:g,queryParams:y,userWorkStats:S,overviewStats:w,userDetailStats:f,userList:p,userLoading:t,memberStatsOverview:s,memberRegisterTrend:a,memberChannelStats:c,memberInviteRank:x,memberActivityStats:k,memberLoading:_,fetchUserRole:L,fetchUserWorkStats:B,fetchOverviewStats:E,fetchUserList:A,fetchUserDetailStats:F,fetchData:async()=>{await L(),r.value==="admin"?(await E(),await A(),await F(),await R()):await B()},fetchMemberStatsOverview:M,fetchMemberRegisterTrend:O,fetchMemberChannelStats:D,fetchMemberInviteRank:W,fetchMemberActivityStats:P,fetchAllMemberStats:R}}function Z(){const r=l(),b=l(),g=l(),y=l(),S=l(),w=l();let f=null,p=null,t=null,s=null,a=null,c=null;return{userCategoryChart:r,adminUserChart:b,overviewRingChart:g,memberRegisterTrendChart:y,memberChannelChart:S,memberActivityChart:w,initUserCategoryChart:()=>{r.value&&(f=C(r.value))},updateUserCategoryChart:n=>{if(!f)return;if(!n||n.length===0){const o={title:{text:"设备分类分布",left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"item",formatter:"暂无数据"},legend:{orient:"horizontal",bottom:"0",data:[]},series:[{name:"设备类型",type:"pie",radius:["30%","70%"],center:["50%","45%"],avoidLabelOverlap:!1,itemStyle:{color:"#E5E7EB"},label:{show:!0,formatter:"暂无数据",position:"center",fontSize:14,color:"#9CA3AF"},labelLine:{show:!1},data:[{value:1,name:"暂无数据",itemStyle:{color:"#E5E7EB"}}]}]};f.setOption(o,!0);return}const e=n.map((o,d)=>({value:o.count,name:o.category_name,itemStyle:{color:["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399","#13C2C2","#722ED1"][d%7]}})),i={title:{text:"设备分类分布",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c}台 ({d}%)"},legend:{orient:"horizontal",bottom:"0"},series:[{name:"设备类型",type:"pie",radius:["30%","70%"],center:["50%","45%"],avoidLabelOverlap:!1,label:{show:!0,formatter:"{b}: {c}台"},labelLine:{show:!0},data:e}]};f.setOption(i)},initAdminUserChart:()=>{b.value&&(p=C(b.value))},updateAdminUserChart:n=>{if(!p)return;if(!n||n.length===0){const m={title:{text:"员工工作量对比",left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{top:"30",data:["签收数量","质检数量","定价数量","打款数量"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:[],axisLabel:{rotate:45,color:"#9CA3AF"},axisLine:{lineStyle:{color:"#E5E7EB"}}},yAxis:{type:"value",axisLabel:{color:"#9CA3AF"},axisLine:{lineStyle:{color:"#E5E7EB"}},splitLine:{lineStyle:{color:"#E5E7EB"}}},graphic:{type:"text",left:"center",top:"middle",style:{text:"暂无数据",fontSize:14,fill:"#9CA3AF"}},series:[{name:"签收数量",type:"bar",data:[],itemStyle:{color:"#13C2C2"}},{name:"质检数量",type:"bar",data:[],itemStyle:{color:"#409EFF"}},{name:"定价数量",type:"bar",data:[],itemStyle:{color:"#67C23A"}},{name:"打款数量",type:"bar",data:[],itemStyle:{color:"#E6A23C"}}]};p.setOption(m,!0);return}const e=n.map(m=>m.user_name),i=n.map(m=>m.signed_device_count),o=n.map(m=>m.check_count),d=n.map(m=>m.price_count),u=n.map(m=>m.payment_count),z={title:{text:"员工工作量对比",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{top:"30"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:e,axisLabel:{rotate:45}},yAxis:{type:"value"},series:[{name:"签收数量",type:"bar",data:i,itemStyle:{color:"#13C2C2"}},{name:"质检数量",type:"bar",data:o,itemStyle:{color:"#409EFF"}},{name:"定价数量",type:"bar",data:d,itemStyle:{color:"#67C23A"}},{name:"打款数量",type:"bar",data:u,itemStyle:{color:"#E6A23C"}}]};p.setOption(z)},initOverviewRingChart:()=>{g.value&&(t=C(g.value))},updateOverviewRingChart:n=>{if(!t)return;const e=[{value:n.today_order_count||0,name:"订单",itemStyle:{color:"#3B82F6"}},{value:n.today_check_count||0,name:"质检",itemStyle:{color:"#10B981"}},{value:n.today_payment_count||0,name:"打款",itemStyle:{color:"#F59E0B"}},{value:n.today_return_count||0,name:"退货",itemStyle:{color:"#EF4444"}}];if(!e.some(d=>d.value>0)){const d={title:{text:"业务分布",left:"center",top:"5%",textStyle:{fontSize:14,fontWeight:"bold",color:"#9CA3AF"}},tooltip:{trigger:"item",formatter:"暂无数据"},legend:{orient:"horizontal",bottom:"5%",left:"center",textStyle:{fontSize:12,color:"#9CA3AF"}},graphic:{type:"text",left:"center",top:"middle",style:{text:"暂无数据",fontSize:14,fill:"#9CA3AF"}},series:[{name:"业务类型",type:"pie",radius:["45%","70%"],center:["50%","50%"],avoidLabelOverlap:!1,label:{show:!1},labelLine:{show:!1},data:[{value:1,name:"订单",itemStyle:{color:"#E5E7EB"}},{value:1,name:"质检",itemStyle:{color:"#E5E7EB"}},{value:1,name:"打款",itemStyle:{color:"#E5E7EB"}},{value:1,name:"退货",itemStyle:{color:"#E5E7EB"}}]}]};t.setOption(d,!0);return}const o={title:{text:"业务分布",left:"center",top:"5%",textStyle:{fontSize:14,fontWeight:"bold",color:"#374151"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"horizontal",bottom:"5%",left:"center",textStyle:{fontSize:12}},series:[{name:"业务类型",type:"pie",radius:["45%","70%"],center:["50%","50%"],avoidLabelOverlap:!0,label:{show:!0,position:"outside",formatter:`{b}
{c}`,fontSize:12},labelLine:{show:!0,length:10,length2:10},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold"},itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},data:e}]};t.setOption(o)},initMemberRegisterTrendChart:()=>{y.value&&(s=C(y.value))},updateMemberRegisterTrendChart:n=>{if(!s)return;const e=n.map(d=>d.date),i=n.map(d=>d.count);Math.max(...i,0),Math.min(...i,0),i.length>0&&(i.reduce((d,u)=>d+u,0)/i.length).toFixed(1);const o={title:{text:"注册趋势",left:"center",textStyle:{fontSize:14,fontWeight:"bold"}},tooltip:{trigger:"axis",backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#e5e7eb",borderWidth:1,textStyle:{color:"#374151"},axisPointer:{type:"cross",crossStyle:{color:"#9ca3af"},lineStyle:{color:"#d1d5db",type:"dashed"}},formatter:d=>{const u=d[0];return`
            <div style="padding: 4px 8px;">
              <div style="font-weight: 600; margin-bottom: 4px;">${u.axisValue}</div>
              <div style="display: flex; align-items: center;">
                <span style="display: inline-block; width: 10px; height: 10px; background: ${u.color}; border-radius: 50%; margin-right: 6px;"></span>
                <span>${u.seriesName}：<strong style="font-size: 16px; color: #3B82F6;">${u.value}</strong> 人</span>
              </div>
            </div>
          `}},grid:{left:"3%",right:"4%",bottom:"10%",top:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e,axisLine:{lineStyle:{color:"#e5e7eb"}},axisLabel:{rotate:45,fontSize:11,color:"#6b7280",margin:10},axisTick:{show:!0,lineStyle:{color:"#e5e7eb"}},splitLine:{show:!0,lineStyle:{color:"#f3f4f6",type:"dashed"}}},yAxis:{type:"value",name:"注册数",nameTextStyle:{color:"#6b7280",fontSize:12,padding:[0,0,0,0]},minInterval:1,axisLine:{show:!0,lineStyle:{color:"#e5e7eb"}},axisLabel:{color:"#6b7280",fontSize:11,formatter:"{value} 人"},splitLine:{show:!0,lineStyle:{color:"#f3f4f6",type:"dashed"}}},series:[{name:"注册用户",type:"line",smooth:!0,symbol:"circle",symbolSize:8,showSymbol:!0,lineStyle:{width:3,color:"#3B82F6",shadowColor:"rgba(59, 130, 246, 0.3)",shadowBlur:10,shadowOffsetY:5},areaStyle:{color:new U(0,0,0,1,[{offset:0,color:"rgba(59, 130, 246, 0.4)"},{offset:1,color:"rgba(59, 130, 246, 0.05)"}])},itemStyle:{color:"#3B82F6",borderWidth:2,borderColor:"#fff",shadowColor:"rgba(59, 130, 246, 0.5)",shadowBlur:8},emphasis:{focus:"series",itemStyle:{color:"#2563eb",borderWidth:3,shadowBlur:15,symbolSize:12}},label:{show:!0,position:"top",color:"#374151",fontSize:10,fontWeight:600,formatter:"{c}",distance:8},markPoint:{symbol:"pin",symbolSize:50,itemStyle:{color:"#ef4444"},data:[{type:"max",name:"最大值",label:{fontSize:11}},{type:"min",name:"最小值",label:{fontSize:11},itemStyle:{color:"#10b981"}}]},markLine:{silent:!0,lineStyle:{color:"#f59e0b",type:"dashed",width:1},label:{formatter:"平均: {c} 人",fontSize:11,color:"#f59e0b"},data:[{type:"average",name:"平均值"}]},data:i}]};s.setOption(o,!0)},initMemberChannelChart:()=>{S.value&&(a=C(S.value))},updateMemberChannelChart:n=>{if(!a)return;const e=n.map((o,d)=>({value:o.count,name:o.channel_name,itemStyle:{color:["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4"][d%7]}})),i={title:{text:"注册渠道",left:"center",textStyle:{fontSize:14,fontWeight:"bold"}},tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"vertical",right:"10",top:"center",textStyle:{fontSize:12}},series:[{name:"注册渠道",type:"pie",radius:["40%","70%"],center:["40%","50%"],avoidLabelOverlap:!1,label:{show:!0,formatter:`{b}
{c}人`,fontSize:11},labelLine:{show:!0,length:10,length2:5},data:e}]};a.setOption(i,!0)},initMemberActivityChart:()=>{w.value&&(c=C(w.value))},updateMemberActivityChart:n=>{if(!c)return;const e=n.map(u=>u.date),i=n.map(u=>u.active_count),o=n.map(u=>u.new_count),d={title:{text:"活跃度统计",left:"center",textStyle:{fontSize:14,fontWeight:"bold"}},tooltip:{trigger:"axis",backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#e5e7eb",borderWidth:1,textStyle:{color:"#374151"},axisPointer:{type:"cross",crossStyle:{color:"#9ca3af"},lineStyle:{color:"#d1d5db",type:"dashed"}},formatter:u=>{let z=`<div style="padding: 6px 10px;">
            <div style="font-weight: 600; margin-bottom: 6px; font-size: 13px;">${u[0].axisValue}</div>`;return u.forEach(m=>{z+=`
              <div style="display: flex; align-items: center; margin-bottom: 4px;">
                <span style="display: inline-block; width: 10px; height: 10px; background: ${m.color}; border-radius: 50%; margin-right: 8px;"></span>
                <span style="flex: 1;">${m.seriesName}：</span>
                <strong style="font-size: 15px; margin-left: 8px;" 
                        style="color: ${m.color};">${m.value}</strong>
                <span style="margin-left: 2px; color: #9ca3af;">人</span>
              </div>
            `}),z+="</div>",z}},legend:{data:["活跃用户","新增用户"],top:"8%",right:"10%",itemWidth:20,itemHeight:12,textStyle:{fontSize:12,color:"#6b7280"},icon:"roundRect"},grid:{left:"3%",right:"4%",bottom:"10%",top:"20%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e,axisLine:{lineStyle:{color:"#e5e7eb"}},axisLabel:{rotate:45,fontSize:11,color:"#6b7280",margin:10},axisTick:{show:!0,lineStyle:{color:"#e5e7eb"}},splitLine:{show:!0,lineStyle:{color:"#f3f4f6",type:"dashed"}}},yAxis:{type:"value",name:"用户数",nameTextStyle:{color:"#6b7280",fontSize:12,padding:[0,0,0,0]},minInterval:1,axisLine:{show:!0,lineStyle:{color:"#e5e7eb"}},axisLabel:{color:"#6b7280",fontSize:11,formatter:"{value} 人"},splitLine:{show:!0,lineStyle:{color:"#f3f4f6",type:"dashed"}}},series:[{name:"活跃用户",type:"line",smooth:!0,symbol:"circle",symbolSize:8,showSymbol:!0,lineStyle:{width:3,color:"#10B981",shadowColor:"rgba(16, 185, 129, 0.3)",shadowBlur:10,shadowOffsetY:5},areaStyle:{color:new U(0,0,0,1,[{offset:0,color:"rgba(16, 185, 129, 0.4)"},{offset:1,color:"rgba(16, 185, 129, 0.05)"}])},itemStyle:{color:"#10B981",borderWidth:2,borderColor:"#fff",shadowColor:"rgba(16, 185, 129, 0.5)",shadowBlur:8},emphasis:{focus:"series",itemStyle:{color:"#059669",borderWidth:3,shadowBlur:15,symbolSize:12}},label:{show:!0,position:"top",color:"#10B981",fontSize:10,fontWeight:600,formatter:"{c}",distance:5},markPoint:{symbol:"pin",symbolSize:45,itemStyle:{color:"#10B981"},data:[{type:"max",name:"峰值",label:{fontSize:10}}]},markLine:{silent:!0,lineStyle:{color:"#10B981",type:"dashed",width:1,opacity:.6},label:{formatter:"活跃平均: {c}",fontSize:10,color:"#10B981"},data:[{type:"average",name:"平均值"}]},data:i},{name:"新增用户",type:"line",smooth:!0,symbol:"circle",symbolSize:8,showSymbol:!0,lineStyle:{width:3,color:"#3B82F6",shadowColor:"rgba(59, 130, 246, 0.3)",shadowBlur:10,shadowOffsetY:5},areaStyle:{color:new U(0,0,0,1,[{offset:0,color:"rgba(59, 130, 246, 0.4)"},{offset:1,color:"rgba(59, 130, 246, 0.05)"}])},itemStyle:{color:"#3B82F6",borderWidth:2,borderColor:"#fff",shadowColor:"rgba(59, 130, 246, 0.5)",shadowBlur:8},emphasis:{focus:"series",itemStyle:{color:"#2563eb",borderWidth:3,shadowBlur:15,symbolSize:12}},label:{show:!0,position:"bottom",color:"#3B82F6",fontSize:10,fontWeight:600,formatter:"{c}",distance:5},markPoint:{symbol:"pin",symbolSize:45,itemStyle:{color:"#3B82F6"},data:[{type:"max",name:"峰值",label:{fontSize:10}}]},markLine:{silent:!0,lineStyle:{color:"#3B82F6",type:"dashed",width:1,opacity:.6},label:{formatter:"新增平均: {c}",fontSize:10,color:"#3B82F6"},data:[{type:"average",name:"平均值"}]},data:o}]};c.setOption(d,!0)},handleResize:()=>{f==null||f.resize(),p==null||p.resize(),t==null||t.resize(),s==null||s.resize(),a==null||a.resize(),c==null||c.resize()},disposeCharts:()=>{f==null||f.dispose(),p==null||p.dispose(),t==null||t.dispose(),s==null||s.dispose(),a==null||a.dispose(),c==null||c.dispose()}}}function I(){const r=l([]),b=l("today"),g=l([{key:"today",label:"今日"},{key:"week",label:"本周"},{key:"month",label:"本月"},{key:"custom",label:"自定义"}]),y=t=>t.toISOString().split("T")[0];return{dateRange:r,activePeriod:b,quickPeriods:g,handleQuickPeriod:(t,s)=>{b.value=t;const a=new Date;let c,x=a;switch(t){case"today":c=a,x=a;break;case"week":c=new Date(a),c.setDate(a.getDate()-a.getDay());break;case"month":c=new Date(a.getFullYear(),a.getMonth(),1);break;case"custom":return;default:c=a}if(t!=="custom"){const k=y(c),_=y(x);r.value=[k,_],s(k,_)}},handleDateChange:(t,s)=>{t&&t.length===2?(b.value="custom",s(t[0],t[1])):s("","")},getTimePeriodText:(t,s)=>t&&s?t===s?t:`${t} 至 ${s}`:"今日",getPeriodLabel:t=>{const a={order:{week:"本周订单",month:"本月订单",default:"今日订单"},check:{week:"本周质检",month:"本月质检",default:"今日质检"},payment:{week:"本周打款",month:"本月打款",default:"今日打款"},return:{week:"本周退货",month:"本月退货",default:"今日退货"}}[t];switch(b.value){case"week":return a.week;case"month":return a.month;default:return a.default}}}}export{Z as a,I as b,K as u};
