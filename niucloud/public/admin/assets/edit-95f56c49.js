import{d as Y,y as K,f as ee,r as w,n as te,l as le,q as a,h as u,c as v,e as r,w as d,u as o,b3 as ae,Z as re,s as T,a as s,t as f,F as x,W as V,i as B,C as R,aX as oe,$ as H,b4 as ne,a9 as ie,L as de,M as se,a4 as pe,a1 as ue,aD as ce,aE as _e,b7 as me,aF as fe,bD as be,N as ge,E as ve,a3 as he}from"./index-6a69b8ba.js";/* empty css                   *//* empty css                  *//* empty css                *//* empty css                          *//* empty css                    *//* empty css                  *//* empty css                       *//* empty css                 *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                *//* empty css                       */import{g as xe,a as ke,b as ye,c as Ve,e as we,d as Pe}from"./printer-2b7f96e3.js";const Ee={class:"main-container"},Ue={class:"panel-title !text-sm"},Ce={class:"text-[12px] text-[#b2b2b2]"},Fe={class:"text-[12px] text-[#b2b2b2]"},Te={class:"text-[12px] text-[#b2b2b2]"},Ne={class:"text-[12px] text-[#b2b2b2]"},qe={class:"panel-title !text-sm"},Me={class:"flex mb-[10px] py-[8px] bg-[#F5F7F9] text-[14px]"},$e={class:"px-[12px] w-[200px]"},Be={class:"px-[12px] w-[100px]"},De={class:"px-[12px] w-[250px]"},Re={class:"px-[12px] w-[200px]"},Le={class:"font-bold w-[200px] px-[12px]"},Oe={class:"w-[100px] px-[12px]"},je={class:"w-[250px] px-[12px]"},Se={key:0,class:"w-[300px] px-[12px] flex-1"},Ge={class:"w-[200px] px-[12px]"},We={class:"fixed-footer-wrap"},He={class:"fixed-footer"},ct=Y({__name:"edit",setup(Ie){const L=K(),O=ee(),P=w(!1),N=w(!0),I=L.meta.title,X={printer_id:L.query.printer_id||0,brand:"",printer_name:"",printer_code:"",printer_key:"",open_id:"",apikey:"",template_type:[],trigger:[],value:{},print_width:"58mm",status:1},e=te({...X}),j=w(),Z=le(()=>({printer_name:[{required:!0,message:a("printerNamePlaceholder"),trigger:"blur"}],brand:[{required:!0,message:a("brandPlaceholder"),trigger:"blur"}],printer_code:[{required:!0,message:a("printerCodePlaceholder"),trigger:"blur"}],printer_key:[{required:!0,message:a("printerKeyPlaceholder"),trigger:"blur"}],open_id:[{required:!0,message:a("openIdPlaceholder"),trigger:"blur"}],apikey:[{required:!0,message:a("apikeyPlaceholder"),trigger:"blur"}]})),k=w([]);(async()=>{await ye({}).then(g=>{if(g.data){k.value=g.data;for(let l=0;l<k.value.length;l++){let n=k.value[l];e.value[n.key]={};let i={};for(let _=0;_<n.condition.length;_++){let m=n.condition[_];if(i[m.key]=[],m.type=="checkbox"){i[m.key]=[];for(let p=0;p<m.list.length;p++)i[m.key].push(m.list[p].value)}}for(let _ in n.trigger)e.value[n.key]["trigger_"+_]={status:1,template_id:"",print_num:1},Object.assign(e.value[n.key]["trigger_"+_],oe(i))}}e.printer_id||(N.value=!1)}),e.printer_id&&Ve(e.printer_id).then(g=>{let l=g.data;l&&Object.keys(e).forEach(n=>{if(l[n]!=null)if(n=="value")for(let i in e[n])Object.assign(e[n][i],l[n][i]);else e[n]=l[n]}),N.value=!1})})();const S=w([]);xe({}).then(g=>{S.value=g.data});const q=w({});ke({}).then(g=>{if(g.data){let l=g.data;for(let n=0;n<l.length;n++){let i=l[n];q.value[i.template_type]==null&&(q.value[i.template_type]=[]),q.value[i.template_type].push({template_id:i.template_id,template_name:i.template_name})}}});const z=async g=>{if(N.value||!g)return;if(k.value.length==0){H({type:"warning",message:a("printTypeEmpty")});return}let l=e.printer_id?we:Pe;await g.validate(async n=>{if(n){let i=!1,_="";for(let p=0;p<k.value.length;p++){let c=k.value[p];for(let E=0;E<Object.keys(c.trigger).length;E++){let y=Object.keys(c.trigger)[E];if(e.value[c.key]["trigger_"+y].status==0)continue;if(!e.value[c.key]["trigger_"+y].template_id){i=!0,_=`请设置${c.title}[${c.trigger[y]}]的小票打印模板`;break}let U=!1;for(let C=0;C<c.condition.length;C++){let F=c.condition[C];if(F.type=="checkbox"&&e.value[c.key]["trigger_"+y][F.key].length==0){i=!0,_=`请设置${c.title}[${c.trigger[y]}]的${F.title}`,U=!0;break}}if(U)break}if(i)break}if(i){H({type:"warning",message:_});return}e.template_type=[],e.trigger=[];for(let p in e.value){for(let c in e.value[p])e.trigger.push(p+"_"+c);e.template_type.push(p)}if(P.value)return;P.value=!0,l(e).then(p=>{P.value=!1,e.printer_id||O.push("/printer/list")}).catch(p=>{P.value=!1})}})},G=()=>{O.push("/printer/list")};return(g,l)=>{const n=ne,i=ie,_=de,m=se,p=pe,c=ue,E=ce,y=_e,U=me,C=fe,F=be,A=ge,W=ve,J=he;return u(),v("div",Ee,[r(i,{class:"card !border-none mb-[15px]",shadow:"never"},{default:d(()=>[r(n,{content:o(I),icon:o(ae),onBack:G},null,8,["content","icon"])]),_:1}),re((u(),T(A,{class:"page-form",model:e,rules:o(Z),"label-width":"150px",ref_key:"formRef",ref:j},{default:d(()=>[r(i,{class:"box-card !border-none",shadow:"never"},{default:d(()=>[s("h3",Ue,f(o(a)("printerSet")),1),r(m,{label:o(a)("printerName"),prop:"printer_name"},{default:d(()=>[r(_,{modelValue:e.printer_name,"onUpdate:modelValue":l[0]||(l[0]=t=>e.printer_name=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(a)("printerNamePlaceholder"),class:"input-width",maxlength:"20"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(m,{label:o(a)("brand"),prop:"brand"},{default:d(()=>[r(c,{modelValue:e.brand,"onUpdate:modelValue":l[1]||(l[1]=t=>e.brand=t),placeholder:o(a)("brandPlaceholder"),clearable:""},{default:d(()=>[(u(!0),v(x,null,V(S.value,(t,D)=>(u(),T(p,{key:D,label:t,value:D},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),r(m,{label:o(a)("printerCode"),prop:"printer_code"},{default:d(()=>[s("div",null,[r(_,{modelValue:e.printer_code,"onUpdate:modelValue":l[2]||(l[2]=t=>e.printer_code=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(a)("printerCodePlaceholder"),class:"input-width",maxlength:"30"},null,8,["modelValue","placeholder"]),s("p",Ce,f(o(a)("printerCodeTips")),1)])]),_:1},8,["label"]),r(m,{label:o(a)("printerKey"),prop:"printer_key"},{default:d(()=>[s("div",null,[r(_,{modelValue:e.printer_key,"onUpdate:modelValue":l[3]||(l[3]=t=>e.printer_key=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(a)("printerKeyPlaceholder"),class:"input-width",maxlength:"30"},null,8,["modelValue","placeholder"]),s("p",Fe,f(o(a)("printerKeyTips")),1)])]),_:1},8,["label"]),r(m,{label:o(a)("openId"),prop:"open_id"},{default:d(()=>[s("div",null,[r(_,{modelValue:e.open_id,"onUpdate:modelValue":l[4]||(l[4]=t=>e.open_id=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(a)("openIdPlaceholder"),class:"input-width",maxlength:"30"},null,8,["modelValue","placeholder"]),s("p",Te,f(o(a)("openIdTips")),1)])]),_:1},8,["label"]),r(m,{label:o(a)("apikey"),prop:"apikey"},{default:d(()=>[s("div",null,[r(_,{modelValue:e.apikey,"onUpdate:modelValue":l[5]||(l[5]=t=>e.apikey=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(a)("apikeyPlaceholder"),class:"input-width",maxlength:"60"},null,8,["modelValue","placeholder"]),s("p",Ne,f(o(a)("apikeyTips")),1)])]),_:1},8,["label"]),r(m,{label:o(a)("printWidth"),prop:"print_width"},{default:d(()=>[r(y,{modelValue:e.print_width,"onUpdate:modelValue":l[6]||(l[6]=t=>e.print_width=t)},{default:d(()=>[r(E,{label:"58mm"},{default:d(()=>[B("58mm")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),r(m,{label:o(a)("status")},{default:d(()=>[r(U,{modelValue:e.status,"onUpdate:modelValue":l[7]||(l[7]=t=>e.status=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),(u(!0),v(x,null,V(k.value,(t,D)=>(u(),T(i,{key:t.key,class:"box-card !border-none",shadow:"never"},{default:d(()=>[s("h3",qe,f(t.title),1),s("div",Me,[s("div",$e,f(o(a)("printTrigger")),1),s("div",Be,f(o(a)("status")),1),s("div",De,f(o(a)("usePrintTemplate")),1),(u(!0),v(x,null,V(t.condition,M=>(u(),v("div",{class:"px-[12px] w-[300px] flex-1",key:M.key},f(M.title),1))),128)),s("div",Re,f(o(a)("printNum")),1)]),t.trigger?(u(!0),v(x,{key:0},V(t.trigger,(M,h)=>(u(),v("div",{class:"flex bg-[#f8f8f9] mb-[10px] py-[20px]",key:h},[e.value[t.key]["trigger_"+h]?(u(),v(x,{key:0},[s("div",Le,f(M),1),s("div",Oe,[r(U,{modelValue:e.value[t.key]["trigger_"+h].status,"onUpdate:modelValue":b=>e.value[t.key]["trigger_"+h].status=b,"active-value":1,"inactive-value":0},null,8,["modelValue","onUpdate:modelValue"])]),s("div",je,[r(c,{modelValue:e.value[t.key]["trigger_"+h].template_id,"onUpdate:modelValue":b=>e.value[t.key]["trigger_"+h].template_id=b,placeholder:o(a)("请选择小票打印模板"),clearable:""},{default:d(()=>[(u(!0),v(x,null,V(q.value[t.key],b=>(u(),T(p,{key:b.template_id,label:b.template_name,value:b.template_id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),(u(!0),v(x,null,V(t.condition,b=>(u(),v(x,null,[b.type=="checkbox"?(u(),v("div",Se,[r(F,{modelValue:e.value[t.key]["trigger_"+h][b.key],"onUpdate:modelValue":$=>e.value[t.key]["trigger_"+h][b.key]=$},{default:d(()=>[(u(!0),v(x,null,V(b.list,($,Q)=>(u(),T(C,{label:$.value,key:Q},{default:d(()=>[B(f($.name),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):R("",!0)],64))),256)),s("div",Ge,[r(c,{modelValue:e.value[t.key]["trigger_"+h].print_num,"onUpdate:modelValue":b=>e.value[t.key]["trigger_"+h].print_num=b},{default:d(()=>[r(p,{label:"1联",value:1}),r(p,{label:"2联",value:2}),r(p,{label:"3联",value:3}),r(p,{label:"4联",value:4})]),_:2},1032,["modelValue","onUpdate:modelValue"])])],64)):R("",!0)]))),128)):R("",!0)]),_:2},1024))),128))]),_:1},8,["model","rules"])),[[J,N.value]]),s("div",We,[s("div",He,[r(W,{type:"primary",loading:P.value,onClick:l[8]||(l[8]=t=>z(j.value))},{default:d(()=>[B(f(o(a)("save")),1)]),_:1},8,["loading"]),r(W,{onClick:l[9]||(l[9]=t=>G())},{default:d(()=>[B(f(o(a)("cancel")),1)]),_:1})])])])}}});export{ct as default};
