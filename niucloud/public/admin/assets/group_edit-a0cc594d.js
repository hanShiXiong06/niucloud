import{d as H,r as m,y as K,f as W,R as q,cT as X,aX as Z,l as z,q as u,a5 as J,h as n,c as _,e as t,w as s,u as d,b3 as Q,Z as Y,s as f,t as i,F as B,W as D,a as r,i as $,cU as ee,cV as le,aq as ae,$ as oe,b4 as te,a9 as se,L as re,M as ne,K as de,a0 as ue,aF as ce,bD as ie,N as pe,E as _e,a3 as fe}from"./index-6a69b8ba.js";/* empty css                   *//* empty css                  *//* empty css                *//* empty css                          *//* empty css                    *//* empty css                 *//* empty css                        */import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                *//* empty css                       */import{a as me}from"./addon-09ef9a53.js";import{_ as ve}from"./_plugin-vue_export-helper-c27b6911.js";const he={class:"main-container"},ge={key:0,class:"text-gray-400"},xe={class:"w-full"},be={class:"flex"},ye={class:"w-[60px] h-[60px] mr-[10px] rounded-md overflow-hidden"},we={class:"image-error"},ke={class:"flex-1 w-0 flex flex-col justify-center"},Ee={class:"font-bold truncate"},Ve=["title"],Ce={key:0,class:"text-gray-400"},Le={class:"w-full"},Ie={class:"flex"},Ae={class:"w-[60px] h-[60px] mr-[10px] rounded-md overflow-hidden"},Fe={class:"image-error"},Ne={class:"flex-1 w-0 flex flex-col justify-center"},Re={class:"font-bold truncate"},qe=["title"],Be={class:"fixed-footer-wrap"},De={class:"fixed-footer"},$e=H({__name:"group_edit",setup(Pe){const y=m(!0),h=m([]),g=m([]),w=K(),P=W(),U=w.meta.title,k=m(!1),o=m({group_id:0,group_name:"",group_desc:"",app:[],addon:[]});q(()=>o.value.app,a=>{V()},{deep:!0}),q(()=>o.value.addon,a=>{V()},{deep:!0}),(async()=>{await me().then(({data:a})=>{const l=[],c=[];Object.keys(a).forEach(v=>{const p=a[v];p.disabled=!1,p.type=="addon"?c.push(p):l.push(p)}),h.value=l,g.value=c,V()}).catch()})(),w.query.id?X(w.query.id).then(a=>{const l=Z(a.data);o.value=l,y.value=!1}).catch():y.value=!1;const E=()=>{P.push({path:"/admin/site/manage",query:{type:"group"}})},L=m(),G=z(()=>({group_name:[{required:!0,message:u("groupNamePlaceholder"),trigger:"blur"}],app:[{required:!0,message:u("mainAppPlaceholder"),trigger:"blur"}]})),M=async a=>{if(k.value||!a)return;const l=o.value.group_id?ee:le;await a.validate(async c=>{c&&(k.value=!0,l(o.value).then(v=>{O(),setTimeout(()=>{E()},1e3)}).catch(()=>{k.value=!1}))})},O=()=>{ae().then(a=>{}).catch(()=>{})},V=()=>{g.value.forEach(a=>{a.support_app==""||o.value.app.indexOf(a.support_app)!=-1?a.disabled=!1:(a.disabled=!0,o.value.addon.indexOf(a.key)!=-1&&o.value.addon.splice(o.value.addon.indexOf(a.key),1))})},S=a=>{if(a.disabled&&a.support_app){const l=h.value.filter(c=>c.key==a.support_app);l.length&&oe({message:`请先选择 ${l[0].title} 应用`,type:"warning"})}};return(a,l)=>{const c=te,v=se,p=re,x=ne,b=de,I=J("icon-picture"),A=ue,F=ce,N=ie,j=pe,R=_e,T=fe;return n(),_("div",he,[t(v,{class:"box-card !border-none",shadow:"never"},{default:s(()=>[t(c,{content:d(U),icon:d(Q),onBack:l[0]||(l[0]=e=>E())},null,8,["content","icon"])]),_:1}),t(v,{class:"box-card mt-[15px] !border-none",shadow:"never"},{default:s(()=>[Y((n(),f(j,{model:o.value,"label-width":"110px",ref_key:"formRef",ref:L,rules:d(G),class:"page-form"},{default:s(()=>[t(x,{label:d(u)("groupName"),prop:"group_name"},{default:s(()=>[t(p,{modelValue:o.value.group_name,"onUpdate:modelValue":l[1]||(l[1]=e=>o.value.group_name=e),modelModifiers:{trim:!0},placeholder:d(u)("groupNamePlaceholder"),clearable:"",disabled:o.value.uid,class:"input-width",maxlength:"20","show-word-limit":!0},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),t(x,{label:d(u)("groupDesc"),prop:"group_desc"},{default:s(()=>[t(p,{modelValue:o.value.group_desc,"onUpdate:modelValue":l[2]||(l[2]=e=>o.value.group_desc=e),modelModifiers:{trim:!0},type:"textarea",rows:"4",clearable:"",placeholder:d(u)("groupDescPlaceholder"),class:"input-width",maxlength:"100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(x,{label:d(u)("mainApp"),prop:"app"},{default:s(()=>[h.value.length?(n(),f(N,{key:1,modelValue:o.value.app,"onUpdate:modelValue":l[3]||(l[3]=e=>o.value.app=e),class:"flex flex-wrap w-full"},{default:s(()=>[(n(!0),_(B,null,D(h.value,(e,C)=>(n(),_("div",{class:"flex w-[300px]",key:C},[t(F,{label:e.key,class:"w-full !h-auto border border-[var(--el-color-info-light-7)] border-solid p-[10px] !mr-[10px] !mb-[10px] rounded-md"},{default:s(()=>[r("div",xe,[r("div",be,[r("div",ye,[e.icon?(n(),f(b,{key:0,src:e.icon,class:"w-full h-full"},null,8,["src"])):(n(),f(b,{key:1,class:"w-full h-full"},{error:s(()=>[r("div",we,[t(A,null,{default:s(()=>[t(I)]),_:1})])]),_:1}))]),r("div",ke,[r("div",Ee,i(e.title),1),r("div",{class:"text-gray-400 mt-[10px] truncate",title:e.desc},i(e.desc),9,Ve)])])])]),_:2},1032,["label"])]))),128))]),_:1},8,["modelValue"])):(n(),_("div",ge,i(d(u)("appListEmpty")),1))]),_:1},8,["label"]),t(x,{label:d(u)("containAddon")},{default:s(()=>[g.value.length?(n(),f(N,{key:1,modelValue:o.value.addon,"onUpdate:modelValue":l[4]||(l[4]=e=>o.value.addon=e),class:"flex flex-wrap w-full"},{default:s(()=>[(n(!0),_(B,null,D(g.value,(e,C)=>(n(),_("div",{class:"flex w-[300px]",key:C},[t(F,{label:e.key,disabled:e.disabled,onClick:Ge=>S(e),class:"w-full !h-auto border border-[var(--el-color-info-light-7)] border-solid p-[10px] !mr-[10px] !mb-[10px] rounded-md"},{default:s(()=>[r("div",Le,[r("div",Ie,[r("div",Ae,[e.icon?(n(),f(b,{key:0,src:e.icon,class:"w-full h-full"},null,8,["src"])):(n(),f(b,{key:1,class:"w-full h-full"},{error:s(()=>[r("div",Fe,[t(A,null,{default:s(()=>[t(I)]),_:1})])]),_:1}))]),r("div",Ne,[r("div",Re,i(e.title),1),r("div",{class:"text-gray-400 mt-[10px] truncate",title:e.desc},i(e.desc),9,qe)])])])]),_:2},1032,["label","disabled","onClick"])]))),128))]),_:1},8,["modelValue"])):(n(),_("div",Ce,i(d(u)("addonListEmpty")),1))]),_:1},8,["label"])]),_:1},8,["model","rules"])),[[T,y.value]])]),_:1}),r("div",Be,[r("div",De,[t(R,{type:"primary",onClick:l[5]||(l[5]=e=>M(L.value))},{default:s(()=>[$(i(d(u)("save")),1)]),_:1}),t(R,{onClick:l[6]||(l[6]=e=>E())},{default:s(()=>[$(i(d(u)("cancel")),1)]),_:1})])])])}}});const el=ve($e,[["__scopeId","data-v-4a0f091f"]]);export{el as default};
