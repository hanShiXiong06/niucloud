import{r as d,R as Nt,aZ as Ne,d as Ft,y as Yt,l as he,n as Ae,h as _,c as P,e as o,w as n,a as s,u as m,dW as Kt,i as y,Y as K,D as Jt,dp as Re,t as p,v as Qt,dX as qt,Z as ze,dY as Gt,F as se,W as le,s as x,bb as be,dZ as Le,_ as Ht,dr as Wt,C as R,d_ as Pe,dF as Be,dK as Ue,dN as Zt,dP as Oe,d$ as Xt,dA as $e,dJ as ea,B as ta,$ as c,du as aa,ah as O,bE as ie,bh as sa,E as la,a0 as ia,L as oa,a4 as ra,a1 as na,bV as ca,N as da,dT as ua,aH as _a,e0 as ma,aI as pa,aj as va,as as fa,dU as ga,ak as ya,cQ as ha,a2 as ba,a9 as xa,ae as ka,af as Ca,V as wa,a3 as Da,p as Ea,g as Sa,e1 as Ta,e2 as Va,dt as Ia,e3 as Ma}from"./index-9cfed1fc.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                         *//* empty css                *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                        *//* empty css                    *//* empty css                 */import Aa from"./CheckDeviceDialog-5aec3e32.js";/* empty css                *//* empty css                       *//* empty css                  */import{d as Ra,e as za,f as La,b as oe,h as Pa,i as Ba,j as xe,k as Ua,l as Oa,m as je,n as $a,p as ja,o as Na}from"./recycle_order-54bfc2b8.js";import{d as Fa}from"./device_query_api-45f3f1dd.js";import{_ as Ya}from"./printer-6e82347a.js";import Ka from"./AddOrderDialog-931805d9.js";import Ja from"./PaymentMethodDialog-5658b9f6.js";import Qa from"./OrderDetailDialog-d7f2743a.js";import qa from"./PriceFormDialog-4016261a.js";import Ga from"./DeviceConfirmDialog-4ca33b40.js";import Ha from"./DeviceDetailDialog-3032f702.js";import Wa from"./index-8d5e5eee.js";import{_ as Za}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-a4ad10ba.js";/* empty css                        */import"./index.vue_vue_type_style_index_0_lang-fad85f8a.js";import"./attachment-4de82df9.js";import"./index.vue_vue_type_script_setup_true_lang-c04cd2bb.js";import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css                  *//* empty css                    *//* empty css                         */import"./index.vue_vue_type_script_setup_true_lang-218b436b.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-e50d9a7c.js";import"./sortable.esm-be94e56d.js";/* empty css                  *//* empty css                        */import"./browser-a1ac24ac.js";import"./WarrantyInfoDisplay-ff2e290f.js";/* empty css                       *//* empty css                 *//* empty css                 *//* empty css                        *//* empty css                         *//* empty css                   *//* empty css                             */import"./member-80ec2b68.js";function Xa($){const S=d([]),I=d({page:1,limit:15,total:0}),T=`page_state_${$}`,j=()=>{const b={expandedRows:S.value.map(C=>typeof C=="object"&&C!==null&&C.id!==void 0?C.id:C),pagination:I.value};localStorage.setItem(T,JSON.stringify(b))},f=()=>{try{const h=localStorage.getItem(T);if(h){const b=JSON.parse(h);b.pagination&&(I.value={...I.value,...b.pagination}),b.expandedRows&&b.expandedRows.length>0&&(S.value=b.expandedRows)}}catch(h){console.error("恢复页面状态失败:",h),localStorage.removeItem(T)}},re=h=>{S.value=h.map(b=>typeof b=="object"&&b!==null&&b.id!==void 0?b.id:b),j()},A=h=>{I.value={...I.value,...h},j()},ke=h=>{if(!S.value.length||!h.length)return[];const b=S.value.map(C=>typeof C=="object"&&C!==null?C.id:C);return h.filter(C=>b.includes(C.id))},ne=()=>{localStorage.removeItem(T),S.value=[],I.value={page:1,limit:15,total:0}};return Nt(()=>I.value,()=>{j()},{deep:!0}),Ne(()=>{f()}),{expandedRows:S,pagination:I,setExpandedRows:re,setPagination:A,applyExpandedRows:ke,clearState:ne,saveState:j,restoreState:f}}const k=$=>(Ea("data-v-b8190628"),$=$(),Sa(),$),es={class:"recycle-order-list h-full"},ts={class:"flex justify-between items-center mb-4"},as=k(()=>s("span",{class:"text-xl font-semibold text-gray-800"},"📱 回收订单管理",-1)),ss={class:"btn-wrap"},ls={class:"mb-6 sticky top-30 z-50 bg-white/95 backdrop-blur-sm shadow-lg rounded-lg p-2 -mx-2"},is={class:"mb-4"},os={class:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100 shadow-sm hover:shadow-md transition-all duration-300"},rs={class:"p-4"},ns={class:"flex flex-wrap items-center gap-4 lg:flex-nowrap"},cs={class:"flex items-center gap-2 text-blue-600 min-w-max"},ds={class:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center"},us=k(()=>s("span",{class:"text-sm font-medium"},"快速搜索",-1)),_s={class:"flex-1 min-w-64"},ms={class:"flex items-center gap-2 min-w-max"},ps={class:"bg-gradient-to-br from-orange-50 to-amber-50 rounded-xl border border-orange-100 shadow-sm"},vs={class:"bg-gradient-to-r from-orange-100 to-amber-100 px-5 py-3 rounded-t-xl border-b border-orange-200"},fs={class:"flex items-center"},gs={class:"w-8 h-8 bg-orange-200 rounded-full flex items-center justify-center mr-3"},ys=k(()=>s("span",{class:"font-semibold text-orange-800"},"高级搜索条件",-1)),hs={class:"p-6"},bs={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6"},xs={class:"space-y-2"},ks=k(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"订单编号",-1)),Cs={class:"space-y-2"},ws=k(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"快递单号",-1)),Ds={class:"space-y-2"},Es=k(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"订单状态",-1)),Ss={class:"flex items-center justify-between"},Ts={class:"flex items-center"},Vs={class:"text-xs text-gray-400"},Is={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6"},Ms={class:"space-y-2"},As=k(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"用户搜索",-1)),Rs={class:"relative"},zs={class:"absolute right-7 top-1/2 transform -translate-y-1/2 text-blue-400 pointer-events-none"},Ls={class:"space-y-2"},Ps=k(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"配送方式",-1)),Bs=k(()=>s("div",{class:"flex items-center justify-between"},[s("div",{class:"flex items-center"},[s("span",{class:"mr-2"},"📦"),s("span",null,"快递配送")]),s("span",{class:"text-xs text-gray-400"},"用户邮寄设备")],-1)),Us=k(()=>s("div",{class:"flex items-center justify-between"},[s("div",{class:"flex items-center"},[s("span",{class:"mr-2"},"🚗"),s("span",null,"自送到店")]),s("span",{class:"text-xs text-gray-400"},"用户上门交付")],-1)),Os={class:"space-y-2"},$s=k(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"设备IMEI",-1)),js={class:"space-y-2"},Ns=k(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"设备型号",-1)),Fs={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},Ys={class:"space-y-2"},Ks=k(()=>s("label",{class:"block text-sm font-medium text-gray-700"},"创建时间",-1)),Js={class:"flex justify-center pt-4 border-t border-orange-200"},Qs={class:"flex gap-3"},qs={class:"flex items-center"},Gs=k(()=>s("span",null,"全部",-1)),Hs={class:"flex items-center"},Ws={class:"device-expansion-panel"},Zs={class:"panel-header mb-3"},Xs=k(()=>s("h4",{class:"text-lg font-medium text-gray-800"},"📱 设备列表",-1)),el={class:"text-sm text-gray-500"},tl={class:"price-text"},al={key:0,class:"flex justify-end mt-3"},sl={class:"order-info-cell"},ll={class:"info-row"},il=k(()=>s("span",{class:"label"},"订单号：",-1)),ol={class:"value"},rl={class:"info-row"},nl=k(()=>s("span",{class:"label"},"配送：",-1)),cl={class:"value"},dl={key:0,class:"info-row"},ul=k(()=>s("span",{class:"text-gray-500 text-xs min-w-16"},"快递单号：",-1)),_l=["onClick"],ml={key:0,class:"font-mono font-medium"},pl={class:"user-info-cell"},vl={class:"user-avatar"},fl={class:"user-details"},gl={class:"user-name"},yl={class:"user-phone"},hl=k(()=>s("div",{class:"text-xs"},"提交数量/签收数量",-1)),bl={class:"flex justify-between items-center mt-4"},xl={class:"text-sm text-gray-500"},kl={key:0,class:"express-info-container"},Cl={class:"express-header mb-4"},wl={class:"flex items-center justify-between"},Dl={class:"text-lg font-medium"},El={class:"text-sm text-gray-600"},Sl={class:"mt-2"},Tl={class:"text-sm text-gray-600"},Vl={class:"text-xs text-gray-500"},Il={class:"express-trace"},Ml=k(()=>s("h4",{class:"text-md font-medium mb-3"},"物流轨迹",-1)),Al={class:"trace-item"},Rl={class:"trace-location"},zl={class:"trace-desc"},Ll={key:1,class:"text-center py-8 text-gray-500"},Pl=Ft({__name:"list",setup($){Yt();const S=d({}),I=d(!1),T=d([]),{expandedRows:j,pagination:f,setExpandedRows:re,setPagination:A,applyExpandedRows:ke}=Xa("recycle_order_list"),ne=he(()=>j.value||[]),h=d(!1),b=d(!1),C=d(0),z=d([]),ce=d(!1),Ce=d(null);d([]);const U=d([]),Z=d(0),X=d({}),de=d(!1),B=d(null),Fe=d(null),N=d(null),Ye=()=>{z.value.push({imei:"",model:"",initial_price:0,editing:!0,category_id:1})},Ke=t=>{const e=z.value.findIndex(i=>i===t||i.id===t.id);e!==-1&&(z.value[e].editing=!0)},Je=async t=>{try{t.id&&(await Ra(t.id),c.success("删除成功"),await g(),h.value=!1),z.value=z.value.filter(e=>e!==t&&e.id!==t.id)}catch(e){console.error("删除设备失败：",e),c.error("删除失败："+(e.message||"未知错误"))}},Qe=()=>{h.value=!1,z.value=[],C.value=0},D=Ae({keyword:"",status:"",delivery_type:""}),r=Ae({order_id:"",express_no:"",status:[],member_id:"",user_mobile:"",delivery_type:[],device_imei:"",device_model:"",device_count_min:null,device_count_max:null,amount_min:null,amount_max:null,create_time_range:[],update_time_range:[]}),J=d(!1),qe=async()=>{try{const t=await za();t.code===1&&(S.value=t.data)}catch(t){console.error("获取状态列表失败:",t)}},Ge=d(null),g=async(t=1)=>{I.value=!0;try{const e={page:f.value.page,limit:f.value.limit};D.keyword&&(e.keyword=D.keyword),D.status&&(e.status=D.status),D.delivery_type&&(e.delivery_type=D.delivery_type),r.order_id&&(e.order_id=r.order_id),r.express_no&&(e.express_no=r.express_no),r.status&&r.status.length>0&&(e.status=r.status.join(",")),r.member_id&&(e.member_id=r.member_id),r.user_mobile&&(e.user_mobile=r.user_mobile),r.delivery_type&&r.delivery_type.length>0&&(e.delivery_type=r.delivery_type.join(",")),r.device_imei&&(e.device_imei=r.device_imei),r.device_model&&(e.device_model=r.device_model),r.device_count_min&&(e.device_count_min=r.device_count_min),r.device_count_max&&(e.device_count_max=r.device_count_max),r.amount_min&&(e.amount_min=r.amount_min),r.amount_max&&(e.amount_max=r.amount_max),r.create_time_range&&r.create_time_range.length===2&&(e.create_time_start=r.create_time_range[0],e.create_time_end=r.create_time_range[1]),r.update_time_range&&r.update_time_range.length===2&&(e.update_time_start=r.update_time_range[0],e.update_time_end=r.update_time_range[1]);const i=await La(e);i.data.data?T.value=i.data.data:i.data.list?T.value=i.data.list:(T.value=[],console.error("API返回的数据结构不符合预期:",i.data));const l=i.data.total||i.data.count||0;we.value=i.data.status_counts,A({total:l})}catch(e){console.error("获取列表失败:",e),c.error("获取列表失败")}finally{I.value=!1}},He=t=>{A({limit:t,page:f.value.page}),g(1)},We=t=>{A({page:t,limit:f.value.limit}),g(t)};d(!1);const we=d({}),Ze=t=>t==="all"?f.value.total:we.value[t]||0,Xe=t=>({1:"warning",2:"warning",3:"primary",4:"success",5:"warning",6:"primary",7:"success",8:"info",9:"danger",10:"danger"})[t]||"info",et=t=>({1:"light",2:"light",3:"light",4:"light",5:"light",6:"dark",7:"dark",8:"plain",9:"dark",10:"dark"})[t]||"plain",tt=t=>({1:"info",2:"warning",3:"primary",4:"success",5:"success",6:"danger"})[t]||"info",ue=t=>{switch(t){case 1:return"Clock";case 2:return"Finished";case 3:return"Loading";case 4:return"DocumentChecked";case 5:return"CircleCheck";case 6:return"Money";case 7:return"CircleCheckFilled";case 8:return"CircleClose";default:return"QuestionFilled"}},at=t=>({1:"warning",2:"info",3:"primary",4:"success",5:"warning",6:"primary",7:"success",8:"info",9:"danger",10:"danger"})[t]||"info",st=t=>({order_sign:"primary",order_check:"success",order_price:"warning",order_payment:"primary",order_complete:"success",order_cancel:"danger",order_delete:"danger",order_detail:"info"})[t]||"default",lt=t=>({order_sign:Pe,order_check:K,order_price:Be,order_payment:Ta,order_complete:Va,order_cancel:Ia,order_delete:Oe,order_detail:$e,order_push_notify:Ma})[t]||aa,it=t=>t?`¥${(typeof t=="string"?parseFloat(t):t).toFixed(2)}`:"¥0.00",ot=async t=>{try{await O.confirm("确定要推送订单确认通知给用户吗？","推送通知",{confirmButtonText:"确定推送",cancelButtonText:"取消",type:"info"});const e=ie.service({lock:!0,text:"正在发送通知...",background:"rgba(0, 0, 0, 0.7)"});await Na(t.id),e.close(),c.success("推送通知已发送")}catch(e){e!=="cancel"&&(console.error("推送通知失败：",e),c.error(e.message||"推送通知失败"))}},rt=async(t,e)=>{try{if(e.key==="order_cancel")await O.confirm("确定要取消该订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await oe(t.id,{action:"order_cancel"}),c.success("订单已取消"),await g(f.value.page);else if(e.key==="order_delete")await O.confirm("确定要删除该订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Pa(t.id),c.success("订单已删除"),await g(f.value.page);else if(e.key==="order_complete")await O.confirm("确定要完成该订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await oe(t.id,{action:"order_complete"}),c.success("操作成功，订单已完成"),await g(f.value.page);else if(e.key==="order_sign")C.value=t.id,z.value=t.devices||[],h.value=!0;else if(e.key==="order_check")C.value=t.id,z.value=t.devices||[],Q.value=!0;else if(e.key==="order_price")C.value=t.id,z.value=t.devices||[],q.value=!0;else if(e.key=="order_payment"){b.value=!0;const i=await Ba(t.member_id);if(i.data&&Array.isArray(i.data)){const l=T.value.find(v=>v.id===t.id);let E=0;l&&l.devices&&Array.isArray(l.devices)&&(E=l.devices.filter(v=>v.status===6).length);let M=0;l&&l.devices&&Array.isArray(l.devices)&&(M=l.devices.filter(v=>v.status>=4).length);let H=0;l&&l.devices&&Array.isArray(l.devices)&&(H=l.devices.filter(v=>v.status>=5).length);let te=0;l&&l.devices&&Array.isArray(l.devices)&&(te=l.devices.filter(v=>v.status==5).length);let ae=0;l&&l.devices&&Array.isArray(l.devices)&&(ae=l.devices.filter(v=>v.status==5).reduce((v,ge)=>v+ +ge.final_price,0));const fe={order_id:l?l.id:t.id,delivery_type:l?l.delivery_type_text:"",device_count:l&&l.devices?l.devices.length:0,confirmed_count:H,checked_count:M,success_count:te,returned_count:E,price_per_device:l?l.price_per_device:0,total_amount:l?ae:0,customer_name:l?l.member.nickname:"",customer_mobile:l?l.member.mobile:"",delivery_type_name:l?l.delivery_type_name:"",devices:l&&l.devices?l.devices.map(v=>({id:v.id,model:v.model,imei:v.imei,final_price:v.final_price||0,status:v.status,status_name:v.status_name||""})):[]},W=i.data.map(v=>({...v,order_summary:fe}));U.value=W,Z.value=W.length>0?0:-1}else U.value=[]}else if(e.key=="order_detail"){const i=T.value.find(l=>l.id===t.id);i?(Ce.value=i,ce.value=!0):c.warning("未找到订单信息")}else e.key=="order_push_notify"?await ot(t):(await oe(t.id,{action:e.key}),c.success("操作成功"),await g())}catch(i){console.error("操作失败：",i),c.error(i.message||"操作失败")}},_e=t=>t?t.length:0,De=()=>{Ee(),A({page:1}),g(1)},nt=()=>{D.keyword="",D.status="",D.delivery_type="",F.value="",A({page:1}),g(1)},ct=()=>{ut(),F.value="",A({page:1}),g(1)},dt=()=>{Ee(),F.value="",A({page:1}),g(1)},ut=()=>{D.keyword="",D.status="",D.delivery_type=""},Ee=()=>{r.order_id="",r.express_no="",r.status=[],r.member_id="",r.user_mobile="",r.delivery_type=[],r.device_imei="",r.device_model="",r.device_count_min=null,r.device_count_max=null,r.amount_min=null,r.amount_max=null,r.create_time_range=[],r.update_time_range=[]},_t=(t,e)=>{r.member_id=t,A({page:1}),g(1)},mt=t=>{const e=T.value.find(i=>i.id===t);return e?e.status:0},ee=d({id:0,imei:"",model:"",initial_price:"",check_result:"",check_images:"",remark:"",status:0,final_price:"",check_status:0}),Q=d(!1),q=d(!1);d({});const pt=async t=>{const e=t.order_id,i=T.value.find(E=>E.id===e);if(i&&i.status===1){c.warning("请先签收订单后再进行质检");return}Q.value=!0;const l=await xe(t.id);l.code===1&&(ee.value={id:l.data.id,imei:l.data.imei,model:l.data.model,initial_price:l.data.initial_price,check_result:l.data.check_result||"",check_images:l.data.check_images||"",final_price:l.data.final_price||"",remark:l.data.remark||"",status:l.data.status,check_status:l.data.check_status})},Se=async t=>{try{const e=await xe(t.id);e.code===1&&(ee.value={id:e.data.id,imei:e.data.imei,model:e.data.model,initial_price:e.data.initial_price,check_result:e.data.check_result||"",check_images:e.data.check_images||"",final_price:e.data.final_price||"",before_price:e.data.before_price||"",remark:e.data.remark||"",status:e.data.status,check_status:e.data.check_status},q.value=!0)}catch(e){console.error("获取设备信息失败:",e),c.error("获取设备信息失败")}},vt=async t=>{var e,i;try{if(!t.check_result){c.warning("请填写质检结果");return}await Ua(t.id,{check_result:t.check_result,check_images:t.check_images,remark:t.remark,check_status:1,final_price:t.final_price,action:"check",imei:t.imei,info:t.info,model:t.model}),c.success("质检信息提交成功"),Q.value=!1,await g(f.value.page)}catch(l){console.error("提交质检信息失败：",l),c.error(((i=(e=l.response)==null?void 0:e.data)==null?void 0:i.message)||"提交失败，请重试")}},ft=async t=>{try{if(!t||!t.final_price||t.final_price<=0){c.warning("请输入有效的价格");return}await Oa(t.id,t),c.success("定价信息提交成功"),q.value=!1,await g(f.value.page)}catch(e){console.error("提交定价信息失败：",e),c.error("提交失败，请重试")}},G=d({}),gt=(t,e)=>{G.value[e]=t},yt=async t=>{t||c.warning("请选择设备");try{await je({ids:t+"",remark:"管理员确认"}),g(f.value.page)}catch{c.error("确认失败")}},ht=async t=>{if(!t){c.warning("请选择设备");return}try{const{value:e}=await O.prompt(`确定要拒绝回收该设备吗？将创建退货订单处理该设备。
请输入拒绝回收原因：`,"拒绝回收确认",{confirmButtonText:"确定拒绝",cancelButtonText:"取消",type:"warning",inputPlaceholder:"请输入拒绝回收原因"}),i=ie.service({lock:!0,text:"正在处理...",background:"rgba(0, 0, 0, 0.7)"});await $a({ids:t+"",remark:e||"商户拒绝回收"}),i.close(),c.success("拒绝成功，已创建退货订单"),g(f.value.page)}catch(e){if(e==="cancel")return;console.error("拒绝失败:",e)}},bt=async t=>{try{const e=G.value[t].map(l=>l.id);if(e.length===0){c.warning("请选择设备");return}const{value:i}=await O.prompt("请输入操作备注","批量确认设备",{confirmButtonText:"确认",cancelButtonText:"取消",inputPlaceholder:"请输入备注信息（可选）"});await je({ids:e.join(","),remark:i||""}),c.success("批量确认成功"),await g(f.value.page)}catch(e){e!=="cancel"&&(console.error("批量确认失败：",e),c.error("批量确认失败"))}},xt=(t,e)=>{const i=e.map(l=>l.id);re(i)},me=d(!1),Te=d({}),kt=async t=>{try{const e=await xe(t.id);if(e.code!==1){c.error(e.msg||"获取设备详情失败");return}ve.value=e.data,me.value=!0}catch(e){console.error("获取设备详情失败:",e),c.error("获取设备详情失败")}},pe=d(!1),Ct=()=>{pe.value=!0},wt=async()=>{await g()};Ne(async()=>{await qe(),await g(f.value.page)}),he(()=>U.value&&U.value.length>0&&Z.value>=0&&Z.value<U.value.length?U.value[Z.value]:null);const F=d(""),Dt=t=>{F.value=t.props.name,D.status=t.props.name,r.status=[],A({page:1}),g(1)},Et=async t=>{try{await ja(t.orderId,{pay_type:t.payType,remark:"财务已确认打款"}),c.success("确认打款成功"),b.value=!1,await g()}catch(e){console.error("确认打款失败",e),c.error("确认打款失败")}},ve=d(null),St=()=>{ve.value=null},Tt=async t=>{const e=ie.service({lock:!0,text:"正在保存...",background:"rgba(0, 0, 0, 0.7)"});try{const i=await oe(t.orderId,{action:"order_sign",devices:t.devices.map(l=>({id:l.id,imei:l.imei,model:l.model,initial_price:l.initial_price,category_id:l.category_id}))});if(i.code!==1)throw e.close(),h.value=!1,new Error(i.message||"操作失败");c.success("订单签收成功"),h.value=!1,await g(),e.close()}catch{e.close()}};he(()=>{var t,e;return(e=(t=Te.value)==null?void 0:t.data)!=null&&e.check_images?Te.value.data.check_images.split(",").filter(i=>i):[]});const Vt=async t=>{try{const e=ie.service({lock:!0,text:"正在打印标签...",background:"rgba(0, 0, 0, 0.7)"}),i=await Ya(t.id);if(e.close(),i.code===1)c.success("标签打印成功"),i.data&&i.data.simulated&&(sa({title:"模拟打印",message:"已生成打印内容，但未连接实际打印机",type:"warning",duration:5e3}),O.alert(`<pre style="white-space: pre-wrap; font-family: monospace; font-size: 12px;">${i.data.content}</pre>`,"打印内容预览",{dangerouslyUseHTMLString:!0,confirmButtonText:"关闭",callback:()=>{}}));else{const l=i.message||"打印失败",E=i.debug_info?JSON.stringify(i.debug_info):"";c.error(`${l} ${E}`),console.error("打印失败:",i)}}catch(e){console.error("打印过程异常:",e),c.error(`打印过程异常: ${e.message||"未知错误"}`)}},It=async(t,e)=>{try{return(await Fa(t,e)).data}catch(i){throw console.error("查询快递信息失败:",i),i}},Mt=async t=>{!t.express_no||t.express_no==="暂无"||(N.value&&clearTimeout(N.value),N.value=setTimeout(async()=>{var e,i;try{X.value[t.id]=!0;const E=(((e=t.member)==null?void 0:e.mobile)||((i=t.recycleUserAddress)==null?void 0:i.mobile)||"").slice(-4);if(!E){c.warning("无法获取用户手机号，无法查询快递信息");return}const M=await It(t.express_no,E);if(!M||!M.data||!M.data.logisticsTraceDetailList||M.data.logisticsTraceDetailList.length===0){c.info("暂无物流信息");return}B.value=M.data,Fe.value=t,de.value=!0}catch(l){console.error("查询快递信息失败:",l),c.error("查询快递信息失败")}finally{X.value[t.id]=!1}},500))},At=()=>{N.value&&(clearTimeout(N.value),N.value=null)},Rt=t=>{switch(t){case"ACCEPT":return"info";case"TRANSPORT":return"warning";case"DELIVER":return"primary";case"SIGN":return"success";case"REJECT":case"EXCEPTION":return"danger";default:return"info"}},zt=t=>{switch(t){case 1:return"待签收";case 2:return"质检中";case 3:return"已质检";case 4:return"待定价";case 5:return"待用户确认";case 6:return"待财务打款";case 7:return"已打款|完成✅";case 8:return"已取消";case 9:return"已取消";case 10:return"已删除";default:return"未知状态"}};return(t,e)=>{const i=la,l=ia,E=oa,M=ra,H=na,te=ca,ae=da,fe=ua,W=_a,v=ma,ge=pa,V=va,Y=fa,ye=ga,Ve=ya,Lt=ha,Pt=ba,Bt=xa,Ut=ka,Ot=Ca,$t=wa,jt=Da;return _(),P("div",es,[o(Bt,{class:"box-card !border-none h-full relative",shadow:"never"},{default:n(()=>[s("div",ts,[as,s("div",ss,[o(i,{type:"primary",icon:m(Kt),onClick:Ct},{default:n(()=>[y("代下单")]),_:1},8,["icon"])])]),s("div",ls,[s("div",is,[s("div",os,[s("div",rs,[s("div",ns,[s("div",cs,[s("div",ds,[o(l,{size:"16"},{default:n(()=>[o(m(K))]),_:1})]),us]),s("div",_s,[o(E,{modelValue:D.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>D.keyword=a),placeholder:"订单号、用户昵称、手机号、IMEI",clearable:"","prefix-icon":m(K),class:"rounded-lg",onKeyup:Jt(De,["enter"])},null,8,["modelValue","prefix-icon","onKeyup"])]),s("div",ms,[o(i,{type:"primary",icon:m(K),onClick:De,class:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 border-0 shadow-sm"},{default:n(()=>[y(" 搜索 ")]),_:1},8,["icon"]),o(i,{icon:m(Re),onClick:nt,class:"border-gray-300 text-gray-600 hover:border-gray-400"},{default:n(()=>[y(" 重置 ")]),_:1},8,["icon"]),o(i,{link:"",type:"primary",onClick:e[1]||(e[1]=a=>J.value=!J.value),class:"text-blue-600 hover:text-blue-700 font-medium"},{default:n(()=>[y(p(J.value?"收起高级搜索":"展开高级搜索")+" ",1),o(l,{class:Qt(["ml-1 transition-transform duration-200",{"rotate-180":J.value}])},{default:n(()=>[o(m(qt))]),_:1},8,["class"])]),_:1})])])])])]),o(fe,null,{default:n(()=>[ze(s("div",null,[s("div",ps,[s("div",vs,[s("div",fs,[s("div",gs,[o(l,{size:"16",class:"text-orange-600"},{default:n(()=>[o(m(Gt))]),_:1})]),ys])]),s("div",hs,[o(ae,{model:r},{default:n(()=>[s("div",bs,[s("div",xs,[ks,o(E,{modelValue:r.order_id,"onUpdate:modelValue":e[2]||(e[2]=a=>r.order_id=a),placeholder:"输入精确订单号",clearable:"",class:"w-full"},null,8,["modelValue"])]),s("div",Cs,[ws,o(E,{modelValue:r.express_no,"onUpdate:modelValue":e[3]||(e[3]=a=>r.express_no=a),placeholder:"输入快递单号",clearable:"",class:"w-full"},null,8,["modelValue"])]),s("div",Ds,[Es,o(H,{modelValue:r.status,"onUpdate:modelValue":e[4]||(e[4]=a=>r.status=a),placeholder:"选择状态",clearable:"",multiple:"","collapse-tags":"",class:"w-full"},{default:n(()=>[(_(!0),P(se,null,le(S.value,(a,w)=>(_(),x(M,{key:w,label:a.name,value:a.status},{default:n(()=>[s("div",Ss,[s("div",Ts,[o(l,{class:"mr-2 text-gray-500"},{default:n(()=>[(_(),x(be(ue(a.status))))]),_:2},1024),s("span",null,p(a.name),1)]),s("span",Vs,p(zt(a.status)),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])])]),s("div",Is,[s("div",Ms,[As,s("div",Rs,[o(Wa,{modelValue:r.member_id,"onUpdate:modelValue":e[5]||(e[5]=a=>r.member_id=a),placeholder:"🔍 输入用户昵称、手机号或用户编号",onChange:_t,class:"w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300 shadow-sm hover:shadow-md"},null,8,["modelValue"]),s("div",zs,[o(l,{size:"16"},{default:n(()=>[o(m(Le))]),_:1})])])]),s("div",Ls,[Ps,o(H,{modelValue:r.delivery_type,"onUpdate:modelValue":e[6]||(e[6]=a=>r.delivery_type=a),placeholder:"选择配送方式",clearable:"",multiple:"",class:"w-full"},{default:n(()=>[o(M,{label:"📦 快递配送",value:"1"},{default:n(()=>[Bs]),_:1}),o(M,{label:"🚗 自送到店",value:"2"},{default:n(()=>[Us]),_:1})]),_:1},8,["modelValue"])]),s("div",Os,[$s,o(E,{modelValue:r.device_imei,"onUpdate:modelValue":e[7]||(e[7]=a=>r.device_imei=a),placeholder:"输入设备IMEI号",clearable:"",class:"w-full"},null,8,["modelValue"])]),s("div",js,[Ns,o(E,{modelValue:r.device_model,"onUpdate:modelValue":e[8]||(e[8]=a=>r.device_model=a),placeholder:"输入设备型号",clearable:"",class:"w-full"},null,8,["modelValue"])])]),s("div",Fs,[s("div",Ys,[Ks,o(te,{modelValue:r.create_time_range,"onUpdate:modelValue":e[9]||(e[9]=a=>r.create_time_range=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"w-full"},null,8,["modelValue"])])]),s("div",Js,[s("div",Qs,[o(i,{type:"primary",icon:m(K),onClick:ct,class:"bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 border-0 shadow-sm px-6"},{default:n(()=>[y(" 执行高级搜索 ")]),_:1},8,["icon"]),o(i,{icon:m(Re),onClick:dt,class:"border-gray-300 text-gray-600 hover:border-gray-400 px-6"},{default:n(()=>[y(" 重置所有条件 ")]),_:1},8,["icon"])])])]),_:1},8,["model"])])])],512),[[Ht,J.value]])]),_:1})]),o(ge,{modelValue:F.value,"onUpdate:modelValue":e[10]||(e[10]=a=>F.value=a),onTabClick:Dt,class:"order-tabs"},{default:n(()=>[o(W,{name:""},{label:n(()=>[s("div",qs,[o(l,{class:"mr-1"},{default:n(()=>[o(m(Wt))]),_:1}),Gs])]),_:1}),(_(!0),P(se,null,le(S.value,(a,w)=>(_(),x(W,{key:w,name:a.status},{label:n(()=>[s("div",Hs,[o(l,{class:"mr-1"},{default:n(()=>[(_(),x(be(ue(a.status))))]),_:2},1024),s("span",null,p(a.name),1),a.status<7?(_(),x(v,{key:0,value:Ze(a.status),class:"ml-1",type:at(a.status)},null,8,["value","type"])):R("",!0)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),ze((_(),x(Ve,{ref_key:"orderTable",ref:Ge,data:T.value,"expand-row-keys":m(ne),"row-key":"id",style:{width:"100%"},onExpandChange:xt,class:"order-table"},{default:n(()=>[o(V,{type:"expand"},{default:n(({row:a})=>{var w;return[s("div",Ws,[s("div",Zs,[Xs,s("span",el,"共 "+p(((w=a.devices)==null?void 0:w.length)||0)+" 台设备",1)]),o(Ve,{data:a.devices,border:"",size:"small",onSelectionChange:u=>gt(u,a.id),class:"device-table"},{default:n(()=>[o(V,{type:"selection",width:"55"}),o(V,{prop:"imei",label:"IMEI","min-width":"150"}),o(V,{prop:"model",label:"设备型号","min-width":"120"}),o(V,{prop:"final_price",label:"最终价格",width:"100"},{default:n(({row:u})=>[s("span",tl,p(it(u.final_price)),1)]),_:2},1024),o(V,{prop:"status_name",label:"状态",width:"100"},{default:n(({row:u})=>[o(Y,{type:tt(u.status),size:"small"},{default:n(()=>[y(p(u.status_name),1)]),_:2},1032,["type"])]),_:2},1024),o(V,{label:"操作","min-width":"280"},{default:n(({row:u})=>[o(ye,null,{default:n(()=>[u.status===1&&mt(u.order_id)>1?(_(),x(i,{key:0,type:"primary",size:"small",icon:m(Pe),onClick:L=>pt(u)},{default:n(()=>[y(" 开始质检 ")]),_:2},1032,["icon","onClick"])):R("",!0),u.status==2||u.status==3?(_(),x(i,{key:1,type:"success",size:"small",icon:m(Be),onClick:L=>Se(u)},{default:n(()=>[y(" 定价 ")]),_:2},1032,["icon","onClick"])):R("",!0),u.status==4?(_(),x(i,{key:2,type:"primary",size:"small",icon:m(Ue),onClick:L=>yt(u.id)},{default:n(()=>[y(" 确认 ")]),_:2},1032,["icon","onClick"])):R("",!0),u.status==4?(_(),x(i,{key:3,type:"warning",size:"small",icon:m(Zt),onClick:L=>Se(u)},{default:n(()=>[y(" 重新定价 ")]),_:2},1032,["icon","onClick"])):R("",!0),u.status==4?(_(),x(i,{key:4,type:"danger",size:"small",icon:m(Oe),onClick:L=>ht(u.id)},{default:n(()=>[y(" 拒绝 ")]),_:2},1032,["icon","onClick"])):R("",!0),u.status>=3?(_(),x(i,{key:5,type:"info",size:"small",icon:m(Xt),onClick:L=>Vt(u)},{default:n(()=>[y(" 打印标签 ")]),_:2},1032,["icon","onClick"])):R("",!0)]),_:2},1024),o(i,{type:"primary",link:"",icon:m($e),onClick:L=>kt(u),size:"small",class:"ml-2"},{default:n(()=>[y(" 查看详情 ")]),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:2},1032,["data","onSelectionChange"]),G.value[a.id]&&G.value[a.id].length>0&&a.status==4?(_(),P("div",al,[o(ye,null,{default:n(()=>[o(i,{type:"primary",size:"small",icon:m(Ue),onClick:u=>bt(a.id)},{default:n(()=>[y(" 批量确认 ("+p(G.value[a.id].length)+") ",1)]),_:2},1032,["icon","onClick"])]),_:2},1024)])):R("",!0)])]}),_:1}),o(V,{label:"订单信息","min-width":"200"},{default:n(({row:a})=>[s("div",sl,[s("div",ll,[il,s("span",ol,p(a.order_no),1)]),s("div",rl,[nl,s("span",cl,[o(Y,{size:"small",type:a.delivery_type==="1"?"warning":"success"},{default:n(()=>[y(p(a.delivery_type==="1"?"📦 快递":"🚗 自送"),1)]),_:2},1032,["type"])])]),a.delivery_type==="1"?(_(),P("div",dl,[ul,s("span",{class:"flex-1 cursor-pointer transition-all duration-300 ease-in-out rounded px-1 py-0.5 hover:bg-blue-50 hover:text-blue-600 text-gray-800 text-sm break-all",onClick:w=>Mt(a),onMouseleave:At},[X.value[a.id]?(_(),x(l,{key:1,class:"animate-spin text-blue-500"},{default:n(()=>[o(m(ea))]),_:1})):(_(),P("span",ml,p(a.express_no||"暂无"),1)),a.express_no&&!X.value[a.id]?(_(),x(l,{key:2,class:"ml-1 text-gray-400 text-xs"},{default:n(()=>[o(m(K))]),_:1})):R("",!0)],40,_l)])):R("",!0)])]),_:1}),o(V,{label:"用户信息","min-width":"150"},{default:n(({row:a})=>{var w,u,L,Ie,Me;return[s("div",pl,[s("div",vl,[o(Lt,{size:32,src:(w=a.member)!=null&&w.headimg?m(ta)(a.member.headimg):"",class:"mr-2"},{default:n(()=>[o(l,null,{default:n(()=>[o(m(Le))]),_:1})]),_:2},1032,["src"])]),s("div",fl,[s("div",gl,p(((u=a.recycleUserAddress)==null?void 0:u.name)||((L=a.member)==null?void 0:L.nickname)||"未知用户"),1),s("div",yl,p(((Ie=a.member)==null?void 0:Ie.mobile)||((Me=a.recycleUserAddress)==null?void 0:Me.mobile)||"暂无联系方式"),1)])])]}),_:1}),o(V,{width:"140",align:"center"},{header:n(()=>[hl]),default:n(({row:a})=>[a.count==_e(a.devices)?(_(),x(Y,{key:0,type:"success",class:"device-count-tag"},{default:n(()=>[y(p(a.count)+"/ "+p(_e(a.devices))+"台 ",1)]),_:2},1024)):(_(),x(Y,{key:1,type:"danger",class:"device-count-tag"},{default:n(()=>[y(p(a.count)+"/ "+p(_e(a.devices))+"台 ",1)]),_:2},1024))]),_:1}),o(V,{label:"状态",width:"120",align:"center"},{default:n(({row:a})=>[o(Y,{type:Xe(a.status),effect:et(a.status)},{default:n(()=>[o(l,{class:"mr-1"},{default:n(()=>[(_(),x(be(ue(a.status))))]),_:2},1024),y(" "+p(a.status_name),1)]),_:2},1032,["type","effect"])]),_:1}),o(V,{prop:"create_at",label:"创建时间",width:"180"}),o(V,{label:"操作",width:"200",fixed:"right"},{default:n(({row:a})=>{var w;return[(w=S.value[a.status])!=null&&w.action?(_(),x(ye,{key:0},{default:n(()=>[(_(!0),P(se,null,le(S.value[a.status].action,u=>(_(),x(i,{key:u.key,size:"small",type:st(u.key),icon:lt(u.key),onClick:L=>rt(a,u)},{default:n(()=>[y(p(u.value),1)]),_:2},1032,["type","icon","onClick"]))),128))]),_:2},1024)):R("",!0)]}),_:1})]),_:1},8,["data","expand-row-keys"])),[[jt,I.value]]),s("div",bl,[s("div",xl," 共 "+p(m(f).total)+" 条记录，当前第 "+p(m(f).page)+" 页 ",1),o(Pt,{"current-page":m(f).page,"onUpdate:current-page":e[11]||(e[11]=a=>m(f).page=a),"page-sizes":[15,30,50,100],"page-size":m(f).limit,total:m(f).total,"hide-on-single-page":!1,layout:"  sizes, prev, pager, next, jumper",onSizeChange:He,onCurrentChange:We},null,8,["current-page","page-size","total"])])]),_:1}),o(Ka,{visible:pe.value,"onUpdate:visible":e[12]||(e[12]=a=>pe.value=a),onSuccess:wt},null,8,["visible"]),o(Ga,{visible:h.value,"onUpdate:visible":e[13]||(e[13]=a=>h.value=a),"device-list":z.value,"order-id":C.value,onConfirm:Tt,onAddDevice:Ye,onEditDevice:Ke,onRemoveDevice:Je,onCancel:Qe},null,8,["visible","device-list","order-id"]),o(Aa,{visible:Q.value,"onUpdate:visible":e[14]||(e[14]=a=>Q.value=a),device:ee.value,onConfirm:vt},null,8,["visible","device"]),o(qa,{visible:q.value,"onUpdate:visible":e[15]||(e[15]=a=>q.value=a),device:ee.value,onConfirm:ft},null,8,["visible","device"]),o(Ha,{visible:me.value,"onUpdate:visible":e[16]||(e[16]=a=>me.value=a),device:ve.value,onClosed:St},null,8,["visible","device"]),o(Qa,{visible:ce.value,"onUpdate:visible":e[17]||(e[17]=a=>ce.value=a),"order-detail":Ce.value},null,8,["visible","order-detail"]),o(Ja,{visible:b.value,"onUpdate:visible":e[18]||(e[18]=a=>b.value=a),"payment-info":U.value,onPaymentConfirmed:Et},null,8,["visible","payment-info"]),o($t,{modelValue:de.value,"onUpdate:modelValue":e[19]||(e[19]=a=>de.value=a),title:"快递物流信息",width:"600px","destroy-on-close":!0},{default:n(()=>[B.value?(_(),P("div",kl,[s("div",Cl,[s("div",wl,[s("div",null,[s("h3",Dl,p(B.value.logisticsCompanyName),1),s("p",El,"运单号："+p(B.value.mailNo),1)]),o(Y,{type:Rt(B.value.logisticsStatus),size:"large"},{default:n(()=>[y(p(B.value.logisticsStatusDesc),1)]),_:1},8,["type"])]),s("div",Sl,[s("p",Tl," 最新状态："+p(B.value.theLastMessage),1),s("p",Vl," 更新时间："+p(B.value.theLastTime),1)])]),s("div",Il,[Ml,o(Ot,null,{default:n(()=>[(_(!0),P(se,null,le(B.value.logisticsTraceDetailList,(a,w)=>(_(),x(Ut,{key:w,timestamp:a.timeDesc,type:w===0?"primary":"info",size:w===0?"large":"normal"},{default:n(()=>[s("div",Al,[s("div",Rl,p(a.areaName),1),s("div",zl,p(a.desc),1)])]),_:2},1032,["timestamp","type","size"]))),128))]),_:1})])])):(_(),P("div",Ll," 暂无快递信息 "))]),_:1},8,["modelValue"])])}}});const Ji=Za(Pl,[["__scopeId","data-v-b8190628"]]);export{Ji as default};
