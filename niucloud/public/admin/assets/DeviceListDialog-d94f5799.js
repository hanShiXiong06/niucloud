import{d as U,r as g,R as k,h as r,s as T,w as o,a as y,t as b,e as a,i as u,c as _,u as V,dN as M,dI as $,ah as j,$ as p,E as w,L as z,aj as J,dU as O,ak as A,V as G}from"./index-28ce54e5.js";/* empty css                  *//* empty css                   *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                        *//* empty css                        *//* empty css               *//* empty css                 *//* empty css                  */import{u as R}from"./recycle_order-836dc5c1.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";const F={class:"flex justify-between items-center"},H={class:"text-lg font-bold"},K={key:0},P={key:1},Q={key:0},W={key:1},X={class:"dialog-footer"},Y=U({__name:"DeviceListDialog",props:{visible:{type:Boolean,default:!1},orderId:{type:[String,Number],default:""},deviceList:{type:Array,default:()=>[]}},emits:["update:visible","success","closed","delete"],setup(D,{emit:m}){const d=D,n=g(d.visible),f=g(!1),s=g([]);k(()=>d.visible,e=>{n.value=e,e&&(s.value=JSON.parse(JSON.stringify(d.deviceList)))}),k(n,e=>{m("update:visible",e)});const E=()=>{s.value.push({imei:"",model:"",initial_price:0,editing:!0})},C=e=>{e.editing=!0},x=async e=>{try{!e.isNew&&e.id?(await j.confirm("确认删除该设备?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),m("delete",e.id)):(s.value=s.value.filter(l=>l!==e),p.success("已移除"))}catch(l){l!=="cancel"&&(console.error("删除设备失败：",l),p.error("删除失败"))}},B=async()=>{for(const e of s.value)if(!e.imei||!e.model){p.warning("请完善设备信息");return}try{f.value=!0;const e={order_id:d.orderId,devices:s.value.map(i=>({id:i.id,imei:i.imei,model:i.model,initial_price:i.initial_price}))},l=await R(String(d.orderId),e);if(l.code!==1)throw new Error(l.message||"操作失败");p.success("订单签收成功"),n.value=!1,m("success")}catch(e){console.error("保存设备信息失败：",e),p.error(e.message||"保存失败")}finally{f.value=!1}},I=()=>{m("closed")};return(e,l)=>{const i=w,h=z,v=J,N=O,L=A,S=G;return r(),T(S,{modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=t=>n.value=t),title:"设备信息确认",width:"800",center:"","destroy-on-close":!0,onClosed:I},{header:o(()=>[y("div",F,[y("span",H,"设备信息确认 , 共 "+b(s.value.length)+" 台 ",1),a(i,{type:"primary",onClick:E},{default:o(()=>[u("添加设备")]),_:1})])]),footer:o(()=>[y("div",X,[a(i,{onClick:l[0]||(l[0]=t=>n.value=!1)},{default:o(()=>[u("取消")]),_:1}),a(i,{type:"primary",onClick:B,loading:f.value},{default:o(()=>[u(" 确认并签收 ")]),_:1},8,["loading"])])]),default:o(()=>[a(L,{data:s.value,border:""},{default:o(()=>[a(v,{label:"IMEI"},{default:o(({row:t})=>[t.editing?(r(),_("div",K,[a(h,{modelValue:t.imei,"onUpdate:modelValue":c=>t.imei=c,placeholder:"请输入IMEI"},null,8,["modelValue","onUpdate:modelValue"])])):(r(),_("span",P,b(t.imei),1))]),_:1}),a(v,{label:"型号"},{default:o(({row:t})=>[t.editing?(r(),_("div",Q,[a(h,{modelValue:t.model,"onUpdate:modelValue":c=>t.model=c,placeholder:"请输入型号"},null,8,["modelValue","onUpdate:modelValue"])])):(r(),_("span",W,b(t.model),1))]),_:1}),a(v,{label:"操作",width:"120"},{default:o(({row:t})=>[a(N,null,{default:o(()=>[a(i,{type:"primary",size:"small",icon:V(M),onClick:c=>C(t)},{default:o(()=>[u(" 编辑 ")]),_:2},1032,["icon","onClick"]),a(i,{type:"danger",size:"small",icon:V($),onClick:c=>x(t)},{default:o(()=>[u(" 删除 ")]),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])}}});const _e=q(Y,[["__scopeId","data-v-e28bd5aa"]]);export{_e as default};
