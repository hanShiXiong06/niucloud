import{d as ee,y as te,f as ae,r as U,n as le,l as oe,q as c,h as s,c as v,e as u,w as d,u as b,b3 as se,Z as ne,s as g,a as _,t as h,F as T,W as P,i as D,C as V,x as re,bb as ue,$ as B,b4 as de,a9 as pe,L as ie,M as me,aD as ce,aE as ve,aF as _e,bD as fe,a4 as ye,a1 as be,N as ke,E as xe,a3 as ge}from"./index-6a69b8ba.js";/* empty css                   *//* empty css                  *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                          *//* empty css                    *//* empty css                       *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                *//* empty css                       */import{b as he,i as Ve,j as we,k as Ee}from"./printer-2b7f96e3.js";const Ue={class:"main-container"},Te={class:"flex"},Ce={class:"flex-1 mr-[20px] bg-[#fff]"},Ne={class:"panel-title !text-sm"},Fe={class:"panel-title !text-sm"},Pe={class:"panel-title !text-sm"},je={class:"flex"},De={class:"leading-[30px] w-[50px] text-center text-[#707070] bg-[#d7d7d7] border-1 border-solid border-[#ededed]"},Oe={key:4,class:"flex mr-[30px]"},Se=_("div",{class:"leading-[30px] w-[50px] text-center text-[#707070] bg-[#d7d7d7] border-1 border-solid border-[#ededed]"},"字号",-1),Be={key:5,class:"flex mr-[30px]"},Re=_("div",{class:"leading-[30px] w-[50px] text-center text-[#707070] bg-[#d7d7d7] border-1 border-solid border-[#ededed]"},"粗细",-1),ze={key:0,class:"text-[12px] text-[#b2b2b2] mt-[10px]"},Me={class:"panel-title !text-sm"},We={class:"fixed-footer-wrap"},$e={class:"fixed-footer"},ut=ee({__name:"template_edit",setup(Le){const R=te(),H=ae(),Z=R.meta.title,C=U(!1),N=U(!0),A={template_id:R.query.template_id||0,template_type:"",template_name:"",value:{}},e=le({...A}),z=U(),J=oe(()=>({template_name:[{required:!0,message:c("templateNamePlaceholder"),trigger:"blur"}],template_type:[{required:!0,message:c("templateTypePlaceholder"),trigger:"blur"}]})),M=Object.assign({}),W=Object.assign({});W&&Object.assign(M,W);const $={};for(const[r,o]of Object.entries(M)){const n=r.split("/").pop().split(".")[0];$[n]=o.default}const L=U(""),f=U([]),w=U([]);(async()=>{await he({}).then(r=>{r.data&&r.data.length&&(f.value=r.data,q(f.value[0].key,Boolean(parseInt(e.template_id)))),e.template_id||(N.value=!1)}),e.template_id&&Ve(e.template_id).then(r=>{let o=r.data;o&&Object.keys(o).length?(Object.keys(e).forEach(l=>{if(l=="value")for(let n in e[l])Object.assign(e[l][n],o[l][n]);else e[l]=o[l]}),N.value=!1):(B({type:"warning",duration:1500,message:c("printTemplateEmpty")}),setTimeout(()=>{j(),N.value=!1},2e3))})})();const q=(r,o=!1)=>{for(let l=0;l<f.value.length;l++)if(f.value[l].key==r){e.template_type=f.value[l].key,L.value=f.value[l].path,w.value=f.value[l].template;break}for(let l in e.value)delete e.value[l];K()},K=()=>{for(let r=0;r<w.value.length;r++){let o=w.value[r];e.value[o.key]={};for(let l=0;l<o.list.length;l++){let n=o.list[l];e.value[o.key][n.key]={type:n.type,value:n.value,status:n.status,fontSize:n.fontSize,fontWeight:n.fontWeight}}}},Q=async r=>{if(N.value||!r)return;if(f.value.length==0){B({type:"warning",message:c("printTypeEmpty")});return}let o=e.template_id?we:Ee;await r.validate(async l=>{if(l){let n=!1,E="";for(let y=0;y<w.value.length;y++){let m=w.value[y],k=!1;for(let x=0;x<m.list.length;x++){let i=m.list[x];if(e.value[m.key][i.key].status!=0){if(i.type=="input"){if(e.value[m.key][i.key].value==""){n=!0,E=`请输入${i.label}`,k=!0;break}}else if(i.type=="select"&&e.value[m.key][i.key].value==""){n=!0,E=`${i.label}未设置[${i.text}]`,k=!0;break}}}if(k)break}if(n){B({type:"warning",message:E});return}for(let y=0;y<w.value.length;y++){let m=w.value[y];for(let k=0;k<m.list.length;k++){let x=m.list[k];x.type=="checkbox"&&(e.value[m.key][x.key].value.length?e.value[m.key][x.key].status=1:e.value[m.key][x.key].status=0)}}if(C.value)return;C.value=!0,o(e).then(y=>{C.value=!1,e.template_id||j()}).catch(y=>{C.value=!1})}})},j=()=>{H.push("/printer/template/list")};return(r,o)=>{const l=de,n=pe,E=ie,O=me,y=ce,m=ve,k=_e,x=fe,i=ye,S=be,X=ke,G=xe,Y=ge;return s(),v("div",Ue,[u(n,{class:"card !border-none mb-[15px]",shadow:"never"},{default:d(()=>[u(l,{content:b(Z),icon:b(se),onBack:j},null,8,["content","icon"])]),_:1}),ne((s(),g(X,{class:"page-form",model:e,rules:b(J),"label-width":"150px",ref_key:"formRef",ref:z},{default:d(()=>[_("div",Te,[_("div",Ce,[u(n,{class:"box-card !border-none",shadow:"never"},{default:d(()=>[_("h3",Ne,h(b(c)("templateInfoLabel")),1),u(O,{label:b(c)("templateName"),prop:"template_name"},{default:d(()=>[u(E,{modelValue:e.template_name,"onUpdate:modelValue":o[0]||(o[0]=a=>e.template_name=a),modelModifiers:{trim:!0},clearable:"",placeholder:b(c)("templateNamePlaceholder"),class:"input-width",maxlength:"20"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),f.value.length?(s(),g(O,{key:0,label:b(c)("templateType"),prop:"template_type"},{default:d(()=>[u(m,{modelValue:e.template_type,"onUpdate:modelValue":o[1]||(o[1]=a=>e.template_type=a)},{default:d(()=>[(s(!0),v(T,null,P(f.value,a=>(s(),g(y,{key:a.key,label:a.key,onChange:q},{default:d(()=>[D(h(a.title),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):V("",!0)]),_:1}),f.value.length?(s(),g(n,{key:0,class:"box-card !border-none",shadow:"never"},{default:d(()=>[_("h3",Fe,h(b(c)("templateEditLabel")),1),(s(!0),v(T,null,P(w.value,a=>(s(),v("div",{key:a.key,class:"bg-[#f8f8f9] mb-[20px] py-[20px] px-[40px] text-[14px]"},[_("h4",Pe,h(a.title),1),(s(!0),v(T,null,P(a.list,(t,I)=>(s(),v("div",{key:t.key,class:"ml-[30px]",style:re({"margin-bottom":a.list.length==I+1?"0":"20px"})},[_("div",je,[t.label?(s(),g(k,{key:0,modelValue:e.value[a.key][t.key].status,"onUpdate:modelValue":p=>e.value[a.key][t.key].status=p,label:t.label,value:t.status,"true-value":1,"false-value":0,class:"w-[180px] mr-[10px]",disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","label","value","disabled"])):V("",!0),t.type=="input"?(s(),g(E,{key:1,modelValue:e.value[a.key][t.key].value,"onUpdate:modelValue":p=>e.value[a.key][t.key].value=p,modelModifiers:{trim:!0},clearable:"",placeholder:"请输入"+(t.placeholder?t.placeholder:t.label),class:"input-width mr-[30px]",maxlength:"32"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):V("",!0),t.type=="checkbox"?(s(),g(x,{key:2,modelValue:e.value[a.key][t.key].value,"onUpdate:modelValue":p=>e.value[a.key][t.key].value=p,class:"mr-[30px]"},{default:d(()=>[(s(!0),v(T,null,P(t.list,(p,F)=>(s(),g(k,{label:F,key:F,disabled:t.disabled},{default:d(()=>[D(h(p),1)]),_:2},1032,["label","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):V("",!0),t.type=="select"?(s(),v(T,{key:3},[_("div",De,h(t.text),1),u(S,{modelValue:e.value[a.key][t.key].value,"onUpdate:modelValue":p=>e.value[a.key][t.key].value=p,class:"!w-[130px] mr-[30px]"},{default:d(()=>[(s(!0),v(T,null,P(t.list,(p,F)=>(s(),g(i,{key:F,label:p,value:F},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])],64)):V("",!0),t.fontSize?(s(),v("div",Oe,[Se,u(S,{modelValue:e.value[a.key][t.key].fontSize,"onUpdate:modelValue":p=>e.value[a.key][t.key].fontSize=p,class:"!w-[130px]"},{default:d(()=>[u(i,{label:"小",value:"normal"}),u(i,{label:"大",value:"big"})]),_:2},1032,["modelValue","onUpdate:modelValue"])])):V("",!0),t.fontWeight?(s(),v("div",Be,[Re,u(S,{modelValue:e.value[a.key][t.key].fontWeight,"onUpdate:modelValue":p=>e.value[a.key][t.key].fontWeight=p,class:"!w-[130px]"},{default:d(()=>[u(i,{label:"正常",value:"normal"}),u(i,{label:"加粗",value:"bold"})]),_:2},1032,["modelValue","onUpdate:modelValue"])])):V("",!0)]),t.remark?(s(),v("div",ze,h(t.remark),1)):V("",!0)],4))),128))]))),128))]),_:1})):V("",!0)]),u(n,{class:"box-card !border-none w-[450px]",shadow:"never"},{default:d(()=>[_("h3",Me,h(b(c)("preview")),1),(s(),g(ue($[L.value]),{value:e.value},null,8,["value"]))]),_:1})])]),_:1},8,["model","rules"])),[[Y,N.value]]),_("div",We,[_("div",$e,[u(G,{type:"primary",loading:C.value,onClick:o[2]||(o[2]=a=>Q(z.value))},{default:d(()=>[D(h(b(c)("save")),1)]),_:1},8,["loading"]),u(G,{onClick:o[3]||(o[3]=a=>j())},{default:d(()=>[D(h(b(c)("cancel")),1)]),_:1})])])])}}});export{ut as default};
