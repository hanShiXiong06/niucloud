import{d as te,f as ae,y as le,n as F,l as oe,q as a,r as y,bS as x,h as p,c as _,e as o,w as s,a as v,t as i,u as l,i as m,C,F as M,W as A,s as g,Z as se,B as re,bT as ne,ah as ie,E as pe,b6 as de,L as ue,M as me,a4 as ce,a1 as fe,N as ye,a9 as _e,aj as ge,as as ve,ak as he,a2 as be,V as ke,a3 as Pe}from"./index-0b74b7aa.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                  */import{c as we,d as xe,m as Ce,f as Ve,h as Te,b as Ee,j as De}from"./poster-9f642d31.js";const Fe={class:"main-container"},Ne={class:"flex justify-between items-center"},$e={class:"text-page-title"},Be={key:0,class:"mt-[20px]"},Ue=v("span",{class:"!text-[14px]"},"检测到PHP未安装ImageMagick扩展，需安装后才能使用海报功能",-1),Re={key:0,class:"text-primary"},Se={key:1},Ie={class:"mt-[16px] flex justify-end"},ze={class:"dialog-footer"},je={key:0},qe=["src"],mt=te({__name:"list",setup(Le){const N=ae(),H=le().meta.title,b=F({}),c=F({name:"",type:""}),O=oe(()=>({name:[{required:!0,message:a("posterNamePlaceholder"),trigger:"blur"}],type:[{required:!0,message:a("posterTypePlaceholder"),trigger:"blur"}]})),$=y(),k=y(!1),W=async n=>{n&&await n.validate(async e=>{if(e){const u={type:c.type,name:c.name},E=N.resolve({path:"/poster/edit",query:u});window.open(E.href),k.value=!1,c.name="",c.type=""}})};(()=>{we({}).then(n=>{for(const e in b)delete b[e];for(const e in n.data)b[e]=n.data[e]})})();const r=F({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{name:"",type:""}}),B=y(),f=(n=1)=>{r.loading=!0,r.page=n,xe({page:r.page,limit:r.limit,...r.searchParam}).then(e=>{r.loading=!1,r.data=e.data.data,r.total=e.data.total,ne(r.page,r.limit,r.searchParam)}).catch(()=>{r.loading=!1})};f(x(r.searchParam).page);const Z=n=>{const e=N.resolve({path:"/poster/edit",query:{id:n.id}});window.open(e.href)},d=y(!1),U=(n,e)=>{d.value||(d.value=!0,Ce({id:n,status:e}).then(u=>{f(x(r.searchParam).page),d.value=!1}))},G=n=>{d.value||(d.value=!0,Ve({id:n}).then(e=>{f(x(r.searchParam).page),d.value=!1}))},J=n=>{ie.confirm(a("diyPosterDeleteTips"),a("warning"),{confirmButtonText:a("confirm"),cancelButtonText:a("cancel"),type:"warning"}).then(()=>{d.value||(d.value=!0,Te(n).then(()=>{f(x(r.searchParam).page),d.value=!1}).catch(()=>{d.value=!1}))})},V=y(!1),T=y(""),K=n=>{d.value||(d.value=!0,Ee({id:n.id,type:n.type}).then(e=>{e.data&&(T.value=e.data,V.value=!0),d.value=!1}))},Q=n=>{n&&(n.resetFields(),f())},R=y(!0);return(()=>{De().then(n=>{R.value=n.data})})(),(n,e)=>{const u=pe,E=de,S=ue,P=me,D=ce,I=fe,z=ye,j=_e,h=ge,q=ve,X=he,Y=be,L=ke,ee=Pe;return p(),_("div",Fe,[o(j,{class:"box-card !border-none",shadow:"never"},{default:s(()=>[v("div",Ne,[v("span",$e,i(l(H)),1),o(u,{type:"primary",class:"w-[100px]",onClick:e[0]||(e[0]=t=>k.value=!0)},{default:s(()=>[m(i(l(a)("添加海报")),1)]),_:1})]),!R.value&&!r.loading?(p(),_("div",Be,[o(E,{type:"warning","show-icon":"",closable:!1},{title:s(()=>[Ue]),_:1})])):C("",!0),o(j,{class:"box-card !border-none my-[10px] table-search-wrap",shadow:"never"},{default:s(()=>[o(z,{inline:!0,model:r.searchParam,ref_key:"searchFormDiyPosterRef",ref:B},{default:s(()=>[o(P,{label:l(a)("posterName"),prop:"name"},{default:s(()=>[o(S,{modelValue:r.searchParam.name,"onUpdate:modelValue":e[1]||(e[1]=t=>r.searchParam.name=t),modelModifiers:{trim:!0},placeholder:l(a)("posterNamePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(P,{label:l(a)("posterType"),prop:"type"},{default:s(()=>[o(I,{modelValue:r.searchParam.type,"onUpdate:modelValue":e[2]||(e[2]=t=>r.searchParam.type=t),placeholder:l(a)("posterTypePlaceholder")},{default:s(()=>[o(D,{label:l(a)("all"),value:""},null,8,["label"]),(p(!0),_(M,null,A(b,t=>(p(),g(D,{label:t.name,value:t.type,key:t.type},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),o(P,null,{default:s(()=>[o(u,{type:"primary",onClick:e[3]||(e[3]=t=>f())},{default:s(()=>[m(i(l(a)("search")),1)]),_:1}),o(u,{onClick:e[4]||(e[4]=t=>Q(B.value))},{default:s(()=>[m(i(l(a)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),se((p(),g(X,{data:r.data,size:"large"},{empty:s(()=>[v("span",null,i(r.loading?"":l(a)("emptyData")),1)]),default:s(()=>[o(h,{prop:"name",label:l(a)("posterName"),"min-width":"120"},null,8,["label"]),o(h,{prop:"type_name",label:l(a)("posterType"),"min-width":"80"},null,8,["label"]),o(h,{label:l(a)("status"),"min-width":"80"},{default:s(({row:t})=>[t.status==1?(p(),g(q,{key:0,type:"success",onClick:w=>U(t.id,0),class:"cursor-pointer"},{default:s(()=>[m(i(l(a)("启用")),1)]),_:2},1032,["onClick"])):(p(),g(q,{key:1,type:"info",onClick:w=>U(t.id,1),class:"cursor-pointer"},{default:s(()=>[m(i(l(a)("未启用")),1)]),_:2},1032,["onClick"]))]),_:1},8,["label"]),o(h,{label:l(a)("isDefault"),"min-width":"80"},{default:s(({row:t})=>[t.is_default==1?(p(),_("span",Re,i(l(a)("defaultPoster")),1)):(p(),_("span",Se,i(l(a)("noDefault")),1))]),_:1},8,["label"]),o(h,{prop:"update_time",label:l(a)("updateTime"),"min-width":"120"},null,8,["label"]),o(h,{label:l(a)("operation"),fixed:"right",align:"right","min-width":"160"},{default:s(({row:t})=>[o(u,{type:"primary",link:"",onClick:w=>K(t)},{default:s(()=>[m(i(l(a)("preview")),1)]),_:2},1032,["onClick"]),t.is_default==0?(p(),g(u,{key:0,type:"primary",link:"",onClick:w=>G(t.id)},{default:s(()=>[m(i(l(a)("modifyDefault")),1)]),_:2},1032,["onClick"])):C("",!0),o(u,{type:"primary",link:"",onClick:w=>Z(t)},{default:s(()=>[m(i(l(a)("edit")),1)]),_:2},1032,["onClick"]),t.is_default==0?(p(),g(u,{key:1,type:"primary",link:"",onClick:w=>J(t.id)},{default:s(()=>[m(i(l(a)("delete")),1)]),_:2},1032,["onClick"])):C("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[ee,r.loading]]),v("div",Ie,[o(Y,{"current-page":r.page,"onUpdate:current-page":e[5]||(e[5]=t=>r.page=t),"page-size":r.limit,"onUpdate:page-size":e[6]||(e[6]=t=>r.limit=t),layout:"total, sizes, prev, pager, next, jumper",total:r.total,onSizeChange:e[7]||(e[7]=t=>f()),onCurrentChange:f},null,8,["current-page","page-size","total"])])]),_:1}),o(L,{modelValue:k.value,"onUpdate:modelValue":e[12]||(e[12]=t=>k.value=t),title:l(a)("addPosterTitle"),width:"350px","destroy-on-close":"true"},{footer:s(()=>[v("span",ze,[o(u,{onClick:e[10]||(e[10]=t=>k.value=!1)},{default:s(()=>[m(i(l(a)("cancel")),1)]),_:1}),o(u,{type:"primary",onClick:e[11]||(e[11]=t=>W($.value))},{default:s(()=>[m(i(l(a)("confirm")),1)]),_:1})])]),default:s(()=>[o(z,{model:c,"label-width":"90px",ref_key:"formRef",ref:$,rules:l(O)},{default:s(()=>[o(P,{label:l(a)("posterName"),prop:"name"},{default:s(()=>[o(S,{modelValue:c.name,"onUpdate:modelValue":e[8]||(e[8]=t=>c.name=t),modelModifiers:{trim:!0},placeholder:l(a)("posterNamePlaceholder"),clearable:"",maxlength:"12","show-word-limit":"",class:"w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(P,{label:l(a)("posterType"),prop:"type"},{default:s(()=>[o(I,{modelValue:c.type,"onUpdate:modelValue":e[9]||(e[9]=t=>c.type=t),placeholder:l(a)("posterTypePlaceholder"),class:"!w-full"},{default:s(()=>[(p(!0),_(M,null,A(b,t=>(p(),g(D,{label:t.name,value:t.type,key:t.type},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),o(L,{modelValue:V.value,"onUpdate:modelValue":e[13]||(e[13]=t=>V.value=t),title:l(a)("previewDialogTitle"),width:"400px",height:"640px"},{default:s(()=>[T.value?(p(),_("div",je,[v("img",{src:l(re)(T.value),class:"w-[360px] h-[640px]"},null,8,qe)])):C("",!0)]),_:1},8,["modelValue","title"])])}}});export{mt as default};
