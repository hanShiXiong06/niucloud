import{d as W,r as y,l as F,n as Z,R as q,q as r,h as V,c as h,e as a,w as o,a as p,i as n,t as c,u as s,Z as m,_,s as z,F as A,W as H,C as N,L as J,M as Q,aD as X,aE as Y,b7 as ee,U as le,N as ae,E as te,V as oe,a3 as re}from"./index-28ce54e5.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                  *//* empty css                *//* empty css                     */import{_ as se}from"./index.vue_vue_type_style_index_0_lang-f699b98f.js";/* empty css                  *//* empty css                       *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                 */import{c as pe,e as de,f as ie,h as ne}from"./app-5ad1d286.js";import{_ as ue}from"./generate-sing-cert.vue_vue_type_script_setup_true_lang-108bdea4.js";const ce={class:"h-[400px]"},me={class:"form-tip"},_e={class:"h-[400px]"},fe={class:"input-width"},ge={key:0,class:"form-tip"},ve={key:1,class:"form-tip"},be={class:"input-width"},ye={class:"form-tip !leading-[1.5]"},Ve=p("div",{class:"form-tip !leading-[1.5]"},"只支持上传.zip 在drawable的根目录进行压缩",-1),we={class:"form-tip"},ke={class:"form-tip !leading-[1.5]"},he={class:"form-tip flex items-center"},Ce={class:"input-width"},Ue={class:"dialog-footer"},Le=W({__name:"app-version-edit",emits:["complete"],setup(xe,{expose:R,emit:T}){const b=y(!1),f=y(!1),x=y({}),v=y(1),P=y(null);(async()=>{await pe().then(({data:u})=>{x.value=u,C.platform=Object.keys(u)[0]})})();const $=F(()=>e.upgrade_type=="app"?".apk":e.upgrade_type=="hot"?".wgt":""),C={id:"",version_code:"",version_name:"",version_desc:"",platform:"",is_forced_upgrade:0,package_path:"",package_type:"file",upgrade_type:"app",build:{icon:""},cert:{type:"public",file:"",key_alias:"",key_password:"",store_password:""}},e=Z({...C}),E=y();q(()=>e.upgrade_type,()=>{(e.upgrade_type=="app"||e.upgrade_type=="hot")&&(e.package_type="file"),e.package_path="",e.cert.type="public"});const S=F(()=>({version_code:[{required:!0,message:r("versionCodePlaceholder"),trigger:"blur"},{trigger:"blur",validator:(u,l,d)=>{isNaN(l)||!/^\d{0,10}$/.test(l)?d(new Error(r("versionCodeTips"))):l<0?d(new Error(r("versionCodeTips"))):d()}}],version_name:[{required:!0,message:r("versionNamePlaceholder"),trigger:"blur"}],package_path:[{required:e.upgrade_type!="market"&&e.package_type=="file",message:"请上传资源文件",trigger:"blur"},{required:e.upgrade_type=="market",message:"请输入应用市场链接",trigger:"blur"}],"build.icon":[{required:e.package_type=="cloud",message:"请上传图标文件",trigger:"blur"}],"cert.file":[{required:e.package_type=="cloud"&&e.cert.type=="private",message:"请上传证书文件",trigger:"blur"}],"cert.key_alias":[{required:e.package_type=="cloud"&&e.cert.type=="private",message:"请输入证书别名",trigger:"blur"}],"cert.key_password":[{required:e.package_type=="cloud"&&e.cert.type=="private",message:"请上传证书密码",trigger:"blur"}],"cert.store_password":[{required:e.package_type=="cloud"&&e.cert.type=="private",message:"请上传证书库密码",trigger:"blur"}]})),B=async u=>{if(f.value||!u)return;const l=e.id?de:ie;await u.validate(async d=>{d&&(f.value=!0,l(e).then(i=>{f.value=!1,b.value=!1,T("complete")}).catch(()=>{f.value=!1}))})},O=async(u=null)=>{if(Object.assign(e,C),f.value=!0,u){const l=await(await ne(u.id)).data;l&&Object.keys(e).forEach(d=>{l[d]!=null&&(e[d]=l[d])})}f.value=!1};q(()=>b.value,()=>{v.value=1});const D=u=>{window.open(u)};return R({showDialog:b,setFormData:O}),(u,l)=>{const d=J,i=Q,g=X,w=Y,j=ee,U=se,I=le,L=ae,k=te,G=oe,K=re;return V(),h(A,null,[a(G,{modelValue:b.value,"onUpdate:modelValue":l[22]||(l[22]=t=>b.value=t),title:e.id?s(r)("updateAppVersion"):s(r)("addAppVersion"),width:"60%",class:"diy-dialog-wrap","destroy-on-close":!0},{footer:o(()=>[p("span",Ue,[a(k,{onClick:l[18]||(l[18]=t=>b.value=!1)},{default:o(()=>[n(c(s(r)("cancel")),1)]),_:1}),m(p("view",null,[a(k,{type:"primary",class:"ml-3",onClick:l[19]||(l[19]=t=>v.value=2)},{default:o(()=>[n(c(s(r)("next")),1)]),_:1})],512),[[_,v.value==1]]),m(p("view",null,[a(k,{type:"primary",class:"ml-3",onClick:l[20]||(l[20]=t=>v.value=1)},{default:o(()=>[n(c(s(r)("prev")),1)]),_:1}),a(k,{type:"primary",loading:f.value,onClick:l[21]||(l[21]=t=>B(E.value))},{default:o(()=>[n(c(s(r)("confirm")),1)]),_:1},8,["loading"])],512),[[_,v.value==2]])])]),default:o(()=>[m((V(),z(L,{model:e,"label-width":"120px",ref_key:"formRef",ref:E,rules:s(S),class:"page-form"},{default:o(()=>[m(p("div",ce,[a(i,{label:s(r)("versionName"),prop:"version_name"},{default:o(()=>[a(d,{modelValue:e.version_name,"onUpdate:modelValue":l[0]||(l[0]=t=>e.version_name=t),clearable:"",placeholder:s(r)("versionNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(i,{label:s(r)("versionCode"),prop:"version_code"},{default:o(()=>[a(d,{modelValue:e.version_code,"onUpdate:modelValue":l[1]||(l[1]=t=>e.version_code=t),clearable:"",placeholder:s(r)("versionCodePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"]),p("div",me,c(s(r)("versionCodeTips")),1)]),_:1},8,["label"]),a(i,{label:s(r)("versionDesc"),prop:"version_desc"},{default:o(()=>[a(d,{modelValue:e.version_desc,"onUpdate:modelValue":l[2]||(l[2]=t=>e.version_desc=t),type:"textarea",rows:"6",clearable:"",placeholder:s(r)("versionDescPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(i,{label:s(r)("platform"),prop:"platform"},{default:o(()=>[a(w,{modelValue:e.platform,"onUpdate:modelValue":l[3]||(l[3]=t=>e.platform=t)},{default:o(()=>[(V(!0),h(A,null,H(x.value,(t,M)=>(V(),z(g,{label:M,size:"large"},{default:o(()=>[n(c(t),1)]),_:2},1032,["label"]))),256))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(i,{label:s(r)("isForcedUpgrade"),prop:"is_forced_upgrade"},{default:o(()=>[a(j,{modelValue:e.is_forced_upgrade,"onUpdate:modelValue":l[4]||(l[4]=t=>e.is_forced_upgrade=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1},8,["label"])],512),[[_,v.value==1]]),m(p("div",_e,[a(I,null,{default:o(()=>[a(i,{label:s(r)("upgradeType")},{default:o(()=>[a(w,{modelValue:e.upgrade_type,"onUpdate:modelValue":l[5]||(l[5]=t=>e.upgrade_type=t)},{default:o(()=>[a(g,{label:"app",size:"large"},{default:o(()=>[n("APP整包升级")]),_:1}),a(g,{label:"hot",size:"large"},{default:o(()=>[n("wgt资源包升级")]),_:1}),a(g,{label:"market",size:"large"},{default:o(()=>[n("应用市场升级")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),m(a(i,{label:s(r)("resourceFile")},{default:o(()=>[a(w,{modelValue:e.package_type,"onUpdate:modelValue":l[6]||(l[6]=t=>e.package_type=t)},{default:o(()=>[a(g,{label:"file",size:"large"},{default:o(()=>[n("上传资源包")]),_:1}),a(g,{label:"cloud",size:"large"},{default:o(()=>[n("云打包")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),[[_,e.upgrade_type=="app"]]),m(p("div",null,[a(i,{label:"",prop:"package_path"},{default:o(()=>[p("div",fe,[a(U,{modelValue:e.package_path,"onUpdate:modelValue":l[7]||(l[7]=t=>e.package_path=t),accept:s($),api:"sys/document/app_package"},null,8,["modelValue","accept"])]),e.upgrade_type=="app"?(V(),h("div",ge,c(s(r)("androidResourceFileTips")),1)):N("",!0),e.upgrade_type=="hot"?(V(),h("div",ve,c(s(r)("iosResourceFileTips")),1)):N("",!0)]),_:1})],512),[[_,e.package_type=="file"&&e.upgrade_type!="market"]]),m(p("div",null,[a(i,{label:"应用市场链接",prop:"package_path"},{default:o(()=>[a(d,{modelValue:e.package_path,"onUpdate:modelValue":l[8]||(l[8]=t=>e.package_path=t),clearable:"",class:"input-width"},null,8,["modelValue"])]),_:1})],512),[[_,e.upgrade_type=="market"]]),m(p("div",null,[a(i,{label:s(r)("icon"),prop:"build.icon"},{default:o(()=>[p("div",be,[a(U,{modelValue:e.build.icon,"onUpdate:modelValue":l[9]||(l[9]=t=>e.build.icon=t),accept:".zip",api:"sys/document/applet"},null,8,["modelValue"])]),p("div",ye,[n("应用图标和启动界面图片 icon.png为应用的图标 push.png为推送消息的图标 splash.png为应用启动页的图标 将icon.png、push.png、splash.png放置到drawable，drawable-ldpi，drawable-mdpi，drawable-hdpi，drawable-xhdpi，drawable-xxhdpi文件夹下压缩成压缩包上传， 具体详情可查看 "),p("span",{class:"text-primary cursor-pointer",onClick:l[10]||(l[10]=t=>D("https://nativesupport.dcloud.net.cn/AppDocs/usesdk/android.html"))},"uniapp App离线打包"),n("中“配置应用图标和启动界面”片段")]),Ve]),_:1},8,["label"]),a(i,{label:s(r)("certType")},{default:o(()=>[a(w,{modelValue:e.cert.type,"onUpdate:modelValue":l[11]||(l[11]=t=>e.cert.type=t)},{default:o(()=>[a(g,{label:"public",size:"large"},{default:o(()=>[n("公共证书")]),_:1}),a(g,{label:"private",size:"large"},{default:o(()=>[n("自有证书")]),_:1})]),_:1},8,["modelValue"]),p("div",we,c(s(r)("publicCertTips")),1),p("div",ke,[n(c(s(r)("privateCertTips")),1),p("span",{class:"text-primary cursor-pointer",onClick:l[12]||(l[12]=t=>D("https://ask.dcloud.net.cn/article/35777"))},"《Android平台签名证书说明》")]),p("div",he,[n("证书可以自己生成也可通过niucloud提供的"),p("span",{class:"text-primary cursor-pointer",onClick:l[13]||(l[13]=t=>P.value.open())},"证书生成工具生成")])]),_:1},8,["label"]),m(p("div",null,[a(i,{label:s(r)("certFile"),prop:"cert.file"},{default:o(()=>[p("div",Ce,[a(U,{modelValue:e.cert.file,"onUpdate:modelValue":l[14]||(l[14]=t=>e.cert.file=t),accept:"",api:"sys/document/android_cert"},null,8,["modelValue"])])]),_:1},8,["label"]),a(i,{label:s(r)("certAlias"),prop:"cert.key_alias"},{default:o(()=>[a(d,{modelValue:e.cert.key_alias,"onUpdate:modelValue":l[15]||(l[15]=t=>e.cert.key_alias=t),clearable:"",placeholder:s(r)("versionDescPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(i,{label:s(r)("certKeyPassword"),prop:"cert.key_password"},{default:o(()=>[a(d,{modelValue:e.cert.key_password,"onUpdate:modelValue":l[16]||(l[16]=t=>e.cert.key_password=t),clearable:"",placeholder:s(r)("versionDescPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(i,{label:s(r)("certStorePassword"),prop:"cert.store_password"},{default:o(()=>[a(d,{modelValue:e.cert.store_password,"onUpdate:modelValue":l[17]||(l[17]=t=>e.cert.store_password=t),clearable:"",placeholder:s(r)("versionDescPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],512),[[_,e.cert.type=="private"]])],512),[[_,e.package_type=="cloud"]])]),_:1})],512),[[_,v.value==2]])]),_:1},8,["model","rules"])),[[K,f.value]])]),_:1},8,["modelValue","title"]),a(ue,{ref_key:"generateSingCertRef",ref:P},null,512)],64)}}});export{Le as _};
