import{d as se,r as n,R as A,aZ as oe,cF as te,a5 as ne,h as m,s as K,w as l,a as r,e,i as x,u as F,Y as re,c as y,F as ue,W as ie,t as C,C as k,dI as ce,D as de,dJ as me,$ as d,ah as ve,a0 as _e,E as pe,L as fe,cQ as ye,M as be,aD as he,aE as ge,N as we,V as xe,p as ke,g as Ee}from"./index-9cfed1fc.js";/* empty css                  *//* empty css                   *//* empty css                *//* empty css                       *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                  *//* empty css                 *//* empty css                  */import{g as Ve,c as Ce}from"./recycle_order-54bfc2b8.js";import{_ as Ie}from"./_plugin-vue_export-helper-c27b6911.js";const Me=b=>(ke("data-v-2ca7d0bf"),b=b(),Ee(),b),Be={class:"member-select"},Se={key:0,class:"search-results"},Te=["onClick"],De={class:"flex items-center"},Fe={class:"member-info"},Ne={class:"member-name"},Oe={class:"member-mobile"},Re={key:1,class:"selected-member"},Ue={class:"flex items-center justify-between"},$e={class:"flex items-center"},ze={class:"member-info"},Ae={class:"member-name"},Ke={class:"member-mobile"},Le={class:"express-input-wrapper"},Ze={key:0,class:"scan-tip"},qe=Me(()=>r("span",null,"准备扫码中，请对准条码...",-1)),Pe={class:"dialog-footer"},je=se({__name:"AddOrderDialog",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","success","closed"],setup(b,{emit:I}){const M=b,p=n(M.visible),B=n(!1),a=n({member_id:"",delivery_type:"1",express_no:""}),f=n(""),v=n([]),E=n(1),N=n(10),O=n(!1),u=n(null),h=n(null),S=n(null),c=n(!1),V=n(""),g=n(null);A(()=>M.visible,o=>{p.value=o}),A(p,o=>{I("update:visible",o)});const L=()=>{h.value&&clearTimeout(h.value),h.value=window.setTimeout(()=>{f.value?T():v.value=[]},300)},T=async()=>{if(!f.value){v.value=[];return}try{const o={page:E.value,page_size:N.value,keyword:f.value},s=await Ve(o.keyword);s.code===1?(v.value=s.data.data||[],O.value=s.data.count>E.value*N.value):d.error(s.message||"搜索会员失败")}catch(o){console.error("搜索会员失败:",o),d.error("搜索会员失败")}},Z=async()=>{E.value++,await T()},q=o=>{u.value=o,a.value.member_id=o.member_id,v.value=[]},P=()=>{u.value=null,a.value.member_id=""},j=()=>{S.value&&(S.value.$el.querySelector("input").focus(),c.value=!0,d.info("请将扫码枪对准条码进行扫描"))},G=()=>{c.value=!0},J=()=>{window.setTimeout(()=>{c.value=!1},100)},Q=o=>{c.value&&o.key==="Enter"&&a.value.express_no&&(d.success("扫码成功："+a.value.express_no),c.value=!1)},R=o=>{c.value&&(g.value&&clearTimeout(g.value),g.value=window.setTimeout(()=>{V.value&&(a.value.express_no=V.value,V.value="",d.success("扫码成功："+a.value.express_no),c.value=!1)},100))};oe(()=>{window.addEventListener("keydown",R)}),te(()=>{window.removeEventListener("keydown",R),g.value&&clearTimeout(g.value),h.value&&clearTimeout(h.value)});const W=async()=>{var o,s;if(!a.value.member_id){d.warning("请选择会员");return}if(a.value.delivery_type==="1"&&!a.value.express_no){d.warning("请输入快递单号");return}try{B.value=!0;const i=((o=u.value)==null?void 0:o.nickname)||((s=u.value)==null?void 0:s.username)||"所选会员";await ve.confirm(`确定要为用户 "${i}" 创建回收订单吗？`,"创建订单确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const _={member_id:a.value.member_id,delivery_type:a.value.delivery_type,express_no:a.value.delivery_type==="1"?a.value.express_no:""},w=await Ce(_);if(w.code!==1)throw new Error(w.message||"创建订单失败");d.success("创建订单成功"),U(),p.value=!1,I("success")}catch(i){if(i==="cancel")return;console.error("创建订单失败:",i),d.error(i.message||"创建订单失败")}finally{B.value=!1}},U=()=>{a.value={member_id:"",delivery_type:"1",express_no:""},u.value=null,f.value="",v.value=[],E.value=1,c.value=!1,V.value=""},Y=()=>{U(),I("closed")};return M.visible,(o,s)=>{const i=_e,_=pe,w=fe,$=ye,D=be,z=he,H=ge,X=ne("ZoomOut"),ee=we,ae=xe;return m(),K(ae,{modelValue:p.value,"onUpdate:modelValue":s[4]||(s[4]=t=>p.value=t),title:"代客户下单",width:"600px","destroy-on-close":!0,onClosed:Y},{footer:l(()=>[r("span",Pe,[e(_,{onClick:s[3]||(s[3]=t=>p.value=!1)},{default:l(()=>[x("取消")]),_:1}),e(_,{type:"primary",onClick:W,loading:B.value},{default:l(()=>[x("确定")]),_:1},8,["loading"])])]),default:l(()=>[e(ee,{ref:"formRef",model:a.value,"label-width":"100px"},{default:l(()=>[e(D,{label:"选择会员",required:""},{default:l(()=>[r("div",Be,[e(w,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=t=>f.value=t),placeholder:"输入会员手机号/昵称/用户名搜索",clearable:"",onInput:L},{append:l(()=>[e(_,{onClick:T},{default:l(()=>[e(i,null,{default:l(()=>[e(F(re))]),_:1})]),_:1})]),_:1},8,["modelValue"]),v.value.length>0?(m(),y("div",Se,[(m(!0),y(ue,null,ie(v.value,(t,le)=>(m(),y("div",{key:le,class:"search-result-item",onClick:Ge=>q(t)},[r("div",De,[e($,{size:30,src:t.headimg||""},null,8,["src"]),r("div",Fe,[r("div",Ne,C(t.nickname||t.username||"未设置昵称"),1),r("div",Oe,C(t.mobile||"未绑定手机"),1)])])],8,Te))),128)),O.value?(m(),y("div",{key:0,class:"search-result-more",onClick:Z}," 加载更多... ")):k("",!0)])):k("",!0),a.value.member_id&&u.value?(m(),y("div",Re,[r("div",Ue,[r("div",$e,[e($,{size:40,src:u.value.headimg||""},null,8,["src"]),r("div",ze,[r("div",Ae,C(u.value.nickname||u.value.username||"未设置昵称"),1),r("div",Ke,C(u.value.mobile||"未绑定手机"),1)])]),e(_,{link:"",type:"danger",onClick:P},{default:l(()=>[e(i,null,{default:l(()=>[e(F(ce))]),_:1})]),_:1})])])):k("",!0)])]),_:1}),e(D,{label:"下单方式"},{default:l(()=>[e(H,{modelValue:a.value.delivery_type,"onUpdate:modelValue":s[1]||(s[1]=t=>a.value.delivery_type=t)},{default:l(()=>[e(z,{label:"1"},{default:l(()=>[x("快递")]),_:1}),e(z,{label:"2"},{default:l(()=>[x("门店")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a.value.delivery_type==="1"?(m(),K(D,{key:0,label:"快递单号"},{default:l(()=>[r("div",Le,[e(w,{ref_key:"expressInput",ref:S,modelValue:a.value.express_no,"onUpdate:modelValue":s[2]||(s[2]=t=>a.value.express_no=t),placeholder:"请输入快递单号或使用扫码枪",onKeydown:de(Q,["enter"]),onFocus:G,onBlur:J},null,8,["modelValue","onKeydown"]),e(_,{type:"primary",onClick:j},{default:l(()=>[e(i,null,{default:l(()=>[e(X)]),_:1}),x(" 扫码 ")]),_:1})]),c.value?(m(),y("div",Ze,[e(i,null,{default:l(()=>[e(F(me),{class:"is-loading"})]),_:1}),qe])):k("",!0)]),_:1})):k("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])}}});const na=Ie(je,[["__scopeId","data-v-2ca7d0bf"]]);export{na as default};
